{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"5f65d6324a42138eb33e52b546963cf9f0982ed3","modified":1510710320000},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1508146036000},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1508146036000},{"_id":"themes/next/.gitignore","hash":"32ea93f21d8693d5d8fa4eef1c51a21ad0670047","modified":1508146036000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1508146036000},{"_id":"themes/next/.javascript_ignore","hash":"8a224b381155f10e6eb132a4d815c5b52962a9d1","modified":1508146036000},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1508146036000},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1508146036000},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1508146036000},{"_id":"themes/next/.travis.yml","hash":"c42d9608c8c7fe90de7b1581a8dc3886e90c179e","modified":1508146036000},{"_id":"themes/next/LICENSE","hash":"f293bcfcdc06c0b77ba13570bb8af55eb5c059fd","modified":1508146036000},{"_id":"themes/next/README.en.md","hash":"32d6cdfec1447f54aae1d7f1365ce6733dfcec8f","modified":1508146036000},{"_id":"themes/next/README.md","hash":"500b5606eb6a09c979d16128f8b00f4bf9bc95ac","modified":1508146036000},{"_id":"themes/next/bower.json","hash":"7d7938f9da896fe710aa0e9120140e528bf058df","modified":1508146036000},{"_id":"themes/next/_config.yml","hash":"ad953b7cdfe51f7e4a0671f2273ec6386fc803b8","modified":1510817900000},{"_id":"themes/next/gulpfile.coffee","hash":"031bffc483e417b20e90eceb6cf358e7596d2e69","modified":1508146036000},{"_id":"themes/next/package.json","hash":"193dad6f59a588908fac082cc46fe067dac1b84d","modified":1508146036000},{"_id":"source/tags/index.md","hash":"5c890fd947e675abc3ce2371a6ff2ff409362311","modified":1508146036000},{"_id":"source/_posts/.DS_Store","hash":"b64e0abfc9c276a3c8706904b0d04cd111a9ac8e","modified":1510660629000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock.md","hash":"3cac85d7be61545a0feacd380f153d5ed6a70e98","modified":1509362447000},{"_id":"source/_posts/Cobar-Enhance-cobar-dataSource-with-dataHost.md","hash":"71217ba6505c854437cbadf0445eedd92514dc78","modified":1509091392000},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability.md","hash":"d52fb6c369c769d9ddd91bbdab661bd6537d272f","modified":1509420726000},{"_id":"source/_posts/Cobar-Enhance-cobar-mysql-heartbeat.md","hash":"41fe5b2b079cb5383cbb9ce2043efe2b13cb35a2","modified":1509420925000},{"_id":"source/_posts/Cobar-FAQ.md","hash":"9560870f070d125ab7abdc2b289645cb636e6567","modified":1509075810000},{"_id":"source/_posts/Cobar-How-sql-executes-in-cobar.md","hash":"65ab30dce7a236b1e560837e35e74e4c00f51308","modified":1508146036000},{"_id":"source/_posts/Cobar-How-to-monitor-cobar.md","hash":"4bc59489ad21ca7b42448bc2fe1b26755e8c1384","modified":1508146036000},{"_id":"source/_posts/Cobar-NIO-client.md","hash":"e724361a2aea9af70ceda90a5d4afacfa9040a60","modified":1508401182000},{"_id":"source/_posts/Cobar-NIO-server.md","hash":"8e16fe3c0615adc4608f426394c651448c0c84c4","modified":1508401182000},{"_id":"source/_posts/Cobar-Reactor-design-pattern.md","hash":"416e44dded294d655e003859b2c530dd75ba4e17","modified":1509518039000},{"_id":"source/_posts/Curator-Distributed-lock.md","hash":"4bb9c799f4d5847b931c1784642537a66fe5c00c","modified":1509440183000},{"_id":"source/_posts/Curator-sync-and-mutual-exclusion-between-thread-and-process.md","hash":"adfb453524a26e4a44034718c4564ae02f55f2e8","modified":1509159037000},{"_id":"source/_posts/Distributed-Consensus-Raft.md","hash":"c1a9ed77ae882f4d52f5612d636201875d66c00f","modified":1510729946000},{"_id":"source/_posts/Distributed-Transaction.md","hash":"b7309aefb9e693efef7c6cfc81faffec72308739","modified":1510800105000},{"_id":"source/_posts/Distributed-Transaction-TCC.md","hash":"5fccc5aefe1b6d51aba39e7e0e6e9d61d9494c08","modified":1510313239000},{"_id":"source/_posts/Distributed-unique-id.md","hash":"b9e2f479f9400d4a3d2f6da9ad9c1a46bc3cbab2","modified":1511143560000},{"_id":"source/_posts/Guava-Black-techs.md","hash":"7570ad8c7bca4acf0127517dfa4571d386641874","modified":1509937314000},{"_id":"source/_posts/Interview-Questions.md","hash":"7206f6aa0ea89949d19a0cb1e1e6dd9fdbf2d2f1","modified":1511163801000},{"_id":"source/_posts/JVM-Atomic-operation.md","hash":"12070dbd5067002b4113ba5ef0fcc7ebf9cd67ac","modified":1510818929000},{"_id":"source/_posts/JVM-CAS-Campare-and-swap.md","hash":"ba68978c50138649b6e89570bdc1e15600d8756f","modified":1510907816000},{"_id":"source/_posts/JVM-Optimization.md","hash":"bef2606f42930f00d24c9fde2f4db8bc21723edf","modified":1510495505000},{"_id":"source/_posts/JVM-Lock.md","hash":"f35140fae0ee915cbb20cc4d39e37174fea0c1ed","modified":1510539209000},{"_id":"source/_posts/JVM-Profiling.md","hash":"ba1bfb41510f40b559a1f0bacc39fcbae4965e55","modified":1510040227000},{"_id":"source/_posts/JVM-Thread-interupt.md","hash":"d6b0d69bceb8489d3995c2aed22181f87bdeb94c","modified":1510231041000},{"_id":"source/_posts/Kafka-FAQ.md","hash":"392bb863de1320555b1cc35495e707854a708164","modified":1511170108000},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache.md","hash":"4177da42578f849dfe278e210391072f63a9863b","modified":1510883664000},{"_id":"source/_posts/Linux-Kernel-space-and-User-space.md","hash":"34df2ae8c7353b5a219c3fd49b5b32637dfe3a3b","modified":1511169726000},{"_id":"source/_posts/Linux-Mmap.md","hash":"8dd784e06617dd2570d4b94263d5c2b9bd372268","modified":1511231188000},{"_id":"source/_posts/Linux-Useful-command.md","hash":"8a821a542f0cf3910db8dfe6eff86baea9efc1d9","modified":1511231181000},{"_id":"source/_posts/Linux-Zero-Copy.md","hash":"b2b5f51dc2095d9b4a8107ecfac7bb83a8fae352","modified":1510821087000},{"_id":"source/_posts/Linux-sync-async-blocking-noblocking.md","hash":"32a9be289fd02b591573f3dc0f1c17dd3acb9591","modified":1510817176000},{"_id":"source/_posts/MySQL-Explain.md","hash":"8222c73362db2d7ea268314f0485b2337b83d32d","modified":1508146036000},{"_id":"source/_posts/Netty-Buffer-Allocator.md","hash":"e742f18d4b11e2f3b7f47ce5dcbe64428ea84655","modified":1510733291000},{"_id":"source/_posts/Netty-ChannelOption.md","hash":"c61a90f47f5b1963c4ae875d04949f08cd1a96d6","modified":1511230953000},{"_id":"source/_posts/Netty-FAQ.md","hash":"e4cbd89d7ec415492a0dc1e6829d7a1ecd37f469","modified":1511231106000},{"_id":"source/_posts/RocketMQ-Consumer-rebalance.md","hash":"1991347d1fb4e8279fb224f3a0aa519d332fd4d2","modified":1509440183000},{"_id":"source/_posts/RocketMQ-Delay-message-delivery.md","hash":"90c1dc23d003496f2326db87233e413868b83f3a","modified":1509003363000},{"_id":"source/_posts/RocketMQ-Debug-with-intellij.md","hash":"b9cadc44b342e4645d2d702cc2925d0caad3f330","modified":1508146036000},{"_id":"source/_posts/RocketMQ-FAQ.md","hash":"1243006f045d30bb9d933160b5a5a1289a4db081","modified":1511162290000},{"_id":"source/_posts/RocketMQ-Index-service.md","hash":"d3402cce575c215bc0aae7aeb3ae6dfceb6aec1f","modified":1509704403000},{"_id":"source/_posts/RocketMQ-Master-slave-high-availability.md","hash":"a528a5a68efcf7aa26fa47f985ede482f54fa08f","modified":1508146036000},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke.md","hash":"2c5fe3afb630894f98c782d82eebeb3ae1c89a37","modified":1508146036000},{"_id":"source/_posts/RocketMQ-Message-send-and-persistence.md","hash":"692a2f2c87b8ab09f0c8aa6316bb5c5c2a1670d0","modified":1511147311000},{"_id":"source/_posts/RocketMQ-Pull-message-with-long-polling.md","hash":"705aef0084f5c53f3dda8e4ce52555d09fd728bf","modified":1510207651000},{"_id":"source/_posts/RocketMQ-Remote-communication-protocol-and-serialization.md","hash":"6ad95fbfebf431b4006dcb3caea35a6f3bdac147","modified":1510797107000},{"_id":"source/_posts/SourceCode-Map.md","hash":"9dc4a53a977fd60c2b5157cd21fd6b35cf6042c9","modified":1510823446000},{"_id":"source/_posts/RocketMQ-Transactional-message.md","hash":"2d09f4fbd448438d8c0870d3c7ef29bfcf2faa11","modified":1509877004000},{"_id":"source/_posts/recipes-in-curator.md","hash":"65b1012602371f6e76db4b611ff74b50026a5bd5","modified":1508146036000},{"_id":"source/_posts/Thread-FAQ.md","hash":"4a5ba0e9013885fc510e21f8ceb431a34a1e532d","modified":1510733291000},{"_id":"source/_posts/tree-cache-single-thread-event-handler-in-curator.md","hash":"8b3e23dfb61e75106ed43aa07cf9dd1bdbd8060f","modified":1508146036000},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"3b5eafd32abb718e56ccf8d1cee0607ad8ce611d","modified":1508146036000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"b56c01cdfc6ee7ffea8a8a9fa149263f368caef6","modified":1508146036000},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"37bd0ec1d655c601946fc5f5ac2fe8ed1e529b77","modified":1508146036000},{"_id":"themes/next/languages/de.yml","hash":"306db8c865630f32c6b6260ade9d3209fbec8011","modified":1508146036000},{"_id":"themes/next/languages/default.yml","hash":"4cc6aeb1ac09a58330e494c8771773758ab354af","modified":1508146036000},{"_id":"themes/next/languages/en.yml","hash":"e7def07a709ef55684490b700a06998c67f35f39","modified":1508146036000},{"_id":"themes/next/languages/fr-FR.yml","hash":"24180322c83587a153cea110e74e96eacc3355ad","modified":1508146036000},{"_id":"themes/next/languages/id.yml","hash":"2835ea80dadf093fcf47edd957680973f1fb6b85","modified":1508146036000},{"_id":"themes/next/languages/ja.yml","hash":"1c3a05ab80a6f8be63268b66da6f19da7aa2c638","modified":1508146036000},{"_id":"themes/next/languages/ko.yml","hash":"be150543379150f78329815af427bf152c0e9431","modified":1508146036000},{"_id":"themes/next/languages/pt-BR.yml","hash":"958e49571818a34fdf4af3232a07a024050f8f4e","modified":1508146036000},{"_id":"themes/next/languages/pt.yml","hash":"36c8f60dacbe5d27d84d0e0d6974d7679f928da0","modified":1508146036000},{"_id":"themes/next/languages/ru.yml","hash":"1549a7c2fe23caa7cbedcd0aa2b77c46e57caf27","modified":1508146036000},{"_id":"themes/next/languages/zh-Hans.yml","hash":"3c0c7dfd0256457ee24df9e9879226c58cb084b5","modified":1508146036000},{"_id":"themes/next/languages/zh-hk.yml","hash":"1c917997413bf566cb79e0975789f3c9c9128ccd","modified":1508146036000},{"_id":"themes/next/languages/zh-tw.yml","hash":"0b2c18aa76570364003c8d1cd429fa158ae89022","modified":1508146036000},{"_id":"themes/next/layout/_layout.swig","hash":"06b1eab2e00273e0b94bd32dc682bd92c1e0a747","modified":1508146036000},{"_id":"themes/next/layout/archive.swig","hash":"383f64deab105724fd5512371963bd9e9aafbffd","modified":1508146036000},{"_id":"themes/next/layout/category.swig","hash":"4472255f4a3e3dd6d79201523a9526dcabdfbf18","modified":1508146036000},{"_id":"themes/next/layout/index.swig","hash":"03e8a2cda03bad42ac0cb827025eb81f95d496a2","modified":1508146036000},{"_id":"themes/next/layout/page.swig","hash":"37c874cd720acf0eda8d26e063278f2b6ae8d3a6","modified":1508146036000},{"_id":"themes/next/layout/post.swig","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1508146036000},{"_id":"themes/next/scripts/merge-configs.js","hash":"13c8b3a2d9fce06c2488820d9248d190c8100e0a","modified":1508146036000},{"_id":"themes/next/layout/schedule.swig","hash":"d86f8de4e118f8c4d778b285c140474084a271db","modified":1508146036000},{"_id":"themes/next/layout/tag.swig","hash":"7e0a7d7d832883eddb1297483ad22c184e4368de","modified":1508146036000},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1508146036000},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1508146037000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1508146037000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1508146037000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif","hash":"999dfe3ed086bd56471bddb697dd2dd70157cb31","modified":1509359731000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioSign.gif","hash":"6c1b820c2c71938b240d4bc5ac56691f2c538dca","modified":1509162805000},{"_id":"source/_posts/JVM-Lock/biased_lock_convert_flow.jpg","hash":"437ba37b1e9acdac50b4d813ddd6b44199cd035c","modified":1509949385000},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg","hash":"3a3bcb8193115780dd7568721270a217ba4499e9","modified":1510658278000},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1508146036000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1508146036000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"31322a7f57936cf2dc62e824af5490da5354cf02","modified":1508146036000},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"53d4f83b2b7fb4387dfc9fe81519abd56fbce4ae","modified":1508146036000},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"39852700e4084ecccffa6d4669168e5cc0514c9e","modified":1508146036000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"ce7094ee05878161e7568a6dfae5b56ff3fbd6e1","modified":1508146036000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"7172c6053118b7c291a56a7860128a652ae66b83","modified":1508146036000},{"_id":"themes/next/layout/_macro/reward.swig","hash":"5d5f70deb6074cb4dd0438463e14ccf89213c282","modified":1508146036000},{"_id":"themes/next/layout/_macro/post.swig","hash":"911363776867d9523a3e322cdf591d49cd166403","modified":1508146036000},{"_id":"themes/next/layout/_partials/head.swig","hash":"1f14d3f494b2dbbcee802fd6f6d1abd5b7e2304c","modified":1508146036000},{"_id":"themes/next/layout/_partials/header.swig","hash":"a1ffbb691dfad3eaf2832a11766e58a179003b8b","modified":1508146036000},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1508146036000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"faa7886ccf986890cd776f4e9d70cb89fe9fda5f","modified":1508146036000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1508146036000},{"_id":"themes/next/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1508146036000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1508146036000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1508146036000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9baf90f7c40b3b10f288e9268c3191e895890cea","modified":1508146036000},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1508146036000},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1508146036000},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1508146036000},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"fc93b1a7e6aed0dddb1f3910142b48d8ab61174e","modified":1508146036000},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1ddb2336a1a19b47af3017047012c01ec5f54529","modified":1508146036000},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1508146036000},{"_id":"themes/next/scripts/tags/button.js","hash":"62e6dbeb53d07627a048132c79630b45d9a8f2cc","modified":1508146036000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1508146036000},{"_id":"themes/next/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1508146036000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1508146036000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1508146036000},{"_id":"themes/next/scripts/tags/label.js","hash":"2f8f41a7316372f0d1ed6b51190dc4acd3e16fff","modified":1508146036000},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"eeeabede68cf263de9e6593ecf682f620da16f0a","modified":1508146036000},{"_id":"themes/next/scripts/tags/note.js","hash":"64de4e9d01cf3b491ffc7d53afdf148ee5ad9779","modified":1508146036000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"5786545d51c38e8ca38d1bfc7dd9e946fc70a316","modified":1508146036000},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1508146036000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1508146036000},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1508146036000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1508146036000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1508146036000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1508146036000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1508146036000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1508146036000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1508146036000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1508146036000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1508146036000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1508146036000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1508146036000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1508146036000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1508146036000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactorSign.gif","hash":"17ac291d666654f13097a9ab729adf5d329bd37a","modified":1508839203000},{"_id":"source/_posts/JVM-Lock/markword_state.jpg","hash":"59b1e2cd4dd8962ab1657d79ac8db8a8cd980d95","modified":1509948899000},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/read_write.gif","hash":"d8b58d9570bbe1056bbbb54d8e1d1b54f1c4870e","modified":1510660691000},{"_id":"source/_posts/RocketMQ-Index-service/index-file.gif","hash":"4ccabf0aed972624fd7a8c4648430c975af70f3c","modified":1509704498000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1508146036000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif","hash":"c2da1c2fc71056fb224ef0c0a276805206c7cbc6","modified":1509359774000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif","hash":"65ce3f933e03889174067eba323f00a55b13129e","modified":1509359754000},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif","hash":"76597fd5ef32d8ebdf1dee82ab29e1fe092c810a","modified":1509420210000},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif","hash":"75a442326aecac7ad3d959ef816cddec8b32dca4","modified":1509419189000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioRegister.gif","hash":"4aec07220806ec8f3168d58ef8ff62b885bba9c6","modified":1509162831000},{"_id":"source/_posts/Distributed-Transaction/transaction_rocketmq.gif","hash":"9a6c9cd908a78d62a435afdea7ac7bac702f4cd0","modified":1509677238000},{"_id":"source/_posts/RocketMQ-Transactional-message/transaction_rocketmq.gif","hash":"9a6c9cd908a78d62a435afdea7ac7bac702f4cd0","modified":1509677238000},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1508146036000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1508146036000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1508146036000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1508146036000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1508146036000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1508146036000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1508146036000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1508146036000},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"63315fcf210799f894208c9f512737096df84962","modified":1508146036000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1508146036000},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1508146036000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"a234c5cd1f75ca5731e814d0dbb92fdcf9240d1b","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"3358d11b9a26185a2d36c96049e4340e701646e4","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"fc65b9c98a0a8ab43a5e7aabff6c5f03838e09c8","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1508146036000},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c316758546dc9ba6c60cb4d852c17ca6bb6d6724","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"ee63aa2e49507b884a2d56778479cf01c723d751","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"8a2e393d2e49f7bf560766d8a07cd461bf3fce4f","modified":1508146036000},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"8b6650f77fe0a824c8075b2659e0403e0c78a705","modified":1508146036000},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1508146036000},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1508146036000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"385c066af96bee30be2459dbec8aae1f15d382f5","modified":1508146036000},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1508146036000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1508146036000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"82f9055955920ed88a2ab6a20ab02169abb2c634","modified":1508146036000},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1508146036000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"eaedfaf06dae94ba77a8f4893e2e434bf8859bac","modified":1508146036000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"d477196c5699c8261b08e993a77ef67054d86166","modified":1508146036000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"49b5210fa62d6cbc6a98f57d89d5067a06ab3561","modified":1508146036000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"c8d35a6b9e3bff6d8fdb66de853065af9d37562d","modified":1508146036000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"cfee25d790e4f9b7d57f0dc7e2ea9c1649f08f11","modified":1508146036000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"6117f97b4984b8e33f21c726132da64ba678e4ed","modified":1508146036000},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1508146036000},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1508146036000},{"_id":"themes/next/source/js/src/motion.js","hash":"dc0365b2fb315a8b43d3ef19b59d3a82a366fcc1","modified":1508146036000},{"_id":"themes/next/source/js/src/post-details.js","hash":"0693695a9512641daff63d99da772625a058ab18","modified":1508146036000},{"_id":"themes/next/source/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1508146036000},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1508146036000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1508146036000},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1508146036000},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1508146036000},{"_id":"themes/next/source/js/src/utils.js","hash":"2917c39c75b14b6dab7e1c46ab4d87b4df9fcd5d","modified":1508146036000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1508146036000},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"7fd2f3e2773555392ef40df40cae3bedb884f17a","modified":1508146036000},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1508146036000},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1508146036000},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1508146036000},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1508146036000},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1508146036000},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1508146037000},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1508146037000},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1508146037000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1508146037000},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1508146037000},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1508146037000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1508146037000},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1508146037000},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1508146037000},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1508146037000},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1508146037000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1508146037000},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1508146037000},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1508146037000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1508146037000},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1508146037000},{"_id":"source/_posts/JVM-Lock/light_lock_flow.jpg","hash":"8e5801eb0ba5786d871c495188a81eb2f21508a0","modified":1509949907000},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1508146037000},{"_id":"source/_posts/JVM-Lock/biased_lock_flow.jpg","hash":"79d27d2fbe382878f0af70a4694657573ad4cc47","modified":1509949308000},{"_id":"source/_posts/RocketMQ-Message-send-and-persistence/disc-fall.gif","hash":"c365fc98e4f8e66420abcaea0474846ae6978533","modified":1509690950000},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1508146036000},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"0dfb4b3ba3180d7285e66f270e1d3fa0f132c3d2","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"d026c8489f66ab6c12ad04bd37f1d5b6f2f3f0d1","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"711c8830886619d4f4a0598b0cde5499dce50c62","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1508146036000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1508146036000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"2915df7152ea095a6290ef69157fd67669e0e793","modified":1508146036000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1508146036000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1508146036000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1508146036000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1508146036000},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"86b6fd7f1b1be3ae98f8af6b23a6b1299c670ce9","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"bc8c388553bbcf95897459a466ba35bffd5ec5f0","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fda14bc35be2e1b332809b55b3d07155a833dbf4","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"82bbaa6322764779a1ac2e2c8390ce901c7972e2","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"215de948be49bcf14f06d500cef9f7035e406a43","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"5b93958239d3d2bf9aeaede44eced2434d784462","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e3e23751d4ad24e8714b425d768cf68e37de7ded","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"69ecd6c97e7cdfd822ac8102b45ad0ede85050db","modified":1508146036000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1508146036000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1508146036000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1508146036000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1508146037000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1508146037000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactor.gif","hash":"54cc8b7c835ff2a16e965b4e3d7734726d7f0164","modified":1508839012000},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1508146037000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1508146037000},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1508146037000},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png","hash":"f5462e215665696a7867fc6d4ca8d0722c4fe72a","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"8994ffcce84deac0471532f270f97c44fea54dc0","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"740d37f428b8f4574a76fc95cc25e50e0565f45e","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"7778920dd105fa4de3a7ab206eeba30b1a7bac45","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"beccb53dcd658136fb91a0c5678dea8f37d6e0b6","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"0f7f522cc6bfb3401d5afd62b0fcdf48bb2d604b","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"88c7d75646b66b168213190ee4cd874609afd5e3","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"ed88c8b51d0517759c777e71a6bfbe2907bcd994","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"963105a531403d7aad6d9e5e23e3bfabb8ec065a","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ee554b1031ef0070a5916477939021800e3c9d27","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"51eca243220cf57133a4becae9b78514bcfdc723","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"65a64d5662637b66e2f039a5f58217afe7a6e800","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"5f6ea57aabfa30a437059bf8352f1ad829dbd4ff","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"08a500b2984f109b751f3697ca33172d1340591a","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/post/post-wordcount.styl","hash":"4fda5d38c6c8d910e3bf5c74a48a8d4a3f3dc73d","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"77c92a449ce84d558d26d052681f2e0dd77c70c9","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"57d2c8a060f5e4e1a0aef9aae11a0016cf7ac5ba","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"b8969e1654eec89a0fd10d88b337fee9cb03cd44","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"ead0d0f2321dc71505788c7f689f92257cf14947","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"45df0cf4c97b47e05573bcd41028ee50f3fdf432","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"aeff0e6e23725e8baea27c890ccbbf466024f767","modified":1508146036000},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1508146036000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1508146036000},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1508146036000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1508146036000},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1508146037000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1508146037000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1508146037000},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png","hash":"65984a036bbd1af9b8b862e80d2f765fc3e19a17","modified":1508146036000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1508146036000},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1508146037000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1508146037000},{"_id":"public/search.xml","hash":"101a1cd691fba4c53f580deb388801ca277b3d1f","modified":1511860917828},{"_id":"public/tags/index.html","hash":"926d6a6be41c6e58146a70da263b164e8755bd0d","modified":1511860917866},{"_id":"public/2017/11/20/Linux-Mmap/index.html","hash":"bcd7c760a362bcb3abe89200d5f1cb30f4a77d93","modified":1511860917866},{"_id":"public/2017/11/20/Netty-ChannelOption/index.html","hash":"9e3bc58d0ee7c94350b97544950693412f8fdfe4","modified":1511860917866},{"_id":"public/2017/11/20/Interview-Questions/index.html","hash":"fa189f8079c2fd4ffd681135eaa26a8af799d77d","modified":1511860917866},{"_id":"public/2017/11/17/Kafka-FAQ/index.html","hash":"38a447d97feefcf54139f218539d15cb5c8ac190","modified":1511860917866},{"_id":"public/2017/11/16/Linux-Zero-Copy/index.html","hash":"37c24efcc47cce987608a4b19ebe483c2f9c3399","modified":1511860917866},{"_id":"public/2017/11/15/Distributed-Consensus-Raft/index.html","hash":"7bea47126ff9d8b5b18de947a383833fcecd9ece","modified":1511860917866},{"_id":"public/2017/11/15/Netty-Buffer-Allocator/index.html","hash":"4ad745e8baafbebfe4017f06b67253bd24782594","modified":1511860917866},{"_id":"public/2017/11/14/Linux-Kernel-space-and-User-space/index.html","hash":"bdde97d298965a466b36bb74fc49693592f302ba","modified":1511860917866},{"_id":"public/2017/11/12/Kafka-High-performance-design-with-pagecache/index.html","hash":"5303ba8cfc66e6915db136a3c27f4f2bff9e3c76","modified":1511860917866},{"_id":"public/2017/11/12/SourceCode-Map/index.html","hash":"da5be400a5dbcd5279943364b9c36320d461f9b2","modified":1511860917866},{"_id":"public/2017/11/10/JVM-CAS-Campare-and-swap/index.html","hash":"51f1baf76ea2ba4f324cf7b6df4444627942cd1e","modified":1511860917866},{"_id":"public/2017/11/10/Distributed-Transaction-TCC/index.html","hash":"0d6ceb28f5a837b949178ca710d561d47698e7f8","modified":1511860917867},{"_id":"public/2017/11/10/RocketMQ-Remote-communication-protocol-and-serialization/index.html","hash":"513b0307bfd4fe4ad6e2a44540e5c2f094b2fa89","modified":1511860917867},{"_id":"public/2017/11/09/JVM-Thread-interupt/index.html","hash":"d119661c81a62092d7cb788ab290d7822f062c5d","modified":1511860917867},{"_id":"public/2017/11/09/JVM-Atomic-operation/index.html","hash":"9a280aa0410cff08dbd6c39871a339e4ebd304bc","modified":1511860917867},{"_id":"public/2017/11/08/Distributed-unique-id/index.html","hash":"2bacfa7a1479000f5f9b6baeb759f59f8bfc8c17","modified":1511860917867},{"_id":"public/2017/11/07/JVM-Profiling/index.html","hash":"9f10f0825226f20bf8ee23bb1cbac79bed0377fe","modified":1511860917867},{"_id":"public/2017/11/06/JVM-Optimization/index.html","hash":"276f28f17baad522d572375f0724163895904fbb","modified":1511860917867},{"_id":"public/2017/11/06/JVM-Lock/index.html","hash":"eb056765101b3e3ab56e55ed2e95c4eb72acde11","modified":1511860917867},{"_id":"public/2017/11/03/RocketMQ-Message-send-and-persistence/index.html","hash":"a547fa31286b9628bd5282588152c5090199a6d7","modified":1511860917867},{"_id":"public/2017/11/03/Distributed-Transaction/index.html","hash":"1f7ca3a80e5ac025d648fbb22190f4dd23e9c7f7","modified":1511860917867},{"_id":"public/2017/11/01/Linux-sync-async-blocking-noblocking/index.html","hash":"8067c065514dc498d3b8a436871bf75cb8041fe9","modified":1511860917867},{"_id":"public/2017/10/28/Curator-sync-and-mutual-exclusion-between-thread-and-process/index.html","hash":"16a2d6b183d54c1459a335810df63166fd335dbf","modified":1511860917867},{"_id":"public/2017/10/27/Cobar-Enhance-cobar-dataSource-with-dataHost/index.html","hash":"f12465333f1ec217ab27d2b353d39656fddb9bec","modified":1511860917867},{"_id":"public/2017/10/27/Cobar-Enhance-cobar-mysql-heartbeat/index.html","hash":"3dba28012b14843ed5a354fb772d393fc48d1184","modified":1511860917867},{"_id":"public/2017/10/27/Thread-FAQ/index.html","hash":"8097ee1016d695a36f0152ea978419d1a530a02e","modified":1511860917867},{"_id":"public/2017/10/18/Cobar-FAQ/index.html","hash":"1d53d6bb8323b01453fc2e477ac2a74d1b98176b","modified":1511860917867},{"_id":"public/2017/10/18/Cobar-NIO-client/index.html","hash":"72da3d09700d73ed424f6e798e15962f17a60def","modified":1511860917867},{"_id":"public/2017/10/18/Cobar-NIO-server/index.html","hash":"b75c79a950c25bc0c4dd0e3f06a370d1e5c32c0d","modified":1511860917867},{"_id":"public/2017/10/16/Netty-FAQ/index.html","hash":"566542b8ac75beff9d7b2be3f840c259f2b526d6","modified":1511860917867},{"_id":"public/2017/10/13/RocketMQ-Delay-message-delivery/index.html","hash":"b6eb3b592f67ee07d6491d7013036e68c625e6f4","modified":1511860917868},{"_id":"public/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/index.html","hash":"75e08b43fcd7bff26b03ffe0b2442b27679d9ac8","modified":1511860917868},{"_id":"public/2017/10/12/Cobar-How-to-monitor-cobar/index.html","hash":"ebb6dd3b4160410c80e3bf77e4e7fe07224c11c1","modified":1511860917868},{"_id":"public/2017/10/12/RocketMQ-Index-service/index.html","hash":"158fe7ddfaaafe99e5d928acfa35ce501de276fd","modified":1511860917868},{"_id":"public/2017/10/12/RocketMQ-Master-slave-high-availability/index.html","hash":"baa7efe01ad802ff38971013f029f1e0f98552e1","modified":1511860917868},{"_id":"public/2017/10/11/RocketMQ-Transactional-message/index.html","hash":"f7a16eb1c6d5022f563bad6fa1c0995ce2b667ab","modified":1511860917868},{"_id":"public/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/index.html","hash":"15ae18bd959061f65bd0cda9dc1bdf546725d3dd","modified":1511860917868},{"_id":"public/2017/09/28/Curator-Distributed-lock/index.html","hash":"6f0e4e480fdb77efffb01ce97e49c39cf20ef6ee","modified":1511860917868},{"_id":"public/2017/09/25/RocketMQ-Consumer-rebalance/index.html","hash":"7220e4131ed8edeaab5abccd33fc43aef7d9658e","modified":1511860917868},{"_id":"public/2017/09/20/RocketMQ-Pull-message-with-long-polling/index.html","hash":"a53ee16b1b4f7d698eb185fd091a003f0e561fa0","modified":1511860917868},{"_id":"public/2017/09/20/tree-cache-single-thread-event-handler-in-curator/index.html","hash":"4e6daeaae6285d7c6ff936185e41a310ad83a8ec","modified":1511860917868},{"_id":"public/2017/09/19/Guava-Black-techs/index.html","hash":"6854d23dd6618947ee0a737a1249f0269e9d46e1","modified":1511860917868},{"_id":"public/2017/09/19/recipes-in-curator/index.html","hash":"c4e1cc85de86a2772705a10abb78987cbe7e64cc","modified":1511860917868},{"_id":"public/2017/09/19/Cobar-How-sql-executes-in-cobar/index.html","hash":"4e0e0c42f817f9d5c72efe51b44da76bbf23ed31","modified":1511860917868},{"_id":"public/2017/09/10/MySQL-Explain/index.html","hash":"1f4f192f45d910995d761f7c54a2874f6559ebdd","modified":1511860917868},{"_id":"public/2017/09/09/Linux-Useful-command/index.html","hash":"da720d2b9a66977809f4c20f24e667f1acbfde40","modified":1511860917868},{"_id":"public/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/index.html","hash":"30c41e5eda84a84c0461ad0d1adb03f585eb5b5c","modified":1511860917868},{"_id":"public/2017/08/20/RocketMQ-Debug-with-intellij/index.html","hash":"4640c68ee3cda2ba3656bfc2a4f1fa90861ad994","modified":1511860917869},{"_id":"public/2017/07/24/Cobar-Reactor-design-pattern/index.html","hash":"ecd5596fe26b5d8735a827cf95f83859b034e4dd","modified":1511860917869},{"_id":"public/2017/08/09/RocketMQ-FAQ/index.html","hash":"0b9e0ae52aa7181db6858a00dcf960ab079a4c05","modified":1511860917869},{"_id":"public/archives/index.html","hash":"082b972bf7cbe4db4e2db95125814f1771056438","modified":1511860917869},{"_id":"public/archives/page/2/index.html","hash":"6d7bd1585adf9b4e3c43e7d7ba6cd669b4447bda","modified":1511860917869},{"_id":"public/archives/page/3/index.html","hash":"424f47a6381a9f926cb9fd93b5511788bb555d0b","modified":1511860917869},{"_id":"public/archives/page/4/index.html","hash":"12bfebe395e78ba98d7b3fe021c36cac6d68e04a","modified":1511860917869},{"_id":"public/archives/page/5/index.html","hash":"fd77c5c0fa3d39d199bb503dcd78defeba1354ec","modified":1511860917869},{"_id":"public/archives/2017/index.html","hash":"9c520f8f93d2205fd7d8849ea1bb81950e223f74","modified":1511860917869},{"_id":"public/archives/2017/page/2/index.html","hash":"1be64e0fd24f891aaabb525f3548213db5691aff","modified":1511860917869},{"_id":"public/archives/2017/page/3/index.html","hash":"32a011a4eead07f60a2bc56675ad92c25758ed3a","modified":1511860917869},{"_id":"public/archives/2017/page/4/index.html","hash":"48852606aa93f68bacb3e4bfb6d710ced15ddf11","modified":1511860917869},{"_id":"public/archives/2017/page/5/index.html","hash":"2b16d1eafc799427aafc9a28c544d8e1c2c90f0b","modified":1511860917869},{"_id":"public/archives/2017/07/index.html","hash":"747968af5383eed978d73577c30a258ce4dccf39","modified":1511860917869},{"_id":"public/archives/2017/08/index.html","hash":"b4a1a70eba41d38d734c44bd4870778a114f5ba2","modified":1511860917869},{"_id":"public/archives/2017/09/index.html","hash":"765b2e64fb41a13b25e9b52a1c209561167c47a9","modified":1511860917869},{"_id":"public/archives/2017/10/index.html","hash":"749e28cdd912ea60394633202ba65e5ba534a49d","modified":1511860917870},{"_id":"public/archives/2017/10/page/2/index.html","hash":"a47a9c81fbaf90550f28c3a5dae7ca6b6933a85e","modified":1511860917870},{"_id":"public/archives/2017/11/index.html","hash":"cb83056500df912b45d13d66ea7385f96a47d312","modified":1511860917870},{"_id":"public/archives/2017/11/page/2/index.html","hash":"6fbfbc1fb329a9ec7f9a44eee228784feb347bf5","modified":1511860917870},{"_id":"public/archives/2017/11/page/3/index.html","hash":"87a6af3d24afcf8a2bd8ad205ee6223c394aaf20","modified":1511860917870},{"_id":"public/index.html","hash":"1ad32fc99c0574e26398e3a69d405177bd4236a5","modified":1511860917870},{"_id":"public/page/2/index.html","hash":"c3e0181f0555fca82d7cffa64b22339eab61232b","modified":1511860917870},{"_id":"public/page/3/index.html","hash":"f1a44b78b9994c514e16822ca8432162cbc1524f","modified":1511860917870},{"_id":"public/page/4/index.html","hash":"c0148e14b0546bac5aef9ce1861ac71816c82313","modified":1511860917870},{"_id":"public/page/5/index.html","hash":"06a7fc42f0d7212c0cba6f1f0ba4107461221655","modified":1511860917870},{"_id":"public/tags/Cobar/index.html","hash":"3c2e57f1ef4a1150f93ded3e8fdc3bd69aa85b55","modified":1511860917870},{"_id":"public/tags/Curator/index.html","hash":"390531a8523d13175359fbb6c17a7099ad9ad304","modified":1511860917870},{"_id":"public/tags/Raft/index.html","hash":"3aab279c97602e7e89dfd2cdabfc8f4141c9b66f","modified":1511860917870},{"_id":"public/tags/Guava/index.html","hash":"1f65d601136e565234a88eb4b636264671cf916c","modified":1511860917870},{"_id":"public/tags/JVM/index.html","hash":"3bd17c7a0799244c6cbe8c197d8dbdd5630a8d55","modified":1511860917870},{"_id":"public/tags/Kafka/index.html","hash":"d6a37f90233c002e4082c4354754a6aa5dee192e","modified":1511860917870},{"_id":"public/tags/Linux/index.html","hash":"2f8301f46bd94d98323c1879ff4c987a234de8d0","modified":1511860917871},{"_id":"public/tags/MySQL/index.html","hash":"786c87c666e16781616c09fef031d00ec5978de2","modified":1511860917871},{"_id":"public/tags/Netty/index.html","hash":"8a35ef49763f031de7a5fb392c2ec73dac6287d1","modified":1511860917871},{"_id":"public/tags/RocketMQ/index.html","hash":"beef6d24ebdc1ecda0e77c14449cfb32c914439a","modified":1511860917871},{"_id":"public/tags/RocketMQ/page/2/index.html","hash":"822695ec27f91d55204dd7ca0e9135bc5e1f5102","modified":1511860917871},{"_id":"public/tags/SourceCode/index.html","hash":"aecbbef565b0bfd53078b9472d2043b6a214368e","modified":1511860917871},{"_id":"public/tags/THread/index.html","hash":"440ac7778529feb298353628713ef40e0b41c405","modified":1511860917871},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1511860917888},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1511860917888},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1511860917888},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1511860917888},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1511860917888},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1511860917888},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1511860917888},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1511860917888},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1511860917888},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1511860917888},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1511860917888},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1511860917888},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1511860917888},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1511860917888},{"_id":"public/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1511860917889},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1511860917889},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1511860917889},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1511860917889},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1511860917889},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1511860917889},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1511860917889},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1511860917889},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1511860917889},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1511860917889},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1511860917889},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1511860917889},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1511860917889},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1511860917889},{"_id":"public/2017/11/12/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg","hash":"3a3bcb8193115780dd7568721270a217ba4499e9","modified":1511860917889},{"_id":"public/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif","hash":"999dfe3ed086bd56471bddb697dd2dd70157cb31","modified":1511860917889},{"_id":"public/2017/07/24/Cobar-Reactor-design-pattern/NioSign.gif","hash":"6c1b820c2c71938b240d4bc5ac56691f2c538dca","modified":1511860917889},{"_id":"public/2017/11/06/JVM-Lock/biased_lock_convert_flow.jpg","hash":"437ba37b1e9acdac50b4d813ddd6b44199cd035c","modified":1511860917889},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1511860918352},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1511860918358},{"_id":"public/2017/10/12/RocketMQ-Index-service/index-file.gif","hash":"4ccabf0aed972624fd7a8c4648430c975af70f3c","modified":1511860918363},{"_id":"public/2017/11/12/Kafka-High-performance-design-with-pagecache/read_write.gif","hash":"d8b58d9570bbe1056bbbb54d8e1d1b54f1c4870e","modified":1511860918364},{"_id":"public/2017/07/24/Cobar-Reactor-design-pattern/CobarReactorSign.gif","hash":"17ac291d666654f13097a9ab729adf5d329bd37a","modified":1511860918364},{"_id":"public/2017/11/06/JVM-Lock/markword_state.jpg","hash":"59b1e2cd4dd8962ab1657d79ac8db8a8cd980d95","modified":1511860918364},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1511860918374},{"_id":"public/js/src/bootstrap.js","hash":"6117f97b4984b8e33f21c726132da64ba678e4ed","modified":1511860918374},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1511860918374},{"_id":"public/js/src/motion.js","hash":"dc0365b2fb315a8b43d3ef19b59d3a82a366fcc1","modified":1511860918374},{"_id":"public/js/src/post-details.js","hash":"0693695a9512641daff63d99da772625a058ab18","modified":1511860918374},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1511860918374},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1511860918375},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1511860918375},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1511860918375},{"_id":"public/js/src/utils.js","hash":"2917c39c75b14b6dab7e1c46ab4d87b4df9fcd5d","modified":1511860918375},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1511860918375},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1511860918375},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"7fd2f3e2773555392ef40df40cae3bedb884f17a","modified":1511860918375},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1511860918375},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1511860918375},{"_id":"public/lib/fastclick/README.html","hash":"da3c74d484c73cc7df565e8abbfa4d6a5a18d4da","modified":1511860918375},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1511860918375},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"a6358170d346af13b1452ac157b60505bec7015c","modified":1511860918375},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1511860918375},{"_id":"public/lib/jquery_lazyload/README.html","hash":"bde24335f6bc09d8801c0dcd7274f71b466552bd","modified":1511860918375},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1511860918375},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1511860918375},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1511860918376},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1511860918376},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1511860918376},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1511860918376},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1511860918376},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1511860918376},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1511860918376},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1511860918376},{"_id":"public/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1511860918376},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1511860918376},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1511860918376},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1511860918376},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1511860918376},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1511860918376},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1511860918376},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1511860918376},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1511860918376},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1511860918376},{"_id":"public/css/main.css","hash":"30f8dac7df2a06358fd876508fc29423cf61fe2b","modified":1511860918376},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1511860918376},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1511860918376},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1511860918377},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1511860918377},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1511860918377},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1511860918377},{"_id":"public/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1511860918377},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1511860918377},{"_id":"public/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1511860918377},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1511860918377},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1511860918377},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1511860918377},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1511860918377},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1511860918377},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1511860918377},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1511860918377},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1511860918377},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1511860918378},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1511860918378},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1511860918378},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1511860918379},{"_id":"public/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif","hash":"c2da1c2fc71056fb224ef0c0a276805206c7cbc6","modified":1511860918379},{"_id":"public/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif","hash":"65ce3f933e03889174067eba323f00a55b13129e","modified":1511860918379},{"_id":"public/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif","hash":"76597fd5ef32d8ebdf1dee82ab29e1fe092c810a","modified":1511860918379},{"_id":"public/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif","hash":"75a442326aecac7ad3d959ef816cddec8b32dca4","modified":1511860918379},{"_id":"public/2017/10/11/RocketMQ-Transactional-message/transaction_rocketmq.gif","hash":"9a6c9cd908a78d62a435afdea7ac7bac702f4cd0","modified":1511860918379},{"_id":"public/2017/07/24/Cobar-Reactor-design-pattern/NioRegister.gif","hash":"4aec07220806ec8f3168d58ef8ff62b885bba9c6","modified":1511860918379},{"_id":"public/2017/11/03/Distributed-Transaction/transaction_rocketmq.gif","hash":"9a6c9cd908a78d62a435afdea7ac7bac702f4cd0","modified":1511860918379},{"_id":"public/2017/11/06/JVM-Lock/light_lock_flow.jpg","hash":"8e5801eb0ba5786d871c495188a81eb2f21508a0","modified":1511860918385},{"_id":"public/2017/11/06/JVM-Lock/biased_lock_flow.jpg","hash":"79d27d2fbe382878f0af70a4694657573ad4cc47","modified":1511860918390},{"_id":"public/2017/11/03/RocketMQ-Message-send-and-persistence/disc-fall.gif","hash":"c365fc98e4f8e66420abcaea0474846ae6978533","modified":1511860918390},{"_id":"public/2017/07/24/Cobar-Reactor-design-pattern/CobarReactor.gif","hash":"54cc8b7c835ff2a16e965b4e3d7734726d7f0164","modified":1511860918398},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1511860918406},{"_id":"public/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png","hash":"f5462e215665696a7867fc6d4ca8d0722c4fe72a","modified":1511860918406},{"_id":"public/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png","hash":"65984a036bbd1af9b8b862e80d2f765fc3e19a17","modified":1511860918413}],"Category":[],"Data":[],"Page":[{"title":"tags","date":"2017-10-12T11:33:19.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2017-10-12 19:33:19\ntype: \"tags\"\n---\n","updated":"2017-10-16T09:27:16.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjajeyawo000017q21hhva24z","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"CobarCobar","date":"2017-10-09T09:31:06.000Z","_content":"\nCobarCobar\n\n### \n\nCobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif)\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif)\n\nCobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif)\n\n### \n\nCobar_BinsertCobar_Aselectbinlog","source":"_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock.md","raw":"---\ntitle: CobarCobar\ndate: 2017-10-09 17:31:06\ntags: Cobar\n---\n\nCobarCobar\n\n### \n\nCobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif)\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif)\n\nCobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif)\n\n### \n\nCobar_BinsertCobar_Aselectbinlog","slug":"Cobar-Cluster-datasource-switch-design-with-distributed-lock","published":1,"updated":"2017-10-30T11:20:47.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyawp000117q2xv349g0t","content":"<p>CobarCobar</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif\" alt=\"\"></p>\n<p>CobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Cobar_BinsertCobar_Aselectbinlog</p>\n","site":{"data":{}},"excerpt":"","more":"<p>CobarCobar</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif\" alt=\"\"></p>\n<p>CobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Cobar_BinsertCobar_Aselectbinlog</p>\n"},{"title":"Cobar-Enhance-cobar-dataSource-with-dataHost","date":"2017-10-27T08:03:12.000Z","_content":"","source":"_posts/Cobar-Enhance-cobar-dataSource-with-dataHost.md","raw":"---\ntitle: Cobar-Enhance-cobar-dataSource-with-dataHost\ndate: 2017-10-27 16:03:12\ntags:\n---\n","slug":"Cobar-Enhance-cobar-dataSource-with-dataHost","published":1,"updated":"2017-10-27T08:03:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyawt000217q2nqhxuxlp","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"CobarCobar Driver","date":"2017-10-12T12:07:23.000Z","_content":"\ncobarcobar-driver\n\n### cobar-driver\n\ncobarJDBC`jdbc:cobar://Cobar_A:8066/user`cobar\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif)\n\n### HA cobar(jdbc)\ncobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif)","source":"_posts/Cobar-Enhance-cobar-driver-with-high-availability.md","raw":"---\ntitle: CobarCobar Driver\ndate: 2017-10-12 20:07:23\ntags: Cobar\n---\n\ncobarcobar-driver\n\n### cobar-driver\n\ncobarJDBC`jdbc:cobar://Cobar_A:8066/user`cobar\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif)\n\n### HA cobar(jdbc)\ncobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif)","slug":"Cobar-Enhance-cobar-driver-with-high-availability","published":1,"updated":"2017-10-31T03:32:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyawx000417q2pytu2eaq","content":"<p>cobarcobar-driver</p>\n<h3 id=\"cobar-driver\"><a href=\"#cobar-driver\" class=\"headerlink\" title=\"cobar-driver\"></a>cobar-driver</h3><p>cobarJDBC<code>jdbc:cobar://Cobar_A:8066/user</code>cobar</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif\" alt=\"\"></p>\n<h3 id=\"HA-cobar-jdbc-\"><a href=\"#HA-cobar-jdbc-\" class=\"headerlink\" title=\"HA cobar(jdbc)\"></a>HA cobar(jdbc)</h3><p>cobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>cobarcobar-driver</p>\n<h3 id=\"cobar-driver\"><a href=\"#cobar-driver\" class=\"headerlink\" title=\"cobar-driver\"></a>cobar-driver</h3><p>cobarJDBC<code>jdbc:cobar://Cobar_A:8066/user</code>cobar</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif\" alt=\"\"></p>\n<h3 id=\"HA-cobar-jdbc-\"><a href=\"#HA-cobar-jdbc-\" class=\"headerlink\" title=\"HA cobar(jdbc)\"></a>HA cobar(jdbc)</h3><p>cobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif\" alt=\"\"></p>\n"},{"title":"Cobar-Enhance-cobar-mysql-heartbeat","date":"2017-10-27T06:37:10.000Z","_content":"\n\n### CobarMySQL\n\nCobarNIONetty\n\n### \n\nCobarMySQL`select user()`Cobar\n* CobarMySQLError\n* CobarMySQL30MySQLTimeout\n\nVPCCobardataNodeMasterSlaveSlaveMasterSQL\n\nError33nError\n\n### ","source":"_posts/Cobar-Enhance-cobar-mysql-heartbeat.md","raw":"---\ntitle: Cobar-Enhance-cobar-mysql-heartbeat\ndate: 2017-10-27 14:37:10\ntags:\n---\n\n\n### CobarMySQL\n\nCobarNIONetty\n\n### \n\nCobarMySQL`select user()`Cobar\n* CobarMySQLError\n* CobarMySQL30MySQLTimeout\n\nVPCCobardataNodeMasterSlaveSlaveMasterSQL\n\nError33nError\n\n### ","slug":"Cobar-Enhance-cobar-mysql-heartbeat","published":1,"updated":"2017-10-31T03:35:25.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyawz000517q2ds5140xv","content":"<h3 id=\"CobarMySQL\"><a href=\"#CobarMySQL\" class=\"headerlink\" title=\"CobarMySQL\"></a>CobarMySQL</h3><p>CobarNIONetty</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarMySQL<code>select user()</code>Cobar</p>\n<ul>\n<li>CobarMySQLError</li>\n<li>CobarMySQL30MySQLTimeout</li>\n</ul>\n<p>VPCCobardataNodeMasterSlaveSlaveMasterSQL</p>\n<p>Error33nError</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"CobarMySQL\"><a href=\"#CobarMySQL\" class=\"headerlink\" title=\"CobarMySQL\"></a>CobarMySQL</h3><p>CobarNIONetty</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarMySQL<code>select user()</code>Cobar</p>\n<ul>\n<li>CobarMySQLError</li>\n<li>CobarMySQL30MySQLTimeout</li>\n</ul>\n<p>VPCCobardataNodeMasterSlaveSlaveMasterSQL</p>\n<p>Error33nError</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"Cobar","date":"2017-10-18T12:24:04.000Z","_content":"\nFrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler\n\nHandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue\n\nCobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar\n![img](https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg)\n\n### Cobar","source":"_posts/Cobar-FAQ.md","raw":"---\ntitle: Cobar\ndate: 2017-10-18 20:24:04\ntags: Cobar\n---\n\nFrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler\n\nHandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue\n\nCobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar\n![img](https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg)\n\n### Cobar","slug":"Cobar-FAQ","published":1,"updated":"2017-10-27T03:43:30.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyax1000617q2rvt5nkf4","content":"<p>FrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler</p>\n<p>HandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue</p>\n<p>Cobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar<br><img src=\"https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg\" alt=\"img\"></p>\n<h3 id=\"Cobar\"><a href=\"#Cobar\" class=\"headerlink\" title=\"Cobar\"></a>Cobar</h3>","site":{"data":{}},"excerpt":"","more":"<p>FrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler</p>\n<p>HandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue</p>\n<p>Cobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar<br><img src=\"https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg\" alt=\"img\"></p>\n<h3 id=\"Cobar\"><a href=\"#Cobar\" class=\"headerlink\" title=\"Cobar\"></a>Cobar</h3>"},{"title":"CobarSQL","date":"2017-09-19T08:58:28.000Z","_content":"","source":"_posts/Cobar-How-sql-executes-in-cobar.md","raw":"---\ntitle: CobarSQL\ndate: 2017-09-19 16:58:28\ntags: Cobar\n---\n","slug":"Cobar-How-sql-executes-in-cobar","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyax5000917q2kkre73z2","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"CobarCobar","date":"2017-10-12T12:04:26.000Z","_content":"","source":"_posts/Cobar-How-to-monitor-cobar.md","raw":"---\ntitle: CobarCobar\ndate: 2017-10-12 20:04:26\ntags: Cobar\n---\n","slug":"Cobar-How-to-monitor-cobar","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxb000b17q2jcqyrwab","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Cobar-NIO-client","date":"2017-10-18T03:13:59.000Z","_content":"\nCobarNIO ServerNIO Client","source":"_posts/Cobar-NIO-client.md","raw":"---\ntitle: Cobar-NIO-client\ndate: 2017-10-18 11:13:59\ntags: Cobar\n---\n\nCobarNIO ServerNIO Client","slug":"Cobar-NIO-client","published":1,"updated":"2017-10-19T08:19:42.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxf000d17q2mn7928tv","content":"<p>CobarNIO ServerNIO Client</p>\n","site":{"data":{}},"excerpt":"","more":"<p>CobarNIO ServerNIO Client</p>\n"},{"title":"Cobar-NIO-server","date":"2017-10-18T03:13:40.000Z","_content":"\nCobarNIO ServerNIO Client","source":"_posts/Cobar-NIO-server.md","raw":"---\ntitle: Cobar-NIO-server\ndate: 2017-10-18 11:13:40\ntags: Cobar\n---\n\nCobarNIO ServerNIO Client","slug":"Cobar-NIO-server","published":1,"updated":"2017-10-19T08:19:42.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxh000f17q218s63zts","content":"<p>CobarNIO ServerNIO Client</p>\n","site":{"data":{}},"excerpt":"","more":"<p>CobarNIO ServerNIO Client</p>\n"},{"title":"CobarReactor","date":"2017-07-24T10:00:58.000Z","_content":"\n\n\n### I/Omultiplexing\n\n\n\n\nhttps://www.zhihu.com/question/28594409/answer/52835876\n\n\n\ntcp30socket301. ABCDsocket2. 30 3. CDCDEAEA IOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor\n\n\n### demultiplexing\n\nhttp://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\n\n\n![](Cobar-Reactor-design-pattern/CobarReactorSign.gif)\n\n### NIOAPI\n\n![](Cobar-Reactor-design-pattern/NioRegister.gif)\n\n### Cobar NIO Server\n\n![](Cobar-Reactor-design-pattern/CobarReactor.gif)\n\n\n\n","source":"_posts/Cobar-Reactor-design-pattern.md","raw":"---\ntitle: CobarReactor\ndate: 2017-07-24 18:00:58\ntags: Cobar\n---\n\n\n\n### I/Omultiplexing\n\n\n\n\nhttps://www.zhihu.com/question/28594409/answer/52835876\n\n\n\ntcp30socket301. ABCDsocket2. 30 3. CDCDEAEA IOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor\n\n\n### demultiplexing\n\nhttp://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\n\n\n![](Cobar-Reactor-design-pattern/CobarReactorSign.gif)\n\n### NIOAPI\n\n![](Cobar-Reactor-design-pattern/NioRegister.gif)\n\n### Cobar NIO Server\n\n![](Cobar-Reactor-design-pattern/CobarReactor.gif)\n\n\n\n","slug":"Cobar-Reactor-design-pattern","published":1,"updated":"2017-11-01T06:33:59.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxk000h17q2se8sprch","content":"<h3 id=\"I-Omultiplexing\"><a href=\"#I-Omultiplexing\" class=\"headerlink\" title=\"I/Omultiplexing\"></a>I/Omultiplexing</h3><p></p>\n<p><br><a href=\"https://www.zhihu.com/question/28594409/answer/52835876\" target=\"_blank\" rel=\"external\">https://www.zhihu.com/question/28594409/answer/52835876</a><br><br></p>\n<p>tcp30socket301. ABCDsocket2. 30 3. CDCDEAEA IOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor</p>\n<h3 id=\"demultiplexing\"><a href=\"#demultiplexing\" class=\"headerlink\" title=\"demultiplexing\"></a>demultiplexing</h3><p><a href=\"http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\" target=\"_blank\" rel=\"external\">http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf</a></p>\n<p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactorSign.gif\" alt=\"\"></p>\n<h3 id=\"NIOAPI\"><a href=\"#NIOAPI\" class=\"headerlink\" title=\"NIOAPI\"></a>NIOAPI</h3><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/NioRegister.gif\" alt=\"\"></p>\n<h3 id=\"Cobar-NIO-Server\"><a href=\"#Cobar-NIO-Server\" class=\"headerlink\" title=\"Cobar NIO Server\"></a>Cobar NIO Server</h3><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactor.gif\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"I-Omultiplexing\"><a href=\"#I-Omultiplexing\" class=\"headerlink\" title=\"I/Omultiplexing\"></a>I/Omultiplexing</h3><p></p>\n<p><br><a href=\"https://www.zhihu.com/question/28594409/answer/52835876\" target=\"_blank\" rel=\"external\">https://www.zhihu.com/question/28594409/answer/52835876</a><br><br></p>\n<p>tcp30socket301. ABCDsocket2. 30 3. CDCDEAEA IOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor</p>\n<h3 id=\"demultiplexing\"><a href=\"#demultiplexing\" class=\"headerlink\" title=\"demultiplexing\"></a>demultiplexing</h3><p><a href=\"http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\" target=\"_blank\" rel=\"external\">http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf</a></p>\n<p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactorSign.gif\" alt=\"\"></p>\n<h3 id=\"NIOAPI\"><a href=\"#NIOAPI\" class=\"headerlink\" title=\"NIOAPI\"></a>NIOAPI</h3><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/NioRegister.gif\" alt=\"\"></p>\n<h3 id=\"Cobar-NIO-Server\"><a href=\"#Cobar-NIO-Server\" class=\"headerlink\" title=\"Cobar NIO Server\"></a>Cobar NIO Server</h3><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactor.gif\" alt=\"\"></p>\n"},{"title":"curator","date":"2017-09-28T08:58:05.000Z","_content":"\n\n* MySQL\n* Redis\n* ZooKeeper\n* RedLock\n\n\n``` java\npublic class InterProcessMutexTest {\n    public static final String LOCK_PATH = \"/curator-kick-off/lock\";\n    private static CuratorFramework client;\n\n    @BeforeClass\n    public static void before() {\n        client = CuratorFrameworkFactory.newClient(\n                \"127.0.0.1:2181\",\n                1000 * 10,\n                3000, new ExponentialBackoffRetry(\n                        1000,\n                        3));\n        client.start();\n    }\n\n    @Test\n    public void test() throws Exception {\n        InterProcessMutex lock = new InterProcessMutex(client, LOCK_PATH);\n        boolean acquire = lock.acquire(5, TimeUnit.SECONDS);\n        System.out.println(acquire);\n        System.out.println(\"done\");\n        lock.release();\n        System.in.read();\n    }\n}\n```\n","source":"_posts/Curator-Distributed-lock.md","raw":"---\ntitle: curator\ndate: 2017-09-28 16:58:05\ntags: Curator\n---\n\n\n* MySQL\n* Redis\n* ZooKeeper\n* RedLock\n\n\n``` java\npublic class InterProcessMutexTest {\n    public static final String LOCK_PATH = \"/curator-kick-off/lock\";\n    private static CuratorFramework client;\n\n    @BeforeClass\n    public static void before() {\n        client = CuratorFrameworkFactory.newClient(\n                \"127.0.0.1:2181\",\n                1000 * 10,\n                3000, new ExponentialBackoffRetry(\n                        1000,\n                        3));\n        client.start();\n    }\n\n    @Test\n    public void test() throws Exception {\n        InterProcessMutex lock = new InterProcessMutex(client, LOCK_PATH);\n        boolean acquire = lock.acquire(5, TimeUnit.SECONDS);\n        System.out.println(acquire);\n        System.out.println(\"done\");\n        lock.release();\n        System.in.read();\n    }\n}\n```\n","slug":"Curator-Distributed-lock","published":1,"updated":"2017-10-31T08:56:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxl000j17q2in6gu58h","content":"<ul>\n<li>MySQL</li>\n<li>Redis</li>\n<li>ZooKeeper</li>\n<li>RedLock</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InterProcessMutexTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LOCK_PATH = <span class=\"string\">\"/curator-kick-off/lock\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CuratorFramework client;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@BeforeClass</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        client = CuratorFrameworkFactory.newClient(</div><div class=\"line\">                <span class=\"string\">\"127.0.0.1:2181\"</span>,</div><div class=\"line\">                <span class=\"number\">1000</span> * <span class=\"number\">10</span>,</div><div class=\"line\">                <span class=\"number\">3000</span>, <span class=\"keyword\">new</span> ExponentialBackoffRetry(</div><div class=\"line\">                        <span class=\"number\">1000</span>,</div><div class=\"line\">                        <span class=\"number\">3</span>));</div><div class=\"line\">        client.start();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        InterProcessMutex lock = <span class=\"keyword\">new</span> InterProcessMutex(client, LOCK_PATH);</div><div class=\"line\">        <span class=\"keyword\">boolean</span> acquire = lock.acquire(<span class=\"number\">5</span>, TimeUnit.SECONDS);</div><div class=\"line\">        System.out.println(acquire);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"done\"</span>);</div><div class=\"line\">        lock.release();</div><div class=\"line\">        System.in.read();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>MySQL</li>\n<li>Redis</li>\n<li>ZooKeeper</li>\n<li>RedLock</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InterProcessMutexTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LOCK_PATH = <span class=\"string\">\"/curator-kick-off/lock\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CuratorFramework client;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@BeforeClass</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        client = CuratorFrameworkFactory.newClient(</div><div class=\"line\">                <span class=\"string\">\"127.0.0.1:2181\"</span>,</div><div class=\"line\">                <span class=\"number\">1000</span> * <span class=\"number\">10</span>,</div><div class=\"line\">                <span class=\"number\">3000</span>, <span class=\"keyword\">new</span> ExponentialBackoffRetry(</div><div class=\"line\">                        <span class=\"number\">1000</span>,</div><div class=\"line\">                        <span class=\"number\">3</span>));</div><div class=\"line\">        client.start();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        InterProcessMutex lock = <span class=\"keyword\">new</span> InterProcessMutex(client, LOCK_PATH);</div><div class=\"line\">        <span class=\"keyword\">boolean</span> acquire = lock.acquire(<span class=\"number\">5</span>, TimeUnit.SECONDS);</div><div class=\"line\">        System.out.println(acquire);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"done\"</span>);</div><div class=\"line\">        lock.release();</div><div class=\"line\">        System.in.read();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"},{"title":"Curator-sync-and-mutual-exclusion-between-thread-and-process","date":"2017-10-28T02:46:49.000Z","_content":"\n### Lock\n\n#### read write lock\n\n#### spin lock\n\n#### reentrant lock\n\n### Barrier\n\n### Semaphore\n\n###","source":"_posts/Curator-sync-and-mutual-exclusion-between-thread-and-process.md","raw":"---\ntitle: Curator-sync-and-mutual-exclusion-between-thread-and-process\ndate: 2017-10-28 10:46:49\ntags: Curator\n---\n\n### Lock\n\n#### read write lock\n\n#### spin lock\n\n#### reentrant lock\n\n### Barrier\n\n### Semaphore\n\n###","slug":"Curator-sync-and-mutual-exclusion-between-thread-and-process","published":1,"updated":"2017-10-28T02:50:37.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxm000l17q2eqy9sr8z","content":"<h3 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h3><h4 id=\"read-write-lock\"><a href=\"#read-write-lock\" class=\"headerlink\" title=\"read write lock\"></a>read write lock</h4><h4 id=\"spin-lock\"><a href=\"#spin-lock\" class=\"headerlink\" title=\"spin lock\"></a>spin lock</h4><h4 id=\"reentrant-lock\"><a href=\"#reentrant-lock\" class=\"headerlink\" title=\"reentrant lock\"></a>reentrant lock</h4><h3 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h3><h3 id=\"Semaphore\"><a href=\"#Semaphore\" class=\"headerlink\" title=\"Semaphore\"></a>Semaphore</h3><p>###</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h3><h4 id=\"read-write-lock\"><a href=\"#read-write-lock\" class=\"headerlink\" title=\"read write lock\"></a>read write lock</h4><h4 id=\"spin-lock\"><a href=\"#spin-lock\" class=\"headerlink\" title=\"spin lock\"></a>spin lock</h4><h4 id=\"reentrant-lock\"><a href=\"#reentrant-lock\" class=\"headerlink\" title=\"reentrant lock\"></a>reentrant lock</h4><h3 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h3><h3 id=\"Semaphore\"><a href=\"#Semaphore\" class=\"headerlink\" title=\"Semaphore\"></a>Semaphore</h3><p>###</p>\n"},{"title":"Distributed-Consensus-Raft","date":"2017-11-15T03:41:21.000Z","_content":"\nhttps://zhuanlan.zhihu.com/p/27910576\nhttp://thesecretlivesofdata.com/raft/\n\n### \n\n### \n\n### ","source":"_posts/Distributed-Consensus-Raft.md","raw":"---\ntitle: Distributed-Consensus-Raft\ndate: 2017-11-15 11:41:21\ntags: Raft\n---\n\nhttps://zhuanlan.zhihu.com/p/27910576\nhttp://thesecretlivesofdata.com/raft/\n\n### \n\n### \n\n### ","slug":"Distributed-Consensus-Raft","published":1,"updated":"2017-11-15T07:12:26.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxn000o17q21nzqxb4k","content":"<p><a href=\"https://zhuanlan.zhihu.com/p/27910576\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/p/27910576</a><br><a href=\"http://thesecretlivesofdata.com/raft/\" target=\"_blank\" rel=\"external\">http://thesecretlivesofdata.com/raft/</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://zhuanlan.zhihu.com/p/27910576\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/p/27910576</a><br><a href=\"http://thesecretlivesofdata.com/raft/\" target=\"_blank\" rel=\"external\">http://thesecretlivesofdata.com/raft/</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"Distributed-Transaction","date":"2017-11-03T02:54:48.000Z","_content":"\n### TCC\n\n### RocketMQ\n![](Distributed-Transaction/transaction_rocketmq.gif)\n\n\n### \nMQHalfMsgSOA\n\n\nhttps://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&mid=2247483713&idx=1&sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&mpshare=1&scene=1&srcid=1110kSXANwBrbL2TWtA0NAK6&key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&ascene=0&uin=MjcyMjMxNTA0Mg%3D%3D&devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&version=12010210&nettype=WIFI&fontScale=100&pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\n\n\n### Spring Cloud \nhttp://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\nhttps://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\n\n\nhttps://github.com/beston123/Tarzan","source":"_posts/Distributed-Transaction.md","raw":"---\ntitle: Distributed-Transaction\ndate: 2017-11-03 10:54:48\ntags:\n---\n\n### TCC\n\n### RocketMQ\n![](Distributed-Transaction/transaction_rocketmq.gif)\n\n\n### \nMQHalfMsgSOA\n\n\nhttps://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&mid=2247483713&idx=1&sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&mpshare=1&scene=1&srcid=1110kSXANwBrbL2TWtA0NAK6&key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&ascene=0&uin=MjcyMjMxNTA0Mg%3D%3D&devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&version=12010210&nettype=WIFI&fontScale=100&pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\n\n\n### Spring Cloud \nhttp://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\nhttps://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\n\n\nhttps://github.com/beston123/Tarzan","slug":"Distributed-Transaction","published":1,"updated":"2017-11-16T02:41:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxo000p17q25y8es4vc","content":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p><img src=\"/2017/11/03/Distributed-Transaction/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>MQHalfMsgSOA</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\" target=\"_blank\" rel=\"external\">https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8</a></p>\n<h3 id=\"Spring-Cloud\"><a href=\"#Spring-Cloud\" class=\"headerlink\" title=\"Spring Cloud\"></a>Spring Cloud</h3><p><a href=\"http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search</a><br><a href=\"https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\" target=\"_blank\" rel=\"external\">https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC</a></p>\n<p><a href=\"https://github.com/beston123/Tarzan\" target=\"_blank\" rel=\"external\">https://github.com/beston123/Tarzan</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p><img src=\"/2017/11/03/Distributed-Transaction/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>MQHalfMsgSOA</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\" target=\"_blank\" rel=\"external\">https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8</a></p>\n<h3 id=\"Spring-Cloud\"><a href=\"#Spring-Cloud\" class=\"headerlink\" title=\"Spring Cloud\"></a>Spring Cloud</h3><p><a href=\"http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search</a><br><a href=\"https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\" target=\"_blank\" rel=\"external\">https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC</a></p>\n<p><a href=\"https://github.com/beston123/Tarzan\" target=\"_blank\" rel=\"external\">https://github.com/beston123/Tarzan</a></p>\n"},{"title":"Distributed-Transaction-TCC","date":"2017-11-10T11:03:55.000Z","_content":"\n### TCC\n\n### \n\nhttps://github.com/1991wangliang/tx-lcn","source":"_posts/Distributed-Transaction-TCC.md","raw":"---\ntitle: Distributed-Transaction-TCC\ndate: 2017-11-10 19:03:55\ntags:\n---\n\n### TCC\n\n### \n\nhttps://github.com/1991wangliang/tx-lcn","slug":"Distributed-Transaction-TCC","published":1,"updated":"2017-11-10T11:27:19.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxp000q17q2mon00jyg","content":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://github.com/1991wangliang/tx-lcn\" target=\"_blank\" rel=\"external\">https://github.com/1991wangliang/tx-lcn</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://github.com/1991wangliang/tx-lcn\" target=\"_blank\" rel=\"external\">https://github.com/1991wangliang/tx-lcn</a></p>\n"},{"title":"Distributed-unique-id","date":"2017-11-08T06:39:03.000Z","_content":"\n\n``` java\n/**\n * Twitter_Snowflake<br>\n * SnowFlake(-):<br>\n * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 <br>\n * 1longJava01id0<br>\n * 41()41 - )\n * idIdWorkerstartTime4169T = (1L << 41) / (1000L * 60 * 60 * 24 * 365) = 69<br>\n * 1010245datacenterId5workerId<br>\n * 1212()4096ID<br>\n * 64Long<br>\n * SnowFlakeID(IDID)SnowFlake26ID\n */\npublic class SnowflakeIdWorker {\n\n    // ==============================Fields===========================================\n    /**  (2015-01-01) */\n    private final long twepoch = 1420041600000L;\n\n    /** id */\n    private final long workerIdBits = 5L;\n\n    /** id */\n    private final long datacenterIdBits = 5L;\n\n    /** id31 () */\n    private final long maxWorkerId = -1L ^ (-1L << workerIdBits);\n\n    /** id31 */\n    private final long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);\n\n    /** id */\n    private final long sequenceBits = 12L;\n\n    /** ID12 */\n    private final long workerIdShift = sequenceBits;\n\n    /** id17(12+5) */\n    private final long datacenterIdShift = sequenceBits + workerIdBits;\n\n    /** 22(5+5+12) */\n    private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n\n    /** 4095 (0b111111111111=0xfff=4095) */\n    private final long sequenceMask = -1L ^ (-1L << sequenceBits);\n\n    /** ID(0~31) */\n    private long workerId;\n\n    /** ID(0~31) */\n    private long datacenterId;\n\n    /** (0~4095) */\n    private long sequence = 0L;\n\n    /** ID */\n    private long lastTimestamp = -1L;\n\n    //==============================Constructors=====================================\n    /**\n     * \n     * @param workerId ID (0~31)\n     * @param datacenterId ID (0~31)\n     */\n    public SnowflakeIdWorker(long workerId, long datacenterId) {\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId));\n        }\n        if (datacenterId > maxDatacenterId || datacenterId < 0) {\n            throw new IllegalArgumentException(String.format(\"datacenter Id can't be greater than %d or less than 0\", maxDatacenterId));\n        }\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n    }\n\n    // ==============================Methods==========================================\n    /**\n     * ID ()\n     * @return SnowflakeId\n     */\n    public synchronized long nextId() {\n        long timestamp = timeGen();\n\n        //ID\n        if (timestamp < lastTimestamp) {\n            throw new RuntimeException(\n                    String.format(\"Clock moved backwards.  Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp));\n        }\n\n        //\n        if (lastTimestamp == timestamp) {\n            sequence = (sequence + 1) & sequenceMask;\n            //\n            if (sequence == 0) {\n                //,\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        }\n        //\n        else {\n            sequence = 0L;\n        }\n\n        //ID\n        lastTimestamp = timestamp;\n\n        //64ID\n        return ((timestamp - twepoch) << timestampLeftShift) //\n                | (datacenterId << datacenterIdShift) //\n                | (workerId << workerIdShift) //\n                | sequence;\n    }\n\n    /**\n     * \n     * @param lastTimestamp ID\n     * @return \n     */\n    protected long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp <= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    /**\n     * \n     * @return ()\n     */\n    protected long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //==============================Test=============================================\n    /**  */\n    public static void main(String[] args) {\n        SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0);\n        for (int i = 0; i < 1000; i++) {\n            long id = idWorker.nextId();\n            System.out.println(Long.toBinaryString(id));\n            System.out.println(id);\n        }\n    }\n}\n```\n\n### baidu uid-generator\n\nhttps://github.com/baidu/uid-generator\n","source":"_posts/Distributed-unique-id.md","raw":"---\ntitle: Distributed-unique-id\ndate: 2017-11-08 14:39:03\ntags:\n---\n\n\n``` java\n/**\n * Twitter_Snowflake<br>\n * SnowFlake(-):<br>\n * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 <br>\n * 1longJava01id0<br>\n * 41()41 - )\n * idIdWorkerstartTime4169T = (1L << 41) / (1000L * 60 * 60 * 24 * 365) = 69<br>\n * 1010245datacenterId5workerId<br>\n * 1212()4096ID<br>\n * 64Long<br>\n * SnowFlakeID(IDID)SnowFlake26ID\n */\npublic class SnowflakeIdWorker {\n\n    // ==============================Fields===========================================\n    /**  (2015-01-01) */\n    private final long twepoch = 1420041600000L;\n\n    /** id */\n    private final long workerIdBits = 5L;\n\n    /** id */\n    private final long datacenterIdBits = 5L;\n\n    /** id31 () */\n    private final long maxWorkerId = -1L ^ (-1L << workerIdBits);\n\n    /** id31 */\n    private final long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);\n\n    /** id */\n    private final long sequenceBits = 12L;\n\n    /** ID12 */\n    private final long workerIdShift = sequenceBits;\n\n    /** id17(12+5) */\n    private final long datacenterIdShift = sequenceBits + workerIdBits;\n\n    /** 22(5+5+12) */\n    private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n\n    /** 4095 (0b111111111111=0xfff=4095) */\n    private final long sequenceMask = -1L ^ (-1L << sequenceBits);\n\n    /** ID(0~31) */\n    private long workerId;\n\n    /** ID(0~31) */\n    private long datacenterId;\n\n    /** (0~4095) */\n    private long sequence = 0L;\n\n    /** ID */\n    private long lastTimestamp = -1L;\n\n    //==============================Constructors=====================================\n    /**\n     * \n     * @param workerId ID (0~31)\n     * @param datacenterId ID (0~31)\n     */\n    public SnowflakeIdWorker(long workerId, long datacenterId) {\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId));\n        }\n        if (datacenterId > maxDatacenterId || datacenterId < 0) {\n            throw new IllegalArgumentException(String.format(\"datacenter Id can't be greater than %d or less than 0\", maxDatacenterId));\n        }\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n    }\n\n    // ==============================Methods==========================================\n    /**\n     * ID ()\n     * @return SnowflakeId\n     */\n    public synchronized long nextId() {\n        long timestamp = timeGen();\n\n        //ID\n        if (timestamp < lastTimestamp) {\n            throw new RuntimeException(\n                    String.format(\"Clock moved backwards.  Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp));\n        }\n\n        //\n        if (lastTimestamp == timestamp) {\n            sequence = (sequence + 1) & sequenceMask;\n            //\n            if (sequence == 0) {\n                //,\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        }\n        //\n        else {\n            sequence = 0L;\n        }\n\n        //ID\n        lastTimestamp = timestamp;\n\n        //64ID\n        return ((timestamp - twepoch) << timestampLeftShift) //\n                | (datacenterId << datacenterIdShift) //\n                | (workerId << workerIdShift) //\n                | sequence;\n    }\n\n    /**\n     * \n     * @param lastTimestamp ID\n     * @return \n     */\n    protected long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp <= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    /**\n     * \n     * @return ()\n     */\n    protected long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //==============================Test=============================================\n    /**  */\n    public static void main(String[] args) {\n        SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0);\n        for (int i = 0; i < 1000; i++) {\n            long id = idWorker.nextId();\n            System.out.println(Long.toBinaryString(id));\n            System.out.println(id);\n        }\n    }\n}\n```\n\n### baidu uid-generator\n\nhttps://github.com/baidu/uid-generator\n","slug":"Distributed-unique-id","published":1,"updated":"2017-11-20T02:06:00.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxq000t17q2c0dqseou","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Twitter_Snowflake&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlake(-):&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1longJava01id0&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 41()41 - )</span></div><div class=\"line\"><span class=\"comment\"> * idIdWorkerstartTime4169T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1010245datacenterId5workerId&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1212()4096ID&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 64Long&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlakeID(IDID)SnowFlake26ID</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeIdWorker</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Fields===========================================</span></div><div class=\"line\">    <span class=\"comment\">/**  (2015-01-01) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> twepoch = <span class=\"number\">1420041600000L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 () */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxWorkerId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; workerIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxDatacenterId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; datacenterIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceBits = <span class=\"number\">12L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID12 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdShift = sequenceBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id17(12+5) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdShift = sequenceBits + workerIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 22(5+5+12) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 4095 (0b111111111111=0xfff=4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceMask = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; sequenceBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> datacenterId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** (0~4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Constructors=====================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> datacenterId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowflakeIdWorker</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> datacenterId)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"worker Id can't be greater than %d or less than 0\"</span>, maxWorkerId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"datacenter Id can't be greater than %d or less than 0\"</span>, maxDatacenterId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">this</span>.workerId = workerId;</div><div class=\"line\">        <span class=\"keyword\">this</span>.datacenterId = datacenterId;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Methods==========================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * ID ()</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (timestamp &lt; lastTimestamp) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</div><div class=\"line\">                    String.format(<span class=\"string\">\"Clock moved backwards.  Refusing to generate id for %d milliseconds\"</span>, lastTimestamp - timestamp));</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (lastTimestamp == timestamp) &#123;</div><div class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</div><div class=\"line\">            <span class=\"comment\">//</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">//,</span></div><div class=\"line\">                timestamp = tilNextMillis(lastTimestamp);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            sequence = <span class=\"number\">0L</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        lastTimestamp = timestamp;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//64ID</span></div><div class=\"line\">        <span class=\"keyword\">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (datacenterId &lt;&lt; datacenterIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (workerId &lt;&lt; workerIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | sequence;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp ID</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</div><div class=\"line\">            timestamp = timeGen();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> timestamp;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ()</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">timeGen</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Test=============================================</span></div><div class=\"line\">    <span class=\"comment\">/**  */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        SnowflakeIdWorker idWorker = <span class=\"keyword\">new</span> SnowflakeIdWorker(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> id = idWorker.nextId();</div><div class=\"line\">            System.out.println(Long.toBinaryString(id));</div><div class=\"line\">            System.out.println(id);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"baidu-uid-generator\"><a href=\"#baidu-uid-generator\" class=\"headerlink\" title=\"baidu uid-generator\"></a>baidu uid-generator</h3><p><a href=\"https://github.com/baidu/uid-generator\" target=\"_blank\" rel=\"external\">https://github.com/baidu/uid-generator</a></p>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Twitter_Snowflake&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlake(-):&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1longJava01id0&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 41()41 - )</span></div><div class=\"line\"><span class=\"comment\"> * idIdWorkerstartTime4169T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1010245datacenterId5workerId&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1212()4096ID&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 64Long&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlakeID(IDID)SnowFlake26ID</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeIdWorker</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Fields===========================================</span></div><div class=\"line\">    <span class=\"comment\">/**  (2015-01-01) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> twepoch = <span class=\"number\">1420041600000L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 () */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxWorkerId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; workerIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxDatacenterId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; datacenterIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceBits = <span class=\"number\">12L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID12 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdShift = sequenceBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id17(12+5) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdShift = sequenceBits + workerIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 22(5+5+12) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 4095 (0b111111111111=0xfff=4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceMask = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; sequenceBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> datacenterId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** (0~4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Constructors=====================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> datacenterId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowflakeIdWorker</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> datacenterId)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"worker Id can't be greater than %d or less than 0\"</span>, maxWorkerId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"datacenter Id can't be greater than %d or less than 0\"</span>, maxDatacenterId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">this</span>.workerId = workerId;</div><div class=\"line\">        <span class=\"keyword\">this</span>.datacenterId = datacenterId;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Methods==========================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * ID ()</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (timestamp &lt; lastTimestamp) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</div><div class=\"line\">                    String.format(<span class=\"string\">\"Clock moved backwards.  Refusing to generate id for %d milliseconds\"</span>, lastTimestamp - timestamp));</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (lastTimestamp == timestamp) &#123;</div><div class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</div><div class=\"line\">            <span class=\"comment\">//</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">//,</span></div><div class=\"line\">                timestamp = tilNextMillis(lastTimestamp);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            sequence = <span class=\"number\">0L</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        lastTimestamp = timestamp;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//64ID</span></div><div class=\"line\">        <span class=\"keyword\">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (datacenterId &lt;&lt; datacenterIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (workerId &lt;&lt; workerIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | sequence;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp ID</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</div><div class=\"line\">            timestamp = timeGen();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> timestamp;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ()</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">timeGen</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Test=============================================</span></div><div class=\"line\">    <span class=\"comment\">/**  */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        SnowflakeIdWorker idWorker = <span class=\"keyword\">new</span> SnowflakeIdWorker(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> id = idWorker.nextId();</div><div class=\"line\">            System.out.println(Long.toBinaryString(id));</div><div class=\"line\">            System.out.println(id);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"baidu-uid-generator\"><a href=\"#baidu-uid-generator\" class=\"headerlink\" title=\"baidu uid-generator\"></a>baidu uid-generator</h3><p><a href=\"https://github.com/baidu/uid-generator\" target=\"_blank\" rel=\"external\">https://github.com/baidu/uid-generator</a></p>\n"},{"title":"guava","date":"2017-09-19T09:39:05.000Z","_content":"\n### \n\n### \n\n### \n\n#### BiMap\n\n### \n\n### ","source":"_posts/Guava-Black-techs.md","raw":"---\ntitle: guava\ndate: 2017-09-19 17:39:05\ntags: Guava\n---\n\n### \n\n### \n\n### \n\n#### BiMap\n\n### \n\n### ","slug":"Guava-Black-techs","published":1,"updated":"2017-11-06T03:01:54.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxr000u17q2e7yw4453","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"BiMap\"><a href=\"#BiMap\" class=\"headerlink\" title=\"BiMap\"></a>BiMap</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"BiMap\"><a href=\"#BiMap\" class=\"headerlink\" title=\"BiMap\"></a>BiMap</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"Interview-Questions","date":"2017-11-20T07:38:08.000Z","_content":"\n\n### \n\nFuture & Promise\nFeed Back","source":"_posts/Interview-Questions.md","raw":"---\ntitle: Interview-Questions\ndate: 2017-11-20 15:38:08\ntags:\n---\n\n\n### \n\nFuture & Promise\nFeed Back","slug":"Interview-Questions","published":1,"updated":"2017-11-20T07:43:21.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxs000x17q2055pduae","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Future &amp; Promise<br>Feed Back</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Future &amp; Promise<br>Feed Back</p>\n"},{"title":"JVM-Atomic-operation","date":"2017-11-09T02:12:31.000Z","_content":"\n### Volatile\n\n#### \n\n### MVCC Copy on write\n\nCopyOnWriteArrayList \n\n``` java\npublic class CopyOnWriteArrayList<E> {\n    /** The lock protecting all mutators */\n    final transient ReentrantLock lock = new ReentrantLock();\n\n    /** The array, accessed only via getArray/setArray. */\n    private transient volatile Object[] array;\n\n    /**\n     * Gets the array.  Non-private so as to also be accessible\n     * from CopyOnWriteArraySet class.\n     */\n    final Object[] getArray() {\n        return array;\n    }\n\n    /**\n     * Sets the array.\n     */\n    final void setArray(Object[] a) {\n        array = a;\n    }\n\n    /**\n     * {@inheritDoc}\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E get(int index) {\n        return get(getArray(), index);\n    }\n\n    /**\n     * Appends the specified element to the end of this list.\n     *\n     * @param e element to be appended to this list\n     * @return {@code true} (as specified by {@link Collection#add})\n     */\n    public boolean add(E e) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            Object[] newElements = Arrays.copyOf(elements, len + 1);\n            newElements[len] = e;\n            setArray(newElements);\n            return true;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * Removes the element at the specified position in this list.\n     * Shifts any subsequent elements to the left (subtracts one from their\n     * indices).  Returns the element that was removed from the list.\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E remove(int index) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            E oldValue = get(elements, index);\n            int numMoved = len - index - 1;\n            if (numMoved == 0)\n                setArray(Arrays.copyOf(elements, len - 1));\n            else {\n                Object[] newElements = new Object[len - 1];\n                System.arraycopy(elements, 0, newElements, 0, index);\n                System.arraycopy(elements, index + 1, newElements, index,\n                                 numMoved);\n                setArray(newElements);\n            }\n            return oldValue;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n   \n}\n```\n\nCopyOnWriteArrayListReentrantLockCopyOnWriteArrayList\n\n> http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html","source":"_posts/JVM-Atomic-operation.md","raw":"---\ntitle: JVM-Atomic-operation\ndate: 2017-11-09 10:12:31\ntags: JVM\n---\n\n### Volatile\n\n#### \n\n### MVCC Copy on write\n\nCopyOnWriteArrayList \n\n``` java\npublic class CopyOnWriteArrayList<E> {\n    /** The lock protecting all mutators */\n    final transient ReentrantLock lock = new ReentrantLock();\n\n    /** The array, accessed only via getArray/setArray. */\n    private transient volatile Object[] array;\n\n    /**\n     * Gets the array.  Non-private so as to also be accessible\n     * from CopyOnWriteArraySet class.\n     */\n    final Object[] getArray() {\n        return array;\n    }\n\n    /**\n     * Sets the array.\n     */\n    final void setArray(Object[] a) {\n        array = a;\n    }\n\n    /**\n     * {@inheritDoc}\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E get(int index) {\n        return get(getArray(), index);\n    }\n\n    /**\n     * Appends the specified element to the end of this list.\n     *\n     * @param e element to be appended to this list\n     * @return {@code true} (as specified by {@link Collection#add})\n     */\n    public boolean add(E e) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            Object[] newElements = Arrays.copyOf(elements, len + 1);\n            newElements[len] = e;\n            setArray(newElements);\n            return true;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * Removes the element at the specified position in this list.\n     * Shifts any subsequent elements to the left (subtracts one from their\n     * indices).  Returns the element that was removed from the list.\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E remove(int index) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            E oldValue = get(elements, index);\n            int numMoved = len - index - 1;\n            if (numMoved == 0)\n                setArray(Arrays.copyOf(elements, len - 1));\n            else {\n                Object[] newElements = new Object[len - 1];\n                System.arraycopy(elements, 0, newElements, 0, index);\n                System.arraycopy(elements, index + 1, newElements, index,\n                                 numMoved);\n                setArray(newElements);\n            }\n            return oldValue;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n   \n}\n```\n\nCopyOnWriteArrayListReentrantLockCopyOnWriteArrayList\n\n> http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html","slug":"JVM-Atomic-operation","published":1,"updated":"2017-11-16T07:55:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxt000y17q2kvayq094","content":"<h3 id=\"Volatile\"><a href=\"#Volatile\" class=\"headerlink\" title=\"Volatile\"></a>Volatile</h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h3 id=\"MVCC-Copy-on-write\"><a href=\"#MVCC-Copy-on-write\" class=\"headerlink\" title=\"MVCC Copy on write\"></a>MVCC Copy on write</h3><p>CopyOnWriteArrayList </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CopyOnWriteArrayList</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</div><div class=\"line\">    <span class=\"comment\">/** The lock protecting all mutators */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">transient</span> ReentrantLock lock = <span class=\"keyword\">new</span> ReentrantLock();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** The array, accessed only via getArray/setArray. */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Object[] array;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Gets the array.  Non-private so as to also be accessible</span></div><div class=\"line\"><span class=\"comment\">     * from CopyOnWriteArraySet class.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> Object[] getArray() &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> array;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Sets the array.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">setArray</span><span class=\"params\">(Object[] a)</span> </span>&#123;</div><div class=\"line\">        array = a;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> get(getArray(), index);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Appends the specified element to the end of this list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> e element to be appended to this list</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;<span class=\"doctag\">@code</span> true&#125; (as specified by &#123;<span class=\"doctag\">@link</span> Collection#add&#125;)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            Object[] newElements = Arrays.copyOf(elements, len + <span class=\"number\">1</span>);</div><div class=\"line\">            newElements[len] = e;</div><div class=\"line\">            setArray(newElements);</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Removes the element at the specified position in this list.</span></div><div class=\"line\"><span class=\"comment\">     * Shifts any subsequent elements to the left (subtracts one from their</span></div><div class=\"line\"><span class=\"comment\">     * indices).  Returns the element that was removed from the list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            E oldValue = get(elements, index);</div><div class=\"line\">            <span class=\"keyword\">int</span> numMoved = len - index - <span class=\"number\">1</span>;</div><div class=\"line\">            <span class=\"keyword\">if</span> (numMoved == <span class=\"number\">0</span>)</div><div class=\"line\">                setArray(Arrays.copyOf(elements, len - <span class=\"number\">1</span>));</div><div class=\"line\">            <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                Object[] newElements = <span class=\"keyword\">new</span> Object[len - <span class=\"number\">1</span>];</div><div class=\"line\">                System.arraycopy(elements, <span class=\"number\">0</span>, newElements, <span class=\"number\">0</span>, index);</div><div class=\"line\">                System.arraycopy(elements, index + <span class=\"number\">1</span>, newElements, index,</div><div class=\"line\">                                 numMoved);</div><div class=\"line\">                setArray(newElements);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">return</span> oldValue;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CopyOnWriteArrayListReentrantLockCopyOnWriteArrayList</p>\n<blockquote>\n<p><a href=\"http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Volatile\"><a href=\"#Volatile\" class=\"headerlink\" title=\"Volatile\"></a>Volatile</h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h3 id=\"MVCC-Copy-on-write\"><a href=\"#MVCC-Copy-on-write\" class=\"headerlink\" title=\"MVCC Copy on write\"></a>MVCC Copy on write</h3><p>CopyOnWriteArrayList </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CopyOnWriteArrayList</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</div><div class=\"line\">    <span class=\"comment\">/** The lock protecting all mutators */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">transient</span> ReentrantLock lock = <span class=\"keyword\">new</span> ReentrantLock();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** The array, accessed only via getArray/setArray. */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Object[] array;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Gets the array.  Non-private so as to also be accessible</span></div><div class=\"line\"><span class=\"comment\">     * from CopyOnWriteArraySet class.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> Object[] getArray() &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> array;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Sets the array.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">setArray</span><span class=\"params\">(Object[] a)</span> </span>&#123;</div><div class=\"line\">        array = a;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> get(getArray(), index);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Appends the specified element to the end of this list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> e element to be appended to this list</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;<span class=\"doctag\">@code</span> true&#125; (as specified by &#123;<span class=\"doctag\">@link</span> Collection#add&#125;)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            Object[] newElements = Arrays.copyOf(elements, len + <span class=\"number\">1</span>);</div><div class=\"line\">            newElements[len] = e;</div><div class=\"line\">            setArray(newElements);</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Removes the element at the specified position in this list.</span></div><div class=\"line\"><span class=\"comment\">     * Shifts any subsequent elements to the left (subtracts one from their</span></div><div class=\"line\"><span class=\"comment\">     * indices).  Returns the element that was removed from the list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            E oldValue = get(elements, index);</div><div class=\"line\">            <span class=\"keyword\">int</span> numMoved = len - index - <span class=\"number\">1</span>;</div><div class=\"line\">            <span class=\"keyword\">if</span> (numMoved == <span class=\"number\">0</span>)</div><div class=\"line\">                setArray(Arrays.copyOf(elements, len - <span class=\"number\">1</span>));</div><div class=\"line\">            <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                Object[] newElements = <span class=\"keyword\">new</span> Object[len - <span class=\"number\">1</span>];</div><div class=\"line\">                System.arraycopy(elements, <span class=\"number\">0</span>, newElements, <span class=\"number\">0</span>, index);</div><div class=\"line\">                System.arraycopy(elements, index + <span class=\"number\">1</span>, newElements, index,</div><div class=\"line\">                                 numMoved);</div><div class=\"line\">                setArray(newElements);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">return</span> oldValue;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CopyOnWriteArrayListReentrantLockCopyOnWriteArrayList</p>\n<blockquote>\n<p><a href=\"http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html</a></p>\n</blockquote>\n"},{"title":"JVM-CAS-Campare-and-swap","date":"2017-11-10T11:48:55.000Z","_content":"> ,,,\n\n### CAS\n\n\n\n### CASLock-Free\n\n\n``` java\n/**\n * \n */\npublic class SpinLock {\n    private AtomicBoolean canLock = new AtomicBoolean(true);\n\n    public void lock() {\n        boolean b;\n        do {\n            b = canLock.compareAndSet(true, false);\n        } while (!b);\n    }\n\n    public void release() {\n        canLock.compareAndSet(false, true);\n    }\n}\n```\n\nlock`canLock`truecasfalsewhilecanLocktruecasCPU\n\n### ABA\n\nCASCASABA\n\n### ABA\n\nABAABA\n","source":"_posts/JVM-CAS-Campare-and-swap.md","raw":"---\ntitle: JVM-CAS-Campare-and-swap\ndate: 2017-11-10 19:48:55\ntags: JVM\n---\n> ,,,\n\n### CAS\n\n\n\n### CASLock-Free\n\n\n``` java\n/**\n * \n */\npublic class SpinLock {\n    private AtomicBoolean canLock = new AtomicBoolean(true);\n\n    public void lock() {\n        boolean b;\n        do {\n            b = canLock.compareAndSet(true, false);\n        } while (!b);\n    }\n\n    public void release() {\n        canLock.compareAndSet(false, true);\n    }\n}\n```\n\nlock`canLock`truecasfalsewhilecanLocktruecasCPU\n\n### ABA\n\nCASCASABA\n\n### ABA\n\nABAABA\n","slug":"JVM-CAS-Campare-and-swap","published":1,"updated":"2017-11-17T08:36:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxu001017q27icnznwf","content":"<blockquote>\n<p>,,,</p>\n</blockquote>\n<h3 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a>CAS</h3><p></p>\n<h3 id=\"CASLock-Free\"><a href=\"#CASLock-Free\" class=\"headerlink\" title=\"CASLock-Free\"></a>CASLock-Free</h3><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpinLock</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> AtomicBoolean canLock = <span class=\"keyword\">new</span> AtomicBoolean(<span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">boolean</span> b;</div><div class=\"line\">        <span class=\"keyword\">do</span> &#123;</div><div class=\"line\">            b = canLock.compareAndSet(<span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">while</span> (!b);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">release</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        canLock.compareAndSet(<span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>lock<code>canLock</code>truecasfalsewhilecanLocktruecasCPU</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>CASCASABA</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>ABAABA</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>,,,</p>\n</blockquote>\n<h3 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a>CAS</h3><p></p>\n<h3 id=\"CASLock-Free\"><a href=\"#CASLock-Free\" class=\"headerlink\" title=\"CASLock-Free\"></a>CASLock-Free</h3><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpinLock</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> AtomicBoolean canLock = <span class=\"keyword\">new</span> AtomicBoolean(<span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">boolean</span> b;</div><div class=\"line\">        <span class=\"keyword\">do</span> &#123;</div><div class=\"line\">            b = canLock.compareAndSet(<span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">while</span> (!b);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">release</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        canLock.compareAndSet(<span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>lock<code>canLock</code>truecasfalsewhilecanLocktruecasCPU</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>CASCASABA</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>ABAABA</p>\n"},{"title":"JVM-Optimization","date":"2017-11-06T06:43:26.000Z","_content":"\nhttp://blog.csdn.net/matt8/article/details/52298397\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\n\nJava ReentrantLock\n\n\n### \n> ReentrantLocksynchronizedJDK5synchronizedJDK6jvm\n\n\nsynchronizedReentrantLockReentrantLock2 \n1. \n2.wait-notifyReentrantLockConditionnotify \n3. \n\nReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java \n\nBuffersynchronized \n\n``` java\npackage com.eric.lock;\n\npublic class Buffer {\n\n    private Object lock;\n\n    public Buffer() {\n        lock = this;\n    }\n\n    public void write() {\n        synchronized (lock) {\n            long startTime = System.currentTimeMillis();\n            System.out.println(\"buff\");\n            // \n            for (; ; ) {\n                if (System.currentTimeMillis() - startTime > Integer.MAX_VALUE)\n                    break;\n            }\n            System.out.println(\"\");\n        }\n    }\n\n    public void read() {\n        synchronized (lock) {\n            System.out.println(\"buff\");\n        }\n    }\n}\n```\n\n2\n\nhttp://www.importnew.com/15311.html\nG1","source":"_posts/JVM-Optimization.md","raw":"---\ntitle: JVM-Optimization\ndate: 2017-11-06 14:43:26\ntags: JVM\n---\n\nhttp://blog.csdn.net/matt8/article/details/52298397\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\n\nJava ReentrantLock\n\n\n### \n> ReentrantLocksynchronizedJDK5synchronizedJDK6jvm\n\n\nsynchronizedReentrantLockReentrantLock2 \n1. \n2.wait-notifyReentrantLockConditionnotify \n3. \n\nReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java \n\nBuffersynchronized \n\n``` java\npackage com.eric.lock;\n\npublic class Buffer {\n\n    private Object lock;\n\n    public Buffer() {\n        lock = this;\n    }\n\n    public void write() {\n        synchronized (lock) {\n            long startTime = System.currentTimeMillis();\n            System.out.println(\"buff\");\n            // \n            for (; ; ) {\n                if (System.currentTimeMillis() - startTime > Integer.MAX_VALUE)\n                    break;\n            }\n            System.out.println(\"\");\n        }\n    }\n\n    public void read() {\n        synchronized (lock) {\n            System.out.println(\"buff\");\n        }\n    }\n}\n```\n\n2\n\nhttp://www.importnew.com/15311.html\nG1","slug":"JVM-Optimization","published":1,"updated":"2017-11-12T14:05:05.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxv001217q25zo9j95y","content":"<p><a href=\"http://blog.csdn.net/matt8/article/details/52298397\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/matt8/article/details/52298397</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments</a></p>\n<p>Java ReentrantLock</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>ReentrantLocksynchronizedJDK5synchronizedJDK6jvm</p>\n</blockquote>\n<p>synchronizedReentrantLockReentrantLock2<br>1.<br>2.wait-notifyReentrantLockConditionnotify<br>3. </p>\n<p>ReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java </p>\n<p>Buffersynchronized </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.eric.lock;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Buffer</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> Object lock;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Buffer</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        lock = <span class=\"keyword\">this</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">            <span class=\"comment\">// </span></div><div class=\"line\">            <span class=\"keyword\">for</span> (; ; ) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (System.currentTimeMillis() - startTime &gt; Integer.MAX_VALUE)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>2</p>\n<p><a href=\"http://www.importnew.com/15311.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/15311.html</a><br>G1</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://blog.csdn.net/matt8/article/details/52298397\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/matt8/article/details/52298397</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments</a></p>\n<p>Java ReentrantLock</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>ReentrantLocksynchronizedJDK5synchronizedJDK6jvm</p>\n</blockquote>\n<p>synchronizedReentrantLockReentrantLock2<br>1.<br>2.wait-notifyReentrantLockConditionnotify<br>3. </p>\n<p>ReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java </p>\n<p>Buffersynchronized </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.eric.lock;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Buffer</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> Object lock;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Buffer</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        lock = <span class=\"keyword\">this</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">            <span class=\"comment\">// </span></div><div class=\"line\">            <span class=\"keyword\">for</span> (; ; ) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (System.currentTimeMillis() - startTime &gt; Integer.MAX_VALUE)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>2</p>\n<p><a href=\"http://www.importnew.com/15311.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/15311.html</a><br>G1</p>\n"},{"title":"JVM-Lock","date":"2017-11-06T02:16:02.000Z","_content":"\n### \n\nJVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor \n\n### Java\n\nJava3Word23232bit\n\n|  |  |  |\n| --------- |:-----------:|:-----------|\n| 32/64bit | Mark Word | hashCode\n| 32/64bit | Class Metadata Address | \n| 32/64bit | Array length | \n\nJavaMark WordHashCode32JVMMark Word\n\n25 bit\t4bit\t1bit\n\t2bit\n\n\thashCode\t\t0\t01\n\nMark WordMark Word4\n![](JVM-Lock/markword_state.jpg)\n\n### \n\n**CPUCPU**\nJava SE1.6Java SE1.6\n****\n\n#### \nHotspotCAS\n![](JVM-Lock/biased_lock_flow.jpg)\n\n##### \nMarkValue\n\n12\n\nJVMJVMepochidentifierepoch\n\n##### \n\n**IDCASMark Word**Mark Word1CASCAS\n\n##### \n\n****Mark Word12\n\n##### \n\nJava 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false\n\n#### \n\nCPUCPU\nrunningJVM\n10,100\nHotSpotCPUHotSpot\nCPUs\n(CPUs/2)\nOwner CPU\nCPUCPU ACPU B\n\n#### \n\n##### \n\nJVMMark WordDisplaced Mark Word**CASMark Word()**\n\n##### \n\n**CASDisplaced Mark Word**\n\n![](JVM-Lock/light_lock_flow.jpg)\n\n### \n\n|  |  |  |  |\n| --------- |:-----------:|:-----------|:-----------|\n| \t |  |  | \n|  |  | CPU | ,\n|  | CPU |  | ,\n\n> http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/","source":"_posts/JVM-Lock.md","raw":"---\ntitle: JVM-Lock\ndate: 2017-11-06 10:16:02\ntags: JVM\n---\n\n### \n\nJVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor \n\n### Java\n\nJava3Word23232bit\n\n|  |  |  |\n| --------- |:-----------:|:-----------|\n| 32/64bit | Mark Word | hashCode\n| 32/64bit | Class Metadata Address | \n| 32/64bit | Array length | \n\nJavaMark WordHashCode32JVMMark Word\n\n25 bit\t4bit\t1bit\n\t2bit\n\n\thashCode\t\t0\t01\n\nMark WordMark Word4\n![](JVM-Lock/markword_state.jpg)\n\n### \n\n**CPUCPU**\nJava SE1.6Java SE1.6\n****\n\n#### \nHotspotCAS\n![](JVM-Lock/biased_lock_flow.jpg)\n\n##### \nMarkValue\n\n12\n\nJVMJVMepochidentifierepoch\n\n##### \n\n**IDCASMark Word**Mark Word1CASCAS\n\n##### \n\n****Mark Word12\n\n##### \n\nJava 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false\n\n#### \n\nCPUCPU\nrunningJVM\n10,100\nHotSpotCPUHotSpot\nCPUs\n(CPUs/2)\nOwner CPU\nCPUCPU ACPU B\n\n#### \n\n##### \n\nJVMMark WordDisplaced Mark Word**CASMark Word()**\n\n##### \n\n**CASDisplaced Mark Word**\n\n![](JVM-Lock/light_lock_flow.jpg)\n\n### \n\n|  |  |  |  |\n| --------- |:-----------:|:-----------|:-----------|\n| \t |  |  | \n|  |  | CPU | ,\n|  | CPU |  | ,\n\n> http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/","slug":"JVM-Lock","published":1,"updated":"2017-11-13T02:13:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxw001417q2trwsk4g6","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>JVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor </p>\n<h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>Java3Word23232bit</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Mark Word</td>\n<td style=\"text-align:left\">hashCode</td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Class Metadata Address</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Array length</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<p>JavaMark WordHashCode32JVMMark Word</p>\n<p>25 bit    4bit    1bit<br>    2bit<br><br>    hashCode        0    01</p>\n<p>Mark WordMark Word4<br><img src=\"/2017/11/06/JVM-Lock/markword_state.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>CPUCPU</strong><br>Java SE1.6Java SE1.6<br><strong></strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>HotspotCAS<br><img src=\"/2017/11/06/JVM-Lock/biased_lock_flow.jpg\" alt=\"\"></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>MarkValue</p>\n<p>12</p>\n<p>JVMJVMepochidentifierepoch</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>IDCASMark Word</strong>Mark Word1CASCAS</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong></strong>Mark Word12</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Java 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>CPUCPU<br>runningJVM<br>10,100<br>HotSpotCPUHotSpot<br>CPUs<br>(CPUs/2)<br>Owner CPU<br>CPUCPU ACPU B</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>JVMMark WordDisplaced Mark Word<strong>CASMark Word()</strong></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>CASDisplaced Mark Word</strong></p>\n<p><img src=\"/2017/11/06/JVM-Lock/light_lock_flow.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">CPU</td>\n<td style=\"text-align:left\">,</td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\">CPU</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">,</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><a href=\"http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>JVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor </p>\n<h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>Java3Word23232bit</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Mark Word</td>\n<td style=\"text-align:left\">hashCode</td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Class Metadata Address</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Array length</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<p>JavaMark WordHashCode32JVMMark Word</p>\n<p>25 bit    4bit    1bit<br>    2bit<br><br>    hashCode        0    01</p>\n<p>Mark WordMark Word4<br><img src=\"/2017/11/06/JVM-Lock/markword_state.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>CPUCPU</strong><br>Java SE1.6Java SE1.6<br><strong></strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>HotspotCAS<br><img src=\"/2017/11/06/JVM-Lock/biased_lock_flow.jpg\" alt=\"\"></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>MarkValue</p>\n<p>12</p>\n<p>JVMJVMepochidentifierepoch</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>IDCASMark Word</strong>Mark Word1CASCAS</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong></strong>Mark Word12</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Java 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>CPUCPU<br>runningJVM<br>10,100<br>HotSpotCPUHotSpot<br>CPUs<br>(CPUs/2)<br>Owner CPU<br>CPUCPU ACPU B</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>JVMMark WordDisplaced Mark Word<strong>CASMark Word()</strong></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>CASDisplaced Mark Word</strong></p>\n<p><img src=\"/2017/11/06/JVM-Lock/light_lock_flow.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">CPU</td>\n<td style=\"text-align:left\">,</td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\">CPU</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">,</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><a href=\"http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/</a></p>\n</blockquote>\n"},{"title":"JVM-Profiling","date":"2017-11-07T07:36:54.000Z","_content":"\nhttps://yq.aliyun.com/articles/2390","source":"_posts/JVM-Profiling.md","raw":"---\ntitle: JVM-Profiling\ndate: 2017-11-07 15:36:54\ntags: JVM\n---\n\nhttps://yq.aliyun.com/articles/2390","slug":"JVM-Profiling","published":1,"updated":"2017-11-07T07:37:07.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxx001617q2vw1wakr1","content":"<p><a href=\"https://yq.aliyun.com/articles/2390\" target=\"_blank\" rel=\"external\">https://yq.aliyun.com/articles/2390</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://yq.aliyun.com/articles/2390\" target=\"_blank\" rel=\"external\">https://yq.aliyun.com/articles/2390</a></p>\n"},{"title":"JVM","date":"2017-11-09T12:36:45.000Z","_content":"\n\nhttp://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/","source":"_posts/JVM-Thread-interupt.md","raw":"---\ntitle: JVM\ndate: 2017-11-09 20:36:45\ntags: JVM\n---\n\n\nhttp://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/","slug":"JVM-Thread-interupt","published":1,"updated":"2017-11-09T12:37:21.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxy001917q26ed1htd4","content":"<p><a href=\"http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/</a></p>\n"},{"title":"Kafka-FAQ","date":"2017-11-17T07:33:16.000Z","_content":"\nKafkaCommitLog?\n\nsync;lock-free;reentrant lock\n\n\n\n. Kafka\n    9.1 \n    9.2 \n    9.3 \n    9.4 ISR","source":"_posts/Kafka-FAQ.md","raw":"---\ntitle: Kafka-FAQ\ndate: 2017-11-17 15:33:16\ntags: Kafka\n---\n\nKafkaCommitLog?\n\nsync;lock-free;reentrant lock\n\n\n\n. Kafka\n    9.1 \n    9.2 \n    9.3 \n    9.4 ISR","slug":"Kafka-FAQ","published":1,"updated":"2017-11-20T09:28:28.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaxz001b17q2x4pwvup1","content":"<p>KafkaCommitLog?</p>\n<p>sync;lock-free;reentrant lock</p>\n<p>. Kafka<br>    9.1 <br>    9.2 <br>    9.3 <br>    9.4 ISR</p>\n","site":{"data":{}},"excerpt":"","more":"<p>KafkaCommitLog?</p>\n<p>sync;lock-free;reentrant lock</p>\n<p>. Kafka<br>    9.1 <br>    9.2 <br>    9.3 <br>    9.4 ISR</p>\n"},{"title":"KafkaPage Cache","date":"2017-11-12T14:47:44.000Z","_content":"\n\n> \n\nhttp://blog.csdn.net/tototuzuoquan/article/details/73437890\n\nhttp://www.jianshu.com/p/eba0067b1e1a\n\n\nhttps://tech.meituan.com/kafka-fs-design-theory.html\n\n\n_java.nio.channels.FileChannel_\n`public abstract void force(boolean metaData) throws java.io.IOException`\nForces any updates to this channel's file to be written to the storage device that contains it.\nIf this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\nIf the file does not reside on a local device then no such guarantee is made.\nThe metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\nInvoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\nThis method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n\n_java.nio.MappedByteBuffer_\n`public final MappedByteBuffer force()`\nForces any changes made to this buffer's content to be written to the storage device containing the mapped file.\nIf the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\nIf the file does not reside on a local device then no such guarantee is made.\nIf this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n\n\n### Don't fear the filesystem!\n\nKafka relies heavily on the filesystem for storing and caching messages. There is a general perception that \"disks are slow\" which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.\n\nThe key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!\n\n![](Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg)\n\nTo compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.\n\nFurthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:\n\nThe memory overhead of objects is very high, often doubling the size of the data stored (or worse).\nJava garbage collection becomes increasingly fiddly and slow as the in-heap data increases.\nAs a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.\n\nThis suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernel's pagecache.\n\nThis style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).\n\n### sendfile\n\nsendfile() copies data between one file descriptor and another.\n\nBecause this copying is done within the kernel, sendfile() is more\nefficient than the combination of read(2) and write(2), which would\nrequire transferring data to and from user space.\n\n![](Kafka-High-performance-design-with-pagecache/read_write.gif)\n\nconventional read and write","source":"_posts/Kafka-High-performance-design-with-pagecache.md","raw":"---\ntitle: KafkaPage Cache\ndate: 2017-11-12 22:47:44\ntags: Kafka\n---\n\n\n> \n\nhttp://blog.csdn.net/tototuzuoquan/article/details/73437890\n\nhttp://www.jianshu.com/p/eba0067b1e1a\n\n\nhttps://tech.meituan.com/kafka-fs-design-theory.html\n\n\n_java.nio.channels.FileChannel_\n`public abstract void force(boolean metaData) throws java.io.IOException`\nForces any updates to this channel's file to be written to the storage device that contains it.\nIf this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\nIf the file does not reside on a local device then no such guarantee is made.\nThe metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\nInvoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\nThis method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n\n_java.nio.MappedByteBuffer_\n`public final MappedByteBuffer force()`\nForces any changes made to this buffer's content to be written to the storage device containing the mapped file.\nIf the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\nIf the file does not reside on a local device then no such guarantee is made.\nIf this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n\n\n### Don't fear the filesystem!\n\nKafka relies heavily on the filesystem for storing and caching messages. There is a general perception that \"disks are slow\" which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.\n\nThe key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!\n\n![](Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg)\n\nTo compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.\n\nFurthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:\n\nThe memory overhead of objects is very high, often doubling the size of the data stored (or worse).\nJava garbage collection becomes increasingly fiddly and slow as the in-heap data increases.\nAs a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.\n\nThis suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernel's pagecache.\n\nThis style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).\n\n### sendfile\n\nsendfile() copies data between one file descriptor and another.\n\nBecause this copying is done within the kernel, sendfile() is more\nefficient than the combination of read(2) and write(2), which would\nrequire transferring data to and from user space.\n\n![](Kafka-High-performance-design-with-pagecache/read_write.gif)\n\nconventional read and write","slug":"Kafka-High-performance-design-with-pagecache","published":1,"updated":"2017-11-17T01:54:24.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay0001e17q28ha2yt00","content":"<blockquote>\n<p></p>\n</blockquote>\n<p><a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a></p>\n<p><a href=\"http://www.jianshu.com/p/eba0067b1e1a\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/eba0067b1e1a</a><br></p>\n<p><a href=\"https://tech.meituan.com/kafka-fs-design-theory.html\" target=\"_blank\" rel=\"external\">https://tech.meituan.com/kafka-fs-design-theory.html</a></p>\n<p><em>java.nio.channels.FileChannel</em><br><code>public abstract void force(boolean metaData) throws java.io.IOException</code><br>Forces any updates to this channels file to be written to the storage device that contains it.<br>If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br>If the file does not reside on a local device then no such guarantee is made.<br>The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br>Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br>This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p><em>java.nio.MappedByteBuffer</em><br><code>public final MappedByteBuffer force()</code><br>Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br>If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br>If the file does not reside on a local device then no such guarantee is made.<br>If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"Dont-fear-the-filesystem\"><a href=\"#Dont-fear-the-filesystem\" class=\"headerlink\" title=\"Dont fear the filesystem!\"></a>Dont fear the filesystem!</h3><p>Kafka relies heavily on the filesystem for storing and caching messages. There is a general perception that disks are slow which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.</p>\n<p>The key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg\" alt=\"\"></p>\n<p>To compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.</p>\n<p>Furthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:</p>\n<p>The memory overhead of objects is very high, often doubling the size of the data stored (or worse).<br>Java garbage collection becomes increasingly fiddly and slow as the in-heap data increases.<br>As a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.</p>\n<p>This suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernels pagecache.</p>\n<p>This style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).</p>\n<h3 id=\"sendfile\"><a href=\"#sendfile\" class=\"headerlink\" title=\"sendfile\"></a>sendfile</h3><p>sendfile() copies data between one file descriptor and another.</p>\n<p>Because this copying is done within the kernel, sendfile() is more<br>efficient than the combination of read(2) and write(2), which would<br>require transferring data to and from user space.</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/read_write.gif\" alt=\"\"></p>\n<p>conventional read and write</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p></p>\n</blockquote>\n<p><a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a></p>\n<p><a href=\"http://www.jianshu.com/p/eba0067b1e1a\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/eba0067b1e1a</a><br></p>\n<p><a href=\"https://tech.meituan.com/kafka-fs-design-theory.html\" target=\"_blank\" rel=\"external\">https://tech.meituan.com/kafka-fs-design-theory.html</a></p>\n<p><em>java.nio.channels.FileChannel</em><br><code>public abstract void force(boolean metaData) throws java.io.IOException</code><br>Forces any updates to this channels file to be written to the storage device that contains it.<br>If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br>If the file does not reside on a local device then no such guarantee is made.<br>The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br>Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br>This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p><em>java.nio.MappedByteBuffer</em><br><code>public final MappedByteBuffer force()</code><br>Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br>If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br>If the file does not reside on a local device then no such guarantee is made.<br>If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"Dont-fear-the-filesystem\"><a href=\"#Dont-fear-the-filesystem\" class=\"headerlink\" title=\"Dont fear the filesystem!\"></a>Dont fear the filesystem!</h3><p>Kafka relies heavily on the filesystem for storing and caching messages. There is a general perception that disks are slow which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.</p>\n<p>The key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg\" alt=\"\"></p>\n<p>To compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.</p>\n<p>Furthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:</p>\n<p>The memory overhead of objects is very high, often doubling the size of the data stored (or worse).<br>Java garbage collection becomes increasingly fiddly and slow as the in-heap data increases.<br>As a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.</p>\n<p>This suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernels pagecache.</p>\n<p>This style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).</p>\n<h3 id=\"sendfile\"><a href=\"#sendfile\" class=\"headerlink\" title=\"sendfile\"></a>sendfile</h3><p>sendfile() copies data between one file descriptor and another.</p>\n<p>Because this copying is done within the kernel, sendfile() is more<br>efficient than the combination of read(2) and write(2), which would<br>require transferring data to and from user space.</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/read_write.gif\" alt=\"\"></p>\n<p>conventional read and write</p>\n"},{"title":"OS-Kernel-space-and-User-space","date":"2017-11-14T03:17:59.000Z","_content":"\nhttp://www.cnblogs.com/Anker/p/3269106.html\n","source":"_posts/Linux-Kernel-space-and-User-space.md","raw":"---\ntitle: OS-Kernel-space-and-User-space\ndate: 2017-11-14 11:17:59\ntags: Linux\n---\n\nhttp://www.cnblogs.com/Anker/p/3269106.html\n","slug":"Linux-Kernel-space-and-User-space","published":1,"updated":"2017-11-20T09:22:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay1001g17q2hoflb1br","content":"<p><a href=\"http://www.cnblogs.com/Anker/p/3269106.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/Anker/p/3269106.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.cnblogs.com/Anker/p/3269106.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/Anker/p/3269106.html</a></p>\n"},{"title":"Linux-Mmap","date":"2017-11-20T09:22:52.000Z","_content":"\nhttp://xiaoz5919.iteye.com/blog/2093323","source":"_posts/Linux-Mmap.md","raw":"---\ntitle: Linux-Mmap\ndate: 2017-11-20 17:22:52\ntags: Linux\n---\n\nhttp://xiaoz5919.iteye.com/blog/2093323","slug":"Linux-Mmap","published":1,"updated":"2017-11-21T02:26:28.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay2001j17q2ythgqbl3","content":"<p><a href=\"http://xiaoz5919.iteye.com/blog/2093323\" target=\"_blank\" rel=\"external\">http://xiaoz5919.iteye.com/blog/2093323</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://xiaoz5919.iteye.com/blog/2093323\" target=\"_blank\" rel=\"external\">http://xiaoz5919.iteye.com/blog/2093323</a></p>\n"},{"title":"Linux","date":"2017-09-09T09:16:00.000Z","_content":"\n#### \n\n``` bash\nsudo sed -i 's/aaa/bbb/g' `grep -Rl aaa order_migrate_conf/`\n```\n\n#### ,\n\n``` bash\ngrep -Rl 1496628000000 order_migrate_conf/\n```\n\n#### vim \n\n``` bash\nless file.log\n```\n\n\n#### kind_pay\n\n``` bash\ntac file_path | grep kind_pay\n```\n\nless file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)\n\n#### TCP\n\n``` bash\nss  -tan|awk 'NR>1{++S[$1]}END{for (a in S) print a,S[a]}'\n```\n\n#### logs\n\n``` bash\ndu -sh logs/*\n```\n\n#### \n\n``` bash\ntelnet zk_ip 2181 | tee -a  -i someFile\n\nenvi\n```\n\n#### \n\n``` bash\nnmon\n```","source":"_posts/Linux-Useful-command.md","raw":"---\ntitle: Linux\ndate: 2017-09-09 17:16:00\ntags: Linux\n---\n\n#### \n\n``` bash\nsudo sed -i 's/aaa/bbb/g' `grep -Rl aaa order_migrate_conf/`\n```\n\n#### ,\n\n``` bash\ngrep -Rl 1496628000000 order_migrate_conf/\n```\n\n#### vim \n\n``` bash\nless file.log\n```\n\n\n#### kind_pay\n\n``` bash\ntac file_path | grep kind_pay\n```\n\nless file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)\n\n#### TCP\n\n``` bash\nss  -tan|awk 'NR>1{++S[$1]}END{for (a in S) print a,S[a]}'\n```\n\n#### logs\n\n``` bash\ndu -sh logs/*\n```\n\n#### \n\n``` bash\ntelnet zk_ip 2181 | tee -a  -i someFile\n\nenvi\n```\n\n#### \n\n``` bash\nnmon\n```","slug":"Linux-Useful-command","published":1,"updated":"2017-11-21T02:26:21.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay3001l17q2bikd9fuk","content":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo sed -i <span class=\"string\">'s/aaa/bbb/g'</span> `grep -Rl aaa order_migrate_conf/`</div></pre></td></tr></table></figure>\n<h4 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">grep -Rl 1496628000000 order_migrate_conf/</div></pre></td></tr></table></figure>\n<h4 id=\"vim-\"><a href=\"#vim-\" class=\"headerlink\" title=\"vim \"></a>vim </h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">less file.log</div></pre></td></tr></table></figure>\n<h4 id=\"kind-pay\"><a href=\"#kind-pay\" class=\"headerlink\" title=\"kind_pay\"></a>kind_pay</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tac file_path | grep kind_pay</div></pre></td></tr></table></figure>\n<p>less file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)</p>\n<h4 id=\"TCP\"><a href=\"#TCP\" class=\"headerlink\" title=\"TCP\"></a>TCP</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ss  -tan|awk <span class=\"string\">'NR&gt;1&#123;++S[$1]&#125;END&#123;for (a in S) print a,S[a]&#125;'</span></div></pre></td></tr></table></figure>\n<h4 id=\"logs\"><a href=\"#logs\" class=\"headerlink\" title=\"logs\"></a>logs</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">du -sh logs/*</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">telnet zk_ip 2181 | tee -a  -i someFile</div><div class=\"line\"></div><div class=\"line\">envi</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">nmon</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo sed -i <span class=\"string\">'s/aaa/bbb/g'</span> `grep -Rl aaa order_migrate_conf/`</div></pre></td></tr></table></figure>\n<h4 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">grep -Rl 1496628000000 order_migrate_conf/</div></pre></td></tr></table></figure>\n<h4 id=\"vim-\"><a href=\"#vim-\" class=\"headerlink\" title=\"vim \"></a>vim </h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">less file.log</div></pre></td></tr></table></figure>\n<h4 id=\"kind-pay\"><a href=\"#kind-pay\" class=\"headerlink\" title=\"kind_pay\"></a>kind_pay</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tac file_path | grep kind_pay</div></pre></td></tr></table></figure>\n<p>less file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)</p>\n<h4 id=\"TCP\"><a href=\"#TCP\" class=\"headerlink\" title=\"TCP\"></a>TCP</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ss  -tan|awk <span class=\"string\">'NR&gt;1&#123;++S[$1]&#125;END&#123;for (a in S) print a,S[a]&#125;'</span></div></pre></td></tr></table></figure>\n<h4 id=\"logs\"><a href=\"#logs\" class=\"headerlink\" title=\"logs\"></a>logs</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">du -sh logs/*</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">telnet zk_ip 2181 | tee -a  -i someFile</div><div class=\"line\"></div><div class=\"line\">envi</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">nmon</div></pre></td></tr></table></figure>"},{"title":"Linux-Zero-Copy","date":"2017-11-16T07:26:51.000Z","_content":"\n Zero copy \n\n\n### \nhttps://www.ibm.com/developerworks/library/j-zerocopy/\nhttp://www.cnblogs.com/zemliu/p/3695549.html","source":"_posts/Linux-Zero-Copy.md","raw":"---\ntitle: Linux-Zero-Copy\ndate: 2017-11-16 15:26:51\ntags: Linux\n---\n\n Zero copy \n\n\n### \nhttps://www.ibm.com/developerworks/library/j-zerocopy/\nhttp://www.cnblogs.com/zemliu/p/3695549.html","slug":"Linux-Zero-Copy","published":1,"updated":"2017-11-16T08:31:27.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay4001m17q2t73vdg9w","content":"<p> Zero copy </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://www.ibm.com/developerworks/library/j-zerocopy/\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/library/j-zerocopy/</a><br><a href=\"http://www.cnblogs.com/zemliu/p/3695549.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/zemliu/p/3695549.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p> Zero copy </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://www.ibm.com/developerworks/library/j-zerocopy/\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/library/j-zerocopy/</a><br><a href=\"http://www.cnblogs.com/zemliu/p/3695549.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/zemliu/p/3695549.html</a></p>\n"},{"title":"OS-sync-async-blocking-noblocking","date":"2017-11-01T07:01:02.000Z","_content":"","source":"_posts/Linux-sync-async-blocking-noblocking.md","raw":"---\ntitle: OS-sync-async-blocking-noblocking\ndate: 2017-11-01 15:01:02\ntags: Linux\n---\n","slug":"Linux-sync-async-blocking-noblocking","published":1,"updated":"2017-11-16T07:26:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay5001p17q220lk33uk","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"MySQL Explain ","date":"2017-09-10T05:11:34.000Z","_content":"\n## select id\n\n``` sql\nexplain select * from student where stu_id = '1000003';\nexplain delete from student where stu_id = '11111';\n#\nexplain select * from (select * from student where stu_id = '1000003') tmp; \n#union select id \nexplain select * from student where stu_id = '1000003' union select * from student where stu_id = '1000004';\n```\n\nMore info: [MySQL DOC](https://dev.mysql.com/doc/refman/5.7/en/explain-output.html)","source":"_posts/MySQL-Explain.md","raw":"---\ntitle: MySQL Explain \ndate: 2017-09-10 13:11:34\ntags: MySQL\n---\n\n## select id\n\n``` sql\nexplain select * from student where stu_id = '1000003';\nexplain delete from student where stu_id = '11111';\n#\nexplain select * from (select * from student where stu_id = '1000003') tmp; \n#union select id \nexplain select * from student where stu_id = '1000003' union select * from student where stu_id = '1000004';\n```\n\nMore info: [MySQL DOC](https://dev.mysql.com/doc/refman/5.7/en/explain-output.html)","slug":"MySQL-Explain","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay6001q17q2z366w0tc","content":"<h2 id=\"select-id\"><a href=\"#select-id\" class=\"headerlink\" title=\"select id\"></a>select id</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>;</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'11111'</span>;</div><div class=\"line\">#</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>) tmp; </div><div class=\"line\">#union select id </div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000004'</span>;</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html\" target=\"_blank\" rel=\"external\">MySQL DOC</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"select-id\"><a href=\"#select-id\" class=\"headerlink\" title=\"select id\"></a>select id</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>;</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'11111'</span>;</div><div class=\"line\">#</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>) tmp; </div><div class=\"line\">#union select id </div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000004'</span>;</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html\" target=\"_blank\" rel=\"external\">MySQL DOC</a></p>\n"},{"title":"Netty-Buffer-Allocator","date":"2017-11-15T02:05:55.000Z","_content":"","source":"_posts/Netty-Buffer-Allocator.md","raw":"---\ntitle: Netty-Buffer-Allocator\ndate: 2017-11-15 10:05:55\ntags: Netty\n---\n","slug":"Netty-Buffer-Allocator","published":1,"updated":"2017-11-15T08:08:11.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay7001t17q2n9tkfazu","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Netty-ChannelOption","date":"2017-11-20T07:53:52.000Z","_content":"\n\nnettyChannelOptionlinuxChannelOption\n\nChannelOption\n\n1ChannelOption.SO_BACKLOG\n\nChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)\n\nbacklog\n\n2ChannelOption.SO_REUSEADDR\n\nChanneOption.SO_REUSEADDRSO_REUSEADDR\n\nTCP80\n\nSO_REUSEADDR\n\n\n\n3ChannelOption.SO_KEEPALIVE\n\nChanneloption.SO_KEEPALIVESO_KEEPALIVETCP\n\nTCP\n\n4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF\n\nChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF\n\n\n\n5ChannelOption.SO_LINGER\n\nChannelOption.SO_LINGERSO_LINGER,Linuxclose\n\nSO_LINGERclose()\n\n6ChannelOption.TCP_NODELAY\n\nChannelOption.TCP_NODELAYTCP_NODELAY,Nagle\n\nNagle,\n\nNagleTCP_NODELAYTCP_CORK\n\n\n\n\n\n### http://budairenqin.iteye.com/blog/2215899\n\n","source":"_posts/Netty-ChannelOption.md","raw":"---\ntitle: Netty-ChannelOption\ndate: 2017-11-20 15:53:52\ntags: Netty\n---\n\n\nnettyChannelOptionlinuxChannelOption\n\nChannelOption\n\n1ChannelOption.SO_BACKLOG\n\nChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)\n\nbacklog\n\n2ChannelOption.SO_REUSEADDR\n\nChanneOption.SO_REUSEADDRSO_REUSEADDR\n\nTCP80\n\nSO_REUSEADDR\n\n\n\n3ChannelOption.SO_KEEPALIVE\n\nChanneloption.SO_KEEPALIVESO_KEEPALIVETCP\n\nTCP\n\n4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF\n\nChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF\n\n\n\n5ChannelOption.SO_LINGER\n\nChannelOption.SO_LINGERSO_LINGER,Linuxclose\n\nSO_LINGERclose()\n\n6ChannelOption.TCP_NODELAY\n\nChannelOption.TCP_NODELAYTCP_NODELAY,Nagle\n\nNagle,\n\nNagleTCP_NODELAYTCP_CORK\n\n\n\n\n\n### http://budairenqin.iteye.com/blog/2215899\n\n","slug":"Netty-ChannelOption","published":1,"updated":"2017-11-21T02:22:33.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay8001u17q2g521fmmm","content":"<p>nettyChannelOptionlinuxChannelOption</p>\n<p>ChannelOption</p>\n<p>1ChannelOption.SO_BACKLOG</p>\n<p>ChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)</p>\n<p>backlog</p>\n<p>2ChannelOption.SO_REUSEADDR</p>\n<p>ChanneOption.SO_REUSEADDRSO_REUSEADDR</p>\n<p>TCP80</p>\n<p>SO_REUSEADDR</p>\n<p></p>\n<p>3ChannelOption.SO_KEEPALIVE</p>\n<p>Channeloption.SO_KEEPALIVESO_KEEPALIVETCP</p>\n<p>TCP</p>\n<p>4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF</p>\n<p>ChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF</p>\n<p></p>\n<p>5ChannelOption.SO_LINGER</p>\n<p>ChannelOption.SO_LINGERSO_LINGER,Linuxclose</p>\n<p>SO_LINGERclose()</p>\n<p>6ChannelOption.TCP_NODELAY</p>\n<p>ChannelOption.TCP_NODELAYTCP_NODELAY,Nagle</p>\n<p>Nagle,</p>\n<p>NagleTCP_NODELAYTCP_CORK</p>\n<p></p>\n<h3 id=\"http-budairenqin-iteye-com-blog-2215899\"><a href=\"#http-budairenqin-iteye-com-blog-2215899\" class=\"headerlink\" title=\"http://budairenqin.iteye.com/blog/2215899\"></a><a href=\"http://budairenqin.iteye.com/blog/2215899\" target=\"_blank\" rel=\"external\">http://budairenqin.iteye.com/blog/2215899</a></h3><p></p>\n","site":{"data":{}},"excerpt":"","more":"<p>nettyChannelOptionlinuxChannelOption</p>\n<p>ChannelOption</p>\n<p>1ChannelOption.SO_BACKLOG</p>\n<p>ChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)</p>\n<p>backlog</p>\n<p>2ChannelOption.SO_REUSEADDR</p>\n<p>ChanneOption.SO_REUSEADDRSO_REUSEADDR</p>\n<p>TCP80</p>\n<p>SO_REUSEADDR</p>\n<p></p>\n<p>3ChannelOption.SO_KEEPALIVE</p>\n<p>Channeloption.SO_KEEPALIVESO_KEEPALIVETCP</p>\n<p>TCP</p>\n<p>4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF</p>\n<p>ChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF</p>\n<p></p>\n<p>5ChannelOption.SO_LINGER</p>\n<p>ChannelOption.SO_LINGERSO_LINGER,Linuxclose</p>\n<p>SO_LINGERclose()</p>\n<p>6ChannelOption.TCP_NODELAY</p>\n<p>ChannelOption.TCP_NODELAYTCP_NODELAY,Nagle</p>\n<p>Nagle,</p>\n<p>NagleTCP_NODELAYTCP_CORK</p>\n<p></p>\n<h3 id=\"http-budairenqin-iteye-com-blog-2215899\"><a href=\"#http-budairenqin-iteye-com-blog-2215899\" class=\"headerlink\" title=\"http://budairenqin.iteye.com/blog/2215899\"></a><a href=\"http://budairenqin.iteye.com/blog/2215899\" target=\"_blank\" rel=\"external\">http://budairenqin.iteye.com/blog/2215899</a></h3><p></p>\n"},{"title":"Netty-","date":"2017-10-16T06:25:04.000Z","_content":"\n### Netty \nByteToMessageDecoderLengthFieldBasedFrameDecoder\n\n###  Future and Promise\n\n### Netty\n\nbytes and messages.\n\n### \ndebugnetty serverbossbossboss\n\nboss\n``` java\n NioEventLoopGroup boss = new NioEventLoopGroup(0, new ThreadFactory() {\n    @Override\n    public Thread newThread(Runnable r) {\n        return new Thread(r, \"boss-event-loop\");\n    }\n});\n```\nIntellijdebugnetty serverdebug tagThreads**Thread Group \"main\"****boss-event-loop**Running**boss-event-loop****suspend****Frames**tab\n\n### \nWeb Socket\nLong Pooling\n\n### NIO\n\n### Netty(watermark)\nhttps://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\nhttp://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\n\n### NettyNettyInbound()Outbound() Handler\n\n### Netty\n\nio\nmqmaster slave\nmysql\n\n\n### Netty bind()\n\n``` java\n@Override\nprotected void doRegister() throws Exception {\n    boolean selected = false;\n    for (;;) {\n        try {\n            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), 0, this);\n            return;\n        } catch (CancelledKeyException e) {\n            if (!selected) {\n                // Force the Selector to select now as the \"canceled\" SelectionKey may still be\n                // cached and not removed because no Select.select(..) operation was called yet.\n                eventLoop().selectNow();\n                selected = true;\n            } else {\n                // We forced a select operation on the selector before but the SelectionKey is still cached\n                // for whatever reason. JDK bug ?\n                throw e;\n            }\n        }\n    }\n}\n```\nregister0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT\n\n### sendBufRecBuf\n\n### Netty\nhttp://blog.csdn.net/asdfayw/article/details/71730543\n\n### Netty\nhttp://www.jianshu.com/p/890525ff73cb\nhttp://www.jianshu.com/p/8f22675d71ac\n\n### Netty\nhttp://blog.csdn.net/dc_726/article/details/48978891","source":"_posts/Netty-FAQ.md","raw":"---\ntitle: Netty-\ndate: 2017-10-16 14:25:04\ntags:\n---\n\n### Netty \nByteToMessageDecoderLengthFieldBasedFrameDecoder\n\n###  Future and Promise\n\n### Netty\n\nbytes and messages.\n\n### \ndebugnetty serverbossbossboss\n\nboss\n``` java\n NioEventLoopGroup boss = new NioEventLoopGroup(0, new ThreadFactory() {\n    @Override\n    public Thread newThread(Runnable r) {\n        return new Thread(r, \"boss-event-loop\");\n    }\n});\n```\nIntellijdebugnetty serverdebug tagThreads**Thread Group \"main\"****boss-event-loop**Running**boss-event-loop****suspend****Frames**tab\n\n### \nWeb Socket\nLong Pooling\n\n### NIO\n\n### Netty(watermark)\nhttps://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\nhttp://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\n\n### NettyNettyInbound()Outbound() Handler\n\n### Netty\n\nio\nmqmaster slave\nmysql\n\n\n### Netty bind()\n\n``` java\n@Override\nprotected void doRegister() throws Exception {\n    boolean selected = false;\n    for (;;) {\n        try {\n            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), 0, this);\n            return;\n        } catch (CancelledKeyException e) {\n            if (!selected) {\n                // Force the Selector to select now as the \"canceled\" SelectionKey may still be\n                // cached and not removed because no Select.select(..) operation was called yet.\n                eventLoop().selectNow();\n                selected = true;\n            } else {\n                // We forced a select operation on the selector before but the SelectionKey is still cached\n                // for whatever reason. JDK bug ?\n                throw e;\n            }\n        }\n    }\n}\n```\nregister0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT\n\n### sendBufRecBuf\n\n### Netty\nhttp://blog.csdn.net/asdfayw/article/details/71730543\n\n### Netty\nhttp://www.jianshu.com/p/890525ff73cb\nhttp://www.jianshu.com/p/8f22675d71ac\n\n### Netty\nhttp://blog.csdn.net/dc_726/article/details/48978891","slug":"Netty-FAQ","published":1,"updated":"2017-11-21T02:25:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyay9001w17q2y24n5elg","content":"<h3 id=\"Netty-\"><a href=\"#Netty-\" class=\"headerlink\" title=\"Netty \"></a>Netty </h3><p>ByteToMessageDecoderLengthFieldBasedFrameDecoder</p>\n<h3 id=\"-Future-and-Promise\"><a href=\"#-Future-and-Promise\" class=\"headerlink\" title=\" Future and Promise\"></a> Future and Promise</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>bytes and messages.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>debugnetty serverbossbossboss</p>\n<p>boss<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"> NioEventLoopGroup boss = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">0</span>, <span class=\"keyword\">new</span> ThreadFactory() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Thread(r, <span class=\"string\">\"boss-event-loop\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<p>Intellijdebugnetty serverdebug tagThreads<strong>Thread Group main</strong><strong>boss-event-loop</strong>Running<strong>boss-event-loop</strong><strong>suspend</strong><strong>Frames</strong>tab</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Web Socket<br>Long Pooling</p>\n<h3 id=\"NIO\"><a href=\"#NIO\" class=\"headerlink\" title=\"NIO\"></a>NIO</h3><h3 id=\"Netty-watermark-\"><a href=\"#Netty-watermark-\" class=\"headerlink\" title=\"Netty(watermark)\"></a>Netty(watermark)</h3><p><a href=\"https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\" target=\"_blank\" rel=\"external\">https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks</a><br><a href=\"http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\" target=\"_blank\" rel=\"external\">http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard</a></p>\n<h3 id=\"NettyNettyInbound--Outbound--Handler\"><a href=\"#NettyNettyInbound--Outbound--Handler\" class=\"headerlink\" title=\"NettyNettyInbound()Outbound() Handler\"></a>NettyNettyInbound()Outbound() Handler</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>io<br>mqmaster slave<br>mysql</p>\n<h3 id=\"Netty-bind-\"><a href=\"#Netty-bind-\" class=\"headerlink\" title=\"Netty bind()\"></a>Netty bind()</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doRegister</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> selected = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class=\"number\">0</span>, <span class=\"keyword\">this</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (CancelledKeyException e) &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (!selected) &#123;</div><div class=\"line\">                <span class=\"comment\">// Force the Selector to select now as the \"canceled\" SelectionKey may still be</span></div><div class=\"line\">                <span class=\"comment\">// cached and not removed because no Select.select(..) operation was called yet.</span></div><div class=\"line\">                eventLoop().selectNow();</div><div class=\"line\">                selected = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"comment\">// We forced a select operation on the selector before but the SelectionKey is still cached</span></div><div class=\"line\">                <span class=\"comment\">// for whatever reason. JDK bug ?</span></div><div class=\"line\">                <span class=\"keyword\">throw</span> e;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>register0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT</p>\n<h3 id=\"sendBufRecBuf\"><a href=\"#sendBufRecBuf\" class=\"headerlink\" title=\"sendBufRecBuf\"></a>sendBufRecBuf</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/asdfayw/article/details/71730543\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/asdfayw/article/details/71730543</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://www.jianshu.com/p/890525ff73cb\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/890525ff73cb</a><br><a href=\"http://www.jianshu.com/p/8f22675d71ac\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/8f22675d71ac</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/dc_726/article/details/48978891\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/dc_726/article/details/48978891</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Netty-\"><a href=\"#Netty-\" class=\"headerlink\" title=\"Netty \"></a>Netty </h3><p>ByteToMessageDecoderLengthFieldBasedFrameDecoder</p>\n<h3 id=\"-Future-and-Promise\"><a href=\"#-Future-and-Promise\" class=\"headerlink\" title=\" Future and Promise\"></a> Future and Promise</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>bytes and messages.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>debugnetty serverbossbossboss</p>\n<p>boss<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"> NioEventLoopGroup boss = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">0</span>, <span class=\"keyword\">new</span> ThreadFactory() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Thread(r, <span class=\"string\">\"boss-event-loop\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<p>Intellijdebugnetty serverdebug tagThreads<strong>Thread Group main</strong><strong>boss-event-loop</strong>Running<strong>boss-event-loop</strong><strong>suspend</strong><strong>Frames</strong>tab</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Web Socket<br>Long Pooling</p>\n<h3 id=\"NIO\"><a href=\"#NIO\" class=\"headerlink\" title=\"NIO\"></a>NIO</h3><h3 id=\"Netty-watermark-\"><a href=\"#Netty-watermark-\" class=\"headerlink\" title=\"Netty(watermark)\"></a>Netty(watermark)</h3><p><a href=\"https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\" target=\"_blank\" rel=\"external\">https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks</a><br><a href=\"http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\" target=\"_blank\" rel=\"external\">http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard</a></p>\n<h3 id=\"NettyNettyInbound--Outbound--Handler\"><a href=\"#NettyNettyInbound--Outbound--Handler\" class=\"headerlink\" title=\"NettyNettyInbound()Outbound() Handler\"></a>NettyNettyInbound()Outbound() Handler</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>io<br>mqmaster slave<br>mysql</p>\n<h3 id=\"Netty-bind-\"><a href=\"#Netty-bind-\" class=\"headerlink\" title=\"Netty bind()\"></a>Netty bind()</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doRegister</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> selected = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class=\"number\">0</span>, <span class=\"keyword\">this</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (CancelledKeyException e) &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (!selected) &#123;</div><div class=\"line\">                <span class=\"comment\">// Force the Selector to select now as the \"canceled\" SelectionKey may still be</span></div><div class=\"line\">                <span class=\"comment\">// cached and not removed because no Select.select(..) operation was called yet.</span></div><div class=\"line\">                eventLoop().selectNow();</div><div class=\"line\">                selected = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"comment\">// We forced a select operation on the selector before but the SelectionKey is still cached</span></div><div class=\"line\">                <span class=\"comment\">// for whatever reason. JDK bug ?</span></div><div class=\"line\">                <span class=\"keyword\">throw</span> e;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>register0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT</p>\n<h3 id=\"sendBufRecBuf\"><a href=\"#sendBufRecBuf\" class=\"headerlink\" title=\"sendBufRecBuf\"></a>sendBufRecBuf</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/asdfayw/article/details/71730543\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/asdfayw/article/details/71730543</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://www.jianshu.com/p/890525ff73cb\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/890525ff73cb</a><br><a href=\"http://www.jianshu.com/p/8f22675d71ac\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/8f22675d71ac</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/dc_726/article/details/48978891\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/dc_726/article/details/48978891</a></p>\n"},{"title":"RocketMQConsumer Rebalance ","date":"2017-09-25T08:58:43.000Z","_content":"","source":"_posts/RocketMQ-Consumer-rebalance.md","raw":"---\ntitle: RocketMQConsumer Rebalance \ndate: 2017-09-25 16:58:43\ntags: RocketMQ\n---\n","slug":"RocketMQ-Consumer-rebalance","published":1,"updated":"2017-10-31T08:56:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaya001y17q2tu809lun","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"RocketMQ","date":"2017-10-13T02:38:19.000Z","_content":"\n### \n\n``` java\nconsumer.registerMessageListener(new MessageListenerConcurrently() {\n    @Override\n    public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs,\n        ConsumeConcurrentlyContext context) {\n        // \n        boolean success = doConsume(msgs);\n        \n        if (success) {\n            return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n        } else {\n            return ConsumeConcurrentlyStatus.RECONSUME_LATER;\n        }\n    }\n});\n```\n\n### \n\n``` java\n\n```\n\n###  Best Effort Delivery","source":"_posts/RocketMQ-Delay-message-delivery.md","raw":"---\ntitle: RocketMQ\ndate: 2017-10-13 10:38:19\ntags: RocketMQ\n---\n\n### \n\n``` java\nconsumer.registerMessageListener(new MessageListenerConcurrently() {\n    @Override\n    public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs,\n        ConsumeConcurrentlyContext context) {\n        // \n        boolean success = doConsume(msgs);\n        \n        if (success) {\n            return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n        } else {\n            return ConsumeConcurrentlyStatus.RECONSUME_LATER;\n        }\n    }\n});\n```\n\n### \n\n``` java\n\n```\n\n###  Best Effort Delivery","slug":"RocketMQ-Delay-message-delivery","published":1,"updated":"2017-10-26T07:36:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayc002017q25pdwjob8","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">        ConsumeConcurrentlyContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// </span></div><div class=\"line\">        <span class=\"keyword\">boolean</span> success = doConsume(msgs);</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<h3 id=\"-Best-Effort-Delivery\"><a href=\"#-Best-Effort-Delivery\" class=\"headerlink\" title=\" Best Effort Delivery\"></a> Best Effort Delivery</h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">        ConsumeConcurrentlyContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// </span></div><div class=\"line\">        <span class=\"keyword\">boolean</span> success = doConsume(msgs);</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<h3 id=\"-Best-Effort-Delivery\"><a href=\"#-Best-Effort-Delivery\" class=\"headerlink\" title=\" Best Effort Delivery\"></a> Best Effort Delivery</h3>"},{"title":"RocketMQIntellij","date":"2017-08-20T05:28:52.000Z","_content":"\n### \n\n\nMQIntellijRemote debug\n\nMacRocketMQ\n\n### \n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n### Name Server\n\n### Broker\nBroker\nRocketMQBroker\nMasterSlave\n\nstore`System.getProperty(\"user.home\") + File.separator + \"store\"`\nMasterSlave`user.home`\n\nPortbroker-a.propertiesbroker-a-s.properties\n\n#### Master Broker\n\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties\n\nbroker-a.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=0\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SYNC_MASTER\nflushDiskType=ASYNC_FLUSH\nlistenPort=11111\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n#### Slave Broker\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties\n\nbroker-a-s.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\nlistenPort=22222\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n Name Server, Master Broker, Slave Broker Producer\n\nStore\n\n![](https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg)","source":"_posts/RocketMQ-Debug-with-intellij.md","raw":"---\ntitle: RocketMQIntellij\ndate: 2017-08-20 13:28:52\ntags: RocketMQ\n---\n\n### \n\n\nMQIntellijRemote debug\n\nMacRocketMQ\n\n### \n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n### Name Server\n\n### Broker\nBroker\nRocketMQBroker\nMasterSlave\n\nstore`System.getProperty(\"user.home\") + File.separator + \"store\"`\nMasterSlave`user.home`\n\nPortbroker-a.propertiesbroker-a-s.properties\n\n#### Master Broker\n\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties\n\nbroker-a.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=0\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SYNC_MASTER\nflushDiskType=ASYNC_FLUSH\nlistenPort=11111\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n#### Slave Broker\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties\n\nbroker-a-s.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\nlistenPort=22222\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n Name Server, Master Broker, Slave Broker Producer\n\nStore\n\n![](https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg)","slug":"RocketMQ-Debug-with-intellij","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayd002217q2g7vdqliz","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>MQIntellijRemote debug</p>\n<p>MacRocketMQ</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h3 id=\"Name-Server\"><a href=\"#Name-Server\" class=\"headerlink\" title=\"Name Server\"></a>Name Server</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h3><p>Broker<br>RocketMQBroker<br>MasterSlave</p>\n<p>store<code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>MasterSlave<code>user.home</code></p>\n<p>Portbroker-a.propertiesbroker-a-s.properties</p>\n<h4 id=\"Master-Broker\"><a href=\"#Master-Broker\" class=\"headerlink\" title=\"Master Broker\"></a>Master Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties</div><div class=\"line\"></div><div class=\"line\">broker-a.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=0</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SYNC_MASTER</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=11111</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h4 id=\"Slave-Broker\"><a href=\"#Slave-Broker\" class=\"headerlink\" title=\"Slave Broker\"></a>Slave Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties</div><div class=\"line\"></div><div class=\"line\">broker-a-s.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=1</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SLAVE</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=22222</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<p> Name Server, Master Broker, Slave Broker Producer</p>\n<p>Store</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>MQIntellijRemote debug</p>\n<p>MacRocketMQ</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h3 id=\"Name-Server\"><a href=\"#Name-Server\" class=\"headerlink\" title=\"Name Server\"></a>Name Server</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h3><p>Broker<br>RocketMQBroker<br>MasterSlave</p>\n<p>store<code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>MasterSlave<code>user.home</code></p>\n<p>Portbroker-a.propertiesbroker-a-s.properties</p>\n<h4 id=\"Master-Broker\"><a href=\"#Master-Broker\" class=\"headerlink\" title=\"Master Broker\"></a>Master Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties</div><div class=\"line\"></div><div class=\"line\">broker-a.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=0</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SYNC_MASTER</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=11111</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h4 id=\"Slave-Broker\"><a href=\"#Slave-Broker\" class=\"headerlink\" title=\"Slave Broker\"></a>Slave Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties</div><div class=\"line\"></div><div class=\"line\">broker-a-s.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=1</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SLAVE</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=22222</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<p> Name Server, Master Broker, Slave Broker Producer</p>\n<p>Store</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg\" alt=\"\"></p>\n"},{"title":"RocketMQIndexService ","date":"2017-10-12T11:29:40.000Z","_content":"\n\n#### RocmetMQIndexService\n\n![](RocketMQ-Index-service/index-file.gif)\n\nRocketMQIndexServiceMQ\n `System.getProperty(\"user.home\") + File.separator + \"store\"`\ntopic\n![image.png](http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\nMQIndexFileindex file\nindex file3IndexHead + HashSlotPart + MsgIndexPart\nIndexHead\n\nHashSlotPart\nhashMsgIndexPart\n4 Byte\nMsgIndexPart\nmsgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int\nMsgIndexPartcapacityappend\n\n\n\n \n`int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);`\n\nCommitLogDispatcherBuildIndexdispatch\n``` java\npublic void dispatch(DispatchRequest request) {\n    if (DefaultMessageStore.this.messageStoreConfig.isMessageIndexEnable()) {\n        DefaultMessageStore.this.indexService.buildIndex(request);\n    }\n}\n```\nbuildIndextopic#msgId=>msgIndex, topic#key1=>msgIndex, topic#key2=>msgIndex\n``` java\npublic void buildIndex(DispatchRequest req) {\n    IndexFile indexFile = retryGetAndCreateIndexFile();\n    if (indexFile != null) {\n        long endPhyOffset = indexFile.getEndPhyOffset();\n        DispatchRequest msg = req;\n        String topic = msg.getTopic();\n        String keys = msg.getKeys();\n\n        ...\n        if (req.getUniqKey() != null) {\n            // UniqKeymsgId\n            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));\n            ...\n        }\n\n        if (keys != null && keys.length() > 0) {\n            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);\n            for (int i = 0; i < keyset.length; i++) {\n                String key = keyset[i];\n                if (key.length() > 0) {\n                    // Key\n                    indexFile = putKey(indexFile, msg, buildKey(topic, key));\n                    ...\n                }\n            }\n        }\n    } else {\n        log.error(\"build index error, stop building index\");\n    }\n}\n```","source":"_posts/RocketMQ-Index-service.md","raw":"---\ntitle: RocketMQIndexService \ndate: 2017-10-12 19:29:40\ntags: RocketMQ\n---\n\n\n#### RocmetMQIndexService\n\n![](RocketMQ-Index-service/index-file.gif)\n\nRocketMQIndexServiceMQ\n `System.getProperty(\"user.home\") + File.separator + \"store\"`\ntopic\n![image.png](http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\nMQIndexFileindex file\nindex file3IndexHead + HashSlotPart + MsgIndexPart\nIndexHead\n\nHashSlotPart\nhashMsgIndexPart\n4 Byte\nMsgIndexPart\nmsgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int\nMsgIndexPartcapacityappend\n\n\n\n \n`int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);`\n\nCommitLogDispatcherBuildIndexdispatch\n``` java\npublic void dispatch(DispatchRequest request) {\n    if (DefaultMessageStore.this.messageStoreConfig.isMessageIndexEnable()) {\n        DefaultMessageStore.this.indexService.buildIndex(request);\n    }\n}\n```\nbuildIndextopic#msgId=>msgIndex, topic#key1=>msgIndex, topic#key2=>msgIndex\n``` java\npublic void buildIndex(DispatchRequest req) {\n    IndexFile indexFile = retryGetAndCreateIndexFile();\n    if (indexFile != null) {\n        long endPhyOffset = indexFile.getEndPhyOffset();\n        DispatchRequest msg = req;\n        String topic = msg.getTopic();\n        String keys = msg.getKeys();\n\n        ...\n        if (req.getUniqKey() != null) {\n            // UniqKeymsgId\n            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));\n            ...\n        }\n\n        if (keys != null && keys.length() > 0) {\n            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);\n            for (int i = 0; i < keyset.length; i++) {\n                String key = keyset[i];\n                if (key.length() > 0) {\n                    // Key\n                    indexFile = putKey(indexFile, msg, buildKey(topic, key));\n                    ...\n                }\n            }\n        }\n    } else {\n        log.error(\"build index error, stop building index\");\n    }\n}\n```","slug":"RocketMQ-Index-service","published":1,"updated":"2017-11-03T10:20:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaye002417q2l45py3j7","content":"<h4 id=\"RocmetMQIndexService\"><a href=\"#RocmetMQIndexService\" class=\"headerlink\" title=\"RocmetMQIndexService\"></a>RocmetMQIndexService</h4><p><img src=\"/2017/10/12/RocketMQ-Index-service/index-file.gif\" alt=\"\"></p>\n<p>RocketMQIndexServiceMQ<br> <code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>topic<br><img src=\"http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"><br>MQIndexFileindex file<br>index file3IndexHead + HashSlotPart + MsgIndexPart<br>IndexHead<br><br>HashSlotPart<br>hashMsgIndexPart<br>4 Byte<br>MsgIndexPart<br>msgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int<br>MsgIndexPartcapacityappend</p>\n<p><br><br><code>int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);</code></p>\n<p>CommitLogDispatcherBuildIndexdispatch<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (DefaultMessageStore.<span class=\"keyword\">this</span>.messageStoreConfig.isMessageIndexEnable()) &#123;</div><div class=\"line\">        DefaultMessageStore.<span class=\"keyword\">this</span>.indexService.buildIndex(request);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>buildIndextopic#msgId=&gt;msgIndex, topic#key1=&gt;msgIndex, topic#key2=&gt;msgIndex<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">buildIndex</span><span class=\"params\">(DispatchRequest req)</span> </span>&#123;</div><div class=\"line\">    IndexFile indexFile = retryGetAndCreateIndexFile();</div><div class=\"line\">    <span class=\"keyword\">if</span> (indexFile != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> endPhyOffset = indexFile.getEndPhyOffset();</div><div class=\"line\">        DispatchRequest msg = req;</div><div class=\"line\">        String topic = msg.getTopic();</div><div class=\"line\">        String keys = msg.getKeys();</div><div class=\"line\"></div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">if</span> (req.getUniqKey() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// UniqKeymsgId</span></div><div class=\"line\">            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (keys != <span class=\"keyword\">null</span> &amp;&amp; keys.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; keyset.length; i++) &#123;</div><div class=\"line\">                String key = keyset[i];</div><div class=\"line\">                <span class=\"keyword\">if</span> (key.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    <span class=\"comment\">// Key</span></div><div class=\"line\">                    indexFile = putKey(indexFile, msg, buildKey(topic, key));</div><div class=\"line\">                    ...</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        log.error(<span class=\"string\">\"build index error, stop building index\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"RocmetMQIndexService\"><a href=\"#RocmetMQIndexService\" class=\"headerlink\" title=\"RocmetMQIndexService\"></a>RocmetMQIndexService</h4><p><img src=\"/2017/10/12/RocketMQ-Index-service/index-file.gif\" alt=\"\"></p>\n<p>RocketMQIndexServiceMQ<br> <code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>topic<br><img src=\"http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"><br>MQIndexFileindex file<br>index file3IndexHead + HashSlotPart + MsgIndexPart<br>IndexHead<br><br>HashSlotPart<br>hashMsgIndexPart<br>4 Byte<br>MsgIndexPart<br>msgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int<br>MsgIndexPartcapacityappend</p>\n<p><br><br><code>int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);</code></p>\n<p>CommitLogDispatcherBuildIndexdispatch<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (DefaultMessageStore.<span class=\"keyword\">this</span>.messageStoreConfig.isMessageIndexEnable()) &#123;</div><div class=\"line\">        DefaultMessageStore.<span class=\"keyword\">this</span>.indexService.buildIndex(request);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>buildIndextopic#msgId=&gt;msgIndex, topic#key1=&gt;msgIndex, topic#key2=&gt;msgIndex<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">buildIndex</span><span class=\"params\">(DispatchRequest req)</span> </span>&#123;</div><div class=\"line\">    IndexFile indexFile = retryGetAndCreateIndexFile();</div><div class=\"line\">    <span class=\"keyword\">if</span> (indexFile != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> endPhyOffset = indexFile.getEndPhyOffset();</div><div class=\"line\">        DispatchRequest msg = req;</div><div class=\"line\">        String topic = msg.getTopic();</div><div class=\"line\">        String keys = msg.getKeys();</div><div class=\"line\"></div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">if</span> (req.getUniqKey() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// UniqKeymsgId</span></div><div class=\"line\">            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (keys != <span class=\"keyword\">null</span> &amp;&amp; keys.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; keyset.length; i++) &#123;</div><div class=\"line\">                String key = keyset[i];</div><div class=\"line\">                <span class=\"keyword\">if</span> (key.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    <span class=\"comment\">// Key</span></div><div class=\"line\">                    indexFile = putKey(indexFile, msg, buildKey(topic, key));</div><div class=\"line\">                    ...</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        log.error(<span class=\"string\">\"build index error, stop building index\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n"},{"title":"RocketMQ","date":"2017-08-09T06:42:53.000Z","_content":"\nRocketMQ\n\n#### RocketMQ\n\n\n\n#### MQ\n\nconsume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend messageconsumerQueuepull message\n\n#### MQNameServerZookeeper\n\n#### MQtopic\n\nMessageQueueSelectorList<MessageQueue> mqsbroker\n\n#### Brokertopicsendbroker\n\nClienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);\nMQpushlistenerack\n\n#### rebalance?    \n\nmq\n\n#### Netty\n\nCountDownLatch\n\n#### NameServerproducerconsumergetTopicRouteInfo\n\n1. UpdateRouteInfoTopic\n\n#### RocketMQ+\n\n+500ms\n\nClientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable\n\nSubscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest\n\nRebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset\n\n#### producerconsumer\n\nNettyReputService\n\n\n\n1. \n2. RocketMQ + \n\n\n\n#### BrokerprotectBroker\n\n#### CommitLogConsumerQueue\n\n#### RocketMQ\n\n1. consume_group*tag\n\n#### afkaOnewayproducerbrokerproducer\n\n#### RocketMQ\nProducerBrokerProducer GroupProducer\n2. Commit Log  MysqlOracle  redolog Commit\n   Log Consume Queue \n3. BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService\n\n#### DebugProducerProducerProducer3CommitLog\n\n#### MQCommitLogConsumeQueueCheckPoint\n\n#### \n\n\n\n#### Page Cache\n\n#### Consume QueueConsumer rebalance\n\nConsumerConsumer\n\n#### topicreadQ, writeQ, topic\n\n#### namesrv\n\n#### topicconsume queue0\n\n#### Consume queueDefaultMessageStore.ReputMessageServiceTopic\n\n#### namesrvBrokernamesrv\n\n#### topictagtopicconsumertag\n\n#### ConsumerQueue\n\n#### index file\n\n#### ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\n5. 4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS\n6. PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker\n\n#### MappedByteBuffer\n\nA MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer\n\n#### RocketMQ\n\nkafka\n\n#### \n\n#### 1s,5s,ns\n\n#### IndexService\n\n\n\n#### Netty\nnettychannelRead0workEventLoopGroup\nnettyClientWorkerThread\n\n#### netty eventLoopGroup \n\n#### \nServer:8080\ncurl 'localhost:8080'\nlsof -i:8080\n\n#### \n```\norg.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg\nSee http://rocketmq.apache.org/docs/faq/ for further details.\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)\n\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)\n\tat org.apache.rock\n```\n\n#### \n2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1\n2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure. \njava.lang.ArrayIndexOutOfBoundsException: -521875234\n\nrocketmq\n\n\n#### RocketMQ\n\n\n\n#### RocketMQ KEY\n\n#### RocketMQ\n\nRocketMQ LengthBasedField\n\n#### MQFlow Control\n\n#### RocketMQNameServer\n\n#### MasterSlaveMaster\n\n","source":"_posts/RocketMQ-FAQ.md","raw":"---\ntitle: RocketMQ\ndate: 2017-08-09 14:42:53\ntags: RocketMQ\n---\n\nRocketMQ\n\n#### RocketMQ\n\n\n\n#### MQ\n\nconsume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend messageconsumerQueuepull message\n\n#### MQNameServerZookeeper\n\n#### MQtopic\n\nMessageQueueSelectorList<MessageQueue> mqsbroker\n\n#### Brokertopicsendbroker\n\nClienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);\nMQpushlistenerack\n\n#### rebalance?    \n\nmq\n\n#### Netty\n\nCountDownLatch\n\n#### NameServerproducerconsumergetTopicRouteInfo\n\n1. UpdateRouteInfoTopic\n\n#### RocketMQ+\n\n+500ms\n\nClientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable\n\nSubscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest\n\nRebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset\n\n#### producerconsumer\n\nNettyReputService\n\n\n\n1. \n2. RocketMQ + \n\n\n\n#### BrokerprotectBroker\n\n#### CommitLogConsumerQueue\n\n#### RocketMQ\n\n1. consume_group*tag\n\n#### afkaOnewayproducerbrokerproducer\n\n#### RocketMQ\nProducerBrokerProducer GroupProducer\n2. Commit Log  MysqlOracle  redolog Commit\n   Log Consume Queue \n3. BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService\n\n#### DebugProducerProducerProducer3CommitLog\n\n#### MQCommitLogConsumeQueueCheckPoint\n\n#### \n\n\n\n#### Page Cache\n\n#### Consume QueueConsumer rebalance\n\nConsumerConsumer\n\n#### topicreadQ, writeQ, topic\n\n#### namesrv\n\n#### topicconsume queue0\n\n#### Consume queueDefaultMessageStore.ReputMessageServiceTopic\n\n#### namesrvBrokernamesrv\n\n#### topictagtopicconsumertag\n\n#### ConsumerQueue\n\n#### index file\n\n#### ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\n5. 4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS\n6. PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker\n\n#### MappedByteBuffer\n\nA MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer\n\n#### RocketMQ\n\nkafka\n\n#### \n\n#### 1s,5s,ns\n\n#### IndexService\n\n\n\n#### Netty\nnettychannelRead0workEventLoopGroup\nnettyClientWorkerThread\n\n#### netty eventLoopGroup \n\n#### \nServer:8080\ncurl 'localhost:8080'\nlsof -i:8080\n\n#### \n```\norg.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg\nSee http://rocketmq.apache.org/docs/faq/ for further details.\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)\n\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)\n\tat org.apache.rock\n```\n\n#### \n2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1\n2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure. \njava.lang.ArrayIndexOutOfBoundsException: -521875234\n\nrocketmq\n\n\n#### RocketMQ\n\n\n\n#### RocketMQ KEY\n\n#### RocketMQ\n\nRocketMQ LengthBasedField\n\n#### MQFlow Control\n\n#### RocketMQNameServer\n\n#### MasterSlaveMaster\n\n","slug":"RocketMQ-FAQ","published":1,"updated":"2017-11-20T07:18:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayg002617q2j5oldmwm","content":"<p>RocketMQ</p>\n<h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p></p>\n<h4 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h4><p>consume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend messageconsumerQueuepull message</p>\n<h4 id=\"MQNameServerZookeeper\"><a href=\"#MQNameServerZookeeper\" class=\"headerlink\" title=\"MQNameServerZookeeper\"></a>MQNameServerZookeeper</h4><h4 id=\"MQtopic\"><a href=\"#MQtopic\" class=\"headerlink\" title=\"MQtopic\"></a>MQtopic</h4><p>MessageQueueSelectorList<messagequeue> mqsbroker</messagequeue></p>\n<h4 id=\"Brokertopicsendbroker\"><a href=\"#Brokertopicsendbroker\" class=\"headerlink\" title=\"Brokertopicsendbroker\"></a>Brokertopicsendbroker</h4><p>Clienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);<br>MQpushlistenerack</p>\n<h4 id=\"rebalance\"><a href=\"#rebalance\" class=\"headerlink\" title=\"rebalance?\"></a>rebalance?</h4><p>mq</p>\n<h4 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h4><p>CountDownLatch</p>\n<h4 id=\"NameServerproducerconsumergetTopicRouteInfo\"><a href=\"#NameServerproducerconsumergetTopicRouteInfo\" class=\"headerlink\" title=\"NameServerproducerconsumergetTopicRouteInfo\"></a>NameServerproducerconsumergetTopicRouteInfo</h4><ol>\n<li>UpdateRouteInfoTopic</li>\n</ol>\n<h4 id=\"RocketMQ-\"><a href=\"#RocketMQ-\" class=\"headerlink\" title=\"RocketMQ+\"></a>RocketMQ+</h4><p>+500ms</p>\n<p>Clientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable</p>\n<p>Subscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest</p>\n<p>RebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset</p>\n<h4 id=\"producerconsumer\"><a href=\"#producerconsumer\" class=\"headerlink\" title=\"producerconsumer\"></a>producerconsumer</h4><p>NettyReputService</p>\n<p></p>\n<ol>\n<li></li>\n<li>RocketMQ + </li>\n</ol>\n<p></p>\n<h4 id=\"BrokerprotectBroker\"><a href=\"#BrokerprotectBroker\" class=\"headerlink\" title=\"BrokerprotectBroker\"></a>BrokerprotectBroker</h4><h4 id=\"CommitLogConsumerQueue\"><a href=\"#CommitLogConsumerQueue\" class=\"headerlink\" title=\"CommitLogConsumerQueue\"></a>CommitLogConsumerQueue</h4><h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><ol>\n<li>consume_group*tag</li>\n</ol>\n<h4 id=\"afkaOnewayproducerbrokerproducer\"><a href=\"#afkaOnewayproducerbrokerproducer\" class=\"headerlink\" title=\"afkaOnewayproducerbrokerproducer\"></a>afkaOnewayproducerbrokerproducer</h4><h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p>ProducerBrokerProducer GroupProducer</p>\n<ol>\n<li>Commit Log  MysqlOracle  redolog Commit<br>Log Consume Queue </li>\n<li>BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService</li>\n</ol>\n<h4 id=\"DebugProducerProducerProducer3CommitLog\"><a href=\"#DebugProducerProducerProducer3CommitLog\" class=\"headerlink\" title=\"DebugProducerProducerProducer3CommitLog\"></a>DebugProducerProducerProducer3CommitLog</h4><h4 id=\"MQCommitLogConsumeQueueCheckPoint\"><a href=\"#MQCommitLogConsumeQueueCheckPoint\" class=\"headerlink\" title=\"MQCommitLogConsumeQueueCheckPoint\"></a>MQCommitLogConsumeQueueCheckPoint</h4><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h4 id=\"Page-Cache\"><a href=\"#Page-Cache\" class=\"headerlink\" title=\"Page Cache\"></a>Page Cache</h4><h4 id=\"Consume-QueueConsumer-rebalance\"><a href=\"#Consume-QueueConsumer-rebalance\" class=\"headerlink\" title=\"Consume QueueConsumer rebalance\"></a>Consume QueueConsumer rebalance</h4><p>ConsumerConsumer</p>\n<h4 id=\"topicreadQ-writeQ-topic\"><a href=\"#topicreadQ-writeQ-topic\" class=\"headerlink\" title=\"topicreadQ, writeQ, topic\"></a>topicreadQ, writeQ, topic</h4><h4 id=\"namesrv\"><a href=\"#namesrv\" class=\"headerlink\" title=\"namesrv\"></a>namesrv</h4><h4 id=\"topicconsume-queue0\"><a href=\"#topicconsume-queue0\" class=\"headerlink\" title=\"topicconsume queue0\"></a>topicconsume queue0</h4><h4 id=\"Consume-queueDefaultMessageStore-ReputMessageServiceTopic\"><a href=\"#Consume-queueDefaultMessageStore-ReputMessageServiceTopic\" class=\"headerlink\" title=\"Consume queueDefaultMessageStore.ReputMessageServiceTopic\"></a>Consume queueDefaultMessageStore.ReputMessageServiceTopic</h4><h4 id=\"namesrvBrokernamesrv\"><a href=\"#namesrvBrokernamesrv\" class=\"headerlink\" title=\"namesrvBrokernamesrv\"></a>namesrvBrokernamesrv</h4><h4 id=\"topictagtopicconsumertag\"><a href=\"#topictagtopicconsumertag\" class=\"headerlink\" title=\"topictagtopicconsumertag\"></a>topictagtopicconsumertag</h4><h4 id=\"ConsumerQueue\"><a href=\"#ConsumerQueue\" class=\"headerlink\" title=\"ConsumerQueue\"></a>ConsumerQueue</h4><h4 id=\"index-file\"><a href=\"#index-file\" class=\"headerlink\" title=\"index file\"></a>index file</h4><h4 id=\"ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\"><a href=\"#ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\" class=\"headerlink\" title=\"ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\"></a>ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash</h4><ol>\n<li>4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS</li>\n<li>PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker</li>\n</ol>\n<h4 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h4><p>A MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer</p>\n<h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p>kafka</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h4 id=\"1s-5s-ns\"><a href=\"#1s-5s-ns\" class=\"headerlink\" title=\"1s,5s,ns\"></a>1s,5s,ns</h4><h4 id=\"IndexService\"><a href=\"#IndexService\" class=\"headerlink\" title=\"IndexService\"></a>IndexService</h4><p></p>\n<h4 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h4><p>nettychannelRead0workEventLoopGroup<br>nettyClientWorkerThread</p>\n<h4 id=\"netty-eventLoopGroup-\"><a href=\"#netty-eventLoopGroup-\" class=\"headerlink\" title=\"netty eventLoopGroup \"></a>netty eventLoopGroup </h4><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Server:8080<br>curl localhost:8080<br>lsof -i:8080</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">org.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg</div><div class=\"line\">See http://rocketmq.apache.org/docs/faq/ for further details.</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)</div><div class=\"line\">\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)</div><div class=\"line\">\tat org.apache.rock</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1<br>2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure.<br>java.lang.ArrayIndexOutOfBoundsException: -521875234</p>\n<p>rocketmq</p>\n<h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p></p>\n<h4 id=\"RocketMQ-KEY\"><a href=\"#RocketMQ-KEY\" class=\"headerlink\" title=\"RocketMQ KEY\"></a>RocketMQ KEY</h4><h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p>RocketMQ LengthBasedField</p>\n<h4 id=\"MQFlow-Control\"><a href=\"#MQFlow-Control\" class=\"headerlink\" title=\"MQFlow Control\"></a>MQFlow Control</h4><h4 id=\"RocketMQNameServer\"><a href=\"#RocketMQNameServer\" class=\"headerlink\" title=\"RocketMQNameServer\"></a>RocketMQNameServer</h4><h4 id=\"MasterSlaveMaster\"><a href=\"#MasterSlaveMaster\" class=\"headerlink\" title=\"MasterSlaveMaster\"></a>MasterSlaveMaster</h4>","site":{"data":{}},"excerpt":"","more":"<p>RocketMQ</p>\n<h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p></p>\n<h4 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h4><p>consume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend messageconsumerQueuepull message</p>\n<h4 id=\"MQNameServerZookeeper\"><a href=\"#MQNameServerZookeeper\" class=\"headerlink\" title=\"MQNameServerZookeeper\"></a>MQNameServerZookeeper</h4><h4 id=\"MQtopic\"><a href=\"#MQtopic\" class=\"headerlink\" title=\"MQtopic\"></a>MQtopic</h4><p>MessageQueueSelectorList<messagequeue> mqsbroker</messagequeue></p>\n<h4 id=\"Brokertopicsendbroker\"><a href=\"#Brokertopicsendbroker\" class=\"headerlink\" title=\"Brokertopicsendbroker\"></a>Brokertopicsendbroker</h4><p>Clienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);<br>MQpushlistenerack</p>\n<h4 id=\"rebalance\"><a href=\"#rebalance\" class=\"headerlink\" title=\"rebalance?\"></a>rebalance?</h4><p>mq</p>\n<h4 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h4><p>CountDownLatch</p>\n<h4 id=\"NameServerproducerconsumergetTopicRouteInfo\"><a href=\"#NameServerproducerconsumergetTopicRouteInfo\" class=\"headerlink\" title=\"NameServerproducerconsumergetTopicRouteInfo\"></a>NameServerproducerconsumergetTopicRouteInfo</h4><ol>\n<li>UpdateRouteInfoTopic</li>\n</ol>\n<h4 id=\"RocketMQ-\"><a href=\"#RocketMQ-\" class=\"headerlink\" title=\"RocketMQ+\"></a>RocketMQ+</h4><p>+500ms</p>\n<p>Clientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable</p>\n<p>Subscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest</p>\n<p>RebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset</p>\n<h4 id=\"producerconsumer\"><a href=\"#producerconsumer\" class=\"headerlink\" title=\"producerconsumer\"></a>producerconsumer</h4><p>NettyReputService</p>\n<p></p>\n<ol>\n<li></li>\n<li>RocketMQ + </li>\n</ol>\n<p></p>\n<h4 id=\"BrokerprotectBroker\"><a href=\"#BrokerprotectBroker\" class=\"headerlink\" title=\"BrokerprotectBroker\"></a>BrokerprotectBroker</h4><h4 id=\"CommitLogConsumerQueue\"><a href=\"#CommitLogConsumerQueue\" class=\"headerlink\" title=\"CommitLogConsumerQueue\"></a>CommitLogConsumerQueue</h4><h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><ol>\n<li>consume_group*tag</li>\n</ol>\n<h4 id=\"afkaOnewayproducerbrokerproducer\"><a href=\"#afkaOnewayproducerbrokerproducer\" class=\"headerlink\" title=\"afkaOnewayproducerbrokerproducer\"></a>afkaOnewayproducerbrokerproducer</h4><h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p>ProducerBrokerProducer GroupProducer</p>\n<ol>\n<li>Commit Log  MysqlOracle  redolog Commit<br>Log Consume Queue </li>\n<li>BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService</li>\n</ol>\n<h4 id=\"DebugProducerProducerProducer3CommitLog\"><a href=\"#DebugProducerProducerProducer3CommitLog\" class=\"headerlink\" title=\"DebugProducerProducerProducer3CommitLog\"></a>DebugProducerProducerProducer3CommitLog</h4><h4 id=\"MQCommitLogConsumeQueueCheckPoint\"><a href=\"#MQCommitLogConsumeQueueCheckPoint\" class=\"headerlink\" title=\"MQCommitLogConsumeQueueCheckPoint\"></a>MQCommitLogConsumeQueueCheckPoint</h4><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h4 id=\"Page-Cache\"><a href=\"#Page-Cache\" class=\"headerlink\" title=\"Page Cache\"></a>Page Cache</h4><h4 id=\"Consume-QueueConsumer-rebalance\"><a href=\"#Consume-QueueConsumer-rebalance\" class=\"headerlink\" title=\"Consume QueueConsumer rebalance\"></a>Consume QueueConsumer rebalance</h4><p>ConsumerConsumer</p>\n<h4 id=\"topicreadQ-writeQ-topic\"><a href=\"#topicreadQ-writeQ-topic\" class=\"headerlink\" title=\"topicreadQ, writeQ, topic\"></a>topicreadQ, writeQ, topic</h4><h4 id=\"namesrv\"><a href=\"#namesrv\" class=\"headerlink\" title=\"namesrv\"></a>namesrv</h4><h4 id=\"topicconsume-queue0\"><a href=\"#topicconsume-queue0\" class=\"headerlink\" title=\"topicconsume queue0\"></a>topicconsume queue0</h4><h4 id=\"Consume-queueDefaultMessageStore-ReputMessageServiceTopic\"><a href=\"#Consume-queueDefaultMessageStore-ReputMessageServiceTopic\" class=\"headerlink\" title=\"Consume queueDefaultMessageStore.ReputMessageServiceTopic\"></a>Consume queueDefaultMessageStore.ReputMessageServiceTopic</h4><h4 id=\"namesrvBrokernamesrv\"><a href=\"#namesrvBrokernamesrv\" class=\"headerlink\" title=\"namesrvBrokernamesrv\"></a>namesrvBrokernamesrv</h4><h4 id=\"topictagtopicconsumertag\"><a href=\"#topictagtopicconsumertag\" class=\"headerlink\" title=\"topictagtopicconsumertag\"></a>topictagtopicconsumertag</h4><h4 id=\"ConsumerQueue\"><a href=\"#ConsumerQueue\" class=\"headerlink\" title=\"ConsumerQueue\"></a>ConsumerQueue</h4><h4 id=\"index-file\"><a href=\"#index-file\" class=\"headerlink\" title=\"index file\"></a>index file</h4><h4 id=\"ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\"><a href=\"#ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\" class=\"headerlink\" title=\"ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\"></a>ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash</h4><ol>\n<li>4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS</li>\n<li>PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker</li>\n</ol>\n<h4 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h4><p>A MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer</p>\n<h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p>kafka</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h4 id=\"1s-5s-ns\"><a href=\"#1s-5s-ns\" class=\"headerlink\" title=\"1s,5s,ns\"></a>1s,5s,ns</h4><h4 id=\"IndexService\"><a href=\"#IndexService\" class=\"headerlink\" title=\"IndexService\"></a>IndexService</h4><p></p>\n<h4 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h4><p>nettychannelRead0workEventLoopGroup<br>nettyClientWorkerThread</p>\n<h4 id=\"netty-eventLoopGroup-\"><a href=\"#netty-eventLoopGroup-\" class=\"headerlink\" title=\"netty eventLoopGroup \"></a>netty eventLoopGroup </h4><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Server:8080<br>curl localhost:8080<br>lsof -i:8080</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">org.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg</div><div class=\"line\">See http://rocketmq.apache.org/docs/faq/ for further details.</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)</div><div class=\"line\">\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)</div><div class=\"line\">\tat org.apache.rock</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1<br>2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure.<br>java.lang.ArrayIndexOutOfBoundsException: -521875234</p>\n<p>rocketmq</p>\n<h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p></p>\n<h4 id=\"RocketMQ-KEY\"><a href=\"#RocketMQ-KEY\" class=\"headerlink\" title=\"RocketMQ KEY\"></a>RocketMQ KEY</h4><h4 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h4><p>RocketMQ LengthBasedField</p>\n<h4 id=\"MQFlow-Control\"><a href=\"#MQFlow-Control\" class=\"headerlink\" title=\"MQFlow Control\"></a>MQFlow Control</h4><h4 id=\"RocketMQNameServer\"><a href=\"#RocketMQNameServer\" class=\"headerlink\" title=\"RocketMQNameServer\"></a>RocketMQNameServer</h4><h4 id=\"MasterSlaveMaster\"><a href=\"#MasterSlaveMaster\" class=\"headerlink\" title=\"MasterSlaveMaster\"></a>MasterSlaveMaster</h4>"},{"title":"RocketMQBroker","date":"2017-10-12T08:28:24.000Z","_content":"\n``` java\n\n```\n![](https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg)","source":"_posts/RocketMQ-Master-slave-high-availability.md","raw":"---\ntitle: RocketMQBroker\ndate: 2017-10-12 16:28:24\ntags: RocketMQ\n---\n\n``` java\n\n```\n![](https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg)","slug":"RocketMQ-Master-slave-high-availability","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayh002817q2645q57vn","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<p><img src=\"https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<p><img src=\"https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg\" alt=\"\"></p>\n"},{"title":"RocketMQNetty","date":"2017-08-21T04:36:42.000Z","_content":"\n### Netty IO\nnettyIOAPInetty\n\n### Remote\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png)\n\n### Remote\nCaller\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png)\n\n###","source":"_posts/RocketMQ-Netty-imp-sync-and-async-invoke.md","raw":"---\ntitle: RocketMQNetty\ndate: 2017-08-21 12:36:42\ntags: RocketMQ\n---\n\n### Netty IO\nnettyIOAPInetty\n\n### Remote\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png)\n\n### Remote\nCaller\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png)\n\n###","slug":"RocketMQ-Netty-imp-sync-and-async-invoke","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayi002a17q2vvfexe3f","content":"<h3 id=\"Netty-IO\"><a href=\"#Netty-IO\" class=\"headerlink\" title=\"Netty IO\"></a>Netty IO</h3><p>nettyIOAPInetty</p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png\" alt=\"\"></p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p>Caller<br><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png\" alt=\"\"></p>\n<p>###</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Netty-IO\"><a href=\"#Netty-IO\" class=\"headerlink\" title=\"Netty IO\"></a>Netty IO</h3><p>nettyIOAPInetty</p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png\" alt=\"\"></p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p>Caller<br><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png\" alt=\"\"></p>\n<p>###</p>\n"},{"title":"RocketMQ","date":"2017-11-03T06:38:10.000Z","_content":"\n\n### \n\n``` java\n// Synchronization flush\nif (FlushDiskType.SYNC_FLUSH == this.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) {\n    final GroupCommitService service = (GroupCommitService) this.flushCommitLogService;\n}\n// Asynchronous flush\nelse {\n    if (!this.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) {\n        // FlushRealTimeService\n        flushCommitLogService.wakeup();\n    } else {\n        // CommitRealTimeService\n        commitLogService.wakeup();\n    }\n}\n```\n\n``` java\npublic boolean isTransientStorePoolEnable() {\n    return transientStorePoolEnable && FlushDiskType.ASYNC_FLUSH == getFlushDiskType()\n        && BrokerRole.SLAVE != getBrokerRole();\n}\n```\n\ntransientStorePoolEnable\nFlushRealTimeServiceCommitRealTimeService\n\n![](RocketMQ-Message-send-and-persistence/disc-fall.gif)\n\n### Offset: ConsumerQueue\n\n\n### Offset: CommitLog\n\n### MappedByteBuffer\n\nMappedByteBufferBuffer\nCommitLogCommitLogAppend\n\n*synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n*JDK1.6BownAAJVMAJVMBBAAhttp://blog.csdn.net/u013080921/article/details/42676231\n\n#### Spin Lock()\n\n#### ReentrantLock()\n\n\n### \n\nhttp://blog.csdn.net/vonzhoufz/article/details/47248777\n\n#### \n\nhttps://kafka.apache.org/documentation/#design_filesystem\n\nhttp://blog.csdn.net/evankaka/article/details/48464013\n\nhttp://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&fps=1\nkafkahttp://blog.csdn.net/tototuzuoquan/article/details/73437890\npagecache\n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\n PAGESIZE\n``` bash\ngetconf PAGESIZE\n```\n\n KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache \n\n commit(atLeastSize)pagecache\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\nConsume Queue  Page Cache\nCommit Log \n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\n1).page cache. page cache, IO, . , , .\npage cache , 1k, , , .\nCommit Log, IONOOP, , 5.\n4k, 8K.\nConsume Queue, , PAGECACHE, Consume Queue, . Consume Queue.\n2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .\n\nhttps://segmentfault.com/a/1190000003985468\nkafka\n\n\n\nlinuxlinuxlinux\n\n### \n\npage cachepage cachepage cachedisc\n\nMQpagecachejvm crash\n\ncommit logconsume queuepagecachejava heappagecachepagecachedisc\n\nproducer\n1.consume queuepagecachepagecache\n2.commit logpagecacheIO\n\npagecachepagecachepagecachesocketconsumer\n\nMappedByteBuffer \nMappedByteBuffer\n\nhttp://www.iocoder.cn/RocketMQ/message-store/\nCommitRealTimeService\t && \t\nFlushRealTimeService\t && \t\nGroupCommitService\t\t\n\n\nhttp://blog.csdn.net/iie_libi/article/details/54289580\n\n\nConsumer  sendfile RocketMQmmap+write\n \n  DMA  sendfile CPUJVM Crash\n\n\n\next4\niodeadlinedeadline IO \n\n\n\n\n+ \n\npagecache\n\nRocketMQFileChannel.map()MappedByteBufferBufferMQ\n``` java\npublic static void clean(final ByteBuffer buffer) {\n    if (buffer == null || !buffer.isDirect() || buffer.capacity() == 0)\n        return;\n    invoke(invoke(viewed(buffer), \"cleaner\"), \"clean\");\n}\n```\n\n``` java\nprivate static class Deallocator\n        implements Runnable {\n    private static Unsafe unsafe = Unsafe.getUnsafe();\n\n    private long address;\n    private long size;\n    private int capacity;\n\n    private Deallocator(long address, long size, int capacity) {\n        assert (address != 0);\n        this.address = address;\n        this.size = size;\n        this.capacity = capacity;\n    }\n\n    public void run() {\n        if (address == 0) {\n            // Paranoia\n            return;\n        }\n        unsafe.freeMemory(address);\n        address = 0;\n        Bits.unreserveMemory(size, capacity);\n    }\n\n}\n```\n\nFull GCFull GCDisableExplicitGCGCFull GC\n\n  pagecacheIO \nrocketmq\n\n \n PAGECACHE  1k \n  Commit Log  IO NOOP 5 \n \n \n \n 1+\n a) \n b) \n 2\n a) \n 3xxhashcrc\n a) https://cyan4973.github.io/xxHash/\n 4topic\n a) topic\n 5STLdequeMESA list\n a) Dequevector\n b) \n 6MESA list\n a) +logn\n b)  \n i. leveldbhbase\n \n _java.nio.channels.FileChannel_\n `public abstract void force(boolean metaData) throws java.io.IOException`\n Forces any updates to this channel's file to be written to the storage device that contains it.\n If this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\n If the file does not reside on a local device then no such guarantee is made.\n The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\n Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\n This method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n \n _java.nio.MappedByteBuffer_\n `public final MappedByteBuffer force()`\n Forces any changes made to this buffer's content to be written to the storage device containing the mapped file.\n If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\n If the file does not reside on a local device then no such guarantee is made.\n If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n \n \n ### \n \n http://blog.csdn.net/a417930422/article/details/52585862\n\n\n\nwangbin00162017-08-08 17:011\n -sendfile java\nFileChannel.transferTo(long position, long count, WritableByteChannel target)//\n\nrocketmq  RocketMQmmap+writesendfile\n\nnettyFileRegion FileChannel.transferTo\n\nFileRegion fileRegion =\nnew ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);\nchannel.writeAndFlush(fileRegion)\n              2\n             a417930422\n            a4179304222017-09-21 10:35\n            wangbin0016rocketmqmmapjavaMappedByteBuffer\n             a417930422\n            a4179304222017-09-21 10:32\n            wangbin0016rocketmqConsumer mmap+writerocketmqhttp://blog.csdn.net/a417930422/article/details/52585180.\n            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket\n            GetMessageResultmmap\n             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage","source":"_posts/RocketMQ-Message-send-and-persistence.md","raw":"---\ntitle: RocketMQ\ndate: 2017-11-03 14:38:10\ntags: RocketMQ\n---\n\n\n### \n\n``` java\n// Synchronization flush\nif (FlushDiskType.SYNC_FLUSH == this.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) {\n    final GroupCommitService service = (GroupCommitService) this.flushCommitLogService;\n}\n// Asynchronous flush\nelse {\n    if (!this.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) {\n        // FlushRealTimeService\n        flushCommitLogService.wakeup();\n    } else {\n        // CommitRealTimeService\n        commitLogService.wakeup();\n    }\n}\n```\n\n``` java\npublic boolean isTransientStorePoolEnable() {\n    return transientStorePoolEnable && FlushDiskType.ASYNC_FLUSH == getFlushDiskType()\n        && BrokerRole.SLAVE != getBrokerRole();\n}\n```\n\ntransientStorePoolEnable\nFlushRealTimeServiceCommitRealTimeService\n\n![](RocketMQ-Message-send-and-persistence/disc-fall.gif)\n\n### Offset: ConsumerQueue\n\n\n### Offset: CommitLog\n\n### MappedByteBuffer\n\nMappedByteBufferBuffer\nCommitLogCommitLogAppend\n\n*synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n*JDK1.6BownAAJVMAJVMBBAAhttp://blog.csdn.net/u013080921/article/details/42676231\n\n#### Spin Lock()\n\n#### ReentrantLock()\n\n\n### \n\nhttp://blog.csdn.net/vonzhoufz/article/details/47248777\n\n#### \n\nhttps://kafka.apache.org/documentation/#design_filesystem\n\nhttp://blog.csdn.net/evankaka/article/details/48464013\n\nhttp://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&fps=1\nkafkahttp://blog.csdn.net/tototuzuoquan/article/details/73437890\npagecache\n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\n PAGESIZE\n``` bash\ngetconf PAGESIZE\n```\n\n KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache \n\n commit(atLeastSize)pagecache\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\nConsume Queue  Page Cache\nCommit Log \n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\n1).page cache. page cache, IO, . , , .\npage cache , 1k, , , .\nCommit Log, IONOOP, , 5.\n4k, 8K.\nConsume Queue, , PAGECACHE, Consume Queue, . Consume Queue.\n2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .\n\nhttps://segmentfault.com/a/1190000003985468\nkafka\n\n\n\nlinuxlinuxlinux\n\n### \n\npage cachepage cachepage cachedisc\n\nMQpagecachejvm crash\n\ncommit logconsume queuepagecachejava heappagecachepagecachedisc\n\nproducer\n1.consume queuepagecachepagecache\n2.commit logpagecacheIO\n\npagecachepagecachepagecachesocketconsumer\n\nMappedByteBuffer \nMappedByteBuffer\n\nhttp://www.iocoder.cn/RocketMQ/message-store/\nCommitRealTimeService\t && \t\nFlushRealTimeService\t && \t\nGroupCommitService\t\t\n\n\nhttp://blog.csdn.net/iie_libi/article/details/54289580\n\n\nConsumer  sendfile RocketMQmmap+write\n \n  DMA  sendfile CPUJVM Crash\n\n\n\next4\niodeadlinedeadline IO \n\n\n\n\n+ \n\npagecache\n\nRocketMQFileChannel.map()MappedByteBufferBufferMQ\n``` java\npublic static void clean(final ByteBuffer buffer) {\n    if (buffer == null || !buffer.isDirect() || buffer.capacity() == 0)\n        return;\n    invoke(invoke(viewed(buffer), \"cleaner\"), \"clean\");\n}\n```\n\n``` java\nprivate static class Deallocator\n        implements Runnable {\n    private static Unsafe unsafe = Unsafe.getUnsafe();\n\n    private long address;\n    private long size;\n    private int capacity;\n\n    private Deallocator(long address, long size, int capacity) {\n        assert (address != 0);\n        this.address = address;\n        this.size = size;\n        this.capacity = capacity;\n    }\n\n    public void run() {\n        if (address == 0) {\n            // Paranoia\n            return;\n        }\n        unsafe.freeMemory(address);\n        address = 0;\n        Bits.unreserveMemory(size, capacity);\n    }\n\n}\n```\n\nFull GCFull GCDisableExplicitGCGCFull GC\n\n  pagecacheIO \nrocketmq\n\n \n PAGECACHE  1k \n  Commit Log  IO NOOP 5 \n \n \n \n 1+\n a) \n b) \n 2\n a) \n 3xxhashcrc\n a) https://cyan4973.github.io/xxHash/\n 4topic\n a) topic\n 5STLdequeMESA list\n a) Dequevector\n b) \n 6MESA list\n a) +logn\n b)  \n i. leveldbhbase\n \n _java.nio.channels.FileChannel_\n `public abstract void force(boolean metaData) throws java.io.IOException`\n Forces any updates to this channel's file to be written to the storage device that contains it.\n If this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\n If the file does not reside on a local device then no such guarantee is made.\n The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\n Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\n This method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n \n _java.nio.MappedByteBuffer_\n `public final MappedByteBuffer force()`\n Forces any changes made to this buffer's content to be written to the storage device containing the mapped file.\n If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\n If the file does not reside on a local device then no such guarantee is made.\n If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n \n \n ### \n \n http://blog.csdn.net/a417930422/article/details/52585862\n\n\n\nwangbin00162017-08-08 17:011\n -sendfile java\nFileChannel.transferTo(long position, long count, WritableByteChannel target)//\n\nrocketmq  RocketMQmmap+writesendfile\n\nnettyFileRegion FileChannel.transferTo\n\nFileRegion fileRegion =\nnew ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);\nchannel.writeAndFlush(fileRegion)\n              2\n             a417930422\n            a4179304222017-09-21 10:35\n            wangbin0016rocketmqmmapjavaMappedByteBuffer\n             a417930422\n            a4179304222017-09-21 10:32\n            wangbin0016rocketmqConsumer mmap+writerocketmqhttp://blog.csdn.net/a417930422/article/details/52585180.\n            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket\n            GetMessageResultmmap\n             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage","slug":"RocketMQ-Message-send-and-persistence","published":1,"updated":"2017-11-20T03:08:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayk002c17q2ga1ovz8u","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Synchronization flush</span></div><div class=\"line\"><span class=\"keyword\">if</span> (FlushDiskType.SYNC_FLUSH == <span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> GroupCommitService service = (GroupCommitService) <span class=\"keyword\">this</span>.flushCommitLogService;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">// Asynchronous flush</span></div><div class=\"line\"><span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) &#123;</div><div class=\"line\">        <span class=\"comment\">// FlushRealTimeService</span></div><div class=\"line\">        flushCommitLogService.wakeup();</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// CommitRealTimeService</span></div><div class=\"line\">        commitLogService.wakeup();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTransientStorePoolEnable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> transientStorePoolEnable &amp;&amp; FlushDiskType.ASYNC_FLUSH == getFlushDiskType()</div><div class=\"line\">        &amp;&amp; BrokerRole.SLAVE != getBrokerRole();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>transientStorePoolEnable<br>FlushRealTimeServiceCommitRealTimeService</p>\n<p><img src=\"/2017/11/03/RocketMQ-Message-send-and-persistence/disc-fall.gif\" alt=\"\"></p>\n<h3 id=\"Offset-ConsumerQueue\"><a href=\"#Offset-ConsumerQueue\" class=\"headerlink\" title=\"Offset: ConsumerQueue\"></a>Offset: ConsumerQueue</h3><h3 id=\"Offset-CommitLog\"><a href=\"#Offset-CommitLog\" class=\"headerlink\" title=\"Offset: CommitLog\"></a>Offset: CommitLog</h3><h3 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h3><p>MappedByteBufferBuffer<br>CommitLogCommitLogAppend</p>\n<p><em>synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n</em>JDK1.6BownAAJVMAJVMBBAA<a href=\"http://blog.csdn.net/u013080921/article/details/42676231\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/u013080921/article/details/42676231</a></p>\n<h4 id=\"Spin-Lock-\"><a href=\"#Spin-Lock-\" class=\"headerlink\" title=\"Spin Lock()\"></a>Spin Lock()</h4><h4 id=\"ReentrantLock-\"><a href=\"#ReentrantLock-\" class=\"headerlink\" title=\"ReentrantLock()\"></a>ReentrantLock()</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/vonzhoufz/article/details/47248777\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/vonzhoufz/article/details/47248777</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://kafka.apache.org/documentation/#design_filesystem\" target=\"_blank\" rel=\"external\">https://kafka.apache.org/documentation/#design_filesystem</a></p>\n<p><a href=\"http://blog.csdn.net/evankaka/article/details/48464013\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/evankaka/article/details/48464013</a></p>\n<p><a href=\"http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1</a><br>kafka<a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a><br>pagecache</p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p> PAGESIZE<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">getconf PAGESIZE</div></pre></td></tr></table></figure></p>\n<p> KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache </p>\n<p> commit(atLeastSize)pagecache</p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>Consume Queue  Page Cache<br>Commit Log </p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>1).page cache. page cache, IO, . , , .<br>page cache , 1k, , , .<br>Commit Log, IONOOP, , 5.<br>4k, 8K.<br>Consume Queue, , PAGECACHE, Consume Queue, . Consume Queue.<br>2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .</p>\n<p><a href=\"https://segmentfault.com/a/1190000003985468\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000003985468</a><br>kafka</p>\n<p>linuxlinuxlinux</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>page cachepage cachepage cachedisc</p>\n<p>MQpagecachejvm crash</p>\n<p>commit logconsume queuepagecachejava heappagecachepagecachedisc</p>\n<p>producer<br>1.consume queuepagecachepagecache<br>2.commit logpagecacheIO</p>\n<p>pagecachepagecachepagecachesocketconsumer</p>\n<p>MappedByteBuffer <br>MappedByteBuffer</p>\n<p><a href=\"http://www.iocoder.cn/RocketMQ/message-store/\" target=\"_blank\" rel=\"external\">http://www.iocoder.cn/RocketMQ/message-store/</a><br>CommitRealTimeService     &amp;&amp;     <br>FlushRealTimeService     &amp;&amp;     <br>GroupCommitService        <br></p>\n<p><a href=\"http://blog.csdn.net/iie_libi/article/details/54289580\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/iie_libi/article/details/54289580</a><br></p>\n<p>Consumer  sendfile RocketMQmmap+write<br> <br>  DMA  sendfile CPUJVM Crash</p>\n<p></p>\n<p>ext4<br>iodeadlinedeadline IO </p>\n<p></p>\n<p><br>+ </p>\n<p>pagecache</p>\n<p>RocketMQFileChannel.map()MappedByteBufferBufferMQ<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">clean</span><span class=\"params\">(<span class=\"keyword\">final</span> ByteBuffer buffer)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (buffer == <span class=\"keyword\">null</span> || !buffer.isDirect() || buffer.capacity() == <span class=\"number\">0</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    invoke(invoke(viewed(buffer), <span class=\"string\">\"cleaner\"</span>), <span class=\"string\">\"clean\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Deallocator</span></span></div><div class=\"line\"><span class=\"class\">        <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Unsafe unsafe = Unsafe.getUnsafe();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> address;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> size;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> capacity;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Deallocator</span><span class=\"params\">(<span class=\"keyword\">long</span> address, <span class=\"keyword\">long</span> size, <span class=\"keyword\">int</span> capacity)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">assert</span> (address != <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">        <span class=\"keyword\">this</span>.size = size;</div><div class=\"line\">        <span class=\"keyword\">this</span>.capacity = capacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (address == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// Paranoia</span></div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        unsafe.freeMemory(address);</div><div class=\"line\">        address = <span class=\"number\">0</span>;</div><div class=\"line\">        Bits.unreserveMemory(size, capacity);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Full GCFull GCDisableExplicitGCGCFull GC</p>\n<p>  pagecacheIO <br>rocketmq<br><br> <br> PAGECACHE  1k <br>  Commit Log  IO NOOP 5 </p>\n<p> </p>\n<p> 1+<br> a) <br> b) <br> 2<br> a) <br> 3xxhashcrc<br> a) <a href=\"https://cyan4973.github.io/xxHash/\" target=\"_blank\" rel=\"external\">https://cyan4973.github.io/xxHash/</a><br> 4topic<br> a) topic<br> 5STLdequeMESA list<br> a) Dequevector<br> b) <br> 6MESA list<br> a) +logn<br> b) <br> i. leveldbhbase</p>\n<p> <em>java.nio.channels.FileChannel</em><br> <code>public abstract void force(boolean metaData) throws java.io.IOException</code><br> Forces any updates to this channels file to be written to the storage device that contains it.<br> If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br> If the file does not reside on a local device then no such guarantee is made.<br> The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br> Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br> This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p> <em>java.nio.MappedByteBuffer</em><br> <code>public final MappedByteBuffer force()</code><br> Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br> If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br> If the file does not reside on a local device then no such guarantee is made.<br> If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <a href=\"http://blog.csdn.net/a417930422/article/details/52585862\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585862</a></p>\n<p></p>\n<p>wangbin00162017-08-08 17:011<br> -sendfile java<br>FileChannel.transferTo(long position, long count, WritableByteChannel target)//</p>\n<p>rocketmq  RocketMQmmap+writesendfile</p>\n<p>nettyFileRegion FileChannel.transferTo</p>\n<p>FileRegion fileRegion =<br>new ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);<br>channel.writeAndFlush(fileRegion)<br>              2<br>             a417930422<br>            a4179304222017-09-21 10:35<br>            wangbin0016rocketmqmmapjavaMappedByteBuffer<br>             a417930422<br>            a4179304222017-09-21 10:32<br>            wangbin0016rocketmqConsumer mmap+writerocketmq<a href=\"http://blog.csdn.net/a417930422/article/details/52585180\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585180</a>.<br>            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket<br>            GetMessageResultmmap<br>             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Synchronization flush</span></div><div class=\"line\"><span class=\"keyword\">if</span> (FlushDiskType.SYNC_FLUSH == <span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> GroupCommitService service = (GroupCommitService) <span class=\"keyword\">this</span>.flushCommitLogService;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">// Asynchronous flush</span></div><div class=\"line\"><span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) &#123;</div><div class=\"line\">        <span class=\"comment\">// FlushRealTimeService</span></div><div class=\"line\">        flushCommitLogService.wakeup();</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// CommitRealTimeService</span></div><div class=\"line\">        commitLogService.wakeup();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTransientStorePoolEnable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> transientStorePoolEnable &amp;&amp; FlushDiskType.ASYNC_FLUSH == getFlushDiskType()</div><div class=\"line\">        &amp;&amp; BrokerRole.SLAVE != getBrokerRole();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>transientStorePoolEnable<br>FlushRealTimeServiceCommitRealTimeService</p>\n<p><img src=\"/2017/11/03/RocketMQ-Message-send-and-persistence/disc-fall.gif\" alt=\"\"></p>\n<h3 id=\"Offset-ConsumerQueue\"><a href=\"#Offset-ConsumerQueue\" class=\"headerlink\" title=\"Offset: ConsumerQueue\"></a>Offset: ConsumerQueue</h3><h3 id=\"Offset-CommitLog\"><a href=\"#Offset-CommitLog\" class=\"headerlink\" title=\"Offset: CommitLog\"></a>Offset: CommitLog</h3><h3 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h3><p>MappedByteBufferBuffer<br>CommitLogCommitLogAppend</p>\n<p><em>synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n</em>JDK1.6BownAAJVMAJVMBBAA<a href=\"http://blog.csdn.net/u013080921/article/details/42676231\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/u013080921/article/details/42676231</a></p>\n<h4 id=\"Spin-Lock-\"><a href=\"#Spin-Lock-\" class=\"headerlink\" title=\"Spin Lock()\"></a>Spin Lock()</h4><h4 id=\"ReentrantLock-\"><a href=\"#ReentrantLock-\" class=\"headerlink\" title=\"ReentrantLock()\"></a>ReentrantLock()</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/vonzhoufz/article/details/47248777\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/vonzhoufz/article/details/47248777</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://kafka.apache.org/documentation/#design_filesystem\" target=\"_blank\" rel=\"external\">https://kafka.apache.org/documentation/#design_filesystem</a></p>\n<p><a href=\"http://blog.csdn.net/evankaka/article/details/48464013\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/evankaka/article/details/48464013</a></p>\n<p><a href=\"http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1</a><br>kafka<a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a><br>pagecache</p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p> PAGESIZE<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">getconf PAGESIZE</div></pre></td></tr></table></figure></p>\n<p> KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache </p>\n<p> commit(atLeastSize)pagecache</p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>Consume Queue  Page Cache<br>Commit Log </p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>1).page cache. page cache, IO, . , , .<br>page cache , 1k, , , .<br>Commit Log, IONOOP, , 5.<br>4k, 8K.<br>Consume Queue, , PAGECACHE, Consume Queue, . Consume Queue.<br>2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .</p>\n<p><a href=\"https://segmentfault.com/a/1190000003985468\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000003985468</a><br>kafka</p>\n<p>linuxlinuxlinux</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>page cachepage cachepage cachedisc</p>\n<p>MQpagecachejvm crash</p>\n<p>commit logconsume queuepagecachejava heappagecachepagecachedisc</p>\n<p>producer<br>1.consume queuepagecachepagecache<br>2.commit logpagecacheIO</p>\n<p>pagecachepagecachepagecachesocketconsumer</p>\n<p>MappedByteBuffer <br>MappedByteBuffer</p>\n<p><a href=\"http://www.iocoder.cn/RocketMQ/message-store/\" target=\"_blank\" rel=\"external\">http://www.iocoder.cn/RocketMQ/message-store/</a><br>CommitRealTimeService     &amp;&amp;     <br>FlushRealTimeService     &amp;&amp;     <br>GroupCommitService        <br></p>\n<p><a href=\"http://blog.csdn.net/iie_libi/article/details/54289580\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/iie_libi/article/details/54289580</a><br></p>\n<p>Consumer  sendfile RocketMQmmap+write<br> <br>  DMA  sendfile CPUJVM Crash</p>\n<p></p>\n<p>ext4<br>iodeadlinedeadline IO </p>\n<p></p>\n<p><br>+ </p>\n<p>pagecache</p>\n<p>RocketMQFileChannel.map()MappedByteBufferBufferMQ<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">clean</span><span class=\"params\">(<span class=\"keyword\">final</span> ByteBuffer buffer)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (buffer == <span class=\"keyword\">null</span> || !buffer.isDirect() || buffer.capacity() == <span class=\"number\">0</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    invoke(invoke(viewed(buffer), <span class=\"string\">\"cleaner\"</span>), <span class=\"string\">\"clean\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Deallocator</span></span></div><div class=\"line\"><span class=\"class\">        <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Unsafe unsafe = Unsafe.getUnsafe();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> address;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> size;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> capacity;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Deallocator</span><span class=\"params\">(<span class=\"keyword\">long</span> address, <span class=\"keyword\">long</span> size, <span class=\"keyword\">int</span> capacity)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">assert</span> (address != <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">        <span class=\"keyword\">this</span>.size = size;</div><div class=\"line\">        <span class=\"keyword\">this</span>.capacity = capacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (address == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// Paranoia</span></div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        unsafe.freeMemory(address);</div><div class=\"line\">        address = <span class=\"number\">0</span>;</div><div class=\"line\">        Bits.unreserveMemory(size, capacity);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Full GCFull GCDisableExplicitGCGCFull GC</p>\n<p>  pagecacheIO <br>rocketmq<br><br> <br> PAGECACHE  1k <br>  Commit Log  IO NOOP 5 </p>\n<p> </p>\n<p> 1+<br> a) <br> b) <br> 2<br> a) <br> 3xxhashcrc<br> a) <a href=\"https://cyan4973.github.io/xxHash/\" target=\"_blank\" rel=\"external\">https://cyan4973.github.io/xxHash/</a><br> 4topic<br> a) topic<br> 5STLdequeMESA list<br> a) Dequevector<br> b) <br> 6MESA list<br> a) +logn<br> b) <br> i. leveldbhbase</p>\n<p> <em>java.nio.channels.FileChannel</em><br> <code>public abstract void force(boolean metaData) throws java.io.IOException</code><br> Forces any updates to this channels file to be written to the storage device that contains it.<br> If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br> If the file does not reside on a local device then no such guarantee is made.<br> The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br> Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br> This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p> <em>java.nio.MappedByteBuffer</em><br> <code>public final MappedByteBuffer force()</code><br> Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br> If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br> If the file does not reside on a local device then no such guarantee is made.<br> If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <a href=\"http://blog.csdn.net/a417930422/article/details/52585862\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585862</a></p>\n<p></p>\n<p>wangbin00162017-08-08 17:011<br> -sendfile java<br>FileChannel.transferTo(long position, long count, WritableByteChannel target)//</p>\n<p>rocketmq  RocketMQmmap+writesendfile</p>\n<p>nettyFileRegion FileChannel.transferTo</p>\n<p>FileRegion fileRegion =<br>new ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);<br>channel.writeAndFlush(fileRegion)<br>              2<br>             a417930422<br>            a4179304222017-09-21 10:35<br>            wangbin0016rocketmqmmapjavaMappedByteBuffer<br>             a417930422<br>            a4179304222017-09-21 10:32<br>            wangbin0016rocketmqConsumer mmap+writerocketmq<a href=\"http://blog.csdn.net/a417930422/article/details/52585180\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585180</a>.<br>            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket<br>            GetMessageResultmmap<br>             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage</p>\n"},{"title":"RocketMQPullRequest()","date":"2017-09-20T08:58:52.000Z","_content":"\n\nClientBroker\n\n### Client: \n\n### Broker:\nPullMessageProcessorprocessRequestConsumerQueue\nNettychannel\npullRequestPullRequestHoldServicepullRequestTablesuspend\n``` java \ncase ResponseCode.PULL_NOT_FOUND:\n    if (brokerAllowSuspend && hasSuspendFlag) {\n        long pollingTimeMills = suspendTimeoutMillisLong;\n        if (!this.brokerController.getBrokerConfig().isLongPollingEnable()) {\n            pollingTimeMills = this.brokerController.getBrokerConfig().getShortPollingTimeMills();\n        }\n\n        String topic = requestHeader.getTopic();\n        long offset = requestHeader.getQueueOffset();\n        int queueId = requestHeader.getQueueId();\n        PullRequest pullRequest = new PullRequest(request, channel, pollingTimeMills,\n            this.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);\n        this.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);\n        // repsonsenullremote-serverchannel\n        // 1. PullRequestHoldService hold\n        // 2. \n        response = null;\n        break;\n    }\n```\nCommitLogHoldPullRequest\nDefaultMessageStore.ReputMessageService\nReputMessageService(Busy Spin)CPU\n``` java\nwhile (!this.isStopped()) {\n    try {\n        Thread.sleep(1);\n        this.doReput();\n    } catch (Exception e) {\n        DefaultMessageStore.log.warn(this.getServiceName() + \" service has exception. \", e);\n    }\n}\n```\nCommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)\n\nconsumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset\nindex file\nbitmapdoDispatch\n\nmessageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving\nPullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient\n``` java\n// \nprivate void doReput() {\n    for (boolean doNext = true; this.isCommitLogAvailable() && doNext; ) {\n        ...\n        SelectMappedBufferResult result = DefaultMessageStore.this.commitLog.getData(reputFromOffset);\n        ...\n        this.reputFromOffset = result.getStartOffset();\n\n        for (int readSize = 0; readSize < result.getSize() && doNext; ) {\n            DispatchRequest dispatchRequest =\n                DefaultMessageStore.this.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), false, false);\n            int size = dispatchRequest.getMsgSize();\n            ...\n            if (size > 0) {\n                // dispatchconsumerQueueindex file\n                DefaultMessageStore.this.doDispatch(dispatchRequest);\n                \n                if (BrokerRole.SLAVE != DefaultMessageStore.this.getMessageStoreConfig().getBrokerRole()\n                    && DefaultMessageStore.this.brokerConfig.isLongPollingEnable()) {\n                    // suspend pullRequestPullRequestHoldServicepullRequesthold\n                    DefaultMessageStore.this.messageArrivingListener.arriving(dispatchRequest.getTopic(),\n                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + 1,\n                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),\n                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());\n                }\n\n            } \n            ...\n        }\n    }\n}\n```\n\n\n\n![](https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg)\n","source":"_posts/RocketMQ-Pull-message-with-long-polling.md","raw":"---\ntitle: RocketMQPullRequest()\ndate: 2017-09-20 16:58:52\ntags: RocketMQ\n---\n\n\nClientBroker\n\n### Client: \n\n### Broker:\nPullMessageProcessorprocessRequestConsumerQueue\nNettychannel\npullRequestPullRequestHoldServicepullRequestTablesuspend\n``` java \ncase ResponseCode.PULL_NOT_FOUND:\n    if (brokerAllowSuspend && hasSuspendFlag) {\n        long pollingTimeMills = suspendTimeoutMillisLong;\n        if (!this.brokerController.getBrokerConfig().isLongPollingEnable()) {\n            pollingTimeMills = this.brokerController.getBrokerConfig().getShortPollingTimeMills();\n        }\n\n        String topic = requestHeader.getTopic();\n        long offset = requestHeader.getQueueOffset();\n        int queueId = requestHeader.getQueueId();\n        PullRequest pullRequest = new PullRequest(request, channel, pollingTimeMills,\n            this.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);\n        this.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);\n        // repsonsenullremote-serverchannel\n        // 1. PullRequestHoldService hold\n        // 2. \n        response = null;\n        break;\n    }\n```\nCommitLogHoldPullRequest\nDefaultMessageStore.ReputMessageService\nReputMessageService(Busy Spin)CPU\n``` java\nwhile (!this.isStopped()) {\n    try {\n        Thread.sleep(1);\n        this.doReput();\n    } catch (Exception e) {\n        DefaultMessageStore.log.warn(this.getServiceName() + \" service has exception. \", e);\n    }\n}\n```\nCommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)\n\nconsumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset\nindex file\nbitmapdoDispatch\n\nmessageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving\nPullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient\n``` java\n// \nprivate void doReput() {\n    for (boolean doNext = true; this.isCommitLogAvailable() && doNext; ) {\n        ...\n        SelectMappedBufferResult result = DefaultMessageStore.this.commitLog.getData(reputFromOffset);\n        ...\n        this.reputFromOffset = result.getStartOffset();\n\n        for (int readSize = 0; readSize < result.getSize() && doNext; ) {\n            DispatchRequest dispatchRequest =\n                DefaultMessageStore.this.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), false, false);\n            int size = dispatchRequest.getMsgSize();\n            ...\n            if (size > 0) {\n                // dispatchconsumerQueueindex file\n                DefaultMessageStore.this.doDispatch(dispatchRequest);\n                \n                if (BrokerRole.SLAVE != DefaultMessageStore.this.getMessageStoreConfig().getBrokerRole()\n                    && DefaultMessageStore.this.brokerConfig.isLongPollingEnable()) {\n                    // suspend pullRequestPullRequestHoldServicepullRequesthold\n                    DefaultMessageStore.this.messageArrivingListener.arriving(dispatchRequest.getTopic(),\n                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + 1,\n                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),\n                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());\n                }\n\n            } \n            ...\n        }\n    }\n}\n```\n\n\n\n![](https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg)\n","slug":"RocketMQ-Pull-message-with-long-polling","published":1,"updated":"2017-11-09T06:07:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayl002e17q2fl74rutr","content":"<p>ClientBroker</p>\n<h3 id=\"Client\"><a href=\"#Client\" class=\"headerlink\" title=\"Client:\"></a>Client:</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker:\"></a>Broker:</h3><p>PullMessageProcessorprocessRequestConsumerQueue<br>Nettychannel<br>pullRequestPullRequestHoldServicepullRequestTablesuspend<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> ResponseCode.PULL_NOT_FOUND:</div><div class=\"line\">    <span class=\"keyword\">if</span> (brokerAllowSuspend &amp;&amp; hasSuspendFlag) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> pollingTimeMills = suspendTimeoutMillisLong;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.brokerController.getBrokerConfig().isLongPollingEnable()) &#123;</div><div class=\"line\">            pollingTimeMills = <span class=\"keyword\">this</span>.brokerController.getBrokerConfig().getShortPollingTimeMills();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        String topic = requestHeader.getTopic();</div><div class=\"line\">        <span class=\"keyword\">long</span> offset = requestHeader.getQueueOffset();</div><div class=\"line\">        <span class=\"keyword\">int</span> queueId = requestHeader.getQueueId();</div><div class=\"line\">        PullRequest pullRequest = <span class=\"keyword\">new</span> PullRequest(request, channel, pollingTimeMills,</div><div class=\"line\">            <span class=\"keyword\">this</span>.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);</div><div class=\"line\">        <span class=\"keyword\">this</span>.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);</div><div class=\"line\">        <span class=\"comment\">// repsonsenullremote-serverchannel</span></div><div class=\"line\">        <span class=\"comment\">// 1. PullRequestHoldService hold</span></div><div class=\"line\">        <span class=\"comment\">// 2. </span></div><div class=\"line\">        response = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogHoldPullRequest<br>DefaultMessageStore.ReputMessageService<br>ReputMessageService(Busy Spin)CPU<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Thread.sleep(<span class=\"number\">1</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.doReput();</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        DefaultMessageStore.log.warn(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">\" service has exception. \"</span>, e);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)<br><br>consumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset<br>index file<br>bitmapdoDispatch</p>\n<p>messageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving<br>PullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doReput</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">boolean</span> doNext = <span class=\"keyword\">true</span>; <span class=\"keyword\">this</span>.isCommitLogAvailable() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">        ...</div><div class=\"line\">        SelectMappedBufferResult result = DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.getData(reputFromOffset);</div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">this</span>.reputFromOffset = result.getStartOffset();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> readSize = <span class=\"number\">0</span>; readSize &lt; result.getSize() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">            DispatchRequest dispatchRequest =</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">int</span> size = dispatchRequest.getMsgSize();</div><div class=\"line\">            ...</div><div class=\"line\">            <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">// dispatchconsumerQueueindex file</span></div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.doDispatch(dispatchRequest);</div><div class=\"line\">                </div><div class=\"line\">                <span class=\"keyword\">if</span> (BrokerRole.SLAVE != DefaultMessageStore.<span class=\"keyword\">this</span>.getMessageStoreConfig().getBrokerRole()</div><div class=\"line\">                    &amp;&amp; DefaultMessageStore.<span class=\"keyword\">this</span>.brokerConfig.isLongPollingEnable()) &#123;</div><div class=\"line\">                    <span class=\"comment\">// suspend pullRequestPullRequestHoldServicepullRequesthold</span></div><div class=\"line\">                    DefaultMessageStore.<span class=\"keyword\">this</span>.messageArrivingListener.arriving(dispatchRequest.getTopic(),</div><div class=\"line\">                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + <span class=\"number\">1</span>,</div><div class=\"line\">                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),</div><div class=\"line\">                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">            &#125; </div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></p>\n<p><img src=\"https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>ClientBroker</p>\n<h3 id=\"Client\"><a href=\"#Client\" class=\"headerlink\" title=\"Client:\"></a>Client:</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker:\"></a>Broker:</h3><p>PullMessageProcessorprocessRequestConsumerQueue<br>Nettychannel<br>pullRequestPullRequestHoldServicepullRequestTablesuspend<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> ResponseCode.PULL_NOT_FOUND:</div><div class=\"line\">    <span class=\"keyword\">if</span> (brokerAllowSuspend &amp;&amp; hasSuspendFlag) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> pollingTimeMills = suspendTimeoutMillisLong;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.brokerController.getBrokerConfig().isLongPollingEnable()) &#123;</div><div class=\"line\">            pollingTimeMills = <span class=\"keyword\">this</span>.brokerController.getBrokerConfig().getShortPollingTimeMills();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        String topic = requestHeader.getTopic();</div><div class=\"line\">        <span class=\"keyword\">long</span> offset = requestHeader.getQueueOffset();</div><div class=\"line\">        <span class=\"keyword\">int</span> queueId = requestHeader.getQueueId();</div><div class=\"line\">        PullRequest pullRequest = <span class=\"keyword\">new</span> PullRequest(request, channel, pollingTimeMills,</div><div class=\"line\">            <span class=\"keyword\">this</span>.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);</div><div class=\"line\">        <span class=\"keyword\">this</span>.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);</div><div class=\"line\">        <span class=\"comment\">// repsonsenullremote-serverchannel</span></div><div class=\"line\">        <span class=\"comment\">// 1. PullRequestHoldService hold</span></div><div class=\"line\">        <span class=\"comment\">// 2. </span></div><div class=\"line\">        response = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogHoldPullRequest<br>DefaultMessageStore.ReputMessageService<br>ReputMessageService(Busy Spin)CPU<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Thread.sleep(<span class=\"number\">1</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.doReput();</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        DefaultMessageStore.log.warn(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">\" service has exception. \"</span>, e);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)<br><br>consumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset<br>index file<br>bitmapdoDispatch</p>\n<p>messageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving<br>PullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doReput</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">boolean</span> doNext = <span class=\"keyword\">true</span>; <span class=\"keyword\">this</span>.isCommitLogAvailable() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">        ...</div><div class=\"line\">        SelectMappedBufferResult result = DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.getData(reputFromOffset);</div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">this</span>.reputFromOffset = result.getStartOffset();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> readSize = <span class=\"number\">0</span>; readSize &lt; result.getSize() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">            DispatchRequest dispatchRequest =</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">int</span> size = dispatchRequest.getMsgSize();</div><div class=\"line\">            ...</div><div class=\"line\">            <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">// dispatchconsumerQueueindex file</span></div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.doDispatch(dispatchRequest);</div><div class=\"line\">                </div><div class=\"line\">                <span class=\"keyword\">if</span> (BrokerRole.SLAVE != DefaultMessageStore.<span class=\"keyword\">this</span>.getMessageStoreConfig().getBrokerRole()</div><div class=\"line\">                    &amp;&amp; DefaultMessageStore.<span class=\"keyword\">this</span>.brokerConfig.isLongPollingEnable()) &#123;</div><div class=\"line\">                    <span class=\"comment\">// suspend pullRequestPullRequestHoldServicepullRequesthold</span></div><div class=\"line\">                    DefaultMessageStore.<span class=\"keyword\">this</span>.messageArrivingListener.arriving(dispatchRequest.getTopic(),</div><div class=\"line\">                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + <span class=\"number\">1</span>,</div><div class=\"line\">                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),</div><div class=\"line\">                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">            &#125; </div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></p>\n<p><img src=\"https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg\" alt=\"\"></p>\n"},{"title":"RocketMQ","date":"2017-11-10T10:41:47.000Z","_content":"\n\n### \n\nLengthFieldBasedFrameDecoder\n\n### Request, Response\n\njsonProtobuf\n\n\nhttps://zhuanlan.zhihu.com/rocketmq","source":"_posts/RocketMQ-Remote-communication-protocol-and-serialization.md","raw":"---\ntitle: RocketMQ\ndate: 2017-11-10 18:41:47\ntags: RocketMQ\n---\n\n\n### \n\nLengthFieldBasedFrameDecoder\n\n### Request, Response\n\njsonProtobuf\n\n\nhttps://zhuanlan.zhihu.com/rocketmq","slug":"RocketMQ-Remote-communication-protocol-and-serialization","published":1,"updated":"2017-11-16T01:51:47.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyaym002g17q2gpca1fy6","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>LengthFieldBasedFrameDecoder</p>\n<h3 id=\"Request-Response\"><a href=\"#Request-Response\" class=\"headerlink\" title=\"Request, Response\"></a>Request, Response</h3><p>jsonProtobuf</p>\n<p><a href=\"https://zhuanlan.zhihu.com/rocketmq\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/rocketmq</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>LengthFieldBasedFrameDecoder</p>\n<h3 id=\"Request-Response\"><a href=\"#Request-Response\" class=\"headerlink\" title=\"Request, Response\"></a>Request, Response</h3><p>jsonProtobuf</p>\n<p><a href=\"https://zhuanlan.zhihu.com/rocketmq\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/rocketmq</a></p>\n"},{"title":"SourceCode-Map","date":"2017-11-12T13:54:26.000Z","_content":"\nhttp://www.importnew.com/26049.html\nConcurrentHashMap\n\nhttp://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\nHashMap\n\nHashMap\n\nHashMap\n\nHashMap  tableloadFactor  \nHashMap \nHashMap  HashTableConcurrentHashMap \nHashMap\nHashMapLinkedMapTreeMap\nHashMapTreeMap\nHashMap(load factor)\nHashMap  Map  hashcode ","source":"_posts/SourceCode-Map.md","raw":"---\ntitle: SourceCode-Map\ndate: 2017-11-12 21:54:26\ntags: SourceCode\n---\n\nhttp://www.importnew.com/26049.html\nConcurrentHashMap\n\nhttp://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\nHashMap\n\nHashMap\n\nHashMap\n\nHashMap  tableloadFactor  \nHashMap \nHashMap  HashTableConcurrentHashMap \nHashMap\nHashMapLinkedMapTreeMap\nHashMapTreeMap\nHashMap(load factor)\nHashMap  Map  hashcode ","slug":"SourceCode-Map","published":1,"updated":"2017-11-16T09:10:46.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayn002i17q2oiovvucq","content":"<p><a href=\"http://www.importnew.com/26049.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/26049.html</a><br>ConcurrentHashMap</p>\n<p><a href=\"http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\" target=\"_blank\" rel=\"external\">http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more</a><br>HashMap</p>\n<p>HashMap</p>\n<p>HashMap<br><br>HashMap  tableloadFactor  <br>HashMap <br>HashMap  HashTableConcurrentHashMap <br>HashMap<br>HashMapLinkedMapTreeMap<br>HashMapTreeMap<br>HashMap(load factor)<br>HashMap  Map  hashcode </p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.importnew.com/26049.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/26049.html</a><br>ConcurrentHashMap</p>\n<p><a href=\"http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\" target=\"_blank\" rel=\"external\">http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more</a><br>HashMap</p>\n<p>HashMap</p>\n<p>HashMap<br><br>HashMap  tableloadFactor  <br>HashMap <br>HashMap  HashTableConcurrentHashMap <br>HashMap<br>HashMapLinkedMapTreeMap<br>HashMapTreeMap<br>HashMap(load factor)<br>HashMap  Map  hashcode </p>\n"},{"title":"RocketMQ","date":"2017-10-11T08:27:43.000Z","_content":"\n\nhttps://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\n\n![](RocketMQ-Transactional-message/transaction_rocketmq.gif)\n\n### \n\nproducerhalf msgbrokerconsumerlong pooling\nCOMMIT ConsumeQueue\n``` java\nclass CommitLogDispatcherBuildConsumeQueue implements CommitLogDispatcher {\n\n    @Override\n    public void dispatch(DispatchRequest request) {\n        final int tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());\n        switch (tranType) {\n            case MessageSysFlag.TRANSACTION_NOT_TYPE:\n            // commit log TRANSACTION_COMMIT_TYPE consume queue\n            // consumer\n            case MessageSysFlag.TRANSACTION_COMMIT_TYPE:\n                DefaultMessageStore.this.putMessagePositionInfo(request);\n                break;\n            case MessageSysFlag.TRANSACTION_PREPARED_TYPE:\n            case MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:\n                break;\n        }\n    }\n}\n```","source":"_posts/RocketMQ-Transactional-message.md","raw":"---\ntitle: RocketMQ\ndate: 2017-10-11 16:27:43\ntags: RocketMQ\n---\n\n\nhttps://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\n\n![](RocketMQ-Transactional-message/transaction_rocketmq.gif)\n\n### \n\nproducerhalf msgbrokerconsumerlong pooling\nCOMMIT ConsumeQueue\n``` java\nclass CommitLogDispatcherBuildConsumeQueue implements CommitLogDispatcher {\n\n    @Override\n    public void dispatch(DispatchRequest request) {\n        final int tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());\n        switch (tranType) {\n            case MessageSysFlag.TRANSACTION_NOT_TYPE:\n            // commit log TRANSACTION_COMMIT_TYPE consume queue\n            // consumer\n            case MessageSysFlag.TRANSACTION_COMMIT_TYPE:\n                DefaultMessageStore.this.putMessagePositionInfo(request);\n                break;\n            case MessageSysFlag.TRANSACTION_PREPARED_TYPE:\n            case MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:\n                break;\n        }\n    }\n}\n```","slug":"RocketMQ-Transactional-message","published":1,"updated":"2017-11-05T10:16:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayo002k17q2jjrt3fb6","content":"<p><a href=\"https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\" target=\"_blank\" rel=\"external\">https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7</a></p>\n<p><img src=\"/2017/10/11/RocketMQ-Transactional-message/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>producerhalf msgbrokerconsumerlong pooling<br>COMMIT ConsumeQueue<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CommitLogDispatcherBuildConsumeQueue</span> <span class=\"keyword\">implements</span> <span class=\"title\">CommitLogDispatcher</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());</div><div class=\"line\">        <span class=\"keyword\">switch</span> (tranType) &#123;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_NOT_TYPE:</div><div class=\"line\">            <span class=\"comment\">// commit log TRANSACTION_COMMIT_TYPE consume queue</span></div><div class=\"line\">            <span class=\"comment\">// consumer</span></div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_COMMIT_TYPE:</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.putMessagePositionInfo(request);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_PREPARED_TYPE:</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\" target=\"_blank\" rel=\"external\">https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7</a></p>\n<p><img src=\"/2017/10/11/RocketMQ-Transactional-message/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>producerhalf msgbrokerconsumerlong pooling<br>COMMIT ConsumeQueue<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CommitLogDispatcherBuildConsumeQueue</span> <span class=\"keyword\">implements</span> <span class=\"title\">CommitLogDispatcher</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());</div><div class=\"line\">        <span class=\"keyword\">switch</span> (tranType) &#123;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_NOT_TYPE:</div><div class=\"line\">            <span class=\"comment\">// commit log TRANSACTION_COMMIT_TYPE consume queue</span></div><div class=\"line\">            <span class=\"comment\">// consumer</span></div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_COMMIT_TYPE:</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.putMessagePositionInfo(request);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_PREPARED_TYPE:</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n"},{"title":"recipes-in-curator","date":"2017-09-19T09:05:45.000Z","_content":"","source":"_posts/recipes-in-curator.md","raw":"---\ntitle: recipes-in-curator\ndate: 2017-09-19 17:05:45\ntags: Curator\n---\n","slug":"recipes-in-curator","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayp002m17q21dz52uxz","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Thread-FAQ","date":"2017-10-27T03:07:35.000Z","_content":"\nhttp://blog.csdn.net/zhandoushi1982/article/details/5506597\nCPU\n\n### ThreadLocal\n\n\n### Future\n\n\n### Promise\n\n### Difference between ReentrantLock and sync\n\n\n### Java\n\nReentrantLock\n\nsyncABmonitorAmonitorAB\n\nCopyOnWrite\n\n15Java\n\n1)T1T2T3T2T1T3T2\n\njoinjoin\n\n2)JavaLocksynchronized\n\nlockConcurrentHashMapJavaLocks\n\n3)javawaitsleep\n\nJavawaitsleepWaitsleep\n\n4Java\n\nJavawait()notify()Java 5\n\n5Java\n\nJava\n\n6Java\n\nJavadeadlock free codeNNn2Java\n\n7) Java\n\njava\n\n8) JavavolatileJavasynchronized\n\nJava 5Javavolatilevolatile\n\n9) \n\nJavajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java\n\n10) thread dumpThread dump\n\nUNIXkill -3thread dumpwindowsCTRL+Break\n\n11) start()run()run()\n\njavaJavastart()run()run()startrun\n\n12) Java\n\nIOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java\n\n13)JavaCycliBarriarCountdownLatch\n\nJDK5CyclicBarrierCountdownLatch\n\n14) \n\njavaString\n\n15) \n\nMemory-interfaceJava\n\nhttp://www.importnew.com/27105.html","source":"_posts/Thread-FAQ.md","raw":"---\ntitle: Thread-FAQ\ndate: 2017-10-27 11:07:35\ntags: THread\n---\n\nhttp://blog.csdn.net/zhandoushi1982/article/details/5506597\nCPU\n\n### ThreadLocal\n\n\n### Future\n\n\n### Promise\n\n### Difference between ReentrantLock and sync\n\n\n### Java\n\nReentrantLock\n\nsyncABmonitorAmonitorAB\n\nCopyOnWrite\n\n15Java\n\n1)T1T2T3T2T1T3T2\n\njoinjoin\n\n2)JavaLocksynchronized\n\nlockConcurrentHashMapJavaLocks\n\n3)javawaitsleep\n\nJavawaitsleepWaitsleep\n\n4Java\n\nJavawait()notify()Java 5\n\n5Java\n\nJava\n\n6Java\n\nJavadeadlock free codeNNn2Java\n\n7) Java\n\njava\n\n8) JavavolatileJavasynchronized\n\nJava 5Javavolatilevolatile\n\n9) \n\nJavajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java\n\n10) thread dumpThread dump\n\nUNIXkill -3thread dumpwindowsCTRL+Break\n\n11) start()run()run()\n\njavaJavastart()run()run()startrun\n\n12) Java\n\nIOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java\n\n13)JavaCycliBarriarCountdownLatch\n\nJDK5CyclicBarrierCountdownLatch\n\n14) \n\njavaString\n\n15) \n\nMemory-interfaceJava\n\nhttp://www.importnew.com/27105.html","slug":"Thread-FAQ","published":1,"updated":"2017-11-15T08:08:11.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayq002o17q224zq66s7","content":"<p><a href=\"http://blog.csdn.net/zhandoushi1982/article/details/5506597\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/zhandoushi1982/article/details/5506597</a><br>CPU</p>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h3><h3 id=\"Future\"><a href=\"#Future\" class=\"headerlink\" title=\"Future\"></a>Future</h3><h3 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h3><h3 id=\"Difference-between-ReentrantLock-and-sync\"><a href=\"#Difference-between-ReentrantLock-and-sync\" class=\"headerlink\" title=\"Difference between ReentrantLock and sync\"></a>Difference between ReentrantLock and sync</h3><h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>ReentrantLock</p>\n<p>syncABmonitorAmonitorAB</p>\n<p>CopyOnWrite</p>\n<p>15Java</p>\n<p>1)T1T2T3T2T1T3T2</p>\n<p>joinjoin</p>\n<p>2)JavaLocksynchronized</p>\n<p>lockConcurrentHashMapJavaLocks</p>\n<p>3)javawaitsleep</p>\n<p>JavawaitsleepWaitsleep</p>\n<p>4Java</p>\n<p>Javawait()notify()Java 5</p>\n<p>5Java</p>\n<p>Java</p>\n<p>6Java</p>\n<p>Javadeadlock free codeNNn2Java</p>\n<p>7) Java</p>\n<p>java</p>\n<p>8) JavavolatileJavasynchronized</p>\n<p>Java 5Javavolatilevolatile</p>\n<p>9) </p>\n<p>Javajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java</p>\n<p>10) thread dumpThread dump</p>\n<p>UNIXkill -3thread dumpwindowsCTRL+Break</p>\n<p>11) start()run()run()</p>\n<p>javaJavastart()run()run()startrun</p>\n<p>12) Java</p>\n<p>IOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java</p>\n<p>13)JavaCycliBarriarCountdownLatch</p>\n<p>JDK5CyclicBarrierCountdownLatch</p>\n<p>14) </p>\n<p>javaString</p>\n<p>15) </p>\n<p>Memory-interfaceJava</p>\n<p><a href=\"http://www.importnew.com/27105.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/27105.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://blog.csdn.net/zhandoushi1982/article/details/5506597\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/zhandoushi1982/article/details/5506597</a><br>CPU</p>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h3><h3 id=\"Future\"><a href=\"#Future\" class=\"headerlink\" title=\"Future\"></a>Future</h3><h3 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h3><h3 id=\"Difference-between-ReentrantLock-and-sync\"><a href=\"#Difference-between-ReentrantLock-and-sync\" class=\"headerlink\" title=\"Difference between ReentrantLock and sync\"></a>Difference between ReentrantLock and sync</h3><h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>ReentrantLock</p>\n<p>syncABmonitorAmonitorAB</p>\n<p>CopyOnWrite</p>\n<p>15Java</p>\n<p>1)T1T2T3T2T1T3T2</p>\n<p>joinjoin</p>\n<p>2)JavaLocksynchronized</p>\n<p>lockConcurrentHashMapJavaLocks</p>\n<p>3)javawaitsleep</p>\n<p>JavawaitsleepWaitsleep</p>\n<p>4Java</p>\n<p>Javawait()notify()Java 5</p>\n<p>5Java</p>\n<p>Java</p>\n<p>6Java</p>\n<p>Javadeadlock free codeNNn2Java</p>\n<p>7) Java</p>\n<p>java</p>\n<p>8) JavavolatileJavasynchronized</p>\n<p>Java 5Javavolatilevolatile</p>\n<p>9) </p>\n<p>Javajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java</p>\n<p>10) thread dumpThread dump</p>\n<p>UNIXkill -3thread dumpwindowsCTRL+Break</p>\n<p>11) start()run()run()</p>\n<p>javaJavastart()run()run()startrun</p>\n<p>12) Java</p>\n<p>IOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java</p>\n<p>13)JavaCycliBarriarCountdownLatch</p>\n<p>JDK5CyclicBarrierCountdownLatch</p>\n<p>14) </p>\n<p>javaString</p>\n<p>15) </p>\n<p>Memory-interfaceJava</p>\n<p><a href=\"http://www.importnew.com/27105.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/27105.html</a></p>\n"},{"title":"tree-cache-single-thread-event-handler-in-curator","date":"2017-09-20T07:32:22.000Z","_content":"\n\nGenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.\n\n``` java\nchannel.writeAndFlush(request).addListener(new ChannelFutureListener() {\n    @Override\n    public void operationComplete(ChannelFuture f) throws Exception {\n        if (f.isSuccess()) {\n            responseFuture.setSendRequestOK(true);\n            return;\n        } else {\n            responseFuture.setSendRequestOK(false);\n        }\n\n        responseTable.remove(opaque);\n        responseFuture.setCause(f.cause());\n        responseFuture.putResponse(null);\n        log.warn(\"send a request command to channel <\" + addr + \"> failed.\");\n    }\n});\n```","source":"_posts/tree-cache-single-thread-event-handler-in-curator.md","raw":"---\ntitle: tree-cache-single-thread-event-handler-in-curator\ndate: 2017-09-20 15:32:22\ntags: Curator\n---\n\n\nGenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.\n\n``` java\nchannel.writeAndFlush(request).addListener(new ChannelFutureListener() {\n    @Override\n    public void operationComplete(ChannelFuture f) throws Exception {\n        if (f.isSuccess()) {\n            responseFuture.setSendRequestOK(true);\n            return;\n        } else {\n            responseFuture.setSendRequestOK(false);\n        }\n\n        responseTable.remove(opaque);\n        responseFuture.setCause(f.cause());\n        responseFuture.putResponse(null);\n        log.warn(\"send a request command to channel <\" + addr + \"> failed.\");\n    }\n});\n```","slug":"tree-cache-single-thread-event-handler-in-curator","published":1,"updated":"2017-10-16T09:27:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjajeyayr002q17q2f3luy20o","content":"<p>GenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">channel.writeAndFlush(request).addListener(<span class=\"keyword\">new</span> ChannelFutureListener() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operationComplete</span><span class=\"params\">(ChannelFuture f)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (f.isSuccess()) &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">true</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        responseTable.remove(opaque);</div><div class=\"line\">        responseFuture.setCause(f.cause());</div><div class=\"line\">        responseFuture.putResponse(<span class=\"keyword\">null</span>);</div><div class=\"line\">        log.warn(<span class=\"string\">\"send a request command to channel &lt;\"</span> + addr + <span class=\"string\">\"&gt; failed.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>GenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">channel.writeAndFlush(request).addListener(<span class=\"keyword\">new</span> ChannelFutureListener() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operationComplete</span><span class=\"params\">(ChannelFuture f)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (f.isSuccess()) &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">true</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        responseTable.remove(opaque);</div><div class=\"line\">        responseFuture.setCause(f.cause());</div><div class=\"line\">        responseFuture.putResponse(<span class=\"keyword\">null</span>);</div><div class=\"line\">        log.warn(<span class=\"string\">\"send a request command to channel &lt;\"</span> + addr + <span class=\"string\">\"&gt; failed.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>"}],"PostAsset":[{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif","slug":"abnormal.gif","post":"cjajeyawp000117q2xv349g0t","modified":1,"renderable":0},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif","slug":"normal.gif","post":"cjajeyawp000117q2xv349g0t","modified":1,"renderable":0},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif","slug":"after-cobar-driver.gif","post":"cjajeyawx000417q2pytu2eaq","modified":1,"renderable":0},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif","slug":"before-cobar-driver.gif","post":"cjajeyawx000417q2pytu2eaq","modified":1,"renderable":0},{"_id":"source/_posts/JVM-Lock/light_lock_flow.jpg","slug":"light_lock_flow.jpg","post":"cjajeyaxw001417q2trwsk4g6","modified":1,"renderable":0},{"_id":"source/_posts/JVM-Lock/biased_lock_flow.jpg","slug":"biased_lock_flow.jpg","post":"cjajeyaxw001417q2trwsk4g6","modified":1,"renderable":0},{"_id":"source/_posts/RocketMQ-Message-send-and-persistence/disc-fall.gif","slug":"disc-fall.gif","post":"cjajeyayk002c17q2ga1ovz8u","modified":1,"renderable":0},{"_id":"source/_posts/Distributed-Transaction/transaction_rocketmq.gif","post":"cjajeyaxo000p17q25y8es4vc","slug":"transaction_rocketmq.gif","modified":1,"renderable":1},{"_id":"source/_posts/RocketMQ-Index-service/index-file.gif","post":"cjajeyaye002417q2l45py3j7","slug":"index-file.gif","modified":1,"renderable":1},{"_id":"source/_posts/RocketMQ-Transactional-message/transaction_rocketmq.gif","post":"cjajeyayo002k17q2jjrt3fb6","slug":"transaction_rocketmq.gif","modified":1,"renderable":1},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg","post":"cjajeyay0001e17q28ha2yt00","slug":"disk_read_write_speed.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/read_write.gif","post":"cjajeyay0001e17q28ha2yt00","slug":"read_write.gif","modified":1,"renderable":1},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png","slug":"invokeAsync.png","post":"cjajeyayi002a17q2vvfexe3f","modified":1,"renderable":0},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png","slug":"invokeSync.png","post":"cjajeyayi002a17q2vvfexe3f","modified":1,"renderable":0},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif","post":"cjajeyawp000117q2xv349g0t","slug":"sign.gif","modified":1,"renderable":1},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactor.gif","slug":"CobarReactor.gif","post":"cjajeyaxk000h17q2se8sprch","modified":1,"renderable":0},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactorSign.gif","post":"cjajeyaxk000h17q2se8sprch","slug":"CobarReactorSign.gif","modified":1,"renderable":1},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioRegister.gif","post":"cjajeyaxk000h17q2se8sprch","slug":"NioRegister.gif","modified":1,"renderable":1},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioSign.gif","post":"cjajeyaxk000h17q2se8sprch","slug":"NioSign.gif","modified":1,"renderable":1},{"_id":"source/_posts/JVM-Lock/biased_lock_convert_flow.jpg","post":"cjajeyaxw001417q2trwsk4g6","slug":"biased_lock_convert_flow.jpg","modified":1,"renderable":1},{"_id":"source/_posts/JVM-Lock/markword_state.jpg","post":"cjajeyaxw001417q2trwsk4g6","slug":"markword_state.jpg","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"cjajeyawp000117q2xv349g0t","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyax4000817q2m3hhqr62"},{"post_id":"cjajeyax1000617q2rvt5nkf4","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyax7000a17q2gy312p0q"},{"post_id":"cjajeyax5000917q2kkre73z2","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyaxf000c17q2nv5bgfsn"},{"post_id":"cjajeyawx000417q2pytu2eaq","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyaxh000e17q2zfhcjdp4"},{"post_id":"cjajeyaxb000b17q2jcqyrwab","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyaxk000g17q28dnylzpx"},{"post_id":"cjajeyaxf000d17q2mn7928tv","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyaxl000i17q2azn06nij"},{"post_id":"cjajeyaxh000f17q218s63zts","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyaxm000k17q22f29wc9t"},{"post_id":"cjajeyaxk000h17q2se8sprch","tag_id":"cjajeyaww000317q22m47ri9a","_id":"cjajeyaxn000n17q2h8ibmy5k"},{"post_id":"cjajeyaxl000j17q2in6gu58h","tag_id":"cjajeyaxn000m17q2w9xwh27x","_id":"cjajeyaxq000s17q2oqrwvob3"},{"post_id":"cjajeyaxm000l17q2eqy9sr8z","tag_id":"cjajeyaxn000m17q2w9xwh27x","_id":"cjajeyaxs000w17q2iu0dra33"},{"post_id":"cjajeyaxn000o17q21nzqxb4k","tag_id":"cjajeyaxr000v17q2ss077g8b","_id":"cjajeyaxv001117q2nydpm2cz"},{"post_id":"cjajeyaxr000u17q2e7yw4453","tag_id":"cjajeyaxu000z17q2qzxah6tp","_id":"cjajeyaxx001517q2brhxav10"},{"post_id":"cjajeyaxw001417q2trwsk4g6","tag_id":"cjajeyaxw001317q2c6yg373f","_id":"cjajeyaxy001717q29rkwftp1"},{"post_id":"cjajeyaxt000y17q2kvayq094","tag_id":"cjajeyaxw001317q2c6yg373f","_id":"cjajeyaxz001a17q2rm3c3ymz"},{"post_id":"cjajeyaxx001617q2vw1wakr1","tag_id":"cjajeyaxw001317q2c6yg373f","_id":"cjajeyay0001c17q2dzh7erv4"},{"post_id":"cjajeyaxy001917q26ed1htd4","tag_id":"cjajeyaxw001317q2c6yg373f","_id":"cjajeyay1001f17q2h9gp0cn7"},{"post_id":"cjajeyaxu001017q27icnznwf","tag_id":"cjajeyaxw001317q2c6yg373f","_id":"cjajeyay2001h17q2xmlhn2dg"},{"post_id":"cjajeyaxv001217q25zo9j95y","tag_id":"cjajeyaxw001317q2c6yg373f","_id":"cjajeyay3001k17q2e2cmfuw9"},{"post_id":"cjajeyaxz001b17q2x4pwvup1","tag_id":"cjajeyay2001i17q2c94berp9","_id":"cjajeyay5001o17q29tb1zw8z"},{"post_id":"cjajeyay0001e17q28ha2yt00","tag_id":"cjajeyay2001i17q2c94berp9","_id":"cjajeyay7001s17q29agqi7dz"},{"post_id":"cjajeyay1001g17q2hoflb1br","tag_id":"cjajeyay7001r17q2d8cqtxhh","_id":"cjajeyaya001x17q2nedvlned"},{"post_id":"cjajeyay2001j17q2ythgqbl3","tag_id":"cjajeyay7001r17q2d8cqtxhh","_id":"cjajeyayc002117q2pptawgik"},{"post_id":"cjajeyay3001l17q2bikd9fuk","tag_id":"cjajeyay7001r17q2d8cqtxhh","_id":"cjajeyayf002517q28fy1zqof"},{"post_id":"cjajeyay4001m17q2t73vdg9w","tag_id":"cjajeyay7001r17q2d8cqtxhh","_id":"cjajeyayi002917q2g74rqv5m"},{"post_id":"cjajeyay5001p17q220lk33uk","tag_id":"cjajeyay7001r17q2d8cqtxhh","_id":"cjajeyayk002d17q2x48k0251"},{"post_id":"cjajeyay6001q17q2z366w0tc","tag_id":"cjajeyayj002b17q2tqf48q54","_id":"cjajeyayn002h17q26lay5poc"},{"post_id":"cjajeyay7001t17q2n9tkfazu","tag_id":"cjajeyayl002f17q2p4runqg2","_id":"cjajeyayp002l17q2ani0x78l"},{"post_id":"cjajeyay8001u17q2g521fmmm","tag_id":"cjajeyayl002f17q2p4runqg2","_id":"cjajeyayq002p17q2y39z79d8"},{"post_id":"cjajeyayp002m17q21dz52uxz","tag_id":"cjajeyaxn000m17q2w9xwh27x","_id":"cjajeyayr002r17q247xga0kg"},{"post_id":"cjajeyayr002q17q2f3luy20o","tag_id":"cjajeyaxn000m17q2w9xwh27x","_id":"cjajeyays002t17q2ht8f86ty"},{"post_id":"cjajeyaya001y17q2tu809lun","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyays002u17q2hd60596r"},{"post_id":"cjajeyayc002017q25pdwjob8","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayt002w17q2saz87uo7"},{"post_id":"cjajeyayd002217q2g7vdqliz","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayu002y17q2fvg05cym"},{"post_id":"cjajeyaye002417q2l45py3j7","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayv003017q2adgvobl3"},{"post_id":"cjajeyayg002617q2j5oldmwm","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayw003217q267dipp8s"},{"post_id":"cjajeyayh002817q2645q57vn","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayw003417q2xe3n2deb"},{"post_id":"cjajeyayi002a17q2vvfexe3f","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayy003617q2igpyhvbc"},{"post_id":"cjajeyayk002c17q2ga1ovz8u","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyayz003817q24xm7y0mz"},{"post_id":"cjajeyayl002e17q2fl74rutr","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyaz0003a17q2l7tqv229"},{"post_id":"cjajeyaym002g17q2gpca1fy6","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyaz0003c17q262fwc1ar"},{"post_id":"cjajeyayn002i17q2oiovvucq","tag_id":"cjajeyaz0003b17q2edhgbbgd","_id":"cjajeyaz2003e17q2pvvsbcq9"},{"post_id":"cjajeyayo002k17q2jjrt3fb6","tag_id":"cjajeyayq002n17q2qvwl1dov","_id":"cjajeyaz3003g17q2o4ws145v"},{"post_id":"cjajeyayq002o17q224zq66s7","tag_id":"cjajeyaz2003f17q2j8a14h78","_id":"cjajeyaz3003h17q28derwm2i"}],"Tag":[{"name":"Cobar","_id":"cjajeyaww000317q22m47ri9a"},{"name":"Curator","_id":"cjajeyaxn000m17q2w9xwh27x"},{"name":"Raft","_id":"cjajeyaxr000v17q2ss077g8b"},{"name":"Guava","_id":"cjajeyaxu000z17q2qzxah6tp"},{"name":"JVM","_id":"cjajeyaxw001317q2c6yg373f"},{"name":"Kafka","_id":"cjajeyay2001i17q2c94berp9"},{"name":"Linux","_id":"cjajeyay7001r17q2d8cqtxhh"},{"name":"MySQL","_id":"cjajeyayj002b17q2tqf48q54"},{"name":"Netty","_id":"cjajeyayl002f17q2p4runqg2"},{"name":"RocketMQ","_id":"cjajeyayq002n17q2qvwl1dov"},{"name":"SourceCode","_id":"cjajeyaz0003b17q2edhgbbgd"},{"name":"THread","_id":"cjajeyaz2003f17q2j8a14h78"}]}}