{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.gitignore","hash":"32ea93f21d8693d5d8fa4eef1c51a21ad0670047","modified":1520324480000},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1520324480000},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1520324480000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1520324480000},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1520324480000},{"_id":"themes/next/.javascript_ignore","hash":"8a224b381155f10e6eb132a4d815c5b52962a9d1","modified":1520324480000},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1520324480000},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1520324480000},{"_id":"themes/next/.travis.yml","hash":"c42d9608c8c7fe90de7b1581a8dc3886e90c179e","modified":1520324480000},{"_id":"themes/next/LICENSE","hash":"f293bcfcdc06c0b77ba13570bb8af55eb5c059fd","modified":1520324480000},{"_id":"themes/next/README.md","hash":"500b5606eb6a09c979d16128f8b00f4bf9bc95ac","modified":1520324480000},{"_id":"themes/next/README.en.md","hash":"32d6cdfec1447f54aae1d7f1365ce6733dfcec8f","modified":1520324480000},{"_id":"themes/next/_config.yml","hash":"ad953b7cdfe51f7e4a0671f2273ec6386fc803b8","modified":1520324480000},{"_id":"themes/next/bower.json","hash":"7d7938f9da896fe710aa0e9120140e528bf058df","modified":1520324480000},{"_id":"themes/next/gulpfile.coffee","hash":"031bffc483e417b20e90eceb6cf358e7596d2e69","modified":1520324480000},{"_id":"themes/next/package.json","hash":"193dad6f59a588908fac082cc46fe067dac1b84d","modified":1520324480000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock.md","hash":"25cacd2213d492af34a3beb9102a5bfcb9f7f3ed","modified":1520324480000},{"_id":"source/_posts/Cobar-Database-Scales.md","hash":"c76b925a18a9d406e9f5eb720e9a2094e5c82086","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-dataSource-with-dataHost.md","hash":"024dfee585945b728f81032b538d0f867c49a3f7","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability.md","hash":"d52fb6c369c769d9ddd91bbdab661bd6537d272f","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-mysql-heartbeat.md","hash":"31f482654ba3408a974490750b74e80da8901623","modified":1520324480000},{"_id":"source/_posts/Cobar-FAQ.md","hash":"c284655bba6f8561ad1f9fcd60fcbbf2d704834e","modified":1520324480000},{"_id":"source/_posts/Cobar-How-to-monitor-cobar.md","hash":"4bc59489ad21ca7b42448bc2fe1b26755e8c1384","modified":1520324480000},{"_id":"source/_posts/Cobar-Performance-Test-With-Sysbench.md","hash":"04728a5fdd793cad02cdbaac5582884715ac6313","modified":1529055887000},{"_id":"source/_posts/Cobar-NIO-client.md","hash":"e724361a2aea9af70ceda90a5d4afacfa9040a60","modified":1520324480000},{"_id":"source/_posts/Cobar-How-sql-executes-in-cobar.md","hash":"65ab30dce7a236b1e560837e35e74e4c00f51308","modified":1520324480000},{"_id":"source/_posts/Cobar-NIO-server.md","hash":"8e16fe3c0615adc4608f426394c651448c0c84c4","modified":1520324480000},{"_id":"source/_posts/Cobar-Reactor-design-pattern.md","hash":"89af190aa6466ce5c0bc789d2f2f004ad2e71695","modified":1520324480000},{"_id":"source/_posts/Curator-Distributed-lock.md","hash":"4ce7ecbc35261132da1e63a5a877d340349937c5","modified":1520324480000},{"_id":"source/_posts/Distributed-Consensus-Raft.md","hash":"c1a9ed77ae882f4d52f5612d636201875d66c00f","modified":1520324480000},{"_id":"source/_posts/Curator-sync-and-mutual-exclusion-between-thread-and-process.md","hash":"adfb453524a26e4a44034718c4564ae02f55f2e8","modified":1520324480000},{"_id":"source/_posts/Distributed-Transaction-TCC.md","hash":"cf9bec2c4b64876dc17faf9baaec72b9619d8d94","modified":1520324480000},{"_id":"source/_posts/Distributed-Unique-id.md","hash":"9251d391cad3597140c12cecb7f24ad8a4d49f8b","modified":1520324480000},{"_id":"source/_posts/Distributed-Transaction.md","hash":"45df09aa76c88d30e2913be4cca7250c8927ef76","modified":1520324480000},{"_id":"source/_posts/Guava-Black-techs.md","hash":"2e51a2c282b32bb6661c54007a76c4e09982ebc2","modified":1520324480000},{"_id":"source/_posts/Interview-Questions.md","hash":"7b42be70e626e188797b70bea7a93312a57ebe8d","modified":1520324480000},{"_id":"source/_posts/JVM-Atomic-operation.md","hash":"0ccc0331a673e525e65bb3027b33a1fdbfb72d39","modified":1520324480000},{"_id":"source/_posts/JVM-CAS-Campare-and-swap.md","hash":"ba68978c50138649b6e89570bdc1e15600d8756f","modified":1520324480000},{"_id":"source/_posts/JVM-Crash-Log-Analysis.md","hash":"31cb1beff89e15bbdf48f6b21fff08adbc9c0aaf","modified":1520324480000},{"_id":"source/_posts/JVM-Debug-Openjdk-On-Mac.md","hash":"edaa1a59c86bc1a1d04719aed91cea40c68845ac","modified":1520324480000},{"_id":"source/_posts/JVM-Lock.md","hash":"ebc3271b10ccae41bd57ff2103d8f84bafed4700","modified":1520324480000},{"_id":"source/_posts/JVM-Off-Heap-Memory.md","hash":"a2514f63e386900e396ab42239efb92691a0fe4b","modified":1520324480000},{"_id":"source/_posts/JVM-Optimization.md","hash":"bef2606f42930f00d24c9fde2f4db8bc21723edf","modified":1520324480000},{"_id":"source/_posts/JVM-Profiling.md","hash":"8b9e1ce6f2d59c5cd527df9b1e7017ce5a64aa5e","modified":1520324480000},{"_id":"source/_posts/JVM-Thread-interupt.md","hash":"d6b0d69bceb8489d3995c2aed22181f87bdeb94c","modified":1520324480000},{"_id":"source/_posts/Kafka-FAQ.md","hash":"89d27def8a1482cf9cb83d61713159aa7eba3743","modified":1520324480000},{"_id":"source/_posts/Linux-Useful-command.md","hash":"81173a021d3519b46f98e69575d707ae2239b220","modified":1526702861000},{"_id":"source/_posts/Linux-Kernel-space-and-User-space.md","hash":"34df2ae8c7353b5a219c3fd49b5b32637dfe3a3b","modified":1520324480000},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache.md","hash":"9aea0b6ce9c1bb9ccbe51fbfcd227a349bb7a03b","modified":1520324480000},{"_id":"source/_posts/Linux-Mmap.md","hash":"8dd784e06617dd2570d4b94263d5c2b9bd372268","modified":1520324480000},{"_id":"source/_posts/Linux-sync-async-blocking-noblocking.md","hash":"8e301b3ccf3c6b75a9e46554a245a1b80b3625f3","modified":1520324480000},{"_id":"source/_posts/Linux-Zero-Copy.md","hash":"b2b5f51dc2095d9b4a8107ecfac7bb83a8fae352","modified":1520324480000},{"_id":"source/_posts/MySQL-Explain.md","hash":"8222c73362db2d7ea268314f0485b2337b83d32d","modified":1520324480000},{"_id":"source/_posts/Netty-Bind-Port.md","hash":"dbbec87f86abc89fa82cb324c7ff4467dc3d2168","modified":1520324480000},{"_id":"source/_posts/Netty-Buffer-Allocator.md","hash":"62b359381afb64c0947490b22b19123c322bda58","modified":1520324480000},{"_id":"source/_posts/Netty-ChannelOption-Backlog.md","hash":"e66c4b7cb2d2a9ff28c73af255886779dd10c458","modified":1520324480000},{"_id":"source/_posts/Netty-ChannelOption.md","hash":"c80e51a1707cab52569842f09ffe3faa344b1df3","modified":1520324480000},{"_id":"source/_posts/Netty-FAQ.md","hash":"332953ebed894616d9572b2058c5c801fef42e10","modified":1520324480000},{"_id":"source/_posts/OSAHS.md","hash":"d9bfcd01d4441264ea1290e4e3aa2a22599915c0","modified":1530516730000},{"_id":"source/_posts/Netty-Performance-Test.md","hash":"9ad441f9fc5e1ec4859f2217811d989ebb98756a","modified":1520324480000},{"_id":"source/_posts/Netty-Jemalloc.md","hash":"637ea7fac1ff1090ca94075da66ee2eb96eb64a0","modified":1520324480000},{"_id":"source/_posts/Redis-SourceCode-Analysis.md","hash":"5eaf0c9ee4a09beb84614a9d1a616c41fbe62e82","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Consumer-rebalance.md","hash":"1991347d1fb4e8279fb224f3a0aa519d332fd4d2","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Debug-with-intellij.md","hash":"2eafec8f43c7b38e3af97f8c21cb427c97c5bfa6","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Delay-message-delivery.md","hash":"90c1dc23d003496f2326db87233e413868b83f3a","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Index-service.md","hash":"d3402cce575c215bc0aae7aeb3ae6dfceb6aec1f","modified":1520324480000},{"_id":"source/_posts/RocketMQ-FAQ.md","hash":"32855a75383d28f46e85a71388c72c9916545b9f","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Master-slave-high-availability.md","hash":"a528a5a68efcf7aa26fa47f985ede482f54fa08f","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke.md","hash":"2c5fe3afb630894f98c782d82eebeb3ae1c89a37","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Message-send-and-persistence.md","hash":"2b0af70614a1f3fcd2dde43aeb0bc3230cf30ce3","modified":1531366275000},{"_id":"source/_posts/RocketMQ-Pull-message-with-long-polling.md","hash":"705aef0084f5c53f3dda8e4ce52555d09fd728bf","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Remote-communication-protocol-and-serialization.md","hash":"6ad95fbfebf431b4006dcb3caea35a6f3bdac147","modified":1520324480000},{"_id":"source/_posts/Serialization-Hessian.md","hash":"47dcc1676849cb6520cfe359fe79e052130d002a","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Transactional-message.md","hash":"2d09f4fbd448438d8c0870d3c7ef29bfcf2faa11","modified":1520324480000},{"_id":"source/_posts/SourceCode-Future.md","hash":"acf533ee38e5815036968106b62f111f3198aff8","modified":1520324480000},{"_id":"source/_posts/SourceCode-AbstractQueuedSynchronizer.md","hash":"56dc807b5064dca3523c2fd4b7bec9e098caad55","modified":1520324480000},{"_id":"source/_posts/SourceCode-Map.md","hash":"61765b0430bdc7f0085d50f142056de7a5bba06d","modified":1520324480000},{"_id":"source/_posts/Thread-FAQ.md","hash":"b1c7bf7a1792aee9d0bafb533fbf59b48281a9a8","modified":1520324480000},{"_id":"source/_posts/tree-cache-single-thread-event-handler-in-curator.md","hash":"8b3e23dfb61e75106ed43aa07cf9dd1bdbd8060f","modified":1520324480000},{"_id":"source/_posts/TCP-Protocol-Analyzer.md","hash":"1e9c30d43a890714192dea23c4e6df5619d41f4f","modified":1520324480000},{"_id":"source/tags/index.md","hash":"5c890fd947e675abc3ce2371a6ff2ff409362311","modified":1520324480000},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"3b5eafd32abb718e56ccf8d1cee0607ad8ce611d","modified":1520324480000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"b56c01cdfc6ee7ffea8a8a9fa149263f368caef6","modified":1520324480000},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"37bd0ec1d655c601946fc5f5ac2fe8ed1e529b77","modified":1520324480000},{"_id":"themes/next/languages/de.yml","hash":"306db8c865630f32c6b6260ade9d3209fbec8011","modified":1520324480000},{"_id":"themes/next/languages/default.yml","hash":"4cc6aeb1ac09a58330e494c8771773758ab354af","modified":1520324480000},{"_id":"themes/next/languages/id.yml","hash":"2835ea80dadf093fcf47edd957680973f1fb6b85","modified":1520324480000},{"_id":"themes/next/languages/fr-FR.yml","hash":"24180322c83587a153cea110e74e96eacc3355ad","modified":1520324480000},{"_id":"themes/next/languages/ja.yml","hash":"1c3a05ab80a6f8be63268b66da6f19da7aa2c638","modified":1520324480000},{"_id":"themes/next/languages/en.yml","hash":"e7def07a709ef55684490b700a06998c67f35f39","modified":1520324480000},{"_id":"themes/next/languages/ko.yml","hash":"be150543379150f78329815af427bf152c0e9431","modified":1520324480000},{"_id":"themes/next/languages/pt-BR.yml","hash":"958e49571818a34fdf4af3232a07a024050f8f4e","modified":1520324480000},{"_id":"themes/next/languages/ru.yml","hash":"1549a7c2fe23caa7cbedcd0aa2b77c46e57caf27","modified":1520324480000},{"_id":"themes/next/languages/pt.yml","hash":"36c8f60dacbe5d27d84d0e0d6974d7679f928da0","modified":1520324480000},{"_id":"themes/next/languages/zh-Hans.yml","hash":"3c0c7dfd0256457ee24df9e9879226c58cb084b5","modified":1520324480000},{"_id":"themes/next/languages/zh-tw.yml","hash":"0b2c18aa76570364003c8d1cd429fa158ae89022","modified":1520324480000},{"_id":"themes/next/layout/_layout.swig","hash":"06b1eab2e00273e0b94bd32dc682bd92c1e0a747","modified":1520324480000},{"_id":"themes/next/languages/zh-hk.yml","hash":"1c917997413bf566cb79e0975789f3c9c9128ccd","modified":1520324480000},{"_id":"themes/next/layout/archive.swig","hash":"383f64deab105724fd5512371963bd9e9aafbffd","modified":1520324480000},{"_id":"themes/next/layout/category.swig","hash":"4472255f4a3e3dd6d79201523a9526dcabdfbf18","modified":1520324480000},{"_id":"themes/next/layout/index.swig","hash":"03e8a2cda03bad42ac0cb827025eb81f95d496a2","modified":1520324480000},{"_id":"themes/next/layout/page.swig","hash":"37c874cd720acf0eda8d26e063278f2b6ae8d3a6","modified":1520324480000},{"_id":"themes/next/layout/post.swig","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1520324480000},{"_id":"themes/next/layout/schedule.swig","hash":"d86f8de4e118f8c4d778b285c140474084a271db","modified":1520324480000},{"_id":"themes/next/scripts/merge-configs.js","hash":"13c8b3a2d9fce06c2488820d9248d190c8100e0a","modified":1520324480000},{"_id":"themes/next/layout/tag.swig","hash":"7e0a7d7d832883eddb1297483ad22c184e4368de","modified":1520324480000},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1520324480000},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1520324480000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1520324480000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1520324480000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif","hash":"999dfe3ed086bd56471bddb697dd2dd70157cb31","modified":1520324480000},{"_id":"source/_posts/Cobar-Database-Scales/cobar-rule-reload.gif","hash":"f22fc213ac979074b93952f9f9371d79d5441b55","modified":1520324480000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioSign.gif","hash":"6c1b820c2c71938b240d4bc5ac56691f2c538dca","modified":1520324480000},{"_id":"source/_posts/JVM-Lock/biased_lock_convert_flow.jpg","hash":"437ba37b1e9acdac50b4d813ddd6b44199cd035c","modified":1520324480000},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg","hash":"3a3bcb8193115780dd7568721270a217ba4499e9","modified":1520324480000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"source/_posts/Cobar-Database-Scales/binlog-sync.gif","hash":"ea89adb683aae42bcb5382e86b2cf79a6aabb609","modified":1520324480000},{"_id":"source/_posts/Cobar-Database-Scales/backup-and-replay.gif","hash":"0a0d6a449b889101bba7f512f8126b9b244f8a93","modified":1520324480000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactorSign.gif","hash":"17ac291d666654f13097a9ab729adf5d329bd37a","modified":1520324480000},{"_id":"source/_posts/JVM-Lock/markword_state.jpg","hash":"59b1e2cd4dd8962ab1657d79ac8db8a8cd980d95","modified":1520324480000},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/read_write.gif","hash":"d8b58d9570bbe1056bbbb54d8e1d1b54f1c4870e","modified":1520324480000},{"_id":"source/_posts/Netty-Jemalloc/jemalloc.jpg","hash":"350568c3a6c2abff13fb244a3e78e7f758fd99c2","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Index-service/index-file.gif","hash":"4ccabf0aed972624fd7a8c4648430c975af70f3c","modified":1520324480000},{"_id":"source/_posts/TCP-Protocol-Analyzer/mySql-handshake.gif","hash":"9f1b58afc5332c49f53b88e2e3ec081d5dd886f9","modified":1520324480000},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1520324480000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1520324480000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"31322a7f57936cf2dc62e824af5490da5354cf02","modified":1520324480000},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"53d4f83b2b7fb4387dfc9fe81519abd56fbce4ae","modified":1520324480000},{"_id":"themes/next/layout/_macro/reward.swig","hash":"5d5f70deb6074cb4dd0438463e14ccf89213c282","modified":1520324480000},{"_id":"themes/next/layout/_macro/post.swig","hash":"911363776867d9523a3e322cdf591d49cd166403","modified":1520324480000},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"39852700e4084ecccffa6d4669168e5cc0514c9e","modified":1520324480000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"faa7886ccf986890cd776f4e9d70cb89fe9fda5f","modified":1520324480000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"ce7094ee05878161e7568a6dfae5b56ff3fbd6e1","modified":1520324480000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"7172c6053118b7c291a56a7860128a652ae66b83","modified":1520324480000},{"_id":"themes/next/layout/_partials/head.swig","hash":"1f14d3f494b2dbbcee802fd6f6d1abd5b7e2304c","modified":1520324480000},{"_id":"themes/next/layout/_partials/header.swig","hash":"a1ffbb691dfad3eaf2832a11766e58a179003b8b","modified":1520324480000},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1520324480000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1520324480000},{"_id":"themes/next/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1520324480000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1520324480000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1520324480000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9baf90f7c40b3b10f288e9268c3191e895890cea","modified":1520324480000},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1520324480000},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1520324480000},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1520324480000},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"fc93b1a7e6aed0dddb1f3910142b48d8ab61174e","modified":1520324480000},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1520324480000},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1ddb2336a1a19b47af3017047012c01ec5f54529","modified":1520324480000},{"_id":"themes/next/scripts/tags/button.js","hash":"62e6dbeb53d07627a048132c79630b45d9a8f2cc","modified":1520324480000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1520324480000},{"_id":"themes/next/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1520324480000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1520324480000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1520324480000},{"_id":"themes/next/scripts/tags/label.js","hash":"2f8f41a7316372f0d1ed6b51190dc4acd3e16fff","modified":1520324480000},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"eeeabede68cf263de9e6593ecf682f620da16f0a","modified":1520324480000},{"_id":"themes/next/scripts/tags/note.js","hash":"64de4e9d01cf3b491ffc7d53afdf148ee5ad9779","modified":1520324480000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"5786545d51c38e8ca38d1bfc7dd9e946fc70a316","modified":1520324480000},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1520324480000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1520324480000},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1520324480000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1520324480000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1520324480000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1520324480000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1520324480000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1520324480000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1520324480000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1520324480000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1520324480000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1520324480000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1520324480000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1520324480000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1520324480000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif","hash":"c2da1c2fc71056fb224ef0c0a276805206c7cbc6","modified":1520324480000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif","hash":"65ce3f933e03889174067eba323f00a55b13129e","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif","hash":"76597fd5ef32d8ebdf1dee82ab29e1fe092c810a","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif","hash":"75a442326aecac7ad3d959ef816cddec8b32dca4","modified":1520324480000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioRegister.gif","hash":"4aec07220806ec8f3168d58ef8ff62b885bba9c6","modified":1520324480000},{"_id":"source/_posts/Distributed-Transaction/transaction_rocketmq.gif","hash":"9a6c9cd908a78d62a435afdea7ac7bac702f4cd0","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Transactional-message/transaction_rocketmq.gif","hash":"9a6c9cd908a78d62a435afdea7ac7bac702f4cd0","modified":1520324480000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520324480000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/datasource-swithch-with-zk-event-sender.gif","hash":"4a199f1a2930ed182c8eab7dabfdd489fe7f69df","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datahost.gif","hash":"60fea3fcc8b92bcac7b5e6449e8c3bdcf0a35104","modified":1520324480000},{"_id":"source/_posts/JVM-Lock/light_lock_flow.jpg","hash":"8e5801eb0ba5786d871c495188a81eb2f21508a0","modified":1520324480000},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1520324480000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1520324480000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1520324480000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1520324480000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1520324480000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1520324480000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1520324480000},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"63315fcf210799f894208c9f512737096df84962","modified":1520324480000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1520324480000},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1520324480000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1520324480000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"a234c5cd1f75ca5731e814d0dbb92fdcf9240d1b","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"3358d11b9a26185a2d36c96049e4340e701646e4","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"fc65b9c98a0a8ab43a5e7aabff6c5f03838e09c8","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c316758546dc9ba6c60cb4d852c17ca6bb6d6724","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"ee63aa2e49507b884a2d56778479cf01c723d751","modified":1520324480000},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"8a2e393d2e49f7bf560766d8a07cd461bf3fce4f","modified":1520324480000},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"8b6650f77fe0a824c8075b2659e0403e0c78a705","modified":1520324480000},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1520324480000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"385c066af96bee30be2459dbec8aae1f15d382f5","modified":1520324480000},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1520324480000},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1520324480000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1520324480000},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1520324480000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"eaedfaf06dae94ba77a8f4893e2e434bf8859bac","modified":1520324480000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"82f9055955920ed88a2ab6a20ab02169abb2c634","modified":1520324480000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"49b5210fa62d6cbc6a98f57d89d5067a06ab3561","modified":1520324480000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"c8d35a6b9e3bff6d8fdb66de853065af9d37562d","modified":1520324480000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"cfee25d790e4f9b7d57f0dc7e2ea9c1649f08f11","modified":1520324480000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"d477196c5699c8261b08e993a77ef67054d86166","modified":1520324480000},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1520324480000},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1520324480000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"6117f97b4984b8e33f21c726132da64ba678e4ed","modified":1520324480000},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1520324480000},{"_id":"themes/next/source/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1520324480000},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1520324480000},{"_id":"themes/next/source/js/src/motion.js","hash":"dc0365b2fb315a8b43d3ef19b59d3a82a366fcc1","modified":1520324480000},{"_id":"themes/next/source/js/src/post-details.js","hash":"0693695a9512641daff63d99da772625a058ab18","modified":1520324480000},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1520324480000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1520324480000},{"_id":"themes/next/source/js/src/utils.js","hash":"2917c39c75b14b6dab7e1c46ab4d87b4df9fcd5d","modified":1520324480000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1520324480000},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1520324480000},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"7fd2f3e2773555392ef40df40cae3bedb884f17a","modified":1520324480000},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1520324480000},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1520324480000},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1520324480000},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1520324480000},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1520324480000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1520324480000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1520324480000},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1520324480000},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1520324480000},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1520324480000},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1520324480000},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1520324480000},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1520324480000},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1520324480000},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1520324480000},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1520324480000},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1520324480000},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1520324480000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1520324480000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1520324480000},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/zk-distributed-lock.gif","hash":"f8f28db26e293ca5eb4c9f357707e5866cecea4b","modified":1520324480000},{"_id":"source/_posts/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datanode.gif","hash":"8a219316b10fe6c514b0baa83585f23298404d8a","modified":1520324480000},{"_id":"source/_posts/JVM-Lock/biased_lock_flow.jpg","hash":"79d27d2fbe382878f0af70a4694657573ad4cc47","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Message-send-and-persistence/disc-fall.gif","hash":"c365fc98e4f8e66420abcaea0474846ae6978533","modified":1520324480000},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1520324480000},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactor.gif","hash":"7ab7adf110a40c2820cd40110d653d44a1e97c3d","modified":1520324480000},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1520324480000},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1520324480000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"2915df7152ea095a6290ef69157fd67669e0e793","modified":1520324480000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1520324480000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1520324480000},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"86b6fd7f1b1be3ae98f8af6b23a6b1299c670ce9","modified":1520324480000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1520324480000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1520324480000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"d026c8489f66ab6c12ad04bd37f1d5b6f2f3f0d1","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"0dfb4b3ba3180d7285e66f270e1d3fa0f132c3d2","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"711c8830886619d4f4a0598b0cde5499dce50c62","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"bc8c388553bbcf95897459a466ba35bffd5ec5f0","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fda14bc35be2e1b332809b55b3d07155a833dbf4","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"82bbaa6322764779a1ac2e2c8390ce901c7972e2","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"5b93958239d3d2bf9aeaede44eced2434d784462","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"215de948be49bcf14f06d500cef9f7035e406a43","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e3e23751d4ad24e8714b425d768cf68e37de7ded","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"69ecd6c97e7cdfd822ac8102b45ad0ede85050db","modified":1520324480000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1520324480000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1520324480000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1520324480000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1520324480000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png","hash":"f5462e215665696a7867fc6d4ca8d0722c4fe72a","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1520324480000},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1520324480000},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png","hash":"65984a036bbd1af9b8b862e80d2f765fc3e19a17","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"8994ffcce84deac0471532f270f97c44fea54dc0","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"740d37f428b8f4574a76fc95cc25e50e0565f45e","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"7778920dd105fa4de3a7ab206eeba30b1a7bac45","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"65a64d5662637b66e2f039a5f58217afe7a6e800","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"5f6ea57aabfa30a437059bf8352f1ad829dbd4ff","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"77c92a449ce84d558d26d052681f2e0dd77c70c9","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"57d2c8a060f5e4e1a0aef9aae11a0016cf7ac5ba","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"beccb53dcd658136fb91a0c5678dea8f37d6e0b6","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"0f7f522cc6bfb3401d5afd62b0fcdf48bb2d604b","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"88c7d75646b66b168213190ee4cd874609afd5e3","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"ed88c8b51d0517759c777e71a6bfbe2907bcd994","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ee554b1031ef0070a5916477939021800e3c9d27","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"963105a531403d7aad6d9e5e23e3bfabb8ec065a","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"08a500b2984f109b751f3697ca33172d1340591a","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post-wordcount.styl","hash":"4fda5d38c6c8d910e3bf5c74a48a8d4a3f3dc73d","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"51eca243220cf57133a4becae9b78514bcfdc723","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"b8969e1654eec89a0fd10d88b337fee9cb03cd44","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"45df0cf4c97b47e05573bcd41028ee50f3fdf432","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"ead0d0f2321dc71505788c7f689f92257cf14947","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1520324480000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"aeff0e6e23725e8baea27c890ccbbf466024f767","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1520324480000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1520324480000},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1520324480000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1520324480000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1520324480000},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1520324480000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1520324480000},{"_id":"source/.DS_Store","hash":"5f5b1ac3c4db4dd77972997d7d5684e05813be04","modified":1531063455000},{"_id":"source/_posts/.DS_Store","hash":"4c0a29dd23d96555b17ed83ca45d0d8e19608544","modified":1531060983000}],"Category":[],"Data":[],"Page":[{"title":"tags","date":"2017-10-12T11:33:19.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2017-10-12 19:33:19\ntype: \"tags\"\n---\n","updated":"2018-03-06T08:21:20.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjj3wcsxi00013iq2r23rb1tn","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"CobarCobar","date":"2017-10-09T09:31:06.000Z","_content":"\nCobarCobar\n\n### \n\nCobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif)\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif)\n\nCobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif)\n\n### \n\nCobar_BinsertCobar_Aselectbinlog\n\n### \n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/datasource-swithch-with-zk-event-sender.gif)\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/zk-distributed-lock.gif)","source":"_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock.md","raw":"---\ntitle: CobarCobar\ndate: 2017-10-09 17:31:06\ntags: Cobar\n---\n\nCobarCobar\n\n### \n\nCobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif)\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif)\n\nCobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif)\n\n### \n\nCobar_BinsertCobar_Aselectbinlog\n\n### \n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/datasource-swithch-with-zk-event-sender.gif)\n\n![](Cobar-Cluster-datasource-switch-design-with-distributed-lock/zk-distributed-lock.gif)","slug":"Cobar-Cluster-datasource-switch-design-with-distributed-lock","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxe00003iq2gzdelso7","content":"<p>CobarCobar</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif\" alt=\"\"></p>\n<p>CobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Cobar_BinsertCobar_Aselectbinlog</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/datasource-swithch-with-zk-event-sender.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/zk-distributed-lock.gif\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>CobarCobar</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarCobar_ClusterCobar_ACobar_B8MySQLMySQL1-8MySQL1-4MasterMySQL5-8Slave</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif\" alt=\"\"></p>\n<p>CobarACobarBMySQL1-4CobarAMySQL_2CobarBMySQL_2CobarAMySQL_6CobarBMySQL_2</p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Cobar_BinsertCobar_Aselectbinlog</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/datasource-swithch-with-zk-event-sender.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/09/Cobar-Cluster-datasource-switch-design-with-distributed-lock/zk-distributed-lock.gif\" alt=\"\"></p>\n"},{"title":"Cobar","date":"2017-11-29T07:49:07.000Z","_content":"\n![](Cobar-Database-Scales/backup-and-replay.gif)\n\n![](Cobar-Database-Scales/binlog-sync.gif)\n\n![](Cobar-Database-Scales/cobar-rule-reload.gif)","source":"_posts/Cobar-Database-Scales.md","raw":"---\ntitle: Cobar\ndate: 2017-11-29 15:49:07\ntags: Cobar\n---\n\n![](Cobar-Database-Scales/backup-and-replay.gif)\n\n![](Cobar-Database-Scales/binlog-sync.gif)\n\n![](Cobar-Database-Scales/cobar-rule-reload.gif)","slug":"Cobar-Database-Scales","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxi00023iq2zuhv730g","content":"<p><img src=\"/2017/11/29/Cobar-Database-Scales/backup-and-replay.gif\" alt=\"\"></p>\n<p><img src=\"/2017/11/29/Cobar-Database-Scales/binlog-sync.gif\" alt=\"\"></p>\n<p><img src=\"/2017/11/29/Cobar-Database-Scales/cobar-rule-reload.gif\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/2017/11/29/Cobar-Database-Scales/backup-and-replay.gif\" alt=\"\"></p>\n<p><img src=\"/2017/11/29/Cobar-Database-Scales/binlog-sync.gif\" alt=\"\"></p>\n<p><img src=\"/2017/11/29/Cobar-Database-Scales/cobar-rule-reload.gif\" alt=\"\"></p>\n"},{"title":"CobarCobarDatahost","date":"2017-10-27T08:03:12.000Z","_content":"\n![](Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datanode.gif)\n\n![](Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datahost.gif)\n\n\n### change log\n\n#### schema.xml\nuserMySQL90-4host15-8host2\n\n<schema name=\"user\" dataNode=\"user_dn[0]\">\n    <!--  -->                                                               \n    <table name=\"user\" dataNode=\"user_dn$1-8\" rule=\"user_id_rule\" />\n</schema>\n\n<dataNode name=\"user_dn$0-4\" dataHost=\"user_host1\" database=\"user$0-4\" />\n<dataNode name=\"user_dn$5-8\" dataHost=\"user_host2\" database=\"user$5-8\" />\n\n<dataHost name=\"user_host1\" maxCon=\"200\" minCon=\"50\">\n    <heartbeat>select user()</heartbeat>\n    <writeHost host=\"M1\" url=\"host1:3306\" user=\"root\" password=\"root\" />\n    <writeHost host=\"S1\" url=\"host1_slave:3306\" user=\"root\" password=\"root\" />\n</dataHost>\n<dataHost name=\"user_host2\" maxCon=\"200\" minCon=\"50\">\n    <heartbeat>select user()</heartbeat>\n    <writeHost host=\"M1\" url=\"host2:3306\" user=\"root\" password=\"root\" />\n    <writeHost host=\"S1\" url=\"host2_slave:3306\" user=\"root\" password=\"root\" />\n</dataHost>\n","source":"_posts/Cobar-Enhance-cobar-dataSource-with-dataHost.md","raw":"---\ntitle: CobarCobarDatahost\ndate: 2017-10-27 16:03:12\ntags: Cobar\n---\n\n![](Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datanode.gif)\n\n![](Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datahost.gif)\n\n\n### change log\n\n#### schema.xml\nuserMySQL90-4host15-8host2\n\n<schema name=\"user\" dataNode=\"user_dn[0]\">\n    <!--  -->                                                               \n    <table name=\"user\" dataNode=\"user_dn$1-8\" rule=\"user_id_rule\" />\n</schema>\n\n<dataNode name=\"user_dn$0-4\" dataHost=\"user_host1\" database=\"user$0-4\" />\n<dataNode name=\"user_dn$5-8\" dataHost=\"user_host2\" database=\"user$5-8\" />\n\n<dataHost name=\"user_host1\" maxCon=\"200\" minCon=\"50\">\n    <heartbeat>select user()</heartbeat>\n    <writeHost host=\"M1\" url=\"host1:3306\" user=\"root\" password=\"root\" />\n    <writeHost host=\"S1\" url=\"host1_slave:3306\" user=\"root\" password=\"root\" />\n</dataHost>\n<dataHost name=\"user_host2\" maxCon=\"200\" minCon=\"50\">\n    <heartbeat>select user()</heartbeat>\n    <writeHost host=\"M1\" url=\"host2:3306\" user=\"root\" password=\"root\" />\n    <writeHost host=\"S1\" url=\"host2_slave:3306\" user=\"root\" password=\"root\" />\n</dataHost>\n","slug":"Cobar-Enhance-cobar-dataSource-with-dataHost","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxm00043iq2c34i3z84","content":"<p><img src=\"/2017/10/27/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datanode.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/27/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datahost.gif\" alt=\"\"></p>\n<h3 id=\"change-log\"><a href=\"#change-log\" class=\"headerlink\" title=\"change log\"></a>change log</h3><h4 id=\"schema-xml\"><a href=\"#schema-xml\" class=\"headerlink\" title=\"schema.xml\"></a>schema.xml</h4><p>userMySQL90-4host15-8host2</p>\n<schema name=\"user\" datanode=\"user_dn[0]\"><br>    <!--  --><br>    <table name=\"user\" datanode=\"user_dn$1-8\" rule=\"user_id_rule\"><br></table></schema>\n\n<p><datanode name=\"user_dn$0-4\" datahost=\"user_host1\" database=\"user$0-4\"></datanode></p>\n<datanode name=\"user_dn$5-8\" datahost=\"user_host2\" database=\"user$5-8\">\n\n<datahost name=\"user_host1\" maxcon=\"200\" mincon=\"50\"><br>    <heartbeat>select user()</heartbeat><br>    <writehost host=\"M1\" url=\"host1:3306\" user=\"root\" password=\"root\"><br>    <writehost host=\"S1\" url=\"host1_slave:3306\" user=\"root\" password=\"root\"><br></writehost></writehost></datahost><br><datahost name=\"user_host2\" maxcon=\"200\" mincon=\"50\"><br>    <heartbeat>select user()</heartbeat><br>    <writehost host=\"M1\" url=\"host2:3306\" user=\"root\" password=\"root\"><br>    <writehost host=\"S1\" url=\"host2_slave:3306\" user=\"root\" password=\"root\"><br></writehost></writehost></datahost>\n</datanode>","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/2017/10/27/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datanode.gif\" alt=\"\"></p>\n<p><img src=\"/2017/10/27/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datahost.gif\" alt=\"\"></p>\n<h3 id=\"change-log\"><a href=\"#change-log\" class=\"headerlink\" title=\"change log\"></a>change log</h3><h4 id=\"schema-xml\"><a href=\"#schema-xml\" class=\"headerlink\" title=\"schema.xml\"></a>schema.xml</h4><p>userMySQL90-4host15-8host2</p>\n<schema name=\"user\" datanode=\"user_dn[0]\"><br>    <!--  --><br>    <table name=\"user\" datanode=\"user_dn$1-8\" rule=\"user_id_rule\"><br></table></schema>\n\n<p><datanode name=\"user_dn$0-4\" datahost=\"user_host1\" database=\"user$0-4\"></datanode></p>\n<datanode name=\"user_dn$5-8\" datahost=\"user_host2\" database=\"user$5-8\">\n\n<datahost name=\"user_host1\" maxcon=\"200\" mincon=\"50\"><br>    <heartbeat>select user()</heartbeat><br>    <writehost host=\"M1\" url=\"host1:3306\" user=\"root\" password=\"root\"><br>    <writehost host=\"S1\" url=\"host1_slave:3306\" user=\"root\" password=\"root\"><br></writehost></writehost></datahost><br><datahost name=\"user_host2\" maxcon=\"200\" mincon=\"50\"><br>    <heartbeat>select user()</heartbeat><br>    <writehost host=\"M1\" url=\"host2:3306\" user=\"root\" password=\"root\"><br>    <writehost host=\"S1\" url=\"host2_slave:3306\" user=\"root\" password=\"root\"><br></writehost></writehost></datahost>\n</datanode>"},{"title":"CobarCobar Driver","date":"2017-10-12T12:07:23.000Z","_content":"\ncobarcobar-driver\n\n### cobar-driver\n\ncobarJDBC`jdbc:cobar://Cobar_A:8066/user`cobar\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif)\n\n### HA cobar(jdbc)\ncobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif)","source":"_posts/Cobar-Enhance-cobar-driver-with-high-availability.md","raw":"---\ntitle: CobarCobar Driver\ndate: 2017-10-12 20:07:23\ntags: Cobar\n---\n\ncobarcobar-driver\n\n### cobar-driver\n\ncobarJDBC`jdbc:cobar://Cobar_A:8066/user`cobar\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif)\n\n### HA cobar(jdbc)\ncobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2\n\n![](Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif)","slug":"Cobar-Enhance-cobar-driver-with-high-availability","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxo00053iq26l3j2g45","content":"<p>cobarcobar-driver</p>\n<h3 id=\"cobar-driver\"><a href=\"#cobar-driver\" class=\"headerlink\" title=\"cobar-driver\"></a>cobar-driver</h3><p>cobarJDBC<code>jdbc:cobar://Cobar_A:8066/user</code>cobar</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif\" alt=\"\"></p>\n<h3 id=\"HA-cobar-jdbc-\"><a href=\"#HA-cobar-jdbc-\" class=\"headerlink\" title=\"HA cobar(jdbc)\"></a>HA cobar(jdbc)</h3><p>cobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>cobarcobar-driver</p>\n<h3 id=\"cobar-driver\"><a href=\"#cobar-driver\" class=\"headerlink\" title=\"cobar-driver\"></a>cobar-driver</h3><p>cobarJDBC<code>jdbc:cobar://Cobar_A:8066/user</code>cobar</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif\" alt=\"\"></p>\n<h3 id=\"HA-cobar-jdbc-\"><a href=\"#HA-cobar-jdbc-\" class=\"headerlink\" title=\"HA cobar(jdbc)\"></a>HA cobar(jdbc)</h3><p>cobar-driverURLhosthostZooKeeperCobarjdbc:cobar_cluster://cobar_1,cobar_2:8066/usercobar_1cobar_2</p>\n<p><img src=\"/2017/10/12/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif\" alt=\"\"></p>\n"},{"title":"Cobar-Enhance-cobar-mysql-heartbeat","date":"2017-10-27T06:37:10.000Z","_content":"\n### CobarMySQL\n\nCobarNIONetty\n\n### \n\nCobarMySQL`select user()`Cobar\n* CobarMySQLError\n* CobarMySQL30MySQLTimeout\n\nVPCCobardataNodeMasterSlaveSlaveMasterSQL\n\nError33nError\n\n### ","source":"_posts/Cobar-Enhance-cobar-mysql-heartbeat.md","raw":"---\ntitle: Cobar-Enhance-cobar-mysql-heartbeat\ndate: 2017-10-27 14:37:10\ntags: Cobar\n---\n\n### CobarMySQL\n\nCobarNIONetty\n\n### \n\nCobarMySQL`select user()`Cobar\n* CobarMySQLError\n* CobarMySQL30MySQLTimeout\n\nVPCCobardataNodeMasterSlaveSlaveMasterSQL\n\nError33nError\n\n### ","slug":"Cobar-Enhance-cobar-mysql-heartbeat","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxq00063iq2xthrhv0u","content":"<h3 id=\"CobarMySQL\"><a href=\"#CobarMySQL\" class=\"headerlink\" title=\"CobarMySQL\"></a>CobarMySQL</h3><p>CobarNIONetty</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarMySQL<code>select user()</code>Cobar</p>\n<ul>\n<li>CobarMySQLError</li>\n<li>CobarMySQL30MySQLTimeout</li>\n</ul>\n<p>VPCCobardataNodeMasterSlaveSlaveMasterSQL</p>\n<p>Error33nError</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"CobarMySQL\"><a href=\"#CobarMySQL\" class=\"headerlink\" title=\"CobarMySQL\"></a>CobarMySQL</h3><p>CobarNIONetty</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CobarMySQL<code>select user()</code>Cobar</p>\n<ul>\n<li>CobarMySQLError</li>\n<li>CobarMySQL30MySQLTimeout</li>\n</ul>\n<p>VPCCobardataNodeMasterSlaveSlaveMasterSQL</p>\n<p>Error33nError</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"Cobar","date":"2017-10-18T12:24:04.000Z","_content":"\nFrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler\n\nHandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue\n\nCobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar\n![img](https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg)\n\n### Cobar\n\n\n\n### hexo new Cobar-Extend-Database\n\nPercona XtraBackup\n","source":"_posts/Cobar-FAQ.md","raw":"---\ntitle: Cobar\ndate: 2017-10-18 20:24:04\ntags: Cobar\n---\n\nFrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler\n\nHandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue\n\nCobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar\n![img](https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg)\n\n### Cobar\n\n\n\n### hexo new Cobar-Extend-Database\n\nPercona XtraBackup\n","slug":"Cobar-FAQ","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxu00093iq2dca6d2bp","content":"<p>FrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler</p>\n<p>HandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue</p>\n<p>Cobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar<br><img src=\"https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg\" alt=\"img\"></p>\n<h3 id=\"Cobar\"><a href=\"#Cobar\" class=\"headerlink\" title=\"Cobar\"></a>Cobar</h3><h3 id=\"hexo-new-Cobar-Extend-Database\"><a href=\"#hexo-new-Cobar-Extend-Database\" class=\"headerlink\" title=\"hexo new Cobar-Extend-Database\"></a>hexo new Cobar-Extend-Database</h3><p>Percona XtraBackup<br></p>\n","site":{"data":{}},"excerpt":"","more":"<p>FrontendConnectionNioHandlerFrontendAuthenticator, FrontendConnectionhandler.handle()handlerFrontendAuthenticatorFrontendConnectionhandlerFrontendCommandHandler</p>\n<p>HandlerNioConnectionHandlerresponseNioConnection, NioConnectionNioProcessorwriteQueue</p>\n<p>Cobar50SQL80-90MySQLmax_connectionsCobarSQLMySQLCobarCobar<br><img src=\"https://ws4.sinaimg.cn/large/006tKfTcgy1fkmo3ieklej31kw0hz7il.jpg\" alt=\"img\"></p>\n<h3 id=\"Cobar\"><a href=\"#Cobar\" class=\"headerlink\" title=\"Cobar\"></a>Cobar</h3><h3 id=\"hexo-new-Cobar-Extend-Database\"><a href=\"#hexo-new-Cobar-Extend-Database\" class=\"headerlink\" title=\"hexo new Cobar-Extend-Database\"></a>hexo new Cobar-Extend-Database</h3><p>Percona XtraBackup<br></p>\n"},{"title":"CobarCobar","date":"2017-10-12T12:04:26.000Z","_content":"","source":"_posts/Cobar-How-to-monitor-cobar.md","raw":"---\ntitle: CobarCobar\ndate: 2017-10-12 20:04:26\ntags: Cobar\n---\n","slug":"Cobar-How-to-monitor-cobar","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsxx000b3iq2t3uuz87t","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Cobar-NIO-client","date":"2017-10-18T03:13:59.000Z","_content":"\nCobarNIO ServerNIO Client","source":"_posts/Cobar-NIO-client.md","raw":"---\ntitle: Cobar-NIO-client\ndate: 2017-10-18 11:13:59\ntags: Cobar\n---\n\nCobarNIO ServerNIO Client","slug":"Cobar-NIO-client","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsy3000e3iq29fsbo0i0","content":"<p>CobarNIO ServerNIO Client</p>\n","site":{"data":{}},"excerpt":"","more":"<p>CobarNIO ServerNIO Client</p>\n"},{"title":"Cobar-NIO-server","date":"2017-10-18T03:13:40.000Z","_content":"\nCobarNIO ServerNIO Client","source":"_posts/Cobar-NIO-server.md","raw":"---\ntitle: Cobar-NIO-server\ndate: 2017-10-18 11:13:40\ntags: Cobar\n---\n\nCobarNIO ServerNIO Client","slug":"Cobar-NIO-server","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsy6000g3iq212o4z0ne","content":"<p>CobarNIO ServerNIO Client</p>\n","site":{"data":{}},"excerpt":"","more":"<p>CobarNIO ServerNIO Client</p>\n"},{"title":"CobarSQL","date":"2017-09-19T08:58:28.000Z","_content":"","source":"_posts/Cobar-How-sql-executes-in-cobar.md","raw":"---\ntitle: CobarSQL\ndate: 2017-09-19 16:58:28\ntags: Cobar\n---\n","slug":"Cobar-How-sql-executes-in-cobar","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsy9000i3iq27zsf12m1","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Cobar-Performance-Test-With-Sysbench","date":"2017-12-13T11:11:35.000Z","_content":"\n### centos\n\n``` bash\nyum install sysbench\n```\n\nlua /usr/share/sysbench/\n\nCobarSQL 92/usr/share/sysbench/oltp_common.lua\n\n\n\n: sysbench [lua_path] help\n: sysbench /usr/share/sysbench/oltp_insert.lua help\n\nsysbench --mysql-host=mac \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password=zerodb \\\n--mysql-db=zerodb \\\n--threads=4 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=2 \\\n/usr/local/Cellar/sysbench/1.0.11/share/sysbench/oltp_insert.lua \\\n\n#cobar_1\n\nsysbench --mysql-host=10.1.21.148 \\\n--mysql-port=8066 \\\n--mysql-user=user \\\n--mysql-password='user' \\\n--mysql-db=user \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 \\\n--events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\n\n\n#cobar_2\n\nsysbench --mysql-host=10.1.21.147 \\\n--mysql-port=8066 \\\n--mysql-user=user \\\n--mysql-password='user' \\\n--mysql-db=user \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\n\n### \n[root@mq001 ~]# sysbench --mysql-host=10.1.21.147 --mysql-port=8066 --mysql-user=user --mysql-password='user' --mysql-db=user --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=60 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\nsysbench 1.0.9 (using system LuaJIT 2.0.4)\n\nRunning the test with following options:\nNumber of threads: 400\nReport intermediate results every 5 second(s)\nInitializing random number generator from current time\n\n\nInitializing worker threads...\n\nThreads started!\n\n[ 5s ] thds: 400 tps: 11516.37 qps: 11516.37 (r/w/o: 0.00/11516.37/0.00) lat (ms,99%): 204.11 err/s: 0.00 reconn/s: 0.00\n[ 10s ] thds: 400 tps: 2884.87 qps: 2884.87 (r/w/o: 0.00/2884.87/0.00) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00\n[ 15s ] thds: 400 tps: 4025.00 qps: 4025.00 (r/w/o: 0.00/4025.00/0.00) lat (ms,99%): 1869.60 err/s: 0.00 reconn/s: 0.00\n[ 20s ] thds: 400 tps: 13497.32 qps: 13497.32 (r/w/o: 0.00/13497.32/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00\n[ 25s ] thds: 400 tps: 10908.17 qps: 10908.17 (r/w/o: 0.00/10908.17/0.00) lat (ms,99%): 144.97 err/s: 0.00 reconn/s: 0.00\n[ 30s ] thds: 400 tps: 12280.74 qps: 12280.74 (r/w/o: 0.00/12280.74/0.00) lat (ms,99%): 132.49 err/s: 0.00 reconn/s: 0.00\n[ 35s ] thds: 400 tps: 9783.37 qps: 9783.37 (r/w/o: 0.00/9783.37/0.00) lat (ms,99%): 150.29 err/s: 0.00 reconn/s: 0.00\n[ 40s ] thds: 400 tps: 11703.52 qps: 11703.72 (r/w/o: 0.00/11703.72/0.00) lat (ms,99%): 173.58 err/s: 0.00 reconn/s: 0.00\n[ 45s ] thds: 400 tps: 8253.06 qps: 8252.86 (r/w/o: 0.00/8252.86/0.00) lat (ms,99%): 207.82 err/s: 0.00 reconn/s: 0.00\n[ 50s ] thds: 400 tps: 7148.98 qps: 7149.18 (r/w/o: 0.00/7149.18/0.00) lat (ms,99%): 657.93 err/s: 0.00 reconn/s: 0.00\n[ 55s ] thds: 400 tps: 10911.35 qps: 10911.15 (r/w/o: 0.00/10911.15/0.00) lat (ms,99%): 176.73 err/s: 0.00 reconn/s: 0.00\n[ 60s ] thds: 400 tps: 8702.48 qps: 8702.48 (r/w/o: 0.00/8702.48/0.00) lat (ms,99%): 235.74 err/s: 0.00 reconn/s: 0.00\nSQL statistics:\n    queries performed:\n        read:                            0\n        write:                           558494\n        other:                           0\n        total:                           558494\n    transactions:                        558494 (9273.20 per sec.)\n    queries:                             558494 (9273.20 per sec.)\n    ignored errors:                      0      (0.00 per sec.)\n    reconnects:                          0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          60.2244s\n    total number of events:              558494\n\nLatency (ms):\n         min:                                  3.89\n         avg:                                 43.02\n         max:                               2881.01\n         99th percentile:                    253.35\n         sum:                            24023700.41\n\nThreads fairness:\n    events (avg/stddev):           1396.2350/30.84\n    execution time (avg/stddev):   60.0593/0.05\n\n\n\n[root@mq001 ~]# sysbench --mysql-host=10.1.21.148 --mysql-port=8066 --mysql-user=user --mysql-password='user' --mysql-db=user --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=60 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\nsysbench 1.0.9 (using system LuaJIT 2.0.4)\n\nRunning the test with following options:\nNumber of threads: 400\nReport intermediate results every 5 second(s)\nInitializing random number generator from current time\n\n\nInitializing worker threads...\n\nThreads started!\n\n[ 5s ] thds: 400 tps: 10470.98 qps: 10470.98 (r/w/o: 0.00/10470.98/0.00) lat (ms,99%): 262.64 err/s: 0.00 reconn/s: 0.00\n[ 10s ] thds: 400 tps: 3020.06 qps: 3020.06 (r/w/o: 0.00/3020.06/0.00) lat (ms,99%): 1050.76 err/s: 0.00 reconn/s: 0.00\n[ 15s ] thds: 400 tps: 1107.64 qps: 1107.64 (r/w/o: 0.00/1107.64/0.00) lat (ms,99%): 1327.91 err/s: 0.00 reconn/s: 0.00\n[ 20s ] thds: 400 tps: 7395.23 qps: 7395.23 (r/w/o: 0.00/7395.23/0.00) lat (ms,99%): 816.63 err/s: 0.00 reconn/s: 0.00\n[ 25s ] thds: 400 tps: 12654.11 qps: 12654.11 (r/w/o: 0.00/12654.11/0.00) lat (ms,99%): 125.52 err/s: 0.00 reconn/s: 0.00\n[ 30s ] thds: 400 tps: 10854.72 qps: 10854.92 (r/w/o: 0.00/10854.92/0.00) lat (ms,99%): 153.02 err/s: 0.00 reconn/s: 0.00\n[ 35s ] thds: 400 tps: 11832.81 qps: 11832.61 (r/w/o: 0.00/11832.61/0.00) lat (ms,99%): 186.54 err/s: 0.00 reconn/s: 0.00\n[ 40s ] thds: 400 tps: 6895.44 qps: 6895.44 (r/w/o: 0.00/6895.44/0.00) lat (ms,99%): 257.95 err/s: 0.00 reconn/s: 0.00\n[ 45s ] thds: 400 tps: 12907.06 qps: 12907.06 (r/w/o: 0.00/12907.06/0.00) lat (ms,99%): 158.63 err/s: 0.00 reconn/s: 0.00\n[ 50s ] thds: 400 tps: 7760.80 qps: 7760.80 (r/w/o: 0.00/7760.80/0.00) lat (ms,99%): 292.60 err/s: 0.00 reconn/s: 0.00\n[ 55s ] thds: 400 tps: 11595.84 qps: 11595.84 (r/w/o: 0.00/11595.84/0.00) lat (ms,99%): 161.51 err/s: 0.00 reconn/s: 0.00\n[ 60s ] thds: 400 tps: 10314.36 qps: 10314.36 (r/w/o: 0.00/10314.36/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00\nSQL statistics:\n    queries performed:\n        read:                            0\n        write:                           534637\n        other:                           0\n        total:                           534637\n    transactions:                        534637 (8890.97 per sec.)\n    queries:                             534637 (8890.97 per sec.)\n    ignored errors:                      0      (0.00 per sec.)\n    reconnects:                          0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          60.1304s\n    total number of events:              534637\n\nLatency (ms):\n         min:                                  4.14\n         avg:                                 44.91\n         max:                               3066.99\n         99th percentile:                    292.60\n         sum:                            24012284.54\n\nThreads fairness:\n    events (avg/stddev):           1336.5925/23.11\n    execution time (avg/stddev):   60.0307/0.03\n    \n    \n    \n    \n\nsysbench --mysql-host=10.1.134.195 \\\n--mysql-port=8066 \\\n--mysql-user=user \\\n--mysql-password='user' \\\n--mysql-db=user \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 \\\n--events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\n\n\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=10 \\\n--debug=on \\\n--verbosity=5 \\\n--tables=5 \\\n--events=1 \\\n--auto_inc=off \\\n--table-size=1000 \\\n--db-driver=mysql \\\n--time=6000000 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_read_only.lua \\\nrun\n\n\n\n# zerodb\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=10 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\ncleanup\n\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=10 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\nprepare\n\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\nrun\n\nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[899:{SchemaIndex=225, TableIndex=899, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1592131459, 7, '55016285732-53347045338-85834558147-71206675947-20854212178-67704861318-55023920639-15021922692-58783263226-91831209826', '44804973802-80594424819-30662288113-07543047794-69158617276')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[607:{SchemaIndex=152, TableIndex=607, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1551461983, 1, '97565032345-06095273461-70708868939-89114711497-07191112359-84320966593-06915637429-34011520393-29123922986-41181266499', '10350064023-47161933420-32840507920-65997397770-16177253238')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[371:{SchemaIndex=93, TableIndex=371, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1688397171, 3, '66563027950-07665251035-46015031422-61663761332-16063948763-45273359443-68411883367-29428347771-65572934442-17492196263', '60851935379-49894017653-67952828882-67412344041-59230452535')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1011:{SchemaIndex=253, TableIndex=1011, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-573803507, 2, '43589791346-92222019297-77586384271-52778612091-96284921979-05035493725-49350672130-03697130813-21052521840-31158762545', '33228172883-24963516238-59142423481-48021525640-21772792414')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1001, mergeExecResult: 0. shardingNode:map[310:{SchemaIndex=78, TableIndex=310, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (439335222, 7, '03793368943-50266953542-49577833032-14468376728-10198261385-85128057368-15281808692-43095784178-01078624681-09027567677', '45982088127-90369291605-80044281219-46887615792-75467747528')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[259:{SchemaIndex=65, TableIndex=259, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (824478979, 9, '79929455805-82686000395-87933678180-97427805059-78850675331-66749630290-23371965370-59789760435-11687903028-37111392097', '65387439360-90889047465-34899315444-83593158053-88419722270')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[388:{SchemaIndex=98, TableIndex=388, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1778834820, 4, '26400620948-86886163258-66955677020-24736956201-37633810654-62170837016-10953232786-08731106510-27930064178-11956848338', '22734010461-63969213016-54927682118-22921617753-25869637636')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[345:{SchemaIndex=87, TableIndex=345, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1906262361, 4, '73054929345-92331883054-27511894619-20000378864-11948567194-86713567705-11190297445-34047180586-99650690403-71903892017', '07335571244-33555087386-76380202973-29490934882-40814481851')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[569:{SchemaIndex=143, TableIndex=569, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1606555193, 2, '94281857928-97538212927-39261666932-79938992409-52558016112-06785833668-50810169070-34555719774-82330250972-35853785503', '29683325026-64124354800-63566774522-19722425169-37547560762')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1143670666, 7, '74870370257-63163303467-80061015187-84192128665-25175084977-80554698357-24269465921-53186773519-78675020561-83488552374', '73368269204-64304332325-34620567277-68846684629-38045820340')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[941:{SchemaIndex=236, TableIndex=941, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1370776493, 6, '16692170437-43512178684-59516594203-75377838995-76081749306-71167865747-97237301685-23453441670-03667446181-56604717727', '14195711604-53513247591-07873804194-96431257292-05520461785')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[872:{SchemaIndex=219, TableIndex=872, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1208557416, 5, '27703568859-81266825379-86789890837-60513053664-22258866897-34966682979-82761864561-83949706302-60135012966-31647733109', '63271991640-87709697591-13072925018-38646644832-79179029573')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[991:{SchemaIndex=248, TableIndex=991, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (138564575, 6, '26857888685-88370802193-51045899118-07572056078-70111763976-05806767425-30208609378-20016792779-48308493020-29821526191', '61555808494-05287717368-66884245341-45983655335-60458704606')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1007, mergeExecResult: 0. shardingNode:map[449:{SchemaIndex=113, TableIndex=449, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-229865921, 8, '14034106238-21876701329-38233326181-31158038417-73928237004-22908354046-72713486563-40610785127-99166317018-52234063725', '23168975405-73598149943-63125122764-74527985990-06171559404')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[959:{SchemaIndex=240, TableIndex=959, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-677583807, 4, '40735866383-98457016615-08789114417-03599576561-48782283253-32055567198-88072330194-83020475968-03693883045-96278614943', '70150968961-19151317381-16983120036-88185867422-84862477300')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1006, mergeExecResult: 0. shardingNode:map[406:{SchemaIndex=102, TableIndex=406, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-2093701526, 5, '09210536591-41896791043-73295525884-89613310006-75387609760-41655764025-47137540812-97100201238-15965683915-13727887851', '48024514833-13441113380-49081922507-17183150276-06208568092')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[894:{SchemaIndex=224, TableIndex=894, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (108403582, 4, '58477996001-39515710854-83438883003-74672331816-19403553257-36113016280-00822951895-43706580851-50122510142-72629874469', '25950012615-74047249694-75644797724-67405314152-48742553448')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[824:{SchemaIndex=207, TableIndex=824, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1108509496, 2, '05591703103-07428761202-09014510822-44571443153-87746638001-18005366596-37591757698-85345493107-52688524466-97341165803', '90287453968-47714845240-54141462203-72968014933-11681199861')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[960:{SchemaIndex=241, TableIndex=960, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-432972736, 4, '32013395637-31037790439-99508763633-39582502523-46934970326-99846192559-79844868065-81128826635-19475623448-94555401729', '72848617704-77451404798-55770002912-34209086424-23821979141')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[864:{SchemaIndex=217, TableIndex=864, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (209038176, 6, '31725269303-67222682770-97738396828-19717571752-01126165612-57542830563-51718817223-13687491781-38891241679-10677758794', '40604117998-67635443824-03882862739-68433432919-44278589057')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-663100941, 3, '13572309986-10356575142-87428874956-18162116973-83396135908-09352768769-83603227505-94165603992-17437041978-81761343722', '58884262253-26008842705-81702669160-02709154611-78739667686')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[821:{SchemaIndex=206, TableIndex=821, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1290297141, 6, '28650953615-66926208686-47052429218-34545146184-51693579732-60563146329-00350338711-30136625347-99506216978-22404723673', '30345581431-18594298965-23203468098-48853746952-30033247101')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[881:{SchemaIndex=221, TableIndex=881, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2128759665, 3, '23557322059-62351008582-19218938648-55023996016-67978090662-04498693910-40333149725-65457542876-11556698223-86845640120', '39531266486-08252986785-52805405505-62972899514-62765043827')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[829:{SchemaIndex=208, TableIndex=829, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1081064253, 2, '39396011527-03550826801-53544579241-44145722341-56423193708-85298116954-45172197891-54532848324-82241582599-97563898680', '76749800295-63255838342-73258070193-02305060704-64352300433')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[900:{SchemaIndex=226, TableIndex=900, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-513806212, 1, '16727493623-40348083665-41922314110-05150944505-43353212884-59194917800-00753396008-63562258886-84259052626-93713085152', '38634951090-07591809914-73325301815-73315254313-82978384844')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1, mergeExecResult: 0. shardingNode:map[863:{SchemaIndex=216, TableIndex=863, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-450094943, 6, '23924438266-62111362125-81473873200-06328498397-88922636306-39182947784-05124699385-49780077333-57313760145-54634535492', '96577223660-83042935121-28454288566-32057418883-39061132652')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[963:{SchemaIndex=241, TableIndex=963, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1800163267, 4, '27948346446-05701199368-49149768636-18762164887-01870692332-13661773677-35851324771-46733712098-36653074427-31181566769', '08781105428-22812332073-21224324603-72676647429-86438534524')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[878:{SchemaIndex=220, TableIndex=878, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1535190894, 9, '46310600095-97541020554-94065740469-24853513335-69630566641-31721053084-60343664925-46348792383-87749652424-52899212634', '41944783155-15764748316-26823908956-07652542569-85074827204')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1945995146, 4, '64447284661-78831878306-27636005022-88863833954-72613803410-72661880191-81775646793-56738842216-16376642732-30662007847', '44349800594-98690127361-78211321236-38340738575-94555021426')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1719256971, 3, '36693810506-14727560109-48871542333-86332816255-91899190554-43809786563-22813456576-32468291237-08105779091-35654765264', '76792216525-13152293559-11187746420-35413475429-73316527358')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[827:{SchemaIndex=207, TableIndex=827, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1191957307, 3, '02373892720-70783246981-33072353568-68101913427-25982074179-25716557733-53487403333-33176741697-19961659954-24745733546', '65228452942-44586411798-63293957289-46889416058-55247585232')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-368940747, 10, '83732843347-38915816227-71028864502-83867874900-55259635749-04867892981-61246311166-86657029985-98371125854-01109713202', '28665022675-32159696841-27962719413-92137483719-65438251505')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[531:{SchemaIndex=133, TableIndex=531, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (296709651, 4, '68512385573-12594713777-31891099071-55341413329-96572532552-89441743744-75535604911-39664974035-50293453830-41657909966', '54516090919-10379612997-70745484084-47657473576-34684395884')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1010:{SchemaIndex=253, TableIndex=1010, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (375408626, 5, '86917579879-69750606525-04310713441-66206378609-22671203503-85955817483-08099675016-87194148638-56030296183-72576969654', '14638356398-42816005551-86372571322-85471822123-78848498639')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 207, mergeExecResult: 0. shardingNode:map[481:{SchemaIndex=121, TableIndex=481, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-453506529, 7, '05922416371-88423926572-06168309932-36230491079-35838894643-96519731061-10785734640-51619035736-36739664574-07173836937', '86251074060-14148969607-50675271708-72280786641-89845672651')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[506:{SchemaIndex=127, TableIndex=506, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (923516410, 1, '71118741783-11388565696-96706199622-38503412573-05309353257-45864148538-09400667746-21110528894-17837136283-91361843504', '67292585002-85708710331-29800085937-37291514623-47320174130')] \n\n\n\n\nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 306, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1344100892, 4, '37923605607-42327774961-35128132820-48158088043-25957128013-51759124002-40449799093-68433809807-31405796686-22817252999', '94291235269-60160247565-39950122186-97684115599-96232437155')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 211, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-757833244, 5, '50104262688-83666007823-06989738144-95141595109-93329094811-13832991101-93076033912-05017862363-35692005246-88744289137', '54081433849-09378248558-38274752100-88855316211-27289637272')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[198:{SchemaIndex=50, TableIndex=198, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (652469446, 1, '07652454524-22981957011-41438122391-90347773905-88663504044-48425601588-32127975840-28199749965-27298300589-25715051794', '60470366939-49887579866-34848349508-29262200362-52000338086')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[670:{SchemaIndex=168, TableIndex=670, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-212205214, 3, '39093408635-10213704095-82878149257-88673860178-07278582464-52697390774-95388237318-03462450231-66036638124-64228596635', '38716722580-86486363760-61985600779-83841271441-42765235992')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 248, mergeExecResult: 0. shardingNode:map[594:{SchemaIndex=149, TableIndex=594, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1136835154, 2, '23757270379-51595389012-47476784586-71294005118-20959815636-40533304860-41036462462-22519409530-16151251756-29363403201', '02895678318-89791495824-44276206517-37575326693-35714861579')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 196, mergeExecResult: 0. shardingNode:map[596:{SchemaIndex=150, TableIndex=596, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (927250004, 3, '02232667199-83769701794-18129066725-31520472849-93375763771-42931518091-56094856485-24182688367-31807939112-07474880757', '46530309679-12705910558-69428237706-14629411089-19801742204')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 213, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1908502072, 6, '11131352749-42538464007-16895664672-62644300750-86974265339-82077852146-68660984992-78157770948-82596046151-02353070903', '35289675345-82804575493-00647347117-53443940605-48670213485')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[530:{SchemaIndex=133, TableIndex=530, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1565462034, 2, '03766551315-88042959333-06619558863-52259377137-27072539179-52210031586-63547684874-18650692849-22136096911-63673950864', '23300762166-38283070103-67223042934-76314148059-35039279078')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[705:{SchemaIndex=177, TableIndex=705, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-282929857, 9, '78018924775-94910259974-14900983402-30428448745-60064721591-40668444882-53712901782-65346911189-59688209606-74312372904', '82234943021-50353143509-80352130420-57571772487-81475633439')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 291, mergeExecResult: 0. shardingNode:map[724:{SchemaIndex=182, TableIndex=724, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2109119188, 7, '36086413796-51767176683-52982238848-36460965892-84578503998-21697029291-39139590496-18305440259-61532992900-70589028518', '30048526034-08924322516-87289516951-51922079500-47125778015')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 210, mergeExecResult: 0. shardingNode:map[573:{SchemaIndex=144, TableIndex=573, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-994558525, 8, '74078055913-58294585862-48131723756-93089582597-72949713745-85429496032-27905841748-82110966829-12174780172-45947256767', '52598986037-80854622196-65516850169-26314282473-46184813701')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 99, mergeExecResult: 0. shardingNode:map[701:{SchemaIndex=176, TableIndex=701, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1290611389, 10, '06010961323-54786660073-11823817491-71384866194-20002003501-13527828508-52664186690-95551041252-11585296099-86883272955', '35567244596-82663971593-11831798779-27870930145-87441039863')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 292, mergeExecResult: 0. shardingNode:map[567:{SchemaIndex=142, TableIndex=567, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (810312247, 10, '41210873160-21444867641-91122365510-19036499914-34569882163-29091701055-84873343605-60726600041-00757500001-24263691698', '41652074477-40057441865-33409084588-16838407116-03941310610')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[213:{SchemaIndex=54, TableIndex=213, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1881853141, 2, '14742564348-19913327041-96137703234-33860693319-12765733015-19685217285-90407570147-69715707192-71609875203-72224693707', '62398998246-64288014470-28245239723-29976129053-08238346550')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 242, mergeExecResult: 0. shardingNode:map[698:{SchemaIndex=175, TableIndex=698, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1011920570, 2, '33865708347-82274332444-45097600411-92274439334-16926356904-33828206076-16463987600-06687756787-06453656924-53622006994', '48462480629-04943720987-66250435599-66843177447-86484400166')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 195, mergeExecResult: 0. shardingNode:map[710:{SchemaIndex=178, TableIndex=710, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-2128817862, 7, '12483300987-88535524922-66334741529-64659385522-75032596868-93466219012-01222978665-55122702202-84142740410-53583589563', '89132580254-79206347601-13534456013-96027776935-07650599065')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 233, mergeExecResult: 0. shardingNode:map[544:{SchemaIndex=137, TableIndex=544, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1496016416, 9, '99154323337-90872497215-53698284897-04686362817-35622767062-48356019022-04016504226-75493501145-38429448892-66989460733', '84409926268-28404056573-96777093808-13481662538-98898905310')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (756613003, 1, '48041615531-14651008388-14559884387-33045819966-91038786346-39394412181-13147015451-43265025586-90014901196-20159726596', '62496325099-63432555894-84244639858-58924561742-12138512609')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 284, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (588268045, 3, '01778869912-44391681202-43730989451-99650497628-58071023040-36244500937-05173857724-21592385062-52662008534-88410130321', '68551597952-73268487812-26478068307-11227961732-49092247276')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[674:{SchemaIndex=169, TableIndex=674, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (75111074, 1, '07857287095-83026714634-10012972058-11441297287-80787536524-31038348780-79408482259-95286783641-23620583564-94195135059', '39714908056-38058099094-71552841772-10457961132-39419941227')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 230, mergeExecResult: 0. shardingNode:map[577:{SchemaIndex=145, TableIndex=577, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-911965761, 8, '07321418565-94055920833-16462957068-14933742620-00134077423-05303377934-66121817102-49230219319-72774150061-80468601177', '26522648558-75134929821-83594530381-47917024515-31668467194')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1315070465, 5, '15474433240-84784850443-17796367719-48021520867-10943303644-48200729918-91013947900-33061132253-28956163141-98846516045', '99644114596-46918915095-13462299586-15204837308-12785249281')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 231, mergeExecResult: 0. shardingNode:map[737:{SchemaIndex=185, TableIndex=737, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-180994785, 9, '61681162669-07252910162-88941330016-07633567093-86234290556-74605484081-92189953463-28499401861-08881094341-04206273246', '73069152681-47514577462-53755512339-63165295325-04957863379')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 225, mergeExecResult: 0. shardingNode:map[583:{SchemaIndex=146, TableIndex=583, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (905672263, 5, '11686869034-48032081508-20645314791-73241768758-13634493369-36096577158-76040275597-65556337906-73745369125-93817830861', '25154935190-35760055237-67095134841-73686707222-08327146392')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 227, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1028081208, 6, '65787201754-47681590360-50036937953-38544197509-01589612011-17576022949-32999165698-83171817746-37315560344-14463882405', '65637926145-34138639858-41094177281-29428779399-44688752051')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[558:{SchemaIndex=140, TableIndex=558, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (278584878, 10, '32358945918-66413584434-88058020708-48390261093-67208582401-88568979078-90497400157-49426845556-80952580018-13610087462', '14198786100-85805610838-89824761297-62058901344-60492560838')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 228, mergeExecResult: 0. shardingNode:map[649:{SchemaIndex=163, TableIndex=649, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1183431305, 2, '43858458237-46788126262-05213368147-07302202409-13593899883-99375055319-42875375550-56499216168-01796902390-08647652700', '48205424174-34611724289-69246697079-03898745311-99595319598')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 26, mergeExecResult: 0. shardingNode:map[1002:{SchemaIndex=251, TableIndex=1002, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1701967850, 9, '59147040383-79705593723-62886101805-60535881029-18413556495-06238443919-02766097021-38361379870-67179305438-52530038201', '14770296700-13396847549-83905253251-99337969432-58669912709')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[745:{SchemaIndex=187, TableIndex=745, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1169184489, 7, '64955629118-36147506634-51676575477-92147977264-45999410094-15567300060-12836575112-28470342888-04361926080-90629622527', '86593300354-87140619605-87718697448-88392415837-04795141111')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 272, mergeExecResult: 0. shardingNode:map[662:{SchemaIndex=166, TableIndex=662, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1555424918, 10, '11260581771-57660361810-58723152189-43635886031-41094065361-37903459575-65856768363-01843670891-17848285384-92171598763', '36462031678-64770373669-77316073133-32672501580-50753545368')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 271, mergeExecResult: 0. shardingNode:map[736:{SchemaIndex=185, TableIndex=736, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-270642912, 9, '87806093665-04774113218-83983577041-09351362099-88339377062-22401969710-89370302094-61598971830-04573362584-60421137580', '26415700902-09148763904-87375314444-00285784497-80449574080')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 222, mergeExecResult: 0. shardingNode:map[588:{SchemaIndex=148, TableIndex=588, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1608970828, 2, '75571666926-33738024136-84313793696-10714487345-57088294174-41711334397-51382524640-08327299973-66970622008-15344703881', '73366501022-14368954292-21130701303-33960859630-28160972955')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[556:{SchemaIndex=140, TableIndex=556, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-993863212, 3, '68136313990-05892185009-94544559127-32267303237-37763842514-89959134082-97215598641-72307869276-49642816905-24994127953', '97111382859-69888150629-89398585714-99569889618-30099083026')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1299240449, 6, '13580427730-91599560017-42392676834-62860979245-65274043134-68243135520-42672727926-56794775679-69217526806-27227304772', '15736027942-38175115801-93773367279-77944721463-03173899187')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 214, mergeExecResult: 0. shardingNode:map[579:{SchemaIndex=145, TableIndex=579, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1346301507, 2, '95777728263-97322915970-24025444526-11872987788-74589515383-37108287704-62890589663-84327075019-58161194629-66166453693', '43925335448-41493749427-45817169562-78879091928-39249185154')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[723:{SchemaIndex=181, TableIndex=723, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1604556499, 3, '54964824319-34611710514-15902154995-18014105243-70193115677-91112406449-61348366967-41301887681-73892593737-54039590822', '26491514771-24473569991-16656607124-07593925149-74926670900')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 253, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (533688011, 7, '17872695538-16064539790-18108982113-60646269894-74784931403-89606878485-67937667670-39824753762-37339034055-79511964331', '65227853620-62393117281-88901273019-02060144110-40123779052')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[731:{SchemaIndex=183, TableIndex=731, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (548553435, 7, '59524856205-92318067592-84001816236-15799238765-61939312958-49774297702-51059777347-11521186806-90725070157-29567571966', '72604893873-81336794708-64989781571-89144801847-53529920629')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[646:{SchemaIndex=162, TableIndex=646, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1980507782, 8, '15361099362-33426846104-81568076007-88926275697-54147190617-21941361738-39219198670-72817831326-95768248501-29228997291', '51713925651-55077435995-56372978084-60334222441-07023013203')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[1023:{SchemaIndex=256, TableIndex=1023, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (419830783, 9, '39839456224-14625126106-10611694673-69035645226-20746732552-01963419766-94676550107-32542648198-96549393904-39850608367', '69725922822-08559910362-36080928509-49601235010-15261238716')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[612:{SchemaIndex=154, TableIndex=612, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1848104548, 6, '02931425025-68282480940-67294056291-41225608697-44038095895-05390291535-10414730978-25086630856-84460614365-62218384416', '74426157735-27538600335-93122572838-36921241106-44481214039')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 305, mergeExecResult: 0. shardingNode:map[517:{SchemaIndex=130, TableIndex=517, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-543662597,\n\ncobar:\nsysbench --mysql-host=10.1.21.242 --mysql-port=8066 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup\nsysbench --mysql-host=10.1.21.242 --mysql-port=8066 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare\nsysbench --mysql-host=10.1.21.242 --mysql-port=8066 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\n\nzero-proxy\nsysbench --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup\nsysbench --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare\nsysbench --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\n\n\n\n\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb  --oltp-tables-count=5 prepare\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb  --oltp-tables-count=5 cleanup\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=128 --read-threads=8 --max-time=3600 random\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=128 --read-threads=8 --max-time=3600 seq\n\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=4 --read-threads=300 --update-threads=20 --delete-threads=10 --max-time=360000000 random\n\n\n\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=400 --read-threads=400 --max-time=3600 random","source":"_posts/Cobar-Performance-Test-With-Sysbench.md","raw":"---\ntitle: Cobar-Performance-Test-With-Sysbench\ndate: 2017-12-13 19:11:35\ntags: Cobar\n---\n\n### centos\n\n``` bash\nyum install sysbench\n```\n\nlua /usr/share/sysbench/\n\nCobarSQL 92/usr/share/sysbench/oltp_common.lua\n\n\n\n: sysbench [lua_path] help\n: sysbench /usr/share/sysbench/oltp_insert.lua help\n\nsysbench --mysql-host=mac \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password=zerodb \\\n--mysql-db=zerodb \\\n--threads=4 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=2 \\\n/usr/local/Cellar/sysbench/1.0.11/share/sysbench/oltp_insert.lua \\\n\n#cobar_1\n\nsysbench --mysql-host=10.1.21.148 \\\n--mysql-port=8066 \\\n--mysql-user=user \\\n--mysql-password='user' \\\n--mysql-db=user \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 \\\n--events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\n\n\n#cobar_2\n\nsysbench --mysql-host=10.1.21.147 \\\n--mysql-port=8066 \\\n--mysql-user=user \\\n--mysql-password='user' \\\n--mysql-db=user \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\n\n### \n[root@mq001 ~]# sysbench --mysql-host=10.1.21.147 --mysql-port=8066 --mysql-user=user --mysql-password='user' --mysql-db=user --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=60 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\nsysbench 1.0.9 (using system LuaJIT 2.0.4)\n\nRunning the test with following options:\nNumber of threads: 400\nReport intermediate results every 5 second(s)\nInitializing random number generator from current time\n\n\nInitializing worker threads...\n\nThreads started!\n\n[ 5s ] thds: 400 tps: 11516.37 qps: 11516.37 (r/w/o: 0.00/11516.37/0.00) lat (ms,99%): 204.11 err/s: 0.00 reconn/s: 0.00\n[ 10s ] thds: 400 tps: 2884.87 qps: 2884.87 (r/w/o: 0.00/2884.87/0.00) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00\n[ 15s ] thds: 400 tps: 4025.00 qps: 4025.00 (r/w/o: 0.00/4025.00/0.00) lat (ms,99%): 1869.60 err/s: 0.00 reconn/s: 0.00\n[ 20s ] thds: 400 tps: 13497.32 qps: 13497.32 (r/w/o: 0.00/13497.32/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00\n[ 25s ] thds: 400 tps: 10908.17 qps: 10908.17 (r/w/o: 0.00/10908.17/0.00) lat (ms,99%): 144.97 err/s: 0.00 reconn/s: 0.00\n[ 30s ] thds: 400 tps: 12280.74 qps: 12280.74 (r/w/o: 0.00/12280.74/0.00) lat (ms,99%): 132.49 err/s: 0.00 reconn/s: 0.00\n[ 35s ] thds: 400 tps: 9783.37 qps: 9783.37 (r/w/o: 0.00/9783.37/0.00) lat (ms,99%): 150.29 err/s: 0.00 reconn/s: 0.00\n[ 40s ] thds: 400 tps: 11703.52 qps: 11703.72 (r/w/o: 0.00/11703.72/0.00) lat (ms,99%): 173.58 err/s: 0.00 reconn/s: 0.00\n[ 45s ] thds: 400 tps: 8253.06 qps: 8252.86 (r/w/o: 0.00/8252.86/0.00) lat (ms,99%): 207.82 err/s: 0.00 reconn/s: 0.00\n[ 50s ] thds: 400 tps: 7148.98 qps: 7149.18 (r/w/o: 0.00/7149.18/0.00) lat (ms,99%): 657.93 err/s: 0.00 reconn/s: 0.00\n[ 55s ] thds: 400 tps: 10911.35 qps: 10911.15 (r/w/o: 0.00/10911.15/0.00) lat (ms,99%): 176.73 err/s: 0.00 reconn/s: 0.00\n[ 60s ] thds: 400 tps: 8702.48 qps: 8702.48 (r/w/o: 0.00/8702.48/0.00) lat (ms,99%): 235.74 err/s: 0.00 reconn/s: 0.00\nSQL statistics:\n    queries performed:\n        read:                            0\n        write:                           558494\n        other:                           0\n        total:                           558494\n    transactions:                        558494 (9273.20 per sec.)\n    queries:                             558494 (9273.20 per sec.)\n    ignored errors:                      0      (0.00 per sec.)\n    reconnects:                          0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          60.2244s\n    total number of events:              558494\n\nLatency (ms):\n         min:                                  3.89\n         avg:                                 43.02\n         max:                               2881.01\n         99th percentile:                    253.35\n         sum:                            24023700.41\n\nThreads fairness:\n    events (avg/stddev):           1396.2350/30.84\n    execution time (avg/stddev):   60.0593/0.05\n\n\n\n[root@mq001 ~]# sysbench --mysql-host=10.1.21.148 --mysql-port=8066 --mysql-user=user --mysql-password='user' --mysql-db=user --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=60 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\nsysbench 1.0.9 (using system LuaJIT 2.0.4)\n\nRunning the test with following options:\nNumber of threads: 400\nReport intermediate results every 5 second(s)\nInitializing random number generator from current time\n\n\nInitializing worker threads...\n\nThreads started!\n\n[ 5s ] thds: 400 tps: 10470.98 qps: 10470.98 (r/w/o: 0.00/10470.98/0.00) lat (ms,99%): 262.64 err/s: 0.00 reconn/s: 0.00\n[ 10s ] thds: 400 tps: 3020.06 qps: 3020.06 (r/w/o: 0.00/3020.06/0.00) lat (ms,99%): 1050.76 err/s: 0.00 reconn/s: 0.00\n[ 15s ] thds: 400 tps: 1107.64 qps: 1107.64 (r/w/o: 0.00/1107.64/0.00) lat (ms,99%): 1327.91 err/s: 0.00 reconn/s: 0.00\n[ 20s ] thds: 400 tps: 7395.23 qps: 7395.23 (r/w/o: 0.00/7395.23/0.00) lat (ms,99%): 816.63 err/s: 0.00 reconn/s: 0.00\n[ 25s ] thds: 400 tps: 12654.11 qps: 12654.11 (r/w/o: 0.00/12654.11/0.00) lat (ms,99%): 125.52 err/s: 0.00 reconn/s: 0.00\n[ 30s ] thds: 400 tps: 10854.72 qps: 10854.92 (r/w/o: 0.00/10854.92/0.00) lat (ms,99%): 153.02 err/s: 0.00 reconn/s: 0.00\n[ 35s ] thds: 400 tps: 11832.81 qps: 11832.61 (r/w/o: 0.00/11832.61/0.00) lat (ms,99%): 186.54 err/s: 0.00 reconn/s: 0.00\n[ 40s ] thds: 400 tps: 6895.44 qps: 6895.44 (r/w/o: 0.00/6895.44/0.00) lat (ms,99%): 257.95 err/s: 0.00 reconn/s: 0.00\n[ 45s ] thds: 400 tps: 12907.06 qps: 12907.06 (r/w/o: 0.00/12907.06/0.00) lat (ms,99%): 158.63 err/s: 0.00 reconn/s: 0.00\n[ 50s ] thds: 400 tps: 7760.80 qps: 7760.80 (r/w/o: 0.00/7760.80/0.00) lat (ms,99%): 292.60 err/s: 0.00 reconn/s: 0.00\n[ 55s ] thds: 400 tps: 11595.84 qps: 11595.84 (r/w/o: 0.00/11595.84/0.00) lat (ms,99%): 161.51 err/s: 0.00 reconn/s: 0.00\n[ 60s ] thds: 400 tps: 10314.36 qps: 10314.36 (r/w/o: 0.00/10314.36/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00\nSQL statistics:\n    queries performed:\n        read:                            0\n        write:                           534637\n        other:                           0\n        total:                           534637\n    transactions:                        534637 (8890.97 per sec.)\n    queries:                             534637 (8890.97 per sec.)\n    ignored errors:                      0      (0.00 per sec.)\n    reconnects:                          0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          60.1304s\n    total number of events:              534637\n\nLatency (ms):\n         min:                                  4.14\n         avg:                                 44.91\n         max:                               3066.99\n         99th percentile:                    292.60\n         sum:                            24012284.54\n\nThreads fairness:\n    events (avg/stddev):           1336.5925/23.11\n    execution time (avg/stddev):   60.0307/0.03\n    \n    \n    \n    \n\nsysbench --mysql-host=10.1.134.195 \\\n--mysql-port=8066 \\\n--mysql-user=user \\\n--mysql-password='user' \\\n--mysql-db=user \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 \\\n--events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\n\n\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=10 \\\n--debug=on \\\n--verbosity=5 \\\n--tables=5 \\\n--events=1 \\\n--auto_inc=off \\\n--table-size=1000 \\\n--db-driver=mysql \\\n--time=6000000 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_read_only.lua \\\nrun\n\n\n\n# zerodb\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=10 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\ncleanup\n\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=10 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\nprepare\n\nsysbench --mysql-host=10.1.21.242 \\\n--mysql-port=9696 \\\n--mysql-user=zerodb \\\n--mysql-password='zerodb' \\\n--mysql-db=zerodb \\\n--threads=400 \\\n--table-size=10 \\\n--auto_inc=off \\\n--tables=5 \\\n--rand-type=uniform \\\n--db-driver=mysql \\\n--time=6000000 --events=0 \\\n--percentile=99 \\\n--report-interval=5 \\\n/usr/share/sysbench/oltp_insert.lua \\\nrun\n\nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[899:{SchemaIndex=225, TableIndex=899, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1592131459, 7, '55016285732-53347045338-85834558147-71206675947-20854212178-67704861318-55023920639-15021922692-58783263226-91831209826', '44804973802-80594424819-30662288113-07543047794-69158617276')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[607:{SchemaIndex=152, TableIndex=607, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1551461983, 1, '97565032345-06095273461-70708868939-89114711497-07191112359-84320966593-06915637429-34011520393-29123922986-41181266499', '10350064023-47161933420-32840507920-65997397770-16177253238')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[371:{SchemaIndex=93, TableIndex=371, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1688397171, 3, '66563027950-07665251035-46015031422-61663761332-16063948763-45273359443-68411883367-29428347771-65572934442-17492196263', '60851935379-49894017653-67952828882-67412344041-59230452535')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1011:{SchemaIndex=253, TableIndex=1011, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-573803507, 2, '43589791346-92222019297-77586384271-52778612091-96284921979-05035493725-49350672130-03697130813-21052521840-31158762545', '33228172883-24963516238-59142423481-48021525640-21772792414')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1001, mergeExecResult: 0. shardingNode:map[310:{SchemaIndex=78, TableIndex=310, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (439335222, 7, '03793368943-50266953542-49577833032-14468376728-10198261385-85128057368-15281808692-43095784178-01078624681-09027567677', '45982088127-90369291605-80044281219-46887615792-75467747528')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[259:{SchemaIndex=65, TableIndex=259, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (824478979, 9, '79929455805-82686000395-87933678180-97427805059-78850675331-66749630290-23371965370-59789760435-11687903028-37111392097', '65387439360-90889047465-34899315444-83593158053-88419722270')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[388:{SchemaIndex=98, TableIndex=388, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1778834820, 4, '26400620948-86886163258-66955677020-24736956201-37633810654-62170837016-10953232786-08731106510-27930064178-11956848338', '22734010461-63969213016-54927682118-22921617753-25869637636')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[345:{SchemaIndex=87, TableIndex=345, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1906262361, 4, '73054929345-92331883054-27511894619-20000378864-11948567194-86713567705-11190297445-34047180586-99650690403-71903892017', '07335571244-33555087386-76380202973-29490934882-40814481851')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[569:{SchemaIndex=143, TableIndex=569, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1606555193, 2, '94281857928-97538212927-39261666932-79938992409-52558016112-06785833668-50810169070-34555719774-82330250972-35853785503', '29683325026-64124354800-63566774522-19722425169-37547560762')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1143670666, 7, '74870370257-63163303467-80061015187-84192128665-25175084977-80554698357-24269465921-53186773519-78675020561-83488552374', '73368269204-64304332325-34620567277-68846684629-38045820340')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[941:{SchemaIndex=236, TableIndex=941, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1370776493, 6, '16692170437-43512178684-59516594203-75377838995-76081749306-71167865747-97237301685-23453441670-03667446181-56604717727', '14195711604-53513247591-07873804194-96431257292-05520461785')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[872:{SchemaIndex=219, TableIndex=872, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1208557416, 5, '27703568859-81266825379-86789890837-60513053664-22258866897-34966682979-82761864561-83949706302-60135012966-31647733109', '63271991640-87709697591-13072925018-38646644832-79179029573')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[991:{SchemaIndex=248, TableIndex=991, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (138564575, 6, '26857888685-88370802193-51045899118-07572056078-70111763976-05806767425-30208609378-20016792779-48308493020-29821526191', '61555808494-05287717368-66884245341-45983655335-60458704606')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1007, mergeExecResult: 0. shardingNode:map[449:{SchemaIndex=113, TableIndex=449, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-229865921, 8, '14034106238-21876701329-38233326181-31158038417-73928237004-22908354046-72713486563-40610785127-99166317018-52234063725', '23168975405-73598149943-63125122764-74527985990-06171559404')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[959:{SchemaIndex=240, TableIndex=959, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-677583807, 4, '40735866383-98457016615-08789114417-03599576561-48782283253-32055567198-88072330194-83020475968-03693883045-96278614943', '70150968961-19151317381-16983120036-88185867422-84862477300')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1006, mergeExecResult: 0. shardingNode:map[406:{SchemaIndex=102, TableIndex=406, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-2093701526, 5, '09210536591-41896791043-73295525884-89613310006-75387609760-41655764025-47137540812-97100201238-15965683915-13727887851', '48024514833-13441113380-49081922507-17183150276-06208568092')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[894:{SchemaIndex=224, TableIndex=894, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (108403582, 4, '58477996001-39515710854-83438883003-74672331816-19403553257-36113016280-00822951895-43706580851-50122510142-72629874469', '25950012615-74047249694-75644797724-67405314152-48742553448')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[824:{SchemaIndex=207, TableIndex=824, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1108509496, 2, '05591703103-07428761202-09014510822-44571443153-87746638001-18005366596-37591757698-85345493107-52688524466-97341165803', '90287453968-47714845240-54141462203-72968014933-11681199861')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[960:{SchemaIndex=241, TableIndex=960, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-432972736, 4, '32013395637-31037790439-99508763633-39582502523-46934970326-99846192559-79844868065-81128826635-19475623448-94555401729', '72848617704-77451404798-55770002912-34209086424-23821979141')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[864:{SchemaIndex=217, TableIndex=864, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (209038176, 6, '31725269303-67222682770-97738396828-19717571752-01126165612-57542830563-51718817223-13687491781-38891241679-10677758794', '40604117998-67635443824-03882862739-68433432919-44278589057')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-663100941, 3, '13572309986-10356575142-87428874956-18162116973-83396135908-09352768769-83603227505-94165603992-17437041978-81761343722', '58884262253-26008842705-81702669160-02709154611-78739667686')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[821:{SchemaIndex=206, TableIndex=821, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1290297141, 6, '28650953615-66926208686-47052429218-34545146184-51693579732-60563146329-00350338711-30136625347-99506216978-22404723673', '30345581431-18594298965-23203468098-48853746952-30033247101')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[881:{SchemaIndex=221, TableIndex=881, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2128759665, 3, '23557322059-62351008582-19218938648-55023996016-67978090662-04498693910-40333149725-65457542876-11556698223-86845640120', '39531266486-08252986785-52805405505-62972899514-62765043827')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[829:{SchemaIndex=208, TableIndex=829, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1081064253, 2, '39396011527-03550826801-53544579241-44145722341-56423193708-85298116954-45172197891-54532848324-82241582599-97563898680', '76749800295-63255838342-73258070193-02305060704-64352300433')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[900:{SchemaIndex=226, TableIndex=900, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-513806212, 1, '16727493623-40348083665-41922314110-05150944505-43353212884-59194917800-00753396008-63562258886-84259052626-93713085152', '38634951090-07591809914-73325301815-73315254313-82978384844')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1, mergeExecResult: 0. shardingNode:map[863:{SchemaIndex=216, TableIndex=863, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-450094943, 6, '23924438266-62111362125-81473873200-06328498397-88922636306-39182947784-05124699385-49780077333-57313760145-54634535492', '96577223660-83042935121-28454288566-32057418883-39061132652')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[963:{SchemaIndex=241, TableIndex=963, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1800163267, 4, '27948346446-05701199368-49149768636-18762164887-01870692332-13661773677-35851324771-46733712098-36653074427-31181566769', '08781105428-22812332073-21224324603-72676647429-86438534524')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[878:{SchemaIndex=220, TableIndex=878, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1535190894, 9, '46310600095-97541020554-94065740469-24853513335-69630566641-31721053084-60343664925-46348792383-87749652424-52899212634', '41944783155-15764748316-26823908956-07652542569-85074827204')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1945995146, 4, '64447284661-78831878306-27636005022-88863833954-72613803410-72661880191-81775646793-56738842216-16376642732-30662007847', '44349800594-98690127361-78211321236-38340738575-94555021426')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1719256971, 3, '36693810506-14727560109-48871542333-86332816255-91899190554-43809786563-22813456576-32468291237-08105779091-35654765264', '76792216525-13152293559-11187746420-35413475429-73316527358')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[827:{SchemaIndex=207, TableIndex=827, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1191957307, 3, '02373892720-70783246981-33072353568-68101913427-25982074179-25716557733-53487403333-33176741697-19961659954-24745733546', '65228452942-44586411798-63293957289-46889416058-55247585232')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-368940747, 10, '83732843347-38915816227-71028864502-83867874900-55259635749-04867892981-61246311166-86657029985-98371125854-01109713202', '28665022675-32159696841-27962719413-92137483719-65438251505')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[531:{SchemaIndex=133, TableIndex=531, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (296709651, 4, '68512385573-12594713777-31891099071-55341413329-96572532552-89441743744-75535604911-39664974035-50293453830-41657909966', '54516090919-10379612997-70745484084-47657473576-34684395884')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1010:{SchemaIndex=253, TableIndex=1010, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (375408626, 5, '86917579879-69750606525-04310713441-66206378609-22671203503-85955817483-08099675016-87194148638-56030296183-72576969654', '14638356398-42816005551-86372571322-85471822123-78848498639')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 207, mergeExecResult: 0. shardingNode:map[481:{SchemaIndex=121, TableIndex=481, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-453506529, 7, '05922416371-88423926572-06168309932-36230491079-35838894643-96519731061-10785734640-51619035736-36739664574-07173836937', '86251074060-14148969607-50675271708-72280786641-89845672651')] \nWARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[506:{SchemaIndex=127, TableIndex=506, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (923516410, 1, '71118741783-11388565696-96706199622-38503412573-05309353257-45864148538-09400667746-21110528894-17837136283-91361843504', '67292585002-85708710331-29800085937-37291514623-47320174130')] \n\n\n\n\nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 306, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1344100892, 4, '37923605607-42327774961-35128132820-48158088043-25957128013-51759124002-40449799093-68433809807-31405796686-22817252999', '94291235269-60160247565-39950122186-97684115599-96232437155')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 211, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-757833244, 5, '50104262688-83666007823-06989738144-95141595109-93329094811-13832991101-93076033912-05017862363-35692005246-88744289137', '54081433849-09378248558-38274752100-88855316211-27289637272')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[198:{SchemaIndex=50, TableIndex=198, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (652469446, 1, '07652454524-22981957011-41438122391-90347773905-88663504044-48425601588-32127975840-28199749965-27298300589-25715051794', '60470366939-49887579866-34848349508-29262200362-52000338086')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[670:{SchemaIndex=168, TableIndex=670, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-212205214, 3, '39093408635-10213704095-82878149257-88673860178-07278582464-52697390774-95388237318-03462450231-66036638124-64228596635', '38716722580-86486363760-61985600779-83841271441-42765235992')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 248, mergeExecResult: 0. shardingNode:map[594:{SchemaIndex=149, TableIndex=594, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1136835154, 2, '23757270379-51595389012-47476784586-71294005118-20959815636-40533304860-41036462462-22519409530-16151251756-29363403201', '02895678318-89791495824-44276206517-37575326693-35714861579')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 196, mergeExecResult: 0. shardingNode:map[596:{SchemaIndex=150, TableIndex=596, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (927250004, 3, '02232667199-83769701794-18129066725-31520472849-93375763771-42931518091-56094856485-24182688367-31807939112-07474880757', '46530309679-12705910558-69428237706-14629411089-19801742204')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 213, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1908502072, 6, '11131352749-42538464007-16895664672-62644300750-86974265339-82077852146-68660984992-78157770948-82596046151-02353070903', '35289675345-82804575493-00647347117-53443940605-48670213485')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[530:{SchemaIndex=133, TableIndex=530, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1565462034, 2, '03766551315-88042959333-06619558863-52259377137-27072539179-52210031586-63547684874-18650692849-22136096911-63673950864', '23300762166-38283070103-67223042934-76314148059-35039279078')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[705:{SchemaIndex=177, TableIndex=705, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-282929857, 9, '78018924775-94910259974-14900983402-30428448745-60064721591-40668444882-53712901782-65346911189-59688209606-74312372904', '82234943021-50353143509-80352130420-57571772487-81475633439')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 291, mergeExecResult: 0. shardingNode:map[724:{SchemaIndex=182, TableIndex=724, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2109119188, 7, '36086413796-51767176683-52982238848-36460965892-84578503998-21697029291-39139590496-18305440259-61532992900-70589028518', '30048526034-08924322516-87289516951-51922079500-47125778015')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 210, mergeExecResult: 0. shardingNode:map[573:{SchemaIndex=144, TableIndex=573, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-994558525, 8, '74078055913-58294585862-48131723756-93089582597-72949713745-85429496032-27905841748-82110966829-12174780172-45947256767', '52598986037-80854622196-65516850169-26314282473-46184813701')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 99, mergeExecResult: 0. shardingNode:map[701:{SchemaIndex=176, TableIndex=701, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1290611389, 10, '06010961323-54786660073-11823817491-71384866194-20002003501-13527828508-52664186690-95551041252-11585296099-86883272955', '35567244596-82663971593-11831798779-27870930145-87441039863')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 292, mergeExecResult: 0. shardingNode:map[567:{SchemaIndex=142, TableIndex=567, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (810312247, 10, '41210873160-21444867641-91122365510-19036499914-34569882163-29091701055-84873343605-60726600041-00757500001-24263691698', '41652074477-40057441865-33409084588-16838407116-03941310610')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[213:{SchemaIndex=54, TableIndex=213, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1881853141, 2, '14742564348-19913327041-96137703234-33860693319-12765733015-19685217285-90407570147-69715707192-71609875203-72224693707', '62398998246-64288014470-28245239723-29976129053-08238346550')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 242, mergeExecResult: 0. shardingNode:map[698:{SchemaIndex=175, TableIndex=698, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1011920570, 2, '33865708347-82274332444-45097600411-92274439334-16926356904-33828206076-16463987600-06687756787-06453656924-53622006994', '48462480629-04943720987-66250435599-66843177447-86484400166')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 195, mergeExecResult: 0. shardingNode:map[710:{SchemaIndex=178, TableIndex=710, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-2128817862, 7, '12483300987-88535524922-66334741529-64659385522-75032596868-93466219012-01222978665-55122702202-84142740410-53583589563', '89132580254-79206347601-13534456013-96027776935-07650599065')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 233, mergeExecResult: 0. shardingNode:map[544:{SchemaIndex=137, TableIndex=544, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1496016416, 9, '99154323337-90872497215-53698284897-04686362817-35622767062-48356019022-04016504226-75493501145-38429448892-66989460733', '84409926268-28404056573-96777093808-13481662538-98898905310')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (756613003, 1, '48041615531-14651008388-14559884387-33045819966-91038786346-39394412181-13147015451-43265025586-90014901196-20159726596', '62496325099-63432555894-84244639858-58924561742-12138512609')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 284, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (588268045, 3, '01778869912-44391681202-43730989451-99650497628-58071023040-36244500937-05173857724-21592385062-52662008534-88410130321', '68551597952-73268487812-26478068307-11227961732-49092247276')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[674:{SchemaIndex=169, TableIndex=674, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (75111074, 1, '07857287095-83026714634-10012972058-11441297287-80787536524-31038348780-79408482259-95286783641-23620583564-94195135059', '39714908056-38058099094-71552841772-10457961132-39419941227')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 230, mergeExecResult: 0. shardingNode:map[577:{SchemaIndex=145, TableIndex=577, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-911965761, 8, '07321418565-94055920833-16462957068-14933742620-00134077423-05303377934-66121817102-49230219319-72774150061-80468601177', '26522648558-75134929821-83594530381-47917024515-31668467194')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1315070465, 5, '15474433240-84784850443-17796367719-48021520867-10943303644-48200729918-91013947900-33061132253-28956163141-98846516045', '99644114596-46918915095-13462299586-15204837308-12785249281')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 231, mergeExecResult: 0. shardingNode:map[737:{SchemaIndex=185, TableIndex=737, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-180994785, 9, '61681162669-07252910162-88941330016-07633567093-86234290556-74605484081-92189953463-28499401861-08881094341-04206273246', '73069152681-47514577462-53755512339-63165295325-04957863379')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 225, mergeExecResult: 0. shardingNode:map[583:{SchemaIndex=146, TableIndex=583, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (905672263, 5, '11686869034-48032081508-20645314791-73241768758-13634493369-36096577158-76040275597-65556337906-73745369125-93817830861', '25154935190-35760055237-67095134841-73686707222-08327146392')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 227, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1028081208, 6, '65787201754-47681590360-50036937953-38544197509-01589612011-17576022949-32999165698-83171817746-37315560344-14463882405', '65637926145-34138639858-41094177281-29428779399-44688752051')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[558:{SchemaIndex=140, TableIndex=558, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (278584878, 10, '32358945918-66413584434-88058020708-48390261093-67208582401-88568979078-90497400157-49426845556-80952580018-13610087462', '14198786100-85805610838-89824761297-62058901344-60492560838')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 228, mergeExecResult: 0. shardingNode:map[649:{SchemaIndex=163, TableIndex=649, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1183431305, 2, '43858458237-46788126262-05213368147-07302202409-13593899883-99375055319-42875375550-56499216168-01796902390-08647652700', '48205424174-34611724289-69246697079-03898745311-99595319598')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 26, mergeExecResult: 0. shardingNode:map[1002:{SchemaIndex=251, TableIndex=1002, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1701967850, 9, '59147040383-79705593723-62886101805-60535881029-18413556495-06238443919-02766097021-38361379870-67179305438-52530038201', '14770296700-13396847549-83905253251-99337969432-58669912709')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[745:{SchemaIndex=187, TableIndex=745, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1169184489, 7, '64955629118-36147506634-51676575477-92147977264-45999410094-15567300060-12836575112-28470342888-04361926080-90629622527', '86593300354-87140619605-87718697448-88392415837-04795141111')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 272, mergeExecResult: 0. shardingNode:map[662:{SchemaIndex=166, TableIndex=662, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1555424918, 10, '11260581771-57660361810-58723152189-43635886031-41094065361-37903459575-65856768363-01843670891-17848285384-92171598763', '36462031678-64770373669-77316073133-32672501580-50753545368')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 271, mergeExecResult: 0. shardingNode:map[736:{SchemaIndex=185, TableIndex=736, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-270642912, 9, '87806093665-04774113218-83983577041-09351362099-88339377062-22401969710-89370302094-61598971830-04573362584-60421137580', '26415700902-09148763904-87375314444-00285784497-80449574080')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 222, mergeExecResult: 0. shardingNode:map[588:{SchemaIndex=148, TableIndex=588, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1608970828, 2, '75571666926-33738024136-84313793696-10714487345-57088294174-41711334397-51382524640-08327299973-66970622008-15344703881', '73366501022-14368954292-21130701303-33960859630-28160972955')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[556:{SchemaIndex=140, TableIndex=556, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-993863212, 3, '68136313990-05892185009-94544559127-32267303237-37763842514-89959134082-97215598641-72307869276-49642816905-24994127953', '97111382859-69888150629-89398585714-99569889618-30099083026')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1299240449, 6, '13580427730-91599560017-42392676834-62860979245-65274043134-68243135520-42672727926-56794775679-69217526806-27227304772', '15736027942-38175115801-93773367279-77944721463-03173899187')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 214, mergeExecResult: 0. shardingNode:map[579:{SchemaIndex=145, TableIndex=579, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1346301507, 2, '95777728263-97322915970-24025444526-11872987788-74589515383-37108287704-62890589663-84327075019-58161194629-66166453693', '43925335448-41493749427-45817169562-78879091928-39249185154')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[723:{SchemaIndex=181, TableIndex=723, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1604556499, 3, '54964824319-34611710514-15902154995-18014105243-70193115677-91112406449-61348366967-41301887681-73892593737-54039590822', '26491514771-24473569991-16656607124-07593925149-74926670900')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 253, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (533688011, 7, '17872695538-16064539790-18108982113-60646269894-74784931403-89606878485-67937667670-39824753762-37339034055-79511964331', '65227853620-62393117281-88901273019-02060144110-40123779052')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[731:{SchemaIndex=183, TableIndex=731, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (548553435, 7, '59524856205-92318067592-84001816236-15799238765-61939312958-49774297702-51059777347-11521186806-90725070157-29567571966', '72604893873-81336794708-64989781571-89144801847-53529920629')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[646:{SchemaIndex=162, TableIndex=646, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1980507782, 8, '15361099362-33426846104-81568076007-88926275697-54147190617-21941361738-39219198670-72817831326-95768248501-29228997291', '51713925651-55077435995-56372978084-60334222441-07023013203')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[1023:{SchemaIndex=256, TableIndex=1023, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (419830783, 9, '39839456224-14625126106-10611694673-69035645226-20746732552-01963419766-94676550107-32542648198-96549393904-39850608367', '69725922822-08559910362-36080928509-49601235010-15261238716')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[612:{SchemaIndex=154, TableIndex=612, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1848104548, 6, '02931425025-68282480940-67294056291-41225608697-44038095895-05390291535-10414730978-25086630856-84460614365-62218384416', '74426157735-27538600335-93122572838-36921241106-44481214039')] \nWARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 305, mergeExecResult: 0. shardingNode:map[517:{SchemaIndex=130, TableIndex=517, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-543662597,\n\ncobar:\nsysbench --mysql-host=10.1.21.242 --mysql-port=8066 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup\nsysbench --mysql-host=10.1.21.242 --mysql-port=8066 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare\nsysbench --mysql-host=10.1.21.242 --mysql-port=8066 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\n\nzero-proxy\nsysbench --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup\nsysbench --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=10 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare\nsysbench --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-user=zerodb --mysql-password='zerodb' --mysql-db=zerodb --threads=400 --table-size=10 --auto_inc=off --tables=5 --rand-type=uniform --db-driver=mysql --time=6000000 --events=0 --percentile=99 --report-interval=5 /usr/share/sysbench/oltp_insert.lua run\n\n\n\n\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb  --oltp-tables-count=5 prepare\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb  --oltp-tables-count=5 cleanup\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=128 --read-threads=8 --max-time=3600 random\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=128 --read-threads=8 --max-time=3600 seq\n\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=4 --read-threads=300 --update-threads=20 --delete-threads=10 --max-time=360000000 random\n\n\n\n\n./benchyou --mysql-host=10.1.21.242 --mysql-port=9696 --mysql-db=zerodb --mysql-user=zerodb --mysql-password=zerodb --ssh-user=root --ssh-password=sdfsdf --oltp-tables-count=5 --write-threads=400 --read-threads=400 --max-time=3600 random","slug":"Cobar-Performance-Test-With-Sysbench","published":1,"updated":"2018-06-15T09:44:47.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsya000k3iq2rwljv25y","content":"<h3 id=\"centos\"><a href=\"#centos\" class=\"headerlink\" title=\"centos\"></a>centos</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install sysbench</div></pre></td></tr></table></figure>\n<p>lua /usr/share/sysbench/</p>\n<p>CobarSQL 92/usr/share/sysbench/oltp_common.lua</p>\n<p></p>\n<p>: sysbench [lua_path] help<br>: sysbench /usr/share/sysbench/oltp_insert.lua help</p>\n<p>sysbench mysql-host=mac \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=4 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=2 \\<br>/usr/local/Cellar/sysbench/1.0.11/share/sysbench/oltp_insert.lua \\</p>\n<p>#cobar_1</p>\n<p>sysbench mysql-host=10.1.21.148 \\<br>mysql-port=8066 \\<br>mysql-user=user \\<br>mysql-password=user \\<br>mysql-db=user \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 \\<br>events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\</p>\n<p>#cobar_2</p>\n<p>sysbench mysql-host=10.1.21.147 \\<br>mysql-port=8066 \\<br>mysql-user=user \\<br>mysql-password=user \\<br>mysql-db=user \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>[root@mq001 ~]# sysbench mysql-host=10.1.21.147 mysql-port=8066 mysql-user=user mysql-password=user mysql-db=user threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=60 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run<br>sysbench 1.0.9 (using system LuaJIT 2.0.4)</p>\n<p>Running the test with following options:<br>Number of threads: 400<br>Report intermediate results every 5 second(s)<br>Initializing random number generator from current time</p>\n<p>Initializing worker threads</p>\n<p>Threads started!</p>\n<p>[ 5s ] thds: 400 tps: 11516.37 qps: 11516.37 (r/w/o: 0.00/11516.37/0.00) lat (ms,99%): 204.11 err/s: 0.00 reconn/s: 0.00<br>[ 10s ] thds: 400 tps: 2884.87 qps: 2884.87 (r/w/o: 0.00/2884.87/0.00) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00<br>[ 15s ] thds: 400 tps: 4025.00 qps: 4025.00 (r/w/o: 0.00/4025.00/0.00) lat (ms,99%): 1869.60 err/s: 0.00 reconn/s: 0.00<br>[ 20s ] thds: 400 tps: 13497.32 qps: 13497.32 (r/w/o: 0.00/13497.32/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00<br>[ 25s ] thds: 400 tps: 10908.17 qps: 10908.17 (r/w/o: 0.00/10908.17/0.00) lat (ms,99%): 144.97 err/s: 0.00 reconn/s: 0.00<br>[ 30s ] thds: 400 tps: 12280.74 qps: 12280.74 (r/w/o: 0.00/12280.74/0.00) lat (ms,99%): 132.49 err/s: 0.00 reconn/s: 0.00<br>[ 35s ] thds: 400 tps: 9783.37 qps: 9783.37 (r/w/o: 0.00/9783.37/0.00) lat (ms,99%): 150.29 err/s: 0.00 reconn/s: 0.00<br>[ 40s ] thds: 400 tps: 11703.52 qps: 11703.72 (r/w/o: 0.00/11703.72/0.00) lat (ms,99%): 173.58 err/s: 0.00 reconn/s: 0.00<br>[ 45s ] thds: 400 tps: 8253.06 qps: 8252.86 (r/w/o: 0.00/8252.86/0.00) lat (ms,99%): 207.82 err/s: 0.00 reconn/s: 0.00<br>[ 50s ] thds: 400 tps: 7148.98 qps: 7149.18 (r/w/o: 0.00/7149.18/0.00) lat (ms,99%): 657.93 err/s: 0.00 reconn/s: 0.00<br>[ 55s ] thds: 400 tps: 10911.35 qps: 10911.15 (r/w/o: 0.00/10911.15/0.00) lat (ms,99%): 176.73 err/s: 0.00 reconn/s: 0.00<br>[ 60s ] thds: 400 tps: 8702.48 qps: 8702.48 (r/w/o: 0.00/8702.48/0.00) lat (ms,99%): 235.74 err/s: 0.00 reconn/s: 0.00<br>SQL statistics:<br>    queries performed:<br>        read:                            0<br>        write:                           558494<br>        other:                           0<br>        total:                           558494<br>    transactions:                        558494 (9273.20 per sec.)<br>    queries:                             558494 (9273.20 per sec.)<br>    ignored errors:                      0      (0.00 per sec.)<br>    reconnects:                          0      (0.00 per sec.)</p>\n<p>General statistics:<br>    total time:                          60.2244s<br>    total number of events:              558494</p>\n<p>Latency (ms):<br>         min:                                  3.89<br>         avg:                                 43.02<br>         max:                               2881.01<br>         99th percentile:                    253.35<br>         sum:                            24023700.41</p>\n<p>Threads fairness:<br>    events (avg/stddev):           1396.2350/30.84<br>    execution time (avg/stddev):   60.0593/0.05</p>\n<p>[root@mq001 ~]# sysbench mysql-host=10.1.21.148 mysql-port=8066 mysql-user=user mysql-password=user mysql-db=user threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=60 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run<br>sysbench 1.0.9 (using system LuaJIT 2.0.4)</p>\n<p>Running the test with following options:<br>Number of threads: 400<br>Report intermediate results every 5 second(s)<br>Initializing random number generator from current time</p>\n<p>Initializing worker threads</p>\n<p>Threads started!</p>\n<p>[ 5s ] thds: 400 tps: 10470.98 qps: 10470.98 (r/w/o: 0.00/10470.98/0.00) lat (ms,99%): 262.64 err/s: 0.00 reconn/s: 0.00<br>[ 10s ] thds: 400 tps: 3020.06 qps: 3020.06 (r/w/o: 0.00/3020.06/0.00) lat (ms,99%): 1050.76 err/s: 0.00 reconn/s: 0.00<br>[ 15s ] thds: 400 tps: 1107.64 qps: 1107.64 (r/w/o: 0.00/1107.64/0.00) lat (ms,99%): 1327.91 err/s: 0.00 reconn/s: 0.00<br>[ 20s ] thds: 400 tps: 7395.23 qps: 7395.23 (r/w/o: 0.00/7395.23/0.00) lat (ms,99%): 816.63 err/s: 0.00 reconn/s: 0.00<br>[ 25s ] thds: 400 tps: 12654.11 qps: 12654.11 (r/w/o: 0.00/12654.11/0.00) lat (ms,99%): 125.52 err/s: 0.00 reconn/s: 0.00<br>[ 30s ] thds: 400 tps: 10854.72 qps: 10854.92 (r/w/o: 0.00/10854.92/0.00) lat (ms,99%): 153.02 err/s: 0.00 reconn/s: 0.00<br>[ 35s ] thds: 400 tps: 11832.81 qps: 11832.61 (r/w/o: 0.00/11832.61/0.00) lat (ms,99%): 186.54 err/s: 0.00 reconn/s: 0.00<br>[ 40s ] thds: 400 tps: 6895.44 qps: 6895.44 (r/w/o: 0.00/6895.44/0.00) lat (ms,99%): 257.95 err/s: 0.00 reconn/s: 0.00<br>[ 45s ] thds: 400 tps: 12907.06 qps: 12907.06 (r/w/o: 0.00/12907.06/0.00) lat (ms,99%): 158.63 err/s: 0.00 reconn/s: 0.00<br>[ 50s ] thds: 400 tps: 7760.80 qps: 7760.80 (r/w/o: 0.00/7760.80/0.00) lat (ms,99%): 292.60 err/s: 0.00 reconn/s: 0.00<br>[ 55s ] thds: 400 tps: 11595.84 qps: 11595.84 (r/w/o: 0.00/11595.84/0.00) lat (ms,99%): 161.51 err/s: 0.00 reconn/s: 0.00<br>[ 60s ] thds: 400 tps: 10314.36 qps: 10314.36 (r/w/o: 0.00/10314.36/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00<br>SQL statistics:<br>    queries performed:<br>        read:                            0<br>        write:                           534637<br>        other:                           0<br>        total:                           534637<br>    transactions:                        534637 (8890.97 per sec.)<br>    queries:                             534637 (8890.97 per sec.)<br>    ignored errors:                      0      (0.00 per sec.)<br>    reconnects:                          0      (0.00 per sec.)</p>\n<p>General statistics:<br>    total time:                          60.1304s<br>    total number of events:              534637</p>\n<p>Latency (ms):<br>         min:                                  4.14<br>         avg:                                 44.91<br>         max:                               3066.99<br>         99th percentile:                    292.60<br>         sum:                            24012284.54</p>\n<p>Threads fairness:<br>    events (avg/stddev):           1336.5925/23.11<br>    execution time (avg/stddev):   60.0307/0.03</p>\n<p>sysbench mysql-host=10.1.134.195 \\<br>mysql-port=8066 \\<br>mysql-user=user \\<br>mysql-password=user \\<br>mysql-db=user \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 \\<br>events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\</p>\n<p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=10 \\<br>debug=on \\<br>verbosity=5 \\<br>tables=5 \\<br>events=1 \\<br>auto_inc=off \\<br>table-size=1000 \\<br>db-driver=mysql \\<br>time=6000000 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_read_only.lua \\<br>run</p>\n<h1 id=\"zerodb\"><a href=\"#zerodb\" class=\"headerlink\" title=\"zerodb\"></a>zerodb</h1><p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=10 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\<br>cleanup</p>\n<p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=10 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\<br>prepare</p>\n<p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\<br>run</p>\n<p>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[899:{SchemaIndex=225, TableIndex=899, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1592131459, 7, 55016285732-53347045338-85834558147-71206675947-20854212178-67704861318-55023920639-15021922692-58783263226-91831209826, 44804973802-80594424819-30662288113-07543047794-69158617276)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[607:{SchemaIndex=152, TableIndex=607, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1551461983, 1, 97565032345-06095273461-70708868939-89114711497-07191112359-84320966593-06915637429-34011520393-29123922986-41181266499, 10350064023-47161933420-32840507920-65997397770-16177253238)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[371:{SchemaIndex=93, TableIndex=371, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1688397171, 3, 66563027950-07665251035-46015031422-61663761332-16063948763-45273359443-68411883367-29428347771-65572934442-17492196263, 60851935379-49894017653-67952828882-67412344041-59230452535)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1011:{SchemaIndex=253, TableIndex=1011, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-573803507, 2, 43589791346-92222019297-77586384271-52778612091-96284921979-05035493725-49350672130-03697130813-21052521840-31158762545, 33228172883-24963516238-59142423481-48021525640-21772792414)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1001, mergeExecResult: 0. shardingNode:map[310:{SchemaIndex=78, TableIndex=310, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (439335222, 7, 03793368943-50266953542-49577833032-14468376728-10198261385-85128057368-15281808692-43095784178-01078624681-09027567677, 45982088127-90369291605-80044281219-46887615792-75467747528)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[259:{SchemaIndex=65, TableIndex=259, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (824478979, 9, 79929455805-82686000395-87933678180-97427805059-78850675331-66749630290-23371965370-59789760435-11687903028-37111392097, 65387439360-90889047465-34899315444-83593158053-88419722270)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[388:{SchemaIndex=98, TableIndex=388, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1778834820, 4, 26400620948-86886163258-66955677020-24736956201-37633810654-62170837016-10953232786-08731106510-27930064178-11956848338, 22734010461-63969213016-54927682118-22921617753-25869637636)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[345:{SchemaIndex=87, TableIndex=345, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1906262361, 4, 73054929345-92331883054-27511894619-20000378864-11948567194-86713567705-11190297445-34047180586-99650690403-71903892017, 07335571244-33555087386-76380202973-29490934882-40814481851)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[569:{SchemaIndex=143, TableIndex=569, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1606555193, 2, 94281857928-97538212927-39261666932-79938992409-52558016112-06785833668-50810169070-34555719774-82330250972-35853785503, 29683325026-64124354800-63566774522-19722425169-37547560762)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1143670666, 7, 74870370257-63163303467-80061015187-84192128665-25175084977-80554698357-24269465921-53186773519-78675020561-83488552374, 73368269204-64304332325-34620567277-68846684629-38045820340)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[941:{SchemaIndex=236, TableIndex=941, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1370776493, 6, 16692170437-43512178684-59516594203-75377838995-76081749306-71167865747-97237301685-23453441670-03667446181-56604717727, 14195711604-53513247591-07873804194-96431257292-05520461785)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[872:{SchemaIndex=219, TableIndex=872, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1208557416, 5, 27703568859-81266825379-86789890837-60513053664-22258866897-34966682979-82761864561-83949706302-60135012966-31647733109, 63271991640-87709697591-13072925018-38646644832-79179029573)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[991:{SchemaIndex=248, TableIndex=991, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (138564575, 6, 26857888685-88370802193-51045899118-07572056078-70111763976-05806767425-30208609378-20016792779-48308493020-29821526191, 61555808494-05287717368-66884245341-45983655335-60458704606)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1007, mergeExecResult: 0. shardingNode:map[449:{SchemaIndex=113, TableIndex=449, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-229865921, 8, 14034106238-21876701329-38233326181-31158038417-73928237004-22908354046-72713486563-40610785127-99166317018-52234063725, 23168975405-73598149943-63125122764-74527985990-06171559404)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[959:{SchemaIndex=240, TableIndex=959, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-677583807, 4, 40735866383-98457016615-08789114417-03599576561-48782283253-32055567198-88072330194-83020475968-03693883045-96278614943, 70150968961-19151317381-16983120036-88185867422-84862477300)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1006, mergeExecResult: 0. shardingNode:map[406:{SchemaIndex=102, TableIndex=406, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-2093701526, 5, 09210536591-41896791043-73295525884-89613310006-75387609760-41655764025-47137540812-97100201238-15965683915-13727887851, 48024514833-13441113380-49081922507-17183150276-06208568092)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[894:{SchemaIndex=224, TableIndex=894, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (108403582, 4, 58477996001-39515710854-83438883003-74672331816-19403553257-36113016280-00822951895-43706580851-50122510142-72629874469, 25950012615-74047249694-75644797724-67405314152-48742553448)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[824:{SchemaIndex=207, TableIndex=824, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1108509496, 2, 05591703103-07428761202-09014510822-44571443153-87746638001-18005366596-37591757698-85345493107-52688524466-97341165803, 90287453968-47714845240-54141462203-72968014933-11681199861)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[960:{SchemaIndex=241, TableIndex=960, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-432972736, 4, 32013395637-31037790439-99508763633-39582502523-46934970326-99846192559-79844868065-81128826635-19475623448-94555401729, 72848617704-77451404798-55770002912-34209086424-23821979141)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[864:{SchemaIndex=217, TableIndex=864, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (209038176, 6, 31725269303-67222682770-97738396828-19717571752-01126165612-57542830563-51718817223-13687491781-38891241679-10677758794, 40604117998-67635443824-03882862739-68433432919-44278589057)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-663100941, 3, 13572309986-10356575142-87428874956-18162116973-83396135908-09352768769-83603227505-94165603992-17437041978-81761343722, 58884262253-26008842705-81702669160-02709154611-78739667686)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[821:{SchemaIndex=206, TableIndex=821, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1290297141, 6, 28650953615-66926208686-47052429218-34545146184-51693579732-60563146329-00350338711-30136625347-99506216978-22404723673, 30345581431-18594298965-23203468098-48853746952-30033247101)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[881:{SchemaIndex=221, TableIndex=881, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2128759665, 3, 23557322059-62351008582-19218938648-55023996016-67978090662-04498693910-40333149725-65457542876-11556698223-86845640120, 39531266486-08252986785-52805405505-62972899514-62765043827)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[829:{SchemaIndex=208, TableIndex=829, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1081064253, 2, 39396011527-03550826801-53544579241-44145722341-56423193708-85298116954-45172197891-54532848324-82241582599-97563898680, 76749800295-63255838342-73258070193-02305060704-64352300433)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[900:{SchemaIndex=226, TableIndex=900, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-513806212, 1, 16727493623-40348083665-41922314110-05150944505-43353212884-59194917800-00753396008-63562258886-84259052626-93713085152, 38634951090-07591809914-73325301815-73315254313-82978384844)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1, mergeExecResult: 0. shardingNode:map[863:{SchemaIndex=216, TableIndex=863, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-450094943, 6, 23924438266-62111362125-81473873200-06328498397-88922636306-39182947784-05124699385-49780077333-57313760145-54634535492, 96577223660-83042935121-28454288566-32057418883-39061132652)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[963:{SchemaIndex=241, TableIndex=963, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1800163267, 4, 27948346446-05701199368-49149768636-18762164887-01870692332-13661773677-35851324771-46733712098-36653074427-31181566769, 08781105428-22812332073-21224324603-72676647429-86438534524)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[878:{SchemaIndex=220, TableIndex=878, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1535190894, 9, 46310600095-97541020554-94065740469-24853513335-69630566641-31721053084-60343664925-46348792383-87749652424-52899212634, 41944783155-15764748316-26823908956-07652542569-85074827204)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1945995146, 4, 64447284661-78831878306-27636005022-88863833954-72613803410-72661880191-81775646793-56738842216-16376642732-30662007847, 44349800594-98690127361-78211321236-38340738575-94555021426)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1719256971, 3, 36693810506-14727560109-48871542333-86332816255-91899190554-43809786563-22813456576-32468291237-08105779091-35654765264, 76792216525-13152293559-11187746420-35413475429-73316527358)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[827:{SchemaIndex=207, TableIndex=827, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1191957307, 3, 02373892720-70783246981-33072353568-68101913427-25982074179-25716557733-53487403333-33176741697-19961659954-24745733546, 65228452942-44586411798-63293957289-46889416058-55247585232)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-368940747, 10, 83732843347-38915816227-71028864502-83867874900-55259635749-04867892981-61246311166-86657029985-98371125854-01109713202, 28665022675-32159696841-27962719413-92137483719-65438251505)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[531:{SchemaIndex=133, TableIndex=531, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (296709651, 4, 68512385573-12594713777-31891099071-55341413329-96572532552-89441743744-75535604911-39664974035-50293453830-41657909966, 54516090919-10379612997-70745484084-47657473576-34684395884)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1010:{SchemaIndex=253, TableIndex=1010, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (375408626, 5, 86917579879-69750606525-04310713441-66206378609-22671203503-85955817483-08099675016-87194148638-56030296183-72576969654, 14638356398-42816005551-86372571322-85471822123-78848498639)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 207, mergeExecResult: 0. shardingNode:map[481:{SchemaIndex=121, TableIndex=481, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-453506529, 7, 05922416371-88423926572-06168309932-36230491079-35838894643-96519731061-10785734640-51619035736-36739664574-07173836937, 86251074060-14148969607-50675271708-72280786641-89845672651)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[506:{SchemaIndex=127, TableIndex=506, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (923516410, 1, 71118741783-11388565696-96706199622-38503412573-05309353257-45864148538-09400667746-21110528894-17837136283-91361843504, 67292585002-85708710331-29800085937-37291514623-47320174130)] </p>\n<p>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 306, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1344100892, 4, 37923605607-42327774961-35128132820-48158088043-25957128013-51759124002-40449799093-68433809807-31405796686-22817252999, 94291235269-60160247565-39950122186-97684115599-96232437155)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 211, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-757833244, 5, 50104262688-83666007823-06989738144-95141595109-93329094811-13832991101-93076033912-05017862363-35692005246-88744289137, 54081433849-09378248558-38274752100-88855316211-27289637272)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[198:{SchemaIndex=50, TableIndex=198, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (652469446, 1, 07652454524-22981957011-41438122391-90347773905-88663504044-48425601588-32127975840-28199749965-27298300589-25715051794, 60470366939-49887579866-34848349508-29262200362-52000338086)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[670:{SchemaIndex=168, TableIndex=670, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-212205214, 3, 39093408635-10213704095-82878149257-88673860178-07278582464-52697390774-95388237318-03462450231-66036638124-64228596635, 38716722580-86486363760-61985600779-83841271441-42765235992)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 248, mergeExecResult: 0. shardingNode:map[594:{SchemaIndex=149, TableIndex=594, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1136835154, 2, 23757270379-51595389012-47476784586-71294005118-20959815636-40533304860-41036462462-22519409530-16151251756-29363403201, 02895678318-89791495824-44276206517-37575326693-35714861579)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 196, mergeExecResult: 0. shardingNode:map[596:{SchemaIndex=150, TableIndex=596, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (927250004, 3, 02232667199-83769701794-18129066725-31520472849-93375763771-42931518091-56094856485-24182688367-31807939112-07474880757, 46530309679-12705910558-69428237706-14629411089-19801742204)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 213, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1908502072, 6, 11131352749-42538464007-16895664672-62644300750-86974265339-82077852146-68660984992-78157770948-82596046151-02353070903, 35289675345-82804575493-00647347117-53443940605-48670213485)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[530:{SchemaIndex=133, TableIndex=530, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1565462034, 2, 03766551315-88042959333-06619558863-52259377137-27072539179-52210031586-63547684874-18650692849-22136096911-63673950864, 23300762166-38283070103-67223042934-76314148059-35039279078)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[705:{SchemaIndex=177, TableIndex=705, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-282929857, 9, 78018924775-94910259974-14900983402-30428448745-60064721591-40668444882-53712901782-65346911189-59688209606-74312372904, 82234943021-50353143509-80352130420-57571772487-81475633439)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 291, mergeExecResult: 0. shardingNode:map[724:{SchemaIndex=182, TableIndex=724, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2109119188, 7, 36086413796-51767176683-52982238848-36460965892-84578503998-21697029291-39139590496-18305440259-61532992900-70589028518, 30048526034-08924322516-87289516951-51922079500-47125778015)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 210, mergeExecResult: 0. shardingNode:map[573:{SchemaIndex=144, TableIndex=573, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-994558525, 8, 74078055913-58294585862-48131723756-93089582597-72949713745-85429496032-27905841748-82110966829-12174780172-45947256767, 52598986037-80854622196-65516850169-26314282473-46184813701)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 99, mergeExecResult: 0. shardingNode:map[701:{SchemaIndex=176, TableIndex=701, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1290611389, 10, 06010961323-54786660073-11823817491-71384866194-20002003501-13527828508-52664186690-95551041252-11585296099-86883272955, 35567244596-82663971593-11831798779-27870930145-87441039863)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 292, mergeExecResult: 0. shardingNode:map[567:{SchemaIndex=142, TableIndex=567, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (810312247, 10, 41210873160-21444867641-91122365510-19036499914-34569882163-29091701055-84873343605-60726600041-00757500001-24263691698, 41652074477-40057441865-33409084588-16838407116-03941310610)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[213:{SchemaIndex=54, TableIndex=213, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1881853141, 2, 14742564348-19913327041-96137703234-33860693319-12765733015-19685217285-90407570147-69715707192-71609875203-72224693707, 62398998246-64288014470-28245239723-29976129053-08238346550)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 242, mergeExecResult: 0. shardingNode:map[698:{SchemaIndex=175, TableIndex=698, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1011920570, 2, 33865708347-82274332444-45097600411-92274439334-16926356904-33828206076-16463987600-06687756787-06453656924-53622006994, 48462480629-04943720987-66250435599-66843177447-86484400166)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 195, mergeExecResult: 0. shardingNode:map[710:{SchemaIndex=178, TableIndex=710, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-2128817862, 7, 12483300987-88535524922-66334741529-64659385522-75032596868-93466219012-01222978665-55122702202-84142740410-53583589563, 89132580254-79206347601-13534456013-96027776935-07650599065)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 233, mergeExecResult: 0. shardingNode:map[544:{SchemaIndex=137, TableIndex=544, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1496016416, 9, 99154323337-90872497215-53698284897-04686362817-35622767062-48356019022-04016504226-75493501145-38429448892-66989460733, 84409926268-28404056573-96777093808-13481662538-98898905310)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (756613003, 1, 48041615531-14651008388-14559884387-33045819966-91038786346-39394412181-13147015451-43265025586-90014901196-20159726596, 62496325099-63432555894-84244639858-58924561742-12138512609)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 284, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (588268045, 3, 01778869912-44391681202-43730989451-99650497628-58071023040-36244500937-05173857724-21592385062-52662008534-88410130321, 68551597952-73268487812-26478068307-11227961732-49092247276)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[674:{SchemaIndex=169, TableIndex=674, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (75111074, 1, 07857287095-83026714634-10012972058-11441297287-80787536524-31038348780-79408482259-95286783641-23620583564-94195135059, 39714908056-38058099094-71552841772-10457961132-39419941227)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 230, mergeExecResult: 0. shardingNode:map[577:{SchemaIndex=145, TableIndex=577, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-911965761, 8, 07321418565-94055920833-16462957068-14933742620-00134077423-05303377934-66121817102-49230219319-72774150061-80468601177, 26522648558-75134929821-83594530381-47917024515-31668467194)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1315070465, 5, 15474433240-84784850443-17796367719-48021520867-10943303644-48200729918-91013947900-33061132253-28956163141-98846516045, 99644114596-46918915095-13462299586-15204837308-12785249281)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 231, mergeExecResult: 0. shardingNode:map[737:{SchemaIndex=185, TableIndex=737, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-180994785, 9, 61681162669-07252910162-88941330016-07633567093-86234290556-74605484081-92189953463-28499401861-08881094341-04206273246, 73069152681-47514577462-53755512339-63165295325-04957863379)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 225, mergeExecResult: 0. shardingNode:map[583:{SchemaIndex=146, TableIndex=583, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (905672263, 5, 11686869034-48032081508-20645314791-73241768758-13634493369-36096577158-76040275597-65556337906-73745369125-93817830861, 25154935190-35760055237-67095134841-73686707222-08327146392)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 227, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1028081208, 6, 65787201754-47681590360-50036937953-38544197509-01589612011-17576022949-32999165698-83171817746-37315560344-14463882405, 65637926145-34138639858-41094177281-29428779399-44688752051)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[558:{SchemaIndex=140, TableIndex=558, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (278584878, 10, 32358945918-66413584434-88058020708-48390261093-67208582401-88568979078-90497400157-49426845556-80952580018-13610087462, 14198786100-85805610838-89824761297-62058901344-60492560838)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 228, mergeExecResult: 0. shardingNode:map[649:{SchemaIndex=163, TableIndex=649, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1183431305, 2, 43858458237-46788126262-05213368147-07302202409-13593899883-99375055319-42875375550-56499216168-01796902390-08647652700, 48205424174-34611724289-69246697079-03898745311-99595319598)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 26, mergeExecResult: 0. shardingNode:map[1002:{SchemaIndex=251, TableIndex=1002, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1701967850, 9, 59147040383-79705593723-62886101805-60535881029-18413556495-06238443919-02766097021-38361379870-67179305438-52530038201, 14770296700-13396847549-83905253251-99337969432-58669912709)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[745:{SchemaIndex=187, TableIndex=745, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1169184489, 7, 64955629118-36147506634-51676575477-92147977264-45999410094-15567300060-12836575112-28470342888-04361926080-90629622527, 86593300354-87140619605-87718697448-88392415837-04795141111)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 272, mergeExecResult: 0. shardingNode:map[662:{SchemaIndex=166, TableIndex=662, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1555424918, 10, 11260581771-57660361810-58723152189-43635886031-41094065361-37903459575-65856768363-01843670891-17848285384-92171598763, 36462031678-64770373669-77316073133-32672501580-50753545368)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 271, mergeExecResult: 0. shardingNode:map[736:{SchemaIndex=185, TableIndex=736, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-270642912, 9, 87806093665-04774113218-83983577041-09351362099-88339377062-22401969710-89370302094-61598971830-04573362584-60421137580, 26415700902-09148763904-87375314444-00285784497-80449574080)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 222, mergeExecResult: 0. shardingNode:map[588:{SchemaIndex=148, TableIndex=588, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1608970828, 2, 75571666926-33738024136-84313793696-10714487345-57088294174-41711334397-51382524640-08327299973-66970622008-15344703881, 73366501022-14368954292-21130701303-33960859630-28160972955)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[556:{SchemaIndex=140, TableIndex=556, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-993863212, 3, 68136313990-05892185009-94544559127-32267303237-37763842514-89959134082-97215598641-72307869276-49642816905-24994127953, 97111382859-69888150629-89398585714-99569889618-30099083026)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1299240449, 6, 13580427730-91599560017-42392676834-62860979245-65274043134-68243135520-42672727926-56794775679-69217526806-27227304772, 15736027942-38175115801-93773367279-77944721463-03173899187)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 214, mergeExecResult: 0. shardingNode:map[579:{SchemaIndex=145, TableIndex=579, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1346301507, 2, 95777728263-97322915970-24025444526-11872987788-74589515383-37108287704-62890589663-84327075019-58161194629-66166453693, 43925335448-41493749427-45817169562-78879091928-39249185154)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[723:{SchemaIndex=181, TableIndex=723, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1604556499, 3, 54964824319-34611710514-15902154995-18014105243-70193115677-91112406449-61348366967-41301887681-73892593737-54039590822, 26491514771-24473569991-16656607124-07593925149-74926670900)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 253, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (533688011, 7, 17872695538-16064539790-18108982113-60646269894-74784931403-89606878485-67937667670-39824753762-37339034055-79511964331, 65227853620-62393117281-88901273019-02060144110-40123779052)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[731:{SchemaIndex=183, TableIndex=731, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (548553435, 7, 59524856205-92318067592-84001816236-15799238765-61939312958-49774297702-51059777347-11521186806-90725070157-29567571966, 72604893873-81336794708-64989781571-89144801847-53529920629)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[646:{SchemaIndex=162, TableIndex=646, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1980507782, 8, 15361099362-33426846104-81568076007-88926275697-54147190617-21941361738-39219198670-72817831326-95768248501-29228997291, 51713925651-55077435995-56372978084-60334222441-07023013203)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[1023:{SchemaIndex=256, TableIndex=1023, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (419830783, 9, 39839456224-14625126106-10611694673-69035645226-20746732552-01963419766-94676550107-32542648198-96549393904-39850608367, 69725922822-08559910362-36080928509-49601235010-15261238716)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[612:{SchemaIndex=154, TableIndex=612, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1848104548, 6, 02931425025-68282480940-67294056291-41225608697-44038095895-05390291535-10414730978-25086630856-84460614365-62218384416, 74426157735-27538600335-93122572838-36921241106-44481214039)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 305, mergeExecResult: 0. shardingNode:map[517:{SchemaIndex=130, TableIndex=517, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-543662597,</p>\n<p>cobar:<br>sysbench mysql-host=10.1.21.242 mysql-port=8066 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup<br>sysbench mysql-host=10.1.21.242 mysql-port=8066 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare<br>sysbench mysql-host=10.1.21.242 mysql-port=8066 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run</p>\n<p>zero-proxy<br>sysbench mysql-host=10.1.21.242 mysql-port=9696 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup<br>sysbench mysql-host=10.1.21.242 mysql-port=9696 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare<br>sysbench mysql-host=10.1.21.242 mysql-port=9696 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb  oltp-tables-count=5 prepare</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb  oltp-tables-count=5 cleanup</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=128 read-threads=8 max-time=3600 random</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=128 read-threads=8 max-time=3600 seq</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=4 read-threads=300 update-threads=20 delete-threads=10 max-time=360000000 random</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=400 read-threads=400 max-time=3600 random</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"centos\"><a href=\"#centos\" class=\"headerlink\" title=\"centos\"></a>centos</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install sysbench</div></pre></td></tr></table></figure>\n<p>lua /usr/share/sysbench/</p>\n<p>CobarSQL 92/usr/share/sysbench/oltp_common.lua</p>\n<p></p>\n<p>: sysbench [lua_path] help<br>: sysbench /usr/share/sysbench/oltp_insert.lua help</p>\n<p>sysbench mysql-host=mac \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=4 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=2 \\<br>/usr/local/Cellar/sysbench/1.0.11/share/sysbench/oltp_insert.lua \\</p>\n<p>#cobar_1</p>\n<p>sysbench mysql-host=10.1.21.148 \\<br>mysql-port=8066 \\<br>mysql-user=user \\<br>mysql-password=user \\<br>mysql-db=user \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 \\<br>events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\</p>\n<p>#cobar_2</p>\n<p>sysbench mysql-host=10.1.21.147 \\<br>mysql-port=8066 \\<br>mysql-user=user \\<br>mysql-password=user \\<br>mysql-db=user \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>[root@mq001 ~]# sysbench mysql-host=10.1.21.147 mysql-port=8066 mysql-user=user mysql-password=user mysql-db=user threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=60 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run<br>sysbench 1.0.9 (using system LuaJIT 2.0.4)</p>\n<p>Running the test with following options:<br>Number of threads: 400<br>Report intermediate results every 5 second(s)<br>Initializing random number generator from current time</p>\n<p>Initializing worker threads</p>\n<p>Threads started!</p>\n<p>[ 5s ] thds: 400 tps: 11516.37 qps: 11516.37 (r/w/o: 0.00/11516.37/0.00) lat (ms,99%): 204.11 err/s: 0.00 reconn/s: 0.00<br>[ 10s ] thds: 400 tps: 2884.87 qps: 2884.87 (r/w/o: 0.00/2884.87/0.00) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00<br>[ 15s ] thds: 400 tps: 4025.00 qps: 4025.00 (r/w/o: 0.00/4025.00/0.00) lat (ms,99%): 1869.60 err/s: 0.00 reconn/s: 0.00<br>[ 20s ] thds: 400 tps: 13497.32 qps: 13497.32 (r/w/o: 0.00/13497.32/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00<br>[ 25s ] thds: 400 tps: 10908.17 qps: 10908.17 (r/w/o: 0.00/10908.17/0.00) lat (ms,99%): 144.97 err/s: 0.00 reconn/s: 0.00<br>[ 30s ] thds: 400 tps: 12280.74 qps: 12280.74 (r/w/o: 0.00/12280.74/0.00) lat (ms,99%): 132.49 err/s: 0.00 reconn/s: 0.00<br>[ 35s ] thds: 400 tps: 9783.37 qps: 9783.37 (r/w/o: 0.00/9783.37/0.00) lat (ms,99%): 150.29 err/s: 0.00 reconn/s: 0.00<br>[ 40s ] thds: 400 tps: 11703.52 qps: 11703.72 (r/w/o: 0.00/11703.72/0.00) lat (ms,99%): 173.58 err/s: 0.00 reconn/s: 0.00<br>[ 45s ] thds: 400 tps: 8253.06 qps: 8252.86 (r/w/o: 0.00/8252.86/0.00) lat (ms,99%): 207.82 err/s: 0.00 reconn/s: 0.00<br>[ 50s ] thds: 400 tps: 7148.98 qps: 7149.18 (r/w/o: 0.00/7149.18/0.00) lat (ms,99%): 657.93 err/s: 0.00 reconn/s: 0.00<br>[ 55s ] thds: 400 tps: 10911.35 qps: 10911.15 (r/w/o: 0.00/10911.15/0.00) lat (ms,99%): 176.73 err/s: 0.00 reconn/s: 0.00<br>[ 60s ] thds: 400 tps: 8702.48 qps: 8702.48 (r/w/o: 0.00/8702.48/0.00) lat (ms,99%): 235.74 err/s: 0.00 reconn/s: 0.00<br>SQL statistics:<br>    queries performed:<br>        read:                            0<br>        write:                           558494<br>        other:                           0<br>        total:                           558494<br>    transactions:                        558494 (9273.20 per sec.)<br>    queries:                             558494 (9273.20 per sec.)<br>    ignored errors:                      0      (0.00 per sec.)<br>    reconnects:                          0      (0.00 per sec.)</p>\n<p>General statistics:<br>    total time:                          60.2244s<br>    total number of events:              558494</p>\n<p>Latency (ms):<br>         min:                                  3.89<br>         avg:                                 43.02<br>         max:                               2881.01<br>         99th percentile:                    253.35<br>         sum:                            24023700.41</p>\n<p>Threads fairness:<br>    events (avg/stddev):           1396.2350/30.84<br>    execution time (avg/stddev):   60.0593/0.05</p>\n<p>[root@mq001 ~]# sysbench mysql-host=10.1.21.148 mysql-port=8066 mysql-user=user mysql-password=user mysql-db=user threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=60 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run<br>sysbench 1.0.9 (using system LuaJIT 2.0.4)</p>\n<p>Running the test with following options:<br>Number of threads: 400<br>Report intermediate results every 5 second(s)<br>Initializing random number generator from current time</p>\n<p>Initializing worker threads</p>\n<p>Threads started!</p>\n<p>[ 5s ] thds: 400 tps: 10470.98 qps: 10470.98 (r/w/o: 0.00/10470.98/0.00) lat (ms,99%): 262.64 err/s: 0.00 reconn/s: 0.00<br>[ 10s ] thds: 400 tps: 3020.06 qps: 3020.06 (r/w/o: 0.00/3020.06/0.00) lat (ms,99%): 1050.76 err/s: 0.00 reconn/s: 0.00<br>[ 15s ] thds: 400 tps: 1107.64 qps: 1107.64 (r/w/o: 0.00/1107.64/0.00) lat (ms,99%): 1327.91 err/s: 0.00 reconn/s: 0.00<br>[ 20s ] thds: 400 tps: 7395.23 qps: 7395.23 (r/w/o: 0.00/7395.23/0.00) lat (ms,99%): 816.63 err/s: 0.00 reconn/s: 0.00<br>[ 25s ] thds: 400 tps: 12654.11 qps: 12654.11 (r/w/o: 0.00/12654.11/0.00) lat (ms,99%): 125.52 err/s: 0.00 reconn/s: 0.00<br>[ 30s ] thds: 400 tps: 10854.72 qps: 10854.92 (r/w/o: 0.00/10854.92/0.00) lat (ms,99%): 153.02 err/s: 0.00 reconn/s: 0.00<br>[ 35s ] thds: 400 tps: 11832.81 qps: 11832.61 (r/w/o: 0.00/11832.61/0.00) lat (ms,99%): 186.54 err/s: 0.00 reconn/s: 0.00<br>[ 40s ] thds: 400 tps: 6895.44 qps: 6895.44 (r/w/o: 0.00/6895.44/0.00) lat (ms,99%): 257.95 err/s: 0.00 reconn/s: 0.00<br>[ 45s ] thds: 400 tps: 12907.06 qps: 12907.06 (r/w/o: 0.00/12907.06/0.00) lat (ms,99%): 158.63 err/s: 0.00 reconn/s: 0.00<br>[ 50s ] thds: 400 tps: 7760.80 qps: 7760.80 (r/w/o: 0.00/7760.80/0.00) lat (ms,99%): 292.60 err/s: 0.00 reconn/s: 0.00<br>[ 55s ] thds: 400 tps: 11595.84 qps: 11595.84 (r/w/o: 0.00/11595.84/0.00) lat (ms,99%): 161.51 err/s: 0.00 reconn/s: 0.00<br>[ 60s ] thds: 400 tps: 10314.36 qps: 10314.36 (r/w/o: 0.00/10314.36/0.00) lat (ms,99%): 142.39 err/s: 0.00 reconn/s: 0.00<br>SQL statistics:<br>    queries performed:<br>        read:                            0<br>        write:                           534637<br>        other:                           0<br>        total:                           534637<br>    transactions:                        534637 (8890.97 per sec.)<br>    queries:                             534637 (8890.97 per sec.)<br>    ignored errors:                      0      (0.00 per sec.)<br>    reconnects:                          0      (0.00 per sec.)</p>\n<p>General statistics:<br>    total time:                          60.1304s<br>    total number of events:              534637</p>\n<p>Latency (ms):<br>         min:                                  4.14<br>         avg:                                 44.91<br>         max:                               3066.99<br>         99th percentile:                    292.60<br>         sum:                            24012284.54</p>\n<p>Threads fairness:<br>    events (avg/stddev):           1336.5925/23.11<br>    execution time (avg/stddev):   60.0307/0.03</p>\n<p>sysbench mysql-host=10.1.134.195 \\<br>mysql-port=8066 \\<br>mysql-user=user \\<br>mysql-password=user \\<br>mysql-db=user \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 \\<br>events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\</p>\n<p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=10 \\<br>debug=on \\<br>verbosity=5 \\<br>tables=5 \\<br>events=1 \\<br>auto_inc=off \\<br>table-size=1000 \\<br>db-driver=mysql \\<br>time=6000000 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_read_only.lua \\<br>run</p>\n<h1 id=\"zerodb\"><a href=\"#zerodb\" class=\"headerlink\" title=\"zerodb\"></a>zerodb</h1><p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=10 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\<br>cleanup</p>\n<p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=10 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\<br>prepare</p>\n<p>sysbench mysql-host=10.1.21.242 \\<br>mysql-port=9696 \\<br>mysql-user=zerodb \\<br>mysql-password=zerodb \\<br>mysql-db=zerodb \\<br>threads=400 \\<br>table-size=10 \\<br>auto_inc=off \\<br>tables=5 \\<br>rand-type=uniform \\<br>db-driver=mysql \\<br>time=6000000 events=0 \\<br>percentile=99 \\<br>report-interval=5 \\<br>/usr/share/sysbench/oltp_insert.lua \\<br>run</p>\n<p>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[899:{SchemaIndex=225, TableIndex=899, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1592131459, 7, 55016285732-53347045338-85834558147-71206675947-20854212178-67704861318-55023920639-15021922692-58783263226-91831209826, 44804973802-80594424819-30662288113-07543047794-69158617276)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[607:{SchemaIndex=152, TableIndex=607, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1551461983, 1, 97565032345-06095273461-70708868939-89114711497-07191112359-84320966593-06915637429-34011520393-29123922986-41181266499, 10350064023-47161933420-32840507920-65997397770-16177253238)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[371:{SchemaIndex=93, TableIndex=371, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1688397171, 3, 66563027950-07665251035-46015031422-61663761332-16063948763-45273359443-68411883367-29428347771-65572934442-17492196263, 60851935379-49894017653-67952828882-67412344041-59230452535)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1011:{SchemaIndex=253, TableIndex=1011, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-573803507, 2, 43589791346-92222019297-77586384271-52778612091-96284921979-05035493725-49350672130-03697130813-21052521840-31158762545, 33228172883-24963516238-59142423481-48021525640-21772792414)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1001, mergeExecResult: 0. shardingNode:map[310:{SchemaIndex=78, TableIndex=310, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (439335222, 7, 03793368943-50266953542-49577833032-14468376728-10198261385-85128057368-15281808692-43095784178-01078624681-09027567677, 45982088127-90369291605-80044281219-46887615792-75467747528)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[259:{SchemaIndex=65, TableIndex=259, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (824478979, 9, 79929455805-82686000395-87933678180-97427805059-78850675331-66749630290-23371965370-59789760435-11687903028-37111392097, 65387439360-90889047465-34899315444-83593158053-88419722270)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[388:{SchemaIndex=98, TableIndex=388, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1778834820, 4, 26400620948-86886163258-66955677020-24736956201-37633810654-62170837016-10953232786-08731106510-27930064178-11956848338, 22734010461-63969213016-54927682118-22921617753-25869637636)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1000, mergeExecResult: 0. shardingNode:map[345:{SchemaIndex=87, TableIndex=345, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1906262361, 4, 73054929345-92331883054-27511894619-20000378864-11948567194-86713567705-11190297445-34047180586-99650690403-71903892017, 07335571244-33555087386-76380202973-29490934882-40814481851)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[569:{SchemaIndex=143, TableIndex=569, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1606555193, 2, 94281857928-97538212927-39261666932-79938992409-52558016112-06785833668-50810169070-34555719774-82330250972-35853785503, 29683325026-64124354800-63566774522-19722425169-37547560762)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1143670666, 7, 74870370257-63163303467-80061015187-84192128665-25175084977-80554698357-24269465921-53186773519-78675020561-83488552374, 73368269204-64304332325-34620567277-68846684629-38045820340)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[941:{SchemaIndex=236, TableIndex=941, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1370776493, 6, 16692170437-43512178684-59516594203-75377838995-76081749306-71167865747-97237301685-23453441670-03667446181-56604717727, 14195711604-53513247591-07873804194-96431257292-05520461785)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[872:{SchemaIndex=219, TableIndex=872, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1208557416, 5, 27703568859-81266825379-86789890837-60513053664-22258866897-34966682979-82761864561-83949706302-60135012966-31647733109, 63271991640-87709697591-13072925018-38646644832-79179029573)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[991:{SchemaIndex=248, TableIndex=991, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (138564575, 6, 26857888685-88370802193-51045899118-07572056078-70111763976-05806767425-30208609378-20016792779-48308493020-29821526191, 61555808494-05287717368-66884245341-45983655335-60458704606)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1007, mergeExecResult: 0. shardingNode:map[449:{SchemaIndex=113, TableIndex=449, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-229865921, 8, 14034106238-21876701329-38233326181-31158038417-73928237004-22908354046-72713486563-40610785127-99166317018-52234063725, 23168975405-73598149943-63125122764-74527985990-06171559404)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[959:{SchemaIndex=240, TableIndex=959, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-677583807, 4, 40735866383-98457016615-08789114417-03599576561-48782283253-32055567198-88072330194-83020475968-03693883045-96278614943, 70150968961-19151317381-16983120036-88185867422-84862477300)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1006, mergeExecResult: 0. shardingNode:map[406:{SchemaIndex=102, TableIndex=406, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-2093701526, 5, 09210536591-41896791043-73295525884-89613310006-75387609760-41655764025-47137540812-97100201238-15965683915-13727887851, 48024514833-13441113380-49081922507-17183150276-06208568092)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[894:{SchemaIndex=224, TableIndex=894, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (108403582, 4, 58477996001-39515710854-83438883003-74672331816-19403553257-36113016280-00822951895-43706580851-50122510142-72629874469, 25950012615-74047249694-75644797724-67405314152-48742553448)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[824:{SchemaIndex=207, TableIndex=824, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1108509496, 2, 05591703103-07428761202-09014510822-44571443153-87746638001-18005366596-37591757698-85345493107-52688524466-97341165803, 90287453968-47714845240-54141462203-72968014933-11681199861)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[960:{SchemaIndex=241, TableIndex=960, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-432972736, 4, 32013395637-31037790439-99508763633-39582502523-46934970326-99846192559-79844868065-81128826635-19475623448-94555401729, 72848617704-77451404798-55770002912-34209086424-23821979141)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[864:{SchemaIndex=217, TableIndex=864, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (209038176, 6, 31725269303-67222682770-97738396828-19717571752-01126165612-57542830563-51718817223-13687491781-38891241679-10677758794, 40604117998-67635443824-03882862739-68433432919-44278589057)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-663100941, 3, 13572309986-10356575142-87428874956-18162116973-83396135908-09352768769-83603227505-94165603992-17437041978-81761343722, 58884262253-26008842705-81702669160-02709154611-78739667686)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[821:{SchemaIndex=206, TableIndex=821, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1290297141, 6, 28650953615-66926208686-47052429218-34545146184-51693579732-60563146329-00350338711-30136625347-99506216978-22404723673, 30345581431-18594298965-23203468098-48853746952-30033247101)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[881:{SchemaIndex=221, TableIndex=881, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2128759665, 3, 23557322059-62351008582-19218938648-55023996016-67978090662-04498693910-40333149725-65457542876-11556698223-86845640120, 39531266486-08252986785-52805405505-62972899514-62765043827)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[829:{SchemaIndex=208, TableIndex=829, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1081064253, 2, 39396011527-03550826801-53544579241-44145722341-56423193708-85298116954-45172197891-54532848324-82241582599-97563898680, 76749800295-63255838342-73258070193-02305060704-64352300433)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[900:{SchemaIndex=226, TableIndex=900, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-513806212, 1, 16727493623-40348083665-41922314110-05150944505-43353212884-59194917800-00753396008-63562258886-84259052626-93713085152, 38634951090-07591809914-73325301815-73315254313-82978384844)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 1, mergeExecResult: 0. shardingNode:map[863:{SchemaIndex=216, TableIndex=863, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-450094943, 6, 23924438266-62111362125-81473873200-06328498397-88922636306-39182947784-05124699385-49780077333-57313760145-54634535492, 96577223660-83042935121-28454288566-32057418883-39061132652)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[963:{SchemaIndex=241, TableIndex=963, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1800163267, 4, 27948346446-05701199368-49149768636-18762164887-01870692332-13661773677-35851324771-46733712098-36653074427-31181566769, 08781105428-22812332073-21224324603-72676647429-86438534524)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[878:{SchemaIndex=220, TableIndex=878, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1535190894, 9, 46310600095-97541020554-94065740469-24853513335-69630566641-31721053084-60343664925-46348792383-87749652424-52899212634, 41944783155-15764748316-26823908956-07652542569-85074827204)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[906:{SchemaIndex=227, TableIndex=906, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1945995146, 4, 64447284661-78831878306-27636005022-88863833954-72613803410-72661880191-81775646793-56738842216-16376642732-30662007847, 44349800594-98690127361-78211321236-38340738575-94555021426)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1719256971, 3, 36693810506-14727560109-48871542333-86332816255-91899190554-43809786563-22813456576-32468291237-08105779091-35654765264, 76792216525-13152293559-11187746420-35413475429-73316527358)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[827:{SchemaIndex=207, TableIndex=827, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1191957307, 3, 02373892720-70783246981-33072353568-68101913427-25982074179-25716557733-53487403333-33176741697-19961659954-24745733546, 65228452942-44586411798-63293957289-46889416058-55247585232)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-368940747, 10, 83732843347-38915816227-71028864502-83867874900-55259635749-04867892981-61246311166-86657029985-98371125854-01109713202, 28665022675-32159696841-27962719413-92137483719-65438251505)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[531:{SchemaIndex=133, TableIndex=531, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (296709651, 4, 68512385573-12594713777-31891099071-55341413329-96572532552-89441743744-75535604911-39664974035-50293453830-41657909966, 54516090919-10379612997-70745484084-47657473576-34684395884)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 2, mergeExecResult: 0. shardingNode:map[1010:{SchemaIndex=253, TableIndex=1010, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (375408626, 5, 86917579879-69750606525-04310713441-66206378609-22671203503-85955817483-08099675016-87194148638-56030296183-72576969654, 14638356398-42816005551-86372571322-85471822123-78848498639)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 207, mergeExecResult: 0. shardingNode:map[481:{SchemaIndex=121, TableIndex=481, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-453506529, 7, 05922416371-88423926572-06168309932-36230491079-35838894643-96519731061-10785734640-51619035736-36739664574-07173836937, 86251074060-14148969607-50675271708-72280786641-89845672651)]<br>WARN[0449] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 999, mergeExecResult: 0. shardingNode:map[506:{SchemaIndex=127, TableIndex=506, HostGroup=hostGroup2}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (923516410, 1, 71118741783-11388565696-96706199622-38503412573-05309353257-45864148538-09400667746-21110528894-17837136283-91361843504, 67292585002-85708710331-29800085937-37291514623-47320174130)] </p>\n<p>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 306, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1344100892, 4, 37923605607-42327774961-35128132820-48158088043-25957128013-51759124002-40449799093-68433809807-31405796686-22817252999, 94291235269-60160247565-39950122186-97684115599-96232437155)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 211, mergeExecResult: 0. shardingNode:map[540:{SchemaIndex=136, TableIndex=540, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-757833244, 5, 50104262688-83666007823-06989738144-95141595109-93329094811-13832991101-93076033912-05017862363-35692005246-88744289137, 54081433849-09378248558-38274752100-88855316211-27289637272)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[198:{SchemaIndex=50, TableIndex=198, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (652469446, 1, 07652454524-22981957011-41438122391-90347773905-88663504044-48425601588-32127975840-28199749965-27298300589-25715051794, 60470366939-49887579866-34848349508-29262200362-52000338086)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[670:{SchemaIndex=168, TableIndex=670, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-212205214, 3, 39093408635-10213704095-82878149257-88673860178-07278582464-52697390774-95388237318-03462450231-66036638124-64228596635, 38716722580-86486363760-61985600779-83841271441-42765235992)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 248, mergeExecResult: 0. shardingNode:map[594:{SchemaIndex=149, TableIndex=594, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1136835154, 2, 23757270379-51595389012-47476784586-71294005118-20959815636-40533304860-41036462462-22519409530-16151251756-29363403201, 02895678318-89791495824-44276206517-37575326693-35714861579)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 196, mergeExecResult: 0. shardingNode:map[596:{SchemaIndex=150, TableIndex=596, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (927250004, 3, 02232667199-83769701794-18129066725-31520472849-93375763771-42931518091-56094856485-24182688367-31807939112-07474880757, 46530309679-12705910558-69428237706-14629411089-19801742204)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 213, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1908502072, 6, 11131352749-42538464007-16895664672-62644300750-86974265339-82077852146-68660984992-78157770948-82596046151-02353070903, 35289675345-82804575493-00647347117-53443940605-48670213485)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[530:{SchemaIndex=133, TableIndex=530, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1565462034, 2, 03766551315-88042959333-06619558863-52259377137-27072539179-52210031586-63547684874-18650692849-22136096911-63673950864, 23300762166-38283070103-67223042934-76314148059-35039279078)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[705:{SchemaIndex=177, TableIndex=705, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-282929857, 9, 78018924775-94910259974-14900983402-30428448745-60064721591-40668444882-53712901782-65346911189-59688209606-74312372904, 82234943021-50353143509-80352130420-57571772487-81475633439)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 291, mergeExecResult: 0. shardingNode:map[724:{SchemaIndex=182, TableIndex=724, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (2109119188, 7, 36086413796-51767176683-52982238848-36460965892-84578503998-21697029291-39139590496-18305440259-61532992900-70589028518, 30048526034-08924322516-87289516951-51922079500-47125778015)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 210, mergeExecResult: 0. shardingNode:map[573:{SchemaIndex=144, TableIndex=573, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-994558525, 8, 74078055913-58294585862-48131723756-93089582597-72949713745-85429496032-27905841748-82110966829-12174780172-45947256767, 52598986037-80854622196-65516850169-26314282473-46184813701)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 99, mergeExecResult: 0. shardingNode:map[701:{SchemaIndex=176, TableIndex=701, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (1290611389, 10, 06010961323-54786660073-11823817491-71384866194-20002003501-13527828508-52664186690-95551041252-11585296099-86883272955, 35567244596-82663971593-11831798779-27870930145-87441039863)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 292, mergeExecResult: 0. shardingNode:map[567:{SchemaIndex=142, TableIndex=567, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (810312247, 10, 41210873160-21444867641-91122365510-19036499914-34569882163-29091701055-84873343605-60726600041-00757500001-24263691698, 41652074477-40057441865-33409084588-16838407116-03941310610)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 3, mergeExecResult: 0. shardingNode:map[213:{SchemaIndex=54, TableIndex=213, HostGroup=hostGroup1}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1881853141, 2, 14742564348-19913327041-96137703234-33860693319-12765733015-19685217285-90407570147-69715707192-71609875203-72224693707, 62398998246-64288014470-28245239723-29976129053-08238346550)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 242, mergeExecResult: 0. shardingNode:map[698:{SchemaIndex=175, TableIndex=698, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1011920570, 2, 33865708347-82274332444-45097600411-92274439334-16926356904-33828206076-16463987600-06687756787-06453656924-53622006994, 48462480629-04943720987-66250435599-66843177447-86484400166)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 195, mergeExecResult: 0. shardingNode:map[710:{SchemaIndex=178, TableIndex=710, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-2128817862, 7, 12483300987-88535524922-66334741529-64659385522-75032596868-93466219012-01222978665-55122702202-84142740410-53583589563, 89132580254-79206347601-13534456013-96027776935-07650599065)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 233, mergeExecResult: 0. shardingNode:map[544:{SchemaIndex=137, TableIndex=544, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1496016416, 9, 99154323337-90872497215-53698284897-04686362817-35622767062-48356019022-04016504226-75493501145-38429448892-66989460733, 84409926268-28404056573-96777093808-13481662538-98898905310)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[907:{SchemaIndex=227, TableIndex=907, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (756613003, 1, 48041615531-14651008388-14559884387-33045819966-91038786346-39394412181-13147015451-43265025586-90014901196-20159726596, 62496325099-63432555894-84244639858-58924561742-12138512609)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 284, mergeExecResult: 0. shardingNode:map[525:{SchemaIndex=132, TableIndex=525, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (588268045, 3, 01778869912-44391681202-43730989451-99650497628-58071023040-36244500937-05173857724-21592385062-52662008534-88410130321, 68551597952-73268487812-26478068307-11227961732-49092247276)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[674:{SchemaIndex=169, TableIndex=674, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (75111074, 1, 07857287095-83026714634-10012972058-11441297287-80787536524-31038348780-79408482259-95286783641-23620583564-94195135059, 39714908056-38058099094-71552841772-10457961132-39419941227)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 230, mergeExecResult: 0. shardingNode:map[577:{SchemaIndex=145, TableIndex=577, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-911965761, 8, 07321418565-94055920833-16462957068-14933742620-00134077423-05303377934-66121817102-49230219319-72774150061-80468601177, 26522648558-75134929821-83594530381-47917024515-31668467194)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (1315070465, 5, 15474433240-84784850443-17796367719-48021520867-10943303644-48200729918-91013947900-33061132253-28956163141-98846516045, 99644114596-46918915095-13462299586-15204837308-12785249281)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 231, mergeExecResult: 0. shardingNode:map[737:{SchemaIndex=185, TableIndex=737, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-180994785, 9, 61681162669-07252910162-88941330016-07633567093-86234290556-74605484081-92189953463-28499401861-08881094341-04206273246, 73069152681-47514577462-53755512339-63165295325-04957863379)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 225, mergeExecResult: 0. shardingNode:map[583:{SchemaIndex=146, TableIndex=583, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (905672263, 5, 11686869034-48032081508-20645314791-73241768758-13634493369-36096577158-76040275597-65556337906-73745369125-93817830861, 25154935190-35760055237-67095134841-73686707222-08327146392)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 227, mergeExecResult: 0. shardingNode:map[568:{SchemaIndex=143, TableIndex=568, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (1028081208, 6, 65787201754-47681590360-50036937953-38544197509-01589612011-17576022949-32999165698-83171817746-37315560344-14463882405, 65637926145-34138639858-41094177281-29428779399-44688752051)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 232, mergeExecResult: 0. shardingNode:map[558:{SchemaIndex=140, TableIndex=558, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (278584878, 10, 32358945918-66413584434-88058020708-48390261093-67208582401-88568979078-90497400157-49426845556-80952580018-13610087462, 14198786100-85805610838-89824761297-62058901344-60492560838)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 228, mergeExecResult: 0. shardingNode:map[649:{SchemaIndex=163, TableIndex=649, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (1183431305, 2, 43858458237-46788126262-05213368147-07302202409-13593899883-99375055319-42875375550-56499216168-01796902390-08647652700, 48205424174-34611724289-69246697079-03898745311-99595319598)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 26, mergeExecResult: 0. shardingNode:map[1002:{SchemaIndex=251, TableIndex=1002, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1701967850, 9, 59147040383-79705593723-62886101805-60535881029-18413556495-06238443919-02766097021-38361379870-67179305438-52530038201, 14770296700-13396847549-83905253251-99337969432-58669912709)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 229, mergeExecResult: 0. shardingNode:map[745:{SchemaIndex=187, TableIndex=745, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-1169184489, 7, 64955629118-36147506634-51676575477-92147977264-45999410094-15567300060-12836575112-28470342888-04361926080-90629622527, 86593300354-87140619605-87718697448-88392415837-04795141111)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 272, mergeExecResult: 0. shardingNode:map[662:{SchemaIndex=166, TableIndex=662, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (1555424918, 10, 11260581771-57660361810-58723152189-43635886031-41094065361-37903459575-65856768363-01843670891-17848285384-92171598763, 36462031678-64770373669-77316073133-32672501580-50753545368)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 271, mergeExecResult: 0. shardingNode:map[736:{SchemaIndex=185, TableIndex=736, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-270642912, 9, 87806093665-04774113218-83983577041-09351362099-88339377062-22401969710-89370302094-61598971830-04573362584-60421137580, 26415700902-09148763904-87375314444-00285784497-80449574080)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 222, mergeExecResult: 0. shardingNode:map[588:{SchemaIndex=148, TableIndex=588, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (-1608970828, 2, 75571666926-33738024136-84313793696-10714487345-57088294174-41711334397-51382524640-08327299973-66970622008-15344703881, 73366501022-14368954292-21130701303-33960859630-28160972955)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[556:{SchemaIndex=140, TableIndex=556, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-993863212, 3, 68136313990-05892185009-94544559127-32267303237-37763842514-89959134082-97215598641-72307869276-49642816905-24994127953, 97111382859-69888150629-89398585714-99569889618-30099083026)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 220, mergeExecResult: 0. shardingNode:map[513:{SchemaIndex=129, TableIndex=513, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1299240449, 6, 13580427730-91599560017-42392676834-62860979245-65274043134-68243135520-42672727926-56794775679-69217526806-27227304772, 15736027942-38175115801-93773367279-77944721463-03173899187)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 214, mergeExecResult: 0. shardingNode:map[579:{SchemaIndex=145, TableIndex=579, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1346301507, 2, 95777728263-97322915970-24025444526-11872987788-74589515383-37108287704-62890589663-84327075019-58161194629-66166453693, 43925335448-41493749427-45817169562-78879091928-39249185154)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 252, mergeExecResult: 0. shardingNode:map[723:{SchemaIndex=181, TableIndex=723, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest3 (id, k, c, pad) VALUES (-1604556499, 3, 54964824319-34611710514-15902154995-18014105243-70193115677-91112406449-61348366967-41301887681-73892593737-54039590822, 26491514771-24473569991-16656607124-07593925149-74926670900)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 253, mergeExecResult: 0. shardingNode:map[715:{SchemaIndex=179, TableIndex=715, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (533688011, 7, 17872695538-16064539790-18108982113-60646269894-74784931403-89606878485-67937667670-39824753762-37339034055-79511964331, 65227853620-62393117281-88901273019-02060144110-40123779052)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 223, mergeExecResult: 0. shardingNode:map[731:{SchemaIndex=183, TableIndex=731, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (548553435, 7, 59524856205-92318067592-84001816236-15799238765-61939312958-49774297702-51059777347-11521186806-90725070157-29567571966, 72604893873-81336794708-64989781571-89144801847-53529920629)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[646:{SchemaIndex=162, TableIndex=646, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest4 (id, k, c, pad) VALUES (-1980507782, 8, 15361099362-33426846104-81568076007-88926275697-54147190617-21941361738-39219198670-72817831326-95768248501-29228997291, 51713925651-55077435995-56372978084-60334222441-07023013203)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 27, mergeExecResult: 0. shardingNode:map[1023:{SchemaIndex=256, TableIndex=1023, HostGroup=hostGroup4}], SQL: [INSERT INTO sbtest1 (id, k, c, pad) VALUES (419830783, 9, 39839456224-14625126106-10611694673-69035645226-20746732552-01963419766-94676550107-32542648198-96549393904-39850608367, 69725922822-08559910362-36080928509-49601235010-15261238716)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 296, mergeExecResult: 0. shardingNode:map[612:{SchemaIndex=154, TableIndex=612, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest2 (id, k, c, pad) VALUES (-1848104548, 6, 02931425025-68282480940-67294056291-41225608697-44038095895-05390291535-10414730978-25086630856-84460614365-62218384416, 74426157735-27538600335-93122572838-36921241106-44481214039)]<br>WARN[0292] Slow SQL. shardingCount: 1, buildPlan: 0, getShardConns: 0, executeInMultiNodes: 305, mergeExecResult: 0. shardingNode:map[517:{SchemaIndex=130, TableIndex=517, HostGroup=hostGroup3}], SQL: [INSERT INTO sbtest5 (id, k, c, pad) VALUES (-543662597,</p>\n<p>cobar:<br>sysbench mysql-host=10.1.21.242 mysql-port=8066 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup<br>sysbench mysql-host=10.1.21.242 mysql-port=8066 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare<br>sysbench mysql-host=10.1.21.242 mysql-port=8066 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run</p>\n<p>zero-proxy<br>sysbench mysql-host=10.1.21.242 mysql-port=9696 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua cleanup<br>sysbench mysql-host=10.1.21.242 mysql-port=9696 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=10 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua prepare<br>sysbench mysql-host=10.1.21.242 mysql-port=9696 mysql-user=zerodb mysql-password=zerodb mysql-db=zerodb threads=400 table-size=10 auto_inc=off tables=5 rand-type=uniform db-driver=mysql time=6000000 events=0 percentile=99 report-interval=5 /usr/share/sysbench/oltp_insert.lua run</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb  oltp-tables-count=5 prepare</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb  oltp-tables-count=5 cleanup</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=128 read-threads=8 max-time=3600 random</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=128 read-threads=8 max-time=3600 seq</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=4 read-threads=300 update-threads=20 delete-threads=10 max-time=360000000 random</p>\n<p>./benchyou mysql-host=10.1.21.242 mysql-port=9696 mysql-db=zerodb mysql-user=zerodb mysql-password=zerodb ssh-user=root ssh-password=sdfsdf oltp-tables-count=5 write-threads=400 read-threads=400 max-time=3600 random</p>\n"},{"title":"CobarReactor","date":"2017-07-24T10:00:58.000Z","_content":"\n### I/Omultiplexing demultiplexing\n\n:\n\n53000\n\n\n\n1. ABCDsocket\n\n2. 300055 \n\n3. 1005CDG10CDGEAEA \n\nIOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor\n\n100\n\nmultiplexing\ndemultiplexing\n\n### Cobar Reactor\n\n![](Cobar-Reactor-design-pattern/CobarReactorSign.gif)\n\n#### NIOAPI\n\n![](Cobar-Reactor-design-pattern/NioRegister.gif)\n\n#### Cobar NIO Server\n\n![](Cobar-Reactor-design-pattern/CobarReactor.gif)\n\n#### Cobar Fork/Join\nForks and Joins: When a job arrives at a fork point, it is split into N sub-jobs which are then serviced by n tasks. After being serviced, each sub-job waits until all other sub-jobs are done processing. Then, they are joined again and leave the system. Thus, in parallel programming, we require synchronization as all the parallel processes wait for several other processes to occur.\n\n\n### reactorproactor\n\nreactor\nproactor: \n\nRefer:\nhttp://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\n\n","source":"_posts/Cobar-Reactor-design-pattern.md","raw":"---\ntitle: CobarReactor\ndate: 2017-07-24 18:00:58\ntags: Cobar\n---\n\n### I/Omultiplexing demultiplexing\n\n:\n\n53000\n\n\n\n1. ABCDsocket\n\n2. 300055 \n\n3. 1005CDG10CDGEAEA \n\nIOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor\n\n100\n\nmultiplexing\ndemultiplexing\n\n### Cobar Reactor\n\n![](Cobar-Reactor-design-pattern/CobarReactorSign.gif)\n\n#### NIOAPI\n\n![](Cobar-Reactor-design-pattern/NioRegister.gif)\n\n#### Cobar NIO Server\n\n![](Cobar-Reactor-design-pattern/CobarReactor.gif)\n\n#### Cobar Fork/Join\nForks and Joins: When a job arrives at a fork point, it is split into N sub-jobs which are then serviced by n tasks. After being serviced, each sub-job waits until all other sub-jobs are done processing. Then, they are joined again and leave the system. Thus, in parallel programming, we require synchronization as all the parallel processes wait for several other processes to occur.\n\n\n### reactorproactor\n\nreactor\nproactor: \n\nRefer:\nhttp://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\n\n","slug":"Cobar-Reactor-design-pattern","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyb000m3iq28hisx8ou","content":"<h3 id=\"I-Omultiplexing-demultiplexing\"><a href=\"#I-Omultiplexing-demultiplexing\" class=\"headerlink\" title=\"I/Omultiplexing demultiplexing\"></a>I/Omultiplexing demultiplexing</h3><p>:</p>\n<p>53000</p>\n<p></p>\n<ol>\n<li><p>ABCDsocket</p>\n</li>\n<li><p>300055 </p>\n</li>\n<li><p>1005CDG10CDGEAEA </p>\n</li>\n</ol>\n<p>IOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor</p>\n<p>100</p>\n<p>multiplexing<br>demultiplexing</p>\n<h3 id=\"Cobar-Reactor\"><a href=\"#Cobar-Reactor\" class=\"headerlink\" title=\"Cobar Reactor\"></a>Cobar Reactor</h3><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactorSign.gif\" alt=\"\"></p>\n<h4 id=\"NIOAPI\"><a href=\"#NIOAPI\" class=\"headerlink\" title=\"NIOAPI\"></a>NIOAPI</h4><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/NioRegister.gif\" alt=\"\"></p>\n<h4 id=\"Cobar-NIO-Server\"><a href=\"#Cobar-NIO-Server\" class=\"headerlink\" title=\"Cobar NIO Server\"></a>Cobar NIO Server</h4><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactor.gif\" alt=\"\"></p>\n<h4 id=\"Cobar-Fork-Join\"><a href=\"#Cobar-Fork-Join\" class=\"headerlink\" title=\"Cobar Fork/Join\"></a>Cobar Fork/Join</h4><p>Forks and Joins: When a job arrives at a fork point, it is split into N sub-jobs which are then serviced by n tasks. After being serviced, each sub-job waits until all other sub-jobs are done processing. Then, they are joined again and leave the system. Thus, in parallel programming, we require synchronization as all the parallel processes wait for several other processes to occur.</p>\n<h3 id=\"reactorproactor\"><a href=\"#reactorproactor\" class=\"headerlink\" title=\"reactorproactor\"></a>reactorproactor</h3><p>reactor<br>proactor: </p>\n<p>Refer:<br><a href=\"http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\" target=\"_blank\" rel=\"external\">http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"I-Omultiplexing-demultiplexing\"><a href=\"#I-Omultiplexing-demultiplexing\" class=\"headerlink\" title=\"I/Omultiplexing demultiplexing\"></a>I/Omultiplexing demultiplexing</h3><p>:</p>\n<p>53000</p>\n<p></p>\n<ol>\n<li><p>ABCDsocket</p>\n</li>\n<li><p>300055 </p>\n</li>\n<li><p>1005CDG10CDGEAEA </p>\n</li>\n</ol>\n<p>IOLinuxselectpollepollsocketfdepollepollsocketsocketselectpollepollreactor</p>\n<p>100</p>\n<p>multiplexing<br>demultiplexing</p>\n<h3 id=\"Cobar-Reactor\"><a href=\"#Cobar-Reactor\" class=\"headerlink\" title=\"Cobar Reactor\"></a>Cobar Reactor</h3><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactorSign.gif\" alt=\"\"></p>\n<h4 id=\"NIOAPI\"><a href=\"#NIOAPI\" class=\"headerlink\" title=\"NIOAPI\"></a>NIOAPI</h4><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/NioRegister.gif\" alt=\"\"></p>\n<h4 id=\"Cobar-NIO-Server\"><a href=\"#Cobar-NIO-Server\" class=\"headerlink\" title=\"Cobar NIO Server\"></a>Cobar NIO Server</h4><p><img src=\"/2017/07/24/Cobar-Reactor-design-pattern/CobarReactor.gif\" alt=\"\"></p>\n<h4 id=\"Cobar-Fork-Join\"><a href=\"#Cobar-Fork-Join\" class=\"headerlink\" title=\"Cobar Fork/Join\"></a>Cobar Fork/Join</h4><p>Forks and Joins: When a job arrives at a fork point, it is split into N sub-jobs which are then serviced by n tasks. After being serviced, each sub-job waits until all other sub-jobs are done processing. Then, they are joined again and leave the system. Thus, in parallel programming, we require synchronization as all the parallel processes wait for several other processes to occur.</p>\n<h3 id=\"reactorproactor\"><a href=\"#reactorproactor\" class=\"headerlink\" title=\"reactorproactor\"></a>reactorproactor</h3><p>reactor<br>proactor: </p>\n<p>Refer:<br><a href=\"http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\" target=\"_blank\" rel=\"external\">http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf</a></p>\n"},{"title":"curator","date":"2017-09-28T08:58:05.000Z","_content":"\n\n### MySQL\n\n\n### Redis\n\nhttp://blog.csdn.net/bolg_hero/article/details/78532920\n\n### ZooKeeper\n RedLock\n\n\n``` java\npublic class InterProcessMutexTest {\n    public static final String LOCK_PATH = \"/curator-kick-off/lock\";\n    private static CuratorFramework client;\n\n    @BeforeClass\n    public static void before() {\n        client = CuratorFrameworkFactory.newClient(\n                \"127.0.0.1:2181\",\n                1000 * 10,\n                3000, new ExponentialBackoffRetry(\n                        1000,\n                        3));\n        client.start();\n    }\n\n    @Test\n    public void test() throws Exception {\n        InterProcessMutex lock = new InterProcessMutex(client, LOCK_PATH);\n        boolean acquire = lock.acquire(5, TimeUnit.SECONDS);\n        System.out.println(acquire);\n        System.out.println(\"done\");\n        lock.release();\n        System.in.read();\n    }\n}\n```\n","source":"_posts/Curator-Distributed-lock.md","raw":"---\ntitle: curator\ndate: 2017-09-28 16:58:05\ntags: Curator\n---\n\n\n### MySQL\n\n\n### Redis\n\nhttp://blog.csdn.net/bolg_hero/article/details/78532920\n\n### ZooKeeper\n RedLock\n\n\n``` java\npublic class InterProcessMutexTest {\n    public static final String LOCK_PATH = \"/curator-kick-off/lock\";\n    private static CuratorFramework client;\n\n    @BeforeClass\n    public static void before() {\n        client = CuratorFrameworkFactory.newClient(\n                \"127.0.0.1:2181\",\n                1000 * 10,\n                3000, new ExponentialBackoffRetry(\n                        1000,\n                        3));\n        client.start();\n    }\n\n    @Test\n    public void test() throws Exception {\n        InterProcessMutex lock = new InterProcessMutex(client, LOCK_PATH);\n        boolean acquire = lock.acquire(5, TimeUnit.SECONDS);\n        System.out.println(acquire);\n        System.out.println(\"done\");\n        lock.release();\n        System.in.read();\n    }\n}\n```\n","slug":"Curator-Distributed-lock","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyc000o3iq2moo800ti","content":"<h3 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h3><h3 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h3><p><a href=\"http://blog.csdn.net/bolg_hero/article/details/78532920\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/bolg_hero/article/details/78532920</a></p>\n<h3 id=\"ZooKeeper\"><a href=\"#ZooKeeper\" class=\"headerlink\" title=\"ZooKeeper\"></a>ZooKeeper</h3><p> RedLock</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InterProcessMutexTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LOCK_PATH = <span class=\"string\">\"/curator-kick-off/lock\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CuratorFramework client;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@BeforeClass</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        client = CuratorFrameworkFactory.newClient(</div><div class=\"line\">                <span class=\"string\">\"127.0.0.1:2181\"</span>,</div><div class=\"line\">                <span class=\"number\">1000</span> * <span class=\"number\">10</span>,</div><div class=\"line\">                <span class=\"number\">3000</span>, <span class=\"keyword\">new</span> ExponentialBackoffRetry(</div><div class=\"line\">                        <span class=\"number\">1000</span>,</div><div class=\"line\">                        <span class=\"number\">3</span>));</div><div class=\"line\">        client.start();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        InterProcessMutex lock = <span class=\"keyword\">new</span> InterProcessMutex(client, LOCK_PATH);</div><div class=\"line\">        <span class=\"keyword\">boolean</span> acquire = lock.acquire(<span class=\"number\">5</span>, TimeUnit.SECONDS);</div><div class=\"line\">        System.out.println(acquire);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"done\"</span>);</div><div class=\"line\">        lock.release();</div><div class=\"line\">        System.in.read();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h3><h3 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h3><p><a href=\"http://blog.csdn.net/bolg_hero/article/details/78532920\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/bolg_hero/article/details/78532920</a></p>\n<h3 id=\"ZooKeeper\"><a href=\"#ZooKeeper\" class=\"headerlink\" title=\"ZooKeeper\"></a>ZooKeeper</h3><p> RedLock</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InterProcessMutexTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LOCK_PATH = <span class=\"string\">\"/curator-kick-off/lock\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CuratorFramework client;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@BeforeClass</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        client = CuratorFrameworkFactory.newClient(</div><div class=\"line\">                <span class=\"string\">\"127.0.0.1:2181\"</span>,</div><div class=\"line\">                <span class=\"number\">1000</span> * <span class=\"number\">10</span>,</div><div class=\"line\">                <span class=\"number\">3000</span>, <span class=\"keyword\">new</span> ExponentialBackoffRetry(</div><div class=\"line\">                        <span class=\"number\">1000</span>,</div><div class=\"line\">                        <span class=\"number\">3</span>));</div><div class=\"line\">        client.start();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        InterProcessMutex lock = <span class=\"keyword\">new</span> InterProcessMutex(client, LOCK_PATH);</div><div class=\"line\">        <span class=\"keyword\">boolean</span> acquire = lock.acquire(<span class=\"number\">5</span>, TimeUnit.SECONDS);</div><div class=\"line\">        System.out.println(acquire);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"done\"</span>);</div><div class=\"line\">        lock.release();</div><div class=\"line\">        System.in.read();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"},{"title":"Distributed-Consensus-Raft","date":"2017-11-15T03:41:21.000Z","_content":"\nhttps://zhuanlan.zhihu.com/p/27910576\nhttp://thesecretlivesofdata.com/raft/\n\n### \n\n### \n\n### ","source":"_posts/Distributed-Consensus-Raft.md","raw":"---\ntitle: Distributed-Consensus-Raft\ndate: 2017-11-15 11:41:21\ntags: Raft\n---\n\nhttps://zhuanlan.zhihu.com/p/27910576\nhttp://thesecretlivesofdata.com/raft/\n\n### \n\n### \n\n### ","slug":"Distributed-Consensus-Raft","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyd000q3iq2b0608ezy","content":"<p><a href=\"https://zhuanlan.zhihu.com/p/27910576\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/p/27910576</a><br><a href=\"http://thesecretlivesofdata.com/raft/\" target=\"_blank\" rel=\"external\">http://thesecretlivesofdata.com/raft/</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://zhuanlan.zhihu.com/p/27910576\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/p/27910576</a><br><a href=\"http://thesecretlivesofdata.com/raft/\" target=\"_blank\" rel=\"external\">http://thesecretlivesofdata.com/raft/</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"Curator-sync-and-mutual-exclusion-between-thread-and-process","date":"2017-10-28T02:46:49.000Z","_content":"\n### Lock\n\n#### read write lock\n\n#### spin lock\n\n#### reentrant lock\n\n### Barrier\n\n### Semaphore\n\n###","source":"_posts/Curator-sync-and-mutual-exclusion-between-thread-and-process.md","raw":"---\ntitle: Curator-sync-and-mutual-exclusion-between-thread-and-process\ndate: 2017-10-28 10:46:49\ntags: Curator\n---\n\n### Lock\n\n#### read write lock\n\n#### spin lock\n\n#### reentrant lock\n\n### Barrier\n\n### Semaphore\n\n###","slug":"Curator-sync-and-mutual-exclusion-between-thread-and-process","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsye000t3iq2wdmff3j6","content":"<h3 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h3><h4 id=\"read-write-lock\"><a href=\"#read-write-lock\" class=\"headerlink\" title=\"read write lock\"></a>read write lock</h4><h4 id=\"spin-lock\"><a href=\"#spin-lock\" class=\"headerlink\" title=\"spin lock\"></a>spin lock</h4><h4 id=\"reentrant-lock\"><a href=\"#reentrant-lock\" class=\"headerlink\" title=\"reentrant lock\"></a>reentrant lock</h4><h3 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h3><h3 id=\"Semaphore\"><a href=\"#Semaphore\" class=\"headerlink\" title=\"Semaphore\"></a>Semaphore</h3><p>###</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h3><h4 id=\"read-write-lock\"><a href=\"#read-write-lock\" class=\"headerlink\" title=\"read write lock\"></a>read write lock</h4><h4 id=\"spin-lock\"><a href=\"#spin-lock\" class=\"headerlink\" title=\"spin lock\"></a>spin lock</h4><h4 id=\"reentrant-lock\"><a href=\"#reentrant-lock\" class=\"headerlink\" title=\"reentrant lock\"></a>reentrant lock</h4><h3 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h3><h3 id=\"Semaphore\"><a href=\"#Semaphore\" class=\"headerlink\" title=\"Semaphore\"></a>Semaphore</h3><p>###</p>\n"},{"title":"Distributed-Transaction-TCC","date":"2017-11-10T11:03:55.000Z","_content":"\n### TCC\n\n### \n\nhttps://github.com/1991wangliang/tx-lcn","source":"_posts/Distributed-Transaction-TCC.md","raw":"---\ntitle: Distributed-Transaction-TCC\ndate: 2017-11-10 19:03:55\ntags: \n---\n\n### TCC\n\n### \n\nhttps://github.com/1991wangliang/tx-lcn","slug":"Distributed-Transaction-TCC","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyf000v3iq2br47vxag","content":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://github.com/1991wangliang/tx-lcn\" target=\"_blank\" rel=\"external\">https://github.com/1991wangliang/tx-lcn</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://github.com/1991wangliang/tx-lcn\" target=\"_blank\" rel=\"external\">https://github.com/1991wangliang/tx-lcn</a></p>\n"},{"title":"ID","date":"2017-11-08T06:39:03.000Z","_content":"\n\n``` java\n/**\n * Twitter_Snowflake<br>\n * SnowFlake(-):<br>\n * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 <br>\n * 1longJava01id0<br>\n * 41()41 - )\n * idIdWorkerstartTime4169T = (1L << 41) / (1000L * 60 * 60 * 24 * 365) = 69<br>\n * 1010245datacenterId5workerId<br>\n * 1212()4096ID<br>\n * 64Long<br>\n * SnowFlakeID(IDID)SnowFlake26ID\n */\npublic class SnowflakeIdWorker {\n\n    // ==============================Fields===========================================\n    /**  (2015-01-01) */\n    private final long twepoch = 1420041600000L;\n\n    /** id */\n    private final long workerIdBits = 5L;\n\n    /** id */\n    private final long datacenterIdBits = 5L;\n\n    /** id31 () */\n    private final long maxWorkerId = -1L ^ (-1L << workerIdBits);\n\n    /** id31 */\n    private final long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);\n\n    /** id */\n    private final long sequenceBits = 12L;\n\n    /** ID12 */\n    private final long workerIdShift = sequenceBits;\n\n    /** id17(12+5) */\n    private final long datacenterIdShift = sequenceBits + workerIdBits;\n\n    /** 22(5+5+12) */\n    private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n\n    /** 4095 (0b111111111111=0xfff=4095) */\n    private final long sequenceMask = -1L ^ (-1L << sequenceBits);\n\n    /** ID(0~31) */\n    private long workerId;\n\n    /** ID(0~31) */\n    private long datacenterId;\n\n    /** (0~4095) */\n    private long sequence = 0L;\n\n    /** ID */\n    private long lastTimestamp = -1L;\n\n    //==============================Constructors=====================================\n    /**\n     * \n     * @param workerId ID (0~31)\n     * @param datacenterId ID (0~31)\n     */\n    public SnowflakeIdWorker(long workerId, long datacenterId) {\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId));\n        }\n        if (datacenterId > maxDatacenterId || datacenterId < 0) {\n            throw new IllegalArgumentException(String.format(\"datacenter Id can't be greater than %d or less than 0\", maxDatacenterId));\n        }\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n    }\n\n    // ==============================Methods==========================================\n    /**\n     * ID ()\n     * @return SnowflakeId\n     */\n    public synchronized long nextId() {\n        long timestamp = timeGen();\n\n        //ID\n        if (timestamp < lastTimestamp) {\n            throw new RuntimeException(\n                    String.format(\"Clock moved backwards.  Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp));\n        }\n\n        //\n        if (lastTimestamp == timestamp) {\n            sequence = (sequence + 1) & sequenceMask;\n            //\n            if (sequence == 0) {\n                //,\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        }\n        //\n        else {\n            sequence = 0L;\n        }\n\n        //ID\n        lastTimestamp = timestamp;\n\n        //64ID\n        return ((timestamp - twepoch) << timestampLeftShift) //\n                | (datacenterId << datacenterIdShift) //\n                | (workerId << workerIdShift) //\n                | sequence;\n    }\n\n    /**\n     * \n     * @param lastTimestamp ID\n     * @return \n     */\n    protected long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp <= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    /**\n     * \n     * @return ()\n     */\n    protected long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //==============================Test=============================================\n    /**  */\n    public static void main(String[] args) {\n        SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0);\n        for (int i = 0; i < 1000; i++) {\n            long id = idWorker.nextId();\n            System.out.println(Long.toBinaryString(id));\n            System.out.println(id);\n        }\n    }\n}\n```\n\n### baidu uid-generator\n\nhttps://github.com/baidu/uid-generator\n\n### \n","source":"_posts/Distributed-Unique-id.md","raw":"---\ntitle: ID\ndate: 2017-11-08 14:39:03\ntags: \n---\n\n\n``` java\n/**\n * Twitter_Snowflake<br>\n * SnowFlake(-):<br>\n * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 <br>\n * 1longJava01id0<br>\n * 41()41 - )\n * idIdWorkerstartTime4169T = (1L << 41) / (1000L * 60 * 60 * 24 * 365) = 69<br>\n * 1010245datacenterId5workerId<br>\n * 1212()4096ID<br>\n * 64Long<br>\n * SnowFlakeID(IDID)SnowFlake26ID\n */\npublic class SnowflakeIdWorker {\n\n    // ==============================Fields===========================================\n    /**  (2015-01-01) */\n    private final long twepoch = 1420041600000L;\n\n    /** id */\n    private final long workerIdBits = 5L;\n\n    /** id */\n    private final long datacenterIdBits = 5L;\n\n    /** id31 () */\n    private final long maxWorkerId = -1L ^ (-1L << workerIdBits);\n\n    /** id31 */\n    private final long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);\n\n    /** id */\n    private final long sequenceBits = 12L;\n\n    /** ID12 */\n    private final long workerIdShift = sequenceBits;\n\n    /** id17(12+5) */\n    private final long datacenterIdShift = sequenceBits + workerIdBits;\n\n    /** 22(5+5+12) */\n    private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n\n    /** 4095 (0b111111111111=0xfff=4095) */\n    private final long sequenceMask = -1L ^ (-1L << sequenceBits);\n\n    /** ID(0~31) */\n    private long workerId;\n\n    /** ID(0~31) */\n    private long datacenterId;\n\n    /** (0~4095) */\n    private long sequence = 0L;\n\n    /** ID */\n    private long lastTimestamp = -1L;\n\n    //==============================Constructors=====================================\n    /**\n     * \n     * @param workerId ID (0~31)\n     * @param datacenterId ID (0~31)\n     */\n    public SnowflakeIdWorker(long workerId, long datacenterId) {\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId));\n        }\n        if (datacenterId > maxDatacenterId || datacenterId < 0) {\n            throw new IllegalArgumentException(String.format(\"datacenter Id can't be greater than %d or less than 0\", maxDatacenterId));\n        }\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n    }\n\n    // ==============================Methods==========================================\n    /**\n     * ID ()\n     * @return SnowflakeId\n     */\n    public synchronized long nextId() {\n        long timestamp = timeGen();\n\n        //ID\n        if (timestamp < lastTimestamp) {\n            throw new RuntimeException(\n                    String.format(\"Clock moved backwards.  Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp));\n        }\n\n        //\n        if (lastTimestamp == timestamp) {\n            sequence = (sequence + 1) & sequenceMask;\n            //\n            if (sequence == 0) {\n                //,\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        }\n        //\n        else {\n            sequence = 0L;\n        }\n\n        //ID\n        lastTimestamp = timestamp;\n\n        //64ID\n        return ((timestamp - twepoch) << timestampLeftShift) //\n                | (datacenterId << datacenterIdShift) //\n                | (workerId << workerIdShift) //\n                | sequence;\n    }\n\n    /**\n     * \n     * @param lastTimestamp ID\n     * @return \n     */\n    protected long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp <= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    /**\n     * \n     * @return ()\n     */\n    protected long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //==============================Test=============================================\n    /**  */\n    public static void main(String[] args) {\n        SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0);\n        for (int i = 0; i < 1000; i++) {\n            long id = idWorker.nextId();\n            System.out.println(Long.toBinaryString(id));\n            System.out.println(id);\n        }\n    }\n}\n```\n\n### baidu uid-generator\n\nhttps://github.com/baidu/uid-generator\n\n### \n","slug":"Distributed-Unique-id","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyg000x3iq2dj9yykcq","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Twitter_Snowflake&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlake(-):&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1longJava01id0&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 41()41 - )</span></div><div class=\"line\"><span class=\"comment\"> * idIdWorkerstartTime4169T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1010245datacenterId5workerId&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1212()4096ID&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 64Long&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlakeID(IDID)SnowFlake26ID</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeIdWorker</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Fields===========================================</span></div><div class=\"line\">    <span class=\"comment\">/**  (2015-01-01) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> twepoch = <span class=\"number\">1420041600000L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 () */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxWorkerId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; workerIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxDatacenterId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; datacenterIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceBits = <span class=\"number\">12L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID12 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdShift = sequenceBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id17(12+5) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdShift = sequenceBits + workerIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 22(5+5+12) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 4095 (0b111111111111=0xfff=4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceMask = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; sequenceBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> datacenterId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** (0~4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Constructors=====================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> datacenterId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowflakeIdWorker</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> datacenterId)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"worker Id can't be greater than %d or less than 0\"</span>, maxWorkerId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"datacenter Id can't be greater than %d or less than 0\"</span>, maxDatacenterId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">this</span>.workerId = workerId;</div><div class=\"line\">        <span class=\"keyword\">this</span>.datacenterId = datacenterId;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Methods==========================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * ID ()</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (timestamp &lt; lastTimestamp) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</div><div class=\"line\">                    String.format(<span class=\"string\">\"Clock moved backwards.  Refusing to generate id for %d milliseconds\"</span>, lastTimestamp - timestamp));</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (lastTimestamp == timestamp) &#123;</div><div class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</div><div class=\"line\">            <span class=\"comment\">//</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">//,</span></div><div class=\"line\">                timestamp = tilNextMillis(lastTimestamp);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            sequence = <span class=\"number\">0L</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        lastTimestamp = timestamp;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//64ID</span></div><div class=\"line\">        <span class=\"keyword\">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (datacenterId &lt;&lt; datacenterIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (workerId &lt;&lt; workerIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | sequence;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp ID</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</div><div class=\"line\">            timestamp = timeGen();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> timestamp;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ()</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">timeGen</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Test=============================================</span></div><div class=\"line\">    <span class=\"comment\">/**  */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        SnowflakeIdWorker idWorker = <span class=\"keyword\">new</span> SnowflakeIdWorker(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> id = idWorker.nextId();</div><div class=\"line\">            System.out.println(Long.toBinaryString(id));</div><div class=\"line\">            System.out.println(id);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"baidu-uid-generator\"><a href=\"#baidu-uid-generator\" class=\"headerlink\" title=\"baidu uid-generator\"></a>baidu uid-generator</h3><p><a href=\"https://github.com/baidu/uid-generator\" target=\"_blank\" rel=\"external\">https://github.com/baidu/uid-generator</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Twitter_Snowflake&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlake(-):&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1longJava01id0&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 41()41 - )</span></div><div class=\"line\"><span class=\"comment\"> * idIdWorkerstartTime4169T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1010245datacenterId5workerId&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 1212()4096ID&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * 64Long&lt;br&gt;</span></div><div class=\"line\"><span class=\"comment\"> * SnowFlakeID(IDID)SnowFlake26ID</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeIdWorker</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Fields===========================================</span></div><div class=\"line\">    <span class=\"comment\">/**  (2015-01-01) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> twepoch = <span class=\"number\">1420041600000L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdBits = <span class=\"number\">5L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 () */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxWorkerId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; workerIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id31 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxDatacenterId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; datacenterIdBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceBits = <span class=\"number\">12L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID12 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdShift = sequenceBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** id17(12+5) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdShift = sequenceBits + workerIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 22(5+5+12) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 4095 (0b111111111111=0xfff=4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceMask = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; sequenceBits);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID(0~31) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> datacenterId;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** (0~4095) */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** ID */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Constructors=====================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> datacenterId ID (0~31)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowflakeIdWorker</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> datacenterId)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"worker Id can't be greater than %d or less than 0\"</span>, maxWorkerId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"datacenter Id can't be greater than %d or less than 0\"</span>, maxDatacenterId));</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">this</span>.workerId = workerId;</div><div class=\"line\">        <span class=\"keyword\">this</span>.datacenterId = datacenterId;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// ==============================Methods==========================================</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * ID ()</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (timestamp &lt; lastTimestamp) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</div><div class=\"line\">                    String.format(<span class=\"string\">\"Clock moved backwards.  Refusing to generate id for %d milliseconds\"</span>, lastTimestamp - timestamp));</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (lastTimestamp == timestamp) &#123;</div><div class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</div><div class=\"line\">            <span class=\"comment\">//</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">//,</span></div><div class=\"line\">                timestamp = tilNextMillis(lastTimestamp);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//</span></div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            sequence = <span class=\"number\">0L</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//ID</span></div><div class=\"line\">        lastTimestamp = timestamp;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//64ID</span></div><div class=\"line\">        <span class=\"keyword\">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (datacenterId &lt;&lt; datacenterIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | (workerId &lt;&lt; workerIdShift) <span class=\"comment\">//</span></div><div class=\"line\">                | sequence;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp ID</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> timestamp = timeGen();</div><div class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</div><div class=\"line\">            timestamp = timeGen();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> timestamp;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ()</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">timeGen</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//==============================Test=============================================</span></div><div class=\"line\">    <span class=\"comment\">/**  */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        SnowflakeIdWorker idWorker = <span class=\"keyword\">new</span> SnowflakeIdWorker(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> id = idWorker.nextId();</div><div class=\"line\">            System.out.println(Long.toBinaryString(id));</div><div class=\"line\">            System.out.println(id);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"baidu-uid-generator\"><a href=\"#baidu-uid-generator\" class=\"headerlink\" title=\"baidu uid-generator\"></a>baidu uid-generator</h3><p><a href=\"https://github.com/baidu/uid-generator\" target=\"_blank\" rel=\"external\">https://github.com/baidu/uid-generator</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"Distributed-Transaction","date":"2017-11-03T02:54:48.000Z","_content":"\n### TCC\n\n### RocketMQ\n![](Distributed-Transaction/transaction_rocketmq.gif)\n\n### \nMQHalfMsgSOA\n\nhttps://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&mid=2247483713&idx=1&sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&mpshare=1&scene=1&srcid=1110kSXANwBrbL2TWtA0NAK6&key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&ascene=0&uin=MjcyMjMxNTA0Mg%3D%3D&devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&version=12010210&nettype=WIFI&fontScale=100&pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\n\n### Spring Cloud\nhttp://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\nhttps://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\n\n\nhttps://github.com/beston123/Tarzan","source":"_posts/Distributed-Transaction.md","raw":"---\ntitle: Distributed-Transaction\ndate: 2017-11-03 10:54:48\ntags: \n---\n\n### TCC\n\n### RocketMQ\n![](Distributed-Transaction/transaction_rocketmq.gif)\n\n### \nMQHalfMsgSOA\n\nhttps://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&mid=2247483713&idx=1&sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&mpshare=1&scene=1&srcid=1110kSXANwBrbL2TWtA0NAK6&key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&ascene=0&uin=MjcyMjMxNTA0Mg%3D%3D&devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&version=12010210&nettype=WIFI&fontScale=100&pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\n\n### Spring Cloud\nhttp://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\nhttps://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\n\n\nhttps://github.com/beston123/Tarzan","slug":"Distributed-Transaction","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyp00103iq2ucqi5ypu","content":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p><img src=\"/2017/11/03/Distributed-Transaction/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>MQHalfMsgSOA</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\" target=\"_blank\" rel=\"external\">https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8</a></p>\n<h3 id=\"Spring-Cloud\"><a href=\"#Spring-Cloud\" class=\"headerlink\" title=\"Spring Cloud\"></a>Spring Cloud</h3><p><a href=\"http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search</a><br><a href=\"https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\" target=\"_blank\" rel=\"external\">https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC</a></p>\n<p><a href=\"https://github.com/beston123/Tarzan\" target=\"_blank\" rel=\"external\">https://github.com/beston123/Tarzan</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p><img src=\"/2017/11/03/Distributed-Transaction/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>MQHalfMsgSOA</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8\" target=\"_blank\" rel=\"external\">https://mp.weixin.qq.com/s?__biz=MzU4MTEyODIzMg==&amp;mid=2247483713&amp;idx=1&amp;sn=c9efdd6eda9d7bd32f82e42b2ca3fbe3&amp;chksm=fd4d1806ca3a9110474f9c0b1d2a886a9f994c4b8ed8d354a3c6bd8d8373cd012646443ebfca&amp;mpshare=1&amp;scene=1&amp;srcid=1110kSXANwBrbL2TWtA0NAK6&amp;key=86d1b0bfcae3874289b26357e30923b1734881e3a43437f4558c9c6be8f133e62f000fc4c315915ad48066faca9893f45a6515e6faebf3f27b85a03bf975ca15ecd8401181121b82a5d41040f7b5c565&amp;ascene=0&amp;uin=MjcyMjMxNTA0Mg%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12+build(16A323)&amp;version=12010210&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=T2oTN5azeGV4Brh%2FOFJxtVGb2WVp1QN3ylyWucAGYWTJBOrOLdFJzJoRIwToLTv8</a></p>\n<h3 id=\"Spring-Cloud\"><a href=\"#Spring-Cloud\" class=\"headerlink\" title=\"Spring Cloud\"></a>Spring Cloud</h3><p><a href=\"http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/cf3a2884a8d2?open_source=weibo_search</a><br><a href=\"https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC\" target=\"_blank\" rel=\"external\">https://www.atomikos.com/Blog/TransactionManagementAPIForRESTTCC</a></p>\n<p><a href=\"https://github.com/beston123/Tarzan\" target=\"_blank\" rel=\"external\">https://github.com/beston123/Tarzan</a></p>\n"},{"title":"guava","date":"2017-09-19T09:39:05.000Z","_content":"\n### \n\nhttp://www.itwendao.com/article/detail/357611.html\n\n### \n\n### \n\n#### BiMap\n\n### \n\n### ","source":"_posts/Guava-Black-techs.md","raw":"---\ntitle: guava\ndate: 2017-09-19 17:39:05\ntags: Guava\n---\n\n### \n\nhttp://www.itwendao.com/article/detail/357611.html\n\n### \n\n### \n\n#### BiMap\n\n### \n\n### ","slug":"Guava-Black-techs","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyq00113iq2fhmdjdlq","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://www.itwendao.com/article/detail/357611.html\" target=\"_blank\" rel=\"external\">http://www.itwendao.com/article/detail/357611.html</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"BiMap\"><a href=\"#BiMap\" class=\"headerlink\" title=\"BiMap\"></a>BiMap</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://www.itwendao.com/article/detail/357611.html\" target=\"_blank\" rel=\"external\">http://www.itwendao.com/article/detail/357611.html</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"BiMap\"><a href=\"#BiMap\" class=\"headerlink\" title=\"BiMap\"></a>BiMap</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":"JVM-Atomic-operation","date":"2017-11-09T02:12:31.000Z","_content":"\n### Volatile\n\nvolatile\n\n1.\n\n\n\nvolatileJVMLock volatile\n\n  volatile\n\n2.\n\nLock\n\nRuheng\nhttp://www.jianshu.com/p/7798161d7472\n\n\n\n#### \n\n### MVCC Copy on write\n\nCopyOnWriteArrayList \n\n``` java\npublic class CopyOnWriteArrayList<E> {\n    /** The lock protecting all mutators */\n    final transient ReentrantLock lock = new ReentrantLock();\n\n    /** The array, accessed only via getArray/setArray. */\n    private transient volatile Object[] array;\n\n    /**\n     * Gets the array.  Non-private so as to also be accessible\n     * from CopyOnWriteArraySet class.\n     */\n    final Object[] getArray() {\n        return array;\n    }\n\n    /**\n     * Sets the array.\n     */\n    final void setArray(Object[] a) {\n        array = a;\n    }\n\n    /**\n     * {@inheritDoc}\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E get(int index) {\n        return get(getArray(), index);\n    }\n\n    /**\n     * Appends the specified element to the end of this list.\n     *\n     * @param e element to be appended to this list\n     * @return {@code true} (as specified by {@link Collection#add})\n     */\n    public boolean add(E e) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            Object[] newElements = Arrays.copyOf(elements, len + 1);\n            newElements[len] = e;\n            setArray(newElements);\n            return true;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * Removes the element at the specified position in this list.\n     * Shifts any subsequent elements to the left (subtracts one from their\n     * indices).  Returns the element that was removed from the list.\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E remove(int index) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            E oldValue = get(elements, index);\n            int numMoved = len - index - 1;\n            if (numMoved == 0)\n                setArray(Arrays.copyOf(elements, len - 1));\n            else {\n                Object[] newElements = new Object[len - 1];\n                System.arraycopy(elements, 0, newElements, 0, index);\n                System.arraycopy(elements, index + 1, newElements, index,\n                                 numMoved);\n                setArray(newElements);\n            }\n            return oldValue;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n   \n}\n```\n\nCopyOnWriteArrayListReentrantLockCopyOnWriteArrayList\n\n> http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html\n\nvolatile\n\nsynchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2\n\n1\n\n2\n\nJavavolatile\n\n.\n\n``` java\nvolatile boolean flag = false;\n //1\nwhile(!flag){\n    doSomething();\n}\n  //2\npublic void setFlag() {\n    flag = true;\n}\n```\n\n\n\n.double check\n\n``` java\nclass Singleton{\n    private volatile static Singleton instance = null;\n\n    private Singleton() {\n\n    }\n\n    public static Singleton getInstance() {\n        if(instance==null) {\n            synchronized (Singleton.class) {\n                if(instance==null)\n                    instance = new Singleton();\n            }\n        }\n        return instance;\n    }\n}\n```\n\n\nvolatile instance\n\ninstance = new Singleton() JVM  3 :\n\n1. instance \n\n2. Singleton \n\n3.instance instance  null \n\n JVM  1-2-3  1-3-2 3 2  instance  null  instance\n\nRuheng\nhttp://www.jianshu.com/p/7798161d7472\n\n","source":"_posts/JVM-Atomic-operation.md","raw":"---\ntitle: JVM-Atomic-operation\ndate: 2017-11-09 10:12:31\ntags: JVM\n---\n\n### Volatile\n\nvolatile\n\n1.\n\n\n\nvolatileJVMLock volatile\n\n  volatile\n\n2.\n\nLock\n\nRuheng\nhttp://www.jianshu.com/p/7798161d7472\n\n\n\n#### \n\n### MVCC Copy on write\n\nCopyOnWriteArrayList \n\n``` java\npublic class CopyOnWriteArrayList<E> {\n    /** The lock protecting all mutators */\n    final transient ReentrantLock lock = new ReentrantLock();\n\n    /** The array, accessed only via getArray/setArray. */\n    private transient volatile Object[] array;\n\n    /**\n     * Gets the array.  Non-private so as to also be accessible\n     * from CopyOnWriteArraySet class.\n     */\n    final Object[] getArray() {\n        return array;\n    }\n\n    /**\n     * Sets the array.\n     */\n    final void setArray(Object[] a) {\n        array = a;\n    }\n\n    /**\n     * {@inheritDoc}\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E get(int index) {\n        return get(getArray(), index);\n    }\n\n    /**\n     * Appends the specified element to the end of this list.\n     *\n     * @param e element to be appended to this list\n     * @return {@code true} (as specified by {@link Collection#add})\n     */\n    public boolean add(E e) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            Object[] newElements = Arrays.copyOf(elements, len + 1);\n            newElements[len] = e;\n            setArray(newElements);\n            return true;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * Removes the element at the specified position in this list.\n     * Shifts any subsequent elements to the left (subtracts one from their\n     * indices).  Returns the element that was removed from the list.\n     *\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E remove(int index) {\n        final ReentrantLock lock = this.lock;\n        lock.lock();\n        try {\n            Object[] elements = getArray();\n            int len = elements.length;\n            E oldValue = get(elements, index);\n            int numMoved = len - index - 1;\n            if (numMoved == 0)\n                setArray(Arrays.copyOf(elements, len - 1));\n            else {\n                Object[] newElements = new Object[len - 1];\n                System.arraycopy(elements, 0, newElements, 0, index);\n                System.arraycopy(elements, index + 1, newElements, index,\n                                 numMoved);\n                setArray(newElements);\n            }\n            return oldValue;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n   \n}\n```\n\nCopyOnWriteArrayListReentrantLockCopyOnWriteArrayList\n\n> http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html\n\nvolatile\n\nsynchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2\n\n1\n\n2\n\nJavavolatile\n\n.\n\n``` java\nvolatile boolean flag = false;\n //1\nwhile(!flag){\n    doSomething();\n}\n  //2\npublic void setFlag() {\n    flag = true;\n}\n```\n\n\n\n.double check\n\n``` java\nclass Singleton{\n    private volatile static Singleton instance = null;\n\n    private Singleton() {\n\n    }\n\n    public static Singleton getInstance() {\n        if(instance==null) {\n            synchronized (Singleton.class) {\n                if(instance==null)\n                    instance = new Singleton();\n            }\n        }\n        return instance;\n    }\n}\n```\n\n\nvolatile instance\n\ninstance = new Singleton() JVM  3 :\n\n1. instance \n\n2. Singleton \n\n3.instance instance  null \n\n JVM  1-2-3  1-3-2 3 2  instance  null  instance\n\nRuheng\nhttp://www.jianshu.com/p/7798161d7472\n\n","slug":"JVM-Atomic-operation","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyr00133iq28ruqmiy5","content":"<h3 id=\"Volatile\"><a href=\"#Volatile\" class=\"headerlink\" title=\"Volatile\"></a>Volatile</h3><p>volatile</p>\n<p>1.</p>\n<p></p>\n<p>volatileJVMLock volatile</p>\n<p>  volatile</p>\n<p>2.</p>\n<p>Lock</p>\n<p>Ruheng<br><a href=\"http://www.jianshu.com/p/7798161d7472\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/7798161d7472</a><br><br></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h3 id=\"MVCC-Copy-on-write\"><a href=\"#MVCC-Copy-on-write\" class=\"headerlink\" title=\"MVCC Copy on write\"></a>MVCC Copy on write</h3><p>CopyOnWriteArrayList </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CopyOnWriteArrayList</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</div><div class=\"line\">    <span class=\"comment\">/** The lock protecting all mutators */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">transient</span> ReentrantLock lock = <span class=\"keyword\">new</span> ReentrantLock();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** The array, accessed only via getArray/setArray. */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Object[] array;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Gets the array.  Non-private so as to also be accessible</span></div><div class=\"line\"><span class=\"comment\">     * from CopyOnWriteArraySet class.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> Object[] getArray() &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> array;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Sets the array.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">setArray</span><span class=\"params\">(Object[] a)</span> </span>&#123;</div><div class=\"line\">        array = a;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> get(getArray(), index);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Appends the specified element to the end of this list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> e element to be appended to this list</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;<span class=\"doctag\">@code</span> true&#125; (as specified by &#123;<span class=\"doctag\">@link</span> Collection#add&#125;)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            Object[] newElements = Arrays.copyOf(elements, len + <span class=\"number\">1</span>);</div><div class=\"line\">            newElements[len] = e;</div><div class=\"line\">            setArray(newElements);</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Removes the element at the specified position in this list.</span></div><div class=\"line\"><span class=\"comment\">     * Shifts any subsequent elements to the left (subtracts one from their</span></div><div class=\"line\"><span class=\"comment\">     * indices).  Returns the element that was removed from the list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            E oldValue = get(elements, index);</div><div class=\"line\">            <span class=\"keyword\">int</span> numMoved = len - index - <span class=\"number\">1</span>;</div><div class=\"line\">            <span class=\"keyword\">if</span> (numMoved == <span class=\"number\">0</span>)</div><div class=\"line\">                setArray(Arrays.copyOf(elements, len - <span class=\"number\">1</span>));</div><div class=\"line\">            <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                Object[] newElements = <span class=\"keyword\">new</span> Object[len - <span class=\"number\">1</span>];</div><div class=\"line\">                System.arraycopy(elements, <span class=\"number\">0</span>, newElements, <span class=\"number\">0</span>, index);</div><div class=\"line\">                System.arraycopy(elements, index + <span class=\"number\">1</span>, newElements, index,</div><div class=\"line\">                                 numMoved);</div><div class=\"line\">                setArray(newElements);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">return</span> oldValue;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CopyOnWriteArrayListReentrantLockCopyOnWriteArrayList</p>\n<blockquote>\n<p><a href=\"http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html</a></p>\n</blockquote>\n<p>volatile</p>\n<p>synchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2</p>\n<p>1</p>\n<p>2</p>\n<p>Javavolatile</p>\n<p>.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"keyword\">boolean</span> flag = <span class=\"keyword\">false</span>;</div><div class=\"line\"> <span class=\"comment\">//1</span></div><div class=\"line\"><span class=\"keyword\">while</span>(!flag)&#123;</div><div class=\"line\">    doSomething();</div><div class=\"line\">&#125;</div><div class=\"line\">  <span class=\"comment\">//2</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setFlag</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    flag = <span class=\"keyword\">true</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p></p>\n<p>.double check</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> Singleton instance = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(instance==<span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span>(instance==<span class=\"keyword\">null</span>)</div><div class=\"line\">                    instance = <span class=\"keyword\">new</span> Singleton();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> instance;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>volatile instance</p>\n<p>instance = new Singleton() JVM  3 :</p>\n<p>1. instance </p>\n<p>2. Singleton </p>\n<p>3.instance instance  null </p>\n<p> JVM  1-2-3  1-3-2 3 2  instance  null  instance</p>\n<p>Ruheng<br><a href=\"http://www.jianshu.com/p/7798161d7472\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/7798161d7472</a><br><br></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Volatile\"><a href=\"#Volatile\" class=\"headerlink\" title=\"Volatile\"></a>Volatile</h3><p>volatile</p>\n<p>1.</p>\n<p></p>\n<p>volatileJVMLock volatile</p>\n<p>  volatile</p>\n<p>2.</p>\n<p>Lock</p>\n<p>Ruheng<br><a href=\"http://www.jianshu.com/p/7798161d7472\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/7798161d7472</a><br><br></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h3 id=\"MVCC-Copy-on-write\"><a href=\"#MVCC-Copy-on-write\" class=\"headerlink\" title=\"MVCC Copy on write\"></a>MVCC Copy on write</h3><p>CopyOnWriteArrayList </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CopyOnWriteArrayList</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</div><div class=\"line\">    <span class=\"comment\">/** The lock protecting all mutators */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">transient</span> ReentrantLock lock = <span class=\"keyword\">new</span> ReentrantLock();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** The array, accessed only via getArray/setArray. */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Object[] array;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Gets the array.  Non-private so as to also be accessible</span></div><div class=\"line\"><span class=\"comment\">     * from CopyOnWriteArraySet class.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"keyword\">final</span> Object[] getArray() &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> array;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Sets the array.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">setArray</span><span class=\"params\">(Object[] a)</span> </span>&#123;</div><div class=\"line\">        array = a;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> get(getArray(), index);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Appends the specified element to the end of this list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> e element to be appended to this list</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;<span class=\"doctag\">@code</span> true&#125; (as specified by &#123;<span class=\"doctag\">@link</span> Collection#add&#125;)</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            Object[] newElements = Arrays.copyOf(elements, len + <span class=\"number\">1</span>);</div><div class=\"line\">            newElements[len] = e;</div><div class=\"line\">            setArray(newElements);</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Removes the element at the specified position in this list.</span></div><div class=\"line\"><span class=\"comment\">     * Shifts any subsequent elements to the left (subtracts one from their</span></div><div class=\"line\"><span class=\"comment\">     * indices).  Returns the element that was removed from the list.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException &#123;<span class=\"doctag\">@inheritDoc</span>&#125;</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">this</span>.lock;</div><div class=\"line\">        lock.lock();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Object[] elements = getArray();</div><div class=\"line\">            <span class=\"keyword\">int</span> len = elements.length;</div><div class=\"line\">            E oldValue = get(elements, index);</div><div class=\"line\">            <span class=\"keyword\">int</span> numMoved = len - index - <span class=\"number\">1</span>;</div><div class=\"line\">            <span class=\"keyword\">if</span> (numMoved == <span class=\"number\">0</span>)</div><div class=\"line\">                setArray(Arrays.copyOf(elements, len - <span class=\"number\">1</span>));</div><div class=\"line\">            <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                Object[] newElements = <span class=\"keyword\">new</span> Object[len - <span class=\"number\">1</span>];</div><div class=\"line\">                System.arraycopy(elements, <span class=\"number\">0</span>, newElements, <span class=\"number\">0</span>, index);</div><div class=\"line\">                System.arraycopy(elements, index + <span class=\"number\">1</span>, newElements, index,</div><div class=\"line\">                                 numMoved);</div><div class=\"line\">                setArray(newElements);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">return</span> oldValue;</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            lock.unlock();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CopyOnWriteArrayListReentrantLockCopyOnWriteArrayList</p>\n<blockquote>\n<p><a href=\"http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html</a></p>\n</blockquote>\n<p>volatile</p>\n<p>synchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2</p>\n<p>1</p>\n<p>2</p>\n<p>Javavolatile</p>\n<p>.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"keyword\">boolean</span> flag = <span class=\"keyword\">false</span>;</div><div class=\"line\"> <span class=\"comment\">//1</span></div><div class=\"line\"><span class=\"keyword\">while</span>(!flag)&#123;</div><div class=\"line\">    doSomething();</div><div class=\"line\">&#125;</div><div class=\"line\">  <span class=\"comment\">//2</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setFlag</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    flag = <span class=\"keyword\">true</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p></p>\n<p>.double check</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> Singleton instance = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(instance==<span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span>(instance==<span class=\"keyword\">null</span>)</div><div class=\"line\">                    instance = <span class=\"keyword\">new</span> Singleton();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> instance;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>volatile instance</p>\n<p>instance = new Singleton() JVM  3 :</p>\n<p>1. instance </p>\n<p>2. Singleton </p>\n<p>3.instance instance  null </p>\n<p> JVM  1-2-3  1-3-2 3 2  instance  null  instance</p>\n<p>Ruheng<br><a href=\"http://www.jianshu.com/p/7798161d7472\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/7798161d7472</a><br><br></p>\n"},{"title":"Interview-Questions","date":"2017-11-20T07:38:08.000Z","_content":"\n\n### \n\nFuture & Promise\nFeed Back\n\nLeo Yang\nhttps://www.zhihu.com/question/60949531/answer/184044541\n\n\n\njava\nJDK BIO/NIOannotation     volatile TCP/HTTP \nJDK ConcurrentHashMapNIO JDK9TCCL RPCpaxos sql CAS)docker","source":"_posts/Interview-Questions.md","raw":"---\ntitle: Interview-Questions\ndate: 2017-11-20 15:38:08\ntags: \n---\n\n\n### \n\nFuture & Promise\nFeed Back\n\nLeo Yang\nhttps://www.zhihu.com/question/60949531/answer/184044541\n\n\n\njava\nJDK BIO/NIOannotation     volatile TCP/HTTP \nJDK ConcurrentHashMapNIO JDK9TCCL RPCpaxos sql CAS)docker","slug":"Interview-Questions","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsys00153iq2y5swmh97","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Future &amp; Promise<br>Feed Back</p>\n<p>Leo Yang<br><a href=\"https://www.zhihu.com/question/60949531/answer/184044541\" target=\"_blank\" rel=\"external\">https://www.zhihu.com/question/60949531/answer/184044541</a><br><br></p>\n<p>java<br>JDK BIO/NIOannotation     volatile TCP/HTTP <br>JDK ConcurrentHashMapNIO JDK9TCCL RPCpaxos sql CAS)docker</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Future &amp; Promise<br>Feed Back</p>\n<p>Leo Yang<br><a href=\"https://www.zhihu.com/question/60949531/answer/184044541\" target=\"_blank\" rel=\"external\">https://www.zhihu.com/question/60949531/answer/184044541</a><br><br></p>\n<p>java<br>JDK BIO/NIOannotation     volatile TCP/HTTP <br>JDK ConcurrentHashMapNIO JDK9TCCL RPCpaxos sql CAS)docker</p>\n"},{"title":"JVM-CAS-Campare-and-swap","date":"2017-11-10T11:48:55.000Z","_content":"> ,,,\n\n### CAS\n\n\n\n### CASLock-Free\n\n\n``` java\n/**\n * \n */\npublic class SpinLock {\n    private AtomicBoolean canLock = new AtomicBoolean(true);\n\n    public void lock() {\n        boolean b;\n        do {\n            b = canLock.compareAndSet(true, false);\n        } while (!b);\n    }\n\n    public void release() {\n        canLock.compareAndSet(false, true);\n    }\n}\n```\n\nlock`canLock`truecasfalsewhilecanLocktruecasCPU\n\n### ABA\n\nCASCASABA\n\n### ABA\n\nABAABA\n","source":"_posts/JVM-CAS-Campare-and-swap.md","raw":"---\ntitle: JVM-CAS-Campare-and-swap\ndate: 2017-11-10 19:48:55\ntags: JVM\n---\n> ,,,\n\n### CAS\n\n\n\n### CASLock-Free\n\n\n``` java\n/**\n * \n */\npublic class SpinLock {\n    private AtomicBoolean canLock = new AtomicBoolean(true);\n\n    public void lock() {\n        boolean b;\n        do {\n            b = canLock.compareAndSet(true, false);\n        } while (!b);\n    }\n\n    public void release() {\n        canLock.compareAndSet(false, true);\n    }\n}\n```\n\nlock`canLock`truecasfalsewhilecanLocktruecasCPU\n\n### ABA\n\nCASCASABA\n\n### ABA\n\nABAABA\n","slug":"JVM-CAS-Campare-and-swap","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyt00173iq2d9knarfl","content":"<blockquote>\n<p>,,,</p>\n</blockquote>\n<h3 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a>CAS</h3><p></p>\n<h3 id=\"CASLock-Free\"><a href=\"#CASLock-Free\" class=\"headerlink\" title=\"CASLock-Free\"></a>CASLock-Free</h3><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpinLock</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> AtomicBoolean canLock = <span class=\"keyword\">new</span> AtomicBoolean(<span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">boolean</span> b;</div><div class=\"line\">        <span class=\"keyword\">do</span> &#123;</div><div class=\"line\">            b = canLock.compareAndSet(<span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">while</span> (!b);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">release</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        canLock.compareAndSet(<span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>lock<code>canLock</code>truecasfalsewhilecanLocktruecasCPU</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>CASCASABA</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>ABAABA</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>,,,</p>\n</blockquote>\n<h3 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a>CAS</h3><p></p>\n<h3 id=\"CASLock-Free\"><a href=\"#CASLock-Free\" class=\"headerlink\" title=\"CASLock-Free\"></a>CASLock-Free</h3><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpinLock</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> AtomicBoolean canLock = <span class=\"keyword\">new</span> AtomicBoolean(<span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">boolean</span> b;</div><div class=\"line\">        <span class=\"keyword\">do</span> &#123;</div><div class=\"line\">            b = canLock.compareAndSet(<span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">while</span> (!b);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">release</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        canLock.compareAndSet(<span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>lock<code>canLock</code>truecasfalsewhilecanLocktruecasCPU</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>CASCASABA</p>\n<h3 id=\"ABA\"><a href=\"#ABA\" class=\"headerlink\" title=\"ABA\"></a>ABA</h3><p>ABAABA</p>\n"},{"title":"JVM-Crash-Log-Analysis","date":"2018-01-11T06:39:37.000Z","_content":"\n\nhttp://www.raychase.net/1459\n\nJVMhs_err_pid<pid>.logJVM/tmp\n\n1\njava -XX:ErrorFile=/var/log/java/java_error%p.log\n\n\n\n\n\n\n\n\n\n\nCPU\n\n\n1\n#  SIGSEGV (0xb) at pc=0x03568cf4, pid=16819, tid=3073346448\nJRE\n\nSIGSEGV\n0xb\npc=0x03568cf4\npid=16819\ntid=3073346448\nJVM\n","source":"_posts/JVM-Crash-Log-Analysis.md","raw":"---\ntitle: JVM-Crash-Log-Analysis\ndate: 2018-01-11 14:39:37\ntags:\n---\n\n\nhttp://www.raychase.net/1459\n\nJVMhs_err_pid<pid>.logJVM/tmp\n\n1\njava -XX:ErrorFile=/var/log/java/java_error%p.log\n\n\n\n\n\n\n\n\n\n\nCPU\n\n\n1\n#  SIGSEGV (0xb) at pc=0x03568cf4, pid=16819, tid=3073346448\nJRE\n\nSIGSEGV\n0xb\npc=0x03568cf4\npid=16819\ntid=3073346448\nJVM\n","slug":"JVM-Crash-Log-Analysis","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyu00193iq2exlx32vz","content":"<p><a href=\"http://www.raychase.net/1459\" target=\"_blank\" rel=\"external\">http://www.raychase.net/1459</a></p>\n<p>JVMhs_err_pid<pid>.logJVM/tmp</pid></p>\n<p>1<br>java -XX:ErrorFile=/var/log/java/java_error%p.log<br></p>\n<p><br><br><br><br><br><br><br><br>CPU<br></p>\n<p>1</p>\n<h1 id=\"SIGSEGV-0xb-at-pc-0x03568cf4-pid-16819-tid-3073346448\"><a href=\"#SIGSEGV-0xb-at-pc-0x03568cf4-pid-16819-tid-3073346448\" class=\"headerlink\" title=\"SIGSEGV (0xb) at pc=0x03568cf4, pid=16819, tid=3073346448\"></a>SIGSEGV (0xb) at pc=0x03568cf4, pid=16819, tid=3073346448</h1><p>JRE</p>\n<p>SIGSEGV<br>0xb<br>pc=0x03568cf4<br>pid=16819<br>tid=3073346448<br>JVM</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.raychase.net/1459\" target=\"_blank\" rel=\"external\">http://www.raychase.net/1459</a></p>\n<p>JVMhs_err_pid<pid>.logJVM/tmp</pid></p>\n<p>1<br>java -XX:ErrorFile=/var/log/java/java_error%p.log<br></p>\n<p><br><br><br><br><br><br><br><br>CPU<br></p>\n<p>1</p>\n<h1 id=\"SIGSEGV-0xb-at-pc-0x03568cf4-pid-16819-tid-3073346448\"><a href=\"#SIGSEGV-0xb-at-pc-0x03568cf4-pid-16819-tid-3073346448\" class=\"headerlink\" title=\"SIGSEGV (0xb) at pc=0x03568cf4, pid=16819, tid=3073346448\"></a>SIGSEGV (0xb) at pc=0x03568cf4, pid=16819, tid=3073346448</h1><p>JRE</p>\n<p>SIGSEGV<br>0xb<br>pc=0x03568cf4<br>pid=16819<br>tid=3073346448<br>JVM</p>\n"},{"title":"JVM-Debug-Openjdk-On-Mac","date":"2017-12-08T04:54:59.000Z","_content":"\nhttps://segmentfault.com/a/1190000005082098\n\nhttp://rednaxelafx.iteye.com/\n\n\nhttp://www.javaranger.com/archives/1636\nhttp://www.cnblogs.com/dennyzhangdd/p/6734638.html\nhttp://hllvm.group.iteye.com/group/topic/35385\n\n\ndebug on linux\nhttps://segmentfault.com/a/1190000008346240\n\n\n### netbeanshotspot\n\nhttp://marcelinorc.com/2016/02/17/using-netbeans-to-hack-openjdk9-in-ubuntu/\n\n./configure --with-target-bits=64 \\\n--with-freetype=/usr/local/Cellar/freetype/2.8.1 \\\n--enable-ccache \\\n--with-jvm-variants=server,client \\\n--with-boot-jdk-jvmargs=\"-Xlint:deprecation -Xlint:unchecked\" \\\n--disable-zip-debug-info \\\n--disable-warnings-as-errors \\\n--with-debug-level=slowdebug 2>&1 | tee configure_mac_x64.log\n\n\nbash configure --with-target-bits=64 --with-freetype=/usr/local/Cellar/freetype/2.8.1 --enable-ccache --with-jvm-variants=server,client --with-boot-jdk-jvmargs=\"-Xlint:deprecation -Xlint:unchecked\" --disable-zip-debug-info --disable-warnings-as-errors --with-debug-level=slowdebug","source":"_posts/JVM-Debug-Openjdk-On-Mac.md","raw":"---\ntitle: JVM-Debug-Openjdk-On-Mac\ndate: 2017-12-08 12:54:59\ntags:\n---\n\nhttps://segmentfault.com/a/1190000005082098\n\nhttp://rednaxelafx.iteye.com/\n\n\nhttp://www.javaranger.com/archives/1636\nhttp://www.cnblogs.com/dennyzhangdd/p/6734638.html\nhttp://hllvm.group.iteye.com/group/topic/35385\n\n\ndebug on linux\nhttps://segmentfault.com/a/1190000008346240\n\n\n### netbeanshotspot\n\nhttp://marcelinorc.com/2016/02/17/using-netbeans-to-hack-openjdk9-in-ubuntu/\n\n./configure --with-target-bits=64 \\\n--with-freetype=/usr/local/Cellar/freetype/2.8.1 \\\n--enable-ccache \\\n--with-jvm-variants=server,client \\\n--with-boot-jdk-jvmargs=\"-Xlint:deprecation -Xlint:unchecked\" \\\n--disable-zip-debug-info \\\n--disable-warnings-as-errors \\\n--with-debug-level=slowdebug 2>&1 | tee configure_mac_x64.log\n\n\nbash configure --with-target-bits=64 --with-freetype=/usr/local/Cellar/freetype/2.8.1 --enable-ccache --with-jvm-variants=server,client --with-boot-jdk-jvmargs=\"-Xlint:deprecation -Xlint:unchecked\" --disable-zip-debug-info --disable-warnings-as-errors --with-debug-level=slowdebug","slug":"JVM-Debug-Openjdk-On-Mac","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyu001b3iq262kugjwm","content":"<p><a href=\"https://segmentfault.com/a/1190000005082098\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000005082098</a></p>\n<p><a href=\"http://rednaxelafx.iteye.com/\" target=\"_blank\" rel=\"external\">http://rednaxelafx.iteye.com/</a><br></p>\n<p><a href=\"http://www.javaranger.com/archives/1636\" target=\"_blank\" rel=\"external\">http://www.javaranger.com/archives/1636</a><br><a href=\"http://www.cnblogs.com/dennyzhangdd/p/6734638.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/dennyzhangdd/p/6734638.html</a><br><a href=\"http://hllvm.group.iteye.com/group/topic/35385\" target=\"_blank\" rel=\"external\">http://hllvm.group.iteye.com/group/topic/35385</a></p>\n<p>debug on linux<br><a href=\"https://segmentfault.com/a/1190000008346240\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000008346240</a></p>\n<h3 id=\"netbeanshotspot\"><a href=\"#netbeanshotspot\" class=\"headerlink\" title=\"netbeanshotspot\"></a>netbeanshotspot</h3><p><a href=\"http://marcelinorc.com/2016/02/17/using-netbeans-to-hack-openjdk9-in-ubuntu/\" target=\"_blank\" rel=\"external\">http://marcelinorc.com/2016/02/17/using-netbeans-to-hack-openjdk9-in-ubuntu/</a></p>\n<p>./configure with-target-bits=64 \\<br>with-freetype=/usr/local/Cellar/freetype/2.8.1 \\<br>enable-ccache \\<br>with-jvm-variants=server,client \\<br>with-boot-jdk-jvmargs=-Xlint:deprecation -Xlint:unchecked \\<br>disable-zip-debug-info \\<br>disable-warnings-as-errors \\<br>with-debug-level=slowdebug 2&gt;&amp;1 | tee configure_mac_x64.log</p>\n<p>bash configure with-target-bits=64 with-freetype=/usr/local/Cellar/freetype/2.8.1 enable-ccache with-jvm-variants=server,client with-boot-jdk-jvmargs=-Xlint:deprecation -Xlint:unchecked disable-zip-debug-info disable-warnings-as-errors with-debug-level=slowdebug</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://segmentfault.com/a/1190000005082098\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000005082098</a></p>\n<p><a href=\"http://rednaxelafx.iteye.com/\" target=\"_blank\" rel=\"external\">http://rednaxelafx.iteye.com/</a><br></p>\n<p><a href=\"http://www.javaranger.com/archives/1636\" target=\"_blank\" rel=\"external\">http://www.javaranger.com/archives/1636</a><br><a href=\"http://www.cnblogs.com/dennyzhangdd/p/6734638.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/dennyzhangdd/p/6734638.html</a><br><a href=\"http://hllvm.group.iteye.com/group/topic/35385\" target=\"_blank\" rel=\"external\">http://hllvm.group.iteye.com/group/topic/35385</a></p>\n<p>debug on linux<br><a href=\"https://segmentfault.com/a/1190000008346240\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000008346240</a></p>\n<h3 id=\"netbeanshotspot\"><a href=\"#netbeanshotspot\" class=\"headerlink\" title=\"netbeanshotspot\"></a>netbeanshotspot</h3><p><a href=\"http://marcelinorc.com/2016/02/17/using-netbeans-to-hack-openjdk9-in-ubuntu/\" target=\"_blank\" rel=\"external\">http://marcelinorc.com/2016/02/17/using-netbeans-to-hack-openjdk9-in-ubuntu/</a></p>\n<p>./configure with-target-bits=64 \\<br>with-freetype=/usr/local/Cellar/freetype/2.8.1 \\<br>enable-ccache \\<br>with-jvm-variants=server,client \\<br>with-boot-jdk-jvmargs=-Xlint:deprecation -Xlint:unchecked \\<br>disable-zip-debug-info \\<br>disable-warnings-as-errors \\<br>with-debug-level=slowdebug 2&gt;&amp;1 | tee configure_mac_x64.log</p>\n<p>bash configure with-target-bits=64 with-freetype=/usr/local/Cellar/freetype/2.8.1 enable-ccache with-jvm-variants=server,client with-boot-jdk-jvmargs=-Xlint:deprecation -Xlint:unchecked disable-zip-debug-info disable-warnings-as-errors with-debug-level=slowdebug</p>\n"},{"title":"JVM-Lock","date":"2017-11-06T02:16:02.000Z","_content":"\n### \n\nJVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor \n\n### Java\n\nJava3Word23232bit\n\n|  |  |  |\n| --------- |:-----------:|:-----------|\n| 32/64bit | Mark Word | hashCode\n| 32/64bit | Class Metadata Address | \n| 32/64bit | Array length | \n\nJavaMark WordHashCode32JVMMark Word\n\n25 bit\t4bit\t1bit\n\t2bit\n\n\thashCode\t\t0\t01\n\nMark WordMark Word4\n![](JVM-Lock/markword_state.jpg)\n\n### \n\n**CPUCPU**\nJava SE1.6Java SE1.6\n****\n\n#### \nHotspotCAS\n![](JVM-Lock/biased_lock_flow.jpg)\n\n##### \nMarkValue\n\n12\n\nJVMJVMepochidentifierepoch\n\n##### \n\n**IDCASMark Word**Mark Word1CASCAS\n\n##### \n\n****Mark Word12\n\n##### \n\nJava 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false\n\n#### \n\nCPUCPU\nrunningJVM\n10,100\nHotSpotCPUHotSpot\nCPUs\n(CPUs/2)\nOwner CPU\nCPUCPU ACPU B\n\n#### \n\n##### \n\nJVMMark WordDisplaced Mark Word**CASMark Word()**\n\n##### \n\n**CASDisplaced Mark Word**\n\n![](JVM-Lock/light_lock_flow.jpg)\n\n### \n\n|  |  |  |  |\n| --------- |:-----------:|:-----------|:-----------|\n| \t |  |  | \n|  |  | CPU | ,\n|  | CPU |  | ,\n\n> http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/\n","source":"_posts/JVM-Lock.md","raw":"---\ntitle: JVM-Lock\ndate: 2017-11-06 10:16:02\ntags: JVM\n---\n\n### \n\nJVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor \n\n### Java\n\nJava3Word23232bit\n\n|  |  |  |\n| --------- |:-----------:|:-----------|\n| 32/64bit | Mark Word | hashCode\n| 32/64bit | Class Metadata Address | \n| 32/64bit | Array length | \n\nJavaMark WordHashCode32JVMMark Word\n\n25 bit\t4bit\t1bit\n\t2bit\n\n\thashCode\t\t0\t01\n\nMark WordMark Word4\n![](JVM-Lock/markword_state.jpg)\n\n### \n\n**CPUCPU**\nJava SE1.6Java SE1.6\n****\n\n#### \nHotspotCAS\n![](JVM-Lock/biased_lock_flow.jpg)\n\n##### \nMarkValue\n\n12\n\nJVMJVMepochidentifierepoch\n\n##### \n\n**IDCASMark Word**Mark Word1CASCAS\n\n##### \n\n****Mark Word12\n\n##### \n\nJava 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false\n\n#### \n\nCPUCPU\nrunningJVM\n10,100\nHotSpotCPUHotSpot\nCPUs\n(CPUs/2)\nOwner CPU\nCPUCPU ACPU B\n\n#### \n\n##### \n\nJVMMark WordDisplaced Mark Word**CASMark Word()**\n\n##### \n\n**CASDisplaced Mark Word**\n\n![](JVM-Lock/light_lock_flow.jpg)\n\n### \n\n|  |  |  |  |\n| --------- |:-----------:|:-----------|:-----------|\n| \t |  |  | \n|  |  | CPU | ,\n|  | CPU |  | ,\n\n> http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/\n","slug":"JVM-Lock","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyv001d3iq2r9wnctq8","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>JVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor </p>\n<h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>Java3Word23232bit</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Mark Word</td>\n<td style=\"text-align:left\">hashCode</td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Class Metadata Address</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Array length</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<p>JavaMark WordHashCode32JVMMark Word</p>\n<p>25 bit    4bit    1bit<br>    2bit<br><br>    hashCode        0    01</p>\n<p>Mark WordMark Word4<br><img src=\"/2017/11/06/JVM-Lock/markword_state.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>CPUCPU</strong><br>Java SE1.6Java SE1.6<br><strong></strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>HotspotCAS<br><img src=\"/2017/11/06/JVM-Lock/biased_lock_flow.jpg\" alt=\"\"></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>MarkValue</p>\n<p>12</p>\n<p>JVMJVMepochidentifierepoch</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>IDCASMark Word</strong>Mark Word1CASCAS</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong></strong>Mark Word12</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Java 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>CPUCPU<br>runningJVM<br>10,100<br>HotSpotCPUHotSpot<br>CPUs<br>(CPUs/2)<br>Owner CPU<br>CPUCPU ACPU B</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>JVMMark WordDisplaced Mark Word<strong>CASMark Word()</strong></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>CASDisplaced Mark Word</strong></p>\n<p><img src=\"/2017/11/06/JVM-Lock/light_lock_flow.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">CPU</td>\n<td style=\"text-align:left\">,</td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\">CPU</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">,</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><a href=\"http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>JVMJVMMonitormonitorentermonitorexitJVMmonitorentermonitorexit JVMmonitorentermonitorexit monitor monitor  monitorenter  monitor </p>\n<h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>Java3Word23232bit</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Mark Word</td>\n<td style=\"text-align:left\">hashCode</td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Class Metadata Address</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td>32/64bit</td>\n<td style=\"text-align:center\">Array length</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<p>JavaMark WordHashCode32JVMMark Word</p>\n<p>25 bit    4bit    1bit<br>    2bit<br><br>    hashCode        0    01</p>\n<p>Mark WordMark Word4<br><img src=\"/2017/11/06/JVM-Lock/markword_state.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>CPUCPU</strong><br>Java SE1.6Java SE1.6<br><strong></strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>HotspotCAS<br><img src=\"/2017/11/06/JVM-Lock/biased_lock_flow.jpg\" alt=\"\"></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>MarkValue</p>\n<p>12</p>\n<p>JVMJVMepochidentifierepoch</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>IDCASMark Word</strong>Mark Word1CASCAS</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong></strong>Mark Word12</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Java 6Java 7JVM-XXBiasedLockingStartupDelay = 0JVM-XX:-UseBiasedLocking=false</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>CPUCPU<br>runningJVM<br>10,100<br>HotSpotCPUHotSpot<br>CPUs<br>(CPUs/2)<br>Owner CPU<br>CPUCPU ACPU B</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>JVMMark WordDisplaced Mark Word<strong>CASMark Word()</strong></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><strong>CASDisplaced Mark Word</strong></p>\n<p><img src=\"/2017/11/06/JVM-Lock/light_lock_flow.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">CPU</td>\n<td style=\"text-align:left\">,</td>\n</tr>\n<tr>\n<td></td>\n<td style=\"text-align:center\">CPU</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">,</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><a href=\"http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/</a></p>\n</blockquote>\n"},{"title":"JVM-Off-Heap-Memory","date":"2017-12-02T07:05:06.000Z","_content":"\nhttp://www.jianshu.com/p/007052ee3773\nfull gc\n\nhttp://www.cnblogs.com/holoyong/p/7266240.html\n","source":"_posts/JVM-Off-Heap-Memory.md","raw":"---\ntitle: JVM-Off-Heap-Memory\ndate: 2017-12-02 15:05:06\ntags: JVM\n---\n\nhttp://www.jianshu.com/p/007052ee3773\nfull gc\n\nhttp://www.cnblogs.com/holoyong/p/7266240.html\n","slug":"JVM-Off-Heap-Memory","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyw001f3iq2bm65fbv1","content":"<p><a href=\"http://www.jianshu.com/p/007052ee3773\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/007052ee3773</a><br>full gc</p>\n<p><a href=\"http://www.cnblogs.com/holoyong/p/7266240.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/holoyong/p/7266240.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.jianshu.com/p/007052ee3773\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/007052ee3773</a><br>full gc</p>\n<p><a href=\"http://www.cnblogs.com/holoyong/p/7266240.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/holoyong/p/7266240.html</a></p>\n"},{"title":"JVM-Optimization","date":"2017-11-06T06:43:26.000Z","_content":"\nhttp://blog.csdn.net/matt8/article/details/52298397\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\n\nJava ReentrantLock\n\n\n### \n> ReentrantLocksynchronizedJDK5synchronizedJDK6jvm\n\n\nsynchronizedReentrantLockReentrantLock2 \n1. \n2.wait-notifyReentrantLockConditionnotify \n3. \n\nReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java \n\nBuffersynchronized \n\n``` java\npackage com.eric.lock;\n\npublic class Buffer {\n\n    private Object lock;\n\n    public Buffer() {\n        lock = this;\n    }\n\n    public void write() {\n        synchronized (lock) {\n            long startTime = System.currentTimeMillis();\n            System.out.println(\"buff\");\n            // \n            for (; ; ) {\n                if (System.currentTimeMillis() - startTime > Integer.MAX_VALUE)\n                    break;\n            }\n            System.out.println(\"\");\n        }\n    }\n\n    public void read() {\n        synchronized (lock) {\n            System.out.println(\"buff\");\n        }\n    }\n}\n```\n\n2\n\nhttp://www.importnew.com/15311.html\nG1","source":"_posts/JVM-Optimization.md","raw":"---\ntitle: JVM-Optimization\ndate: 2017-11-06 14:43:26\ntags: JVM\n---\n\nhttp://blog.csdn.net/matt8/article/details/52298397\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\n\nhttps://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\n\nJava ReentrantLock\n\n\n### \n> ReentrantLocksynchronizedJDK5synchronizedJDK6jvm\n\n\nsynchronizedReentrantLockReentrantLock2 \n1. \n2.wait-notifyReentrantLockConditionnotify \n3. \n\nReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java \n\nBuffersynchronized \n\n``` java\npackage com.eric.lock;\n\npublic class Buffer {\n\n    private Object lock;\n\n    public Buffer() {\n        lock = this;\n    }\n\n    public void write() {\n        synchronized (lock) {\n            long startTime = System.currentTimeMillis();\n            System.out.println(\"buff\");\n            // \n            for (; ; ) {\n                if (System.currentTimeMillis() - startTime > Integer.MAX_VALUE)\n                    break;\n            }\n            System.out.println(\"\");\n        }\n    }\n\n    public void read() {\n        synchronized (lock) {\n            System.out.println(\"buff\");\n        }\n    }\n}\n```\n\n2\n\nhttp://www.importnew.com/15311.html\nG1","slug":"JVM-Optimization","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyx001h3iq236xbkaoq","content":"<p><a href=\"http://blog.csdn.net/matt8/article/details/52298397\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/matt8/article/details/52298397</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments</a></p>\n<p>Java ReentrantLock</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>ReentrantLocksynchronizedJDK5synchronizedJDK6jvm</p>\n</blockquote>\n<p>synchronizedReentrantLockReentrantLock2<br>1.<br>2.wait-notifyReentrantLockConditionnotify<br>3. </p>\n<p>ReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java </p>\n<p>Buffersynchronized </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.eric.lock;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Buffer</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> Object lock;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Buffer</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        lock = <span class=\"keyword\">this</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">            <span class=\"comment\">// </span></div><div class=\"line\">            <span class=\"keyword\">for</span> (; ; ) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (System.currentTimeMillis() - startTime &gt; Integer.MAX_VALUE)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>2</p>\n<p><a href=\"http://www.importnew.com/15311.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/15311.html</a><br>G1</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://blog.csdn.net/matt8/article/details/52298397\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/matt8/article/details/52298397</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html#icomments</a></p>\n<p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/#icomments</a></p>\n<p>Java ReentrantLock</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>ReentrantLocksynchronizedJDK5synchronizedJDK6jvm</p>\n</blockquote>\n<p>synchronizedReentrantLockReentrantLock2<br>1.<br>2.wait-notifyReentrantLockConditionnotify<br>3. </p>\n<p>ReentrantLocklock2AB2ABABReentrantLock2BReentrantLockBsynchronizedBReentrantLockjava80%java </p>\n<p>Buffersynchronized </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.eric.lock;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Buffer</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> Object lock;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Buffer</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        lock = <span class=\"keyword\">this</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">            <span class=\"comment\">// </span></div><div class=\"line\">            <span class=\"keyword\">for</span> (; ; ) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (System.currentTimeMillis() - startTime &gt; Integer.MAX_VALUE)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">            System.out.println(<span class=\"string\">\"buff\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>2</p>\n<p><a href=\"http://www.importnew.com/15311.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/15311.html</a><br>G1</p>\n"},{"title":"JVM-Profiling","date":"2017-11-07T07:36:54.000Z","_content":"\nhttps://yq.aliyun.com/articles/2390\n\n### heap dump\njmap -dump:format=b,file=heap.bin [java_process_id]","source":"_posts/JVM-Profiling.md","raw":"---\ntitle: JVM-Profiling\ndate: 2017-11-07 15:36:54\ntags: JVM\n---\n\nhttps://yq.aliyun.com/articles/2390\n\n### heap dump\njmap -dump:format=b,file=heap.bin [java_process_id]","slug":"JVM-Profiling","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyy001j3iq2svsv8eib","content":"<p><a href=\"https://yq.aliyun.com/articles/2390\" target=\"_blank\" rel=\"external\">https://yq.aliyun.com/articles/2390</a></p>\n<h3 id=\"heap-dump\"><a href=\"#heap-dump\" class=\"headerlink\" title=\"heap dump\"></a>heap dump</h3><p>jmap -dump:format=b,file=heap.bin [java_process_id]</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://yq.aliyun.com/articles/2390\" target=\"_blank\" rel=\"external\">https://yq.aliyun.com/articles/2390</a></p>\n<h3 id=\"heap-dump\"><a href=\"#heap-dump\" class=\"headerlink\" title=\"heap dump\"></a>heap dump</h3><p>jmap -dump:format=b,file=heap.bin [java_process_id]</p>\n"},{"title":"JVM","date":"2017-11-09T12:36:45.000Z","_content":"\n\nhttp://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/","source":"_posts/JVM-Thread-interupt.md","raw":"---\ntitle: JVM\ndate: 2017-11-09 20:36:45\ntags: JVM\n---\n\n\nhttp://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/","slug":"JVM-Thread-interupt","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyz001l3iq2xv0kkf5u","content":"<p><a href=\"http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/\" target=\"_blank\" rel=\"external\">http://luojinping.com/2015/04/13/Java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD/</a></p>\n"},{"title":"Kafka-FAQ","date":"2017-11-17T07:33:16.000Z","_content":"\nKafkaCommitLog?\n\nsync;lock-free;reentrant lock\n\n\n### kafkaRocketMQ\n\nhttp://blog.csdn.net/chunlongyu/article/details/54576649\n\n\n### \nhttp://blog.csdn.net/chunlongyu/article/category/6638499\n\nhttp://blog.csdn.net/chunlongyu/article/details/54407633\n\nhttp://blog.csdn.net/a417930422/article/category/6086259\n\nhttp://blog.csdn.net/lizhitao\n\nhttp://www.cnblogs.com/huxi2b\n\nhttp://blog.csdn.net/u014393917/article/category/6332828\n\n \nhttp://jm.taobao.org/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/\n\n\n. Kafka\n    9.1 \n    9.2 \n    9.3 \n    9.4 ISR","source":"_posts/Kafka-FAQ.md","raw":"---\ntitle: Kafka-FAQ\ndate: 2017-11-17 15:33:16\ntags: Kafka\n---\n\nKafkaCommitLog?\n\nsync;lock-free;reentrant lock\n\n\n### kafkaRocketMQ\n\nhttp://blog.csdn.net/chunlongyu/article/details/54576649\n\n\n### \nhttp://blog.csdn.net/chunlongyu/article/category/6638499\n\nhttp://blog.csdn.net/chunlongyu/article/details/54407633\n\nhttp://blog.csdn.net/a417930422/article/category/6086259\n\nhttp://blog.csdn.net/lizhitao\n\nhttp://www.cnblogs.com/huxi2b\n\nhttp://blog.csdn.net/u014393917/article/category/6332828\n\n \nhttp://jm.taobao.org/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/\n\n\n. Kafka\n    9.1 \n    9.2 \n    9.3 \n    9.4 ISR","slug":"Kafka-FAQ","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsyz001m3iq22f2w8ej8","content":"<p>KafkaCommitLog?</p>\n<p>sync;lock-free;reentrant lock</p>\n<h3 id=\"kafkaRocketMQ\"><a href=\"#kafkaRocketMQ\" class=\"headerlink\" title=\"kafkaRocketMQ\"></a>kafkaRocketMQ</h3><p><a href=\"http://blog.csdn.net/chunlongyu/article/details/54576649\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/chunlongyu/article/details/54576649</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/chunlongyu/article/category/6638499\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/chunlongyu/article/category/6638499</a></p>\n<p><a href=\"http://blog.csdn.net/chunlongyu/article/details/54407633\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/chunlongyu/article/details/54407633</a></p>\n<p><a href=\"http://blog.csdn.net/a417930422/article/category/6086259\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/category/6086259</a></p>\n<p><a href=\"http://blog.csdn.net/lizhitao\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/lizhitao</a></p>\n<p><a href=\"http://www.cnblogs.com/huxi2b\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/huxi2b</a></p>\n<p><a href=\"http://blog.csdn.net/u014393917/article/category/6332828\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/u014393917/article/category/6332828</a></p>\n<p><br><a href=\"http://jm.taobao.org/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/\" target=\"_blank\" rel=\"external\">http://jm.taobao.org/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/</a></p>\n<p>. Kafka<br>    9.1 <br>    9.2 <br>    9.3 <br>    9.4 ISR</p>\n","site":{"data":{}},"excerpt":"","more":"<p>KafkaCommitLog?</p>\n<p>sync;lock-free;reentrant lock</p>\n<h3 id=\"kafkaRocketMQ\"><a href=\"#kafkaRocketMQ\" class=\"headerlink\" title=\"kafkaRocketMQ\"></a>kafkaRocketMQ</h3><p><a href=\"http://blog.csdn.net/chunlongyu/article/details/54576649\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/chunlongyu/article/details/54576649</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/chunlongyu/article/category/6638499\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/chunlongyu/article/category/6638499</a></p>\n<p><a href=\"http://blog.csdn.net/chunlongyu/article/details/54407633\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/chunlongyu/article/details/54407633</a></p>\n<p><a href=\"http://blog.csdn.net/a417930422/article/category/6086259\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/category/6086259</a></p>\n<p><a href=\"http://blog.csdn.net/lizhitao\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/lizhitao</a></p>\n<p><a href=\"http://www.cnblogs.com/huxi2b\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/huxi2b</a></p>\n<p><a href=\"http://blog.csdn.net/u014393917/article/category/6332828\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/u014393917/article/category/6332828</a></p>\n<p><br><a href=\"http://jm.taobao.org/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/\" target=\"_blank\" rel=\"external\">http://jm.taobao.org/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/</a></p>\n<p>. Kafka<br>    9.1 <br>    9.2 <br>    9.3 <br>    9.4 ISR</p>\n"},{"title":"Linux","date":"2017-09-09T09:16:00.000Z","_content":"\n#### \n\n``` bash\nsudo sed -i 's/aaa/bbb/g' `grep -Rl aaa order_migrate_conf/`\n```\n\n#### ,\n\n``` bash\ngrep -Rl 1496628000000 order_migrate_conf/\n```\n\n#### vim \n\n``` bash\nless file.log\n```\n\n\n#### kind_pay\n\n``` bash\ntac file_path | grep kind_pay\n```\n\nless file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)\n\n#### TCP\n\n``` bash\nss  -tan|awk 'NR>1{++S[$1]}END{for (a in S) print a,S[a]}'\n```\n\n#### logs\n\n``` bash\ndu -sh logs/*\n```\n```\n$ du -sh Movies/* | sort -nr\n 28G\tMovies/Pan's.Labyrinth..2006.1080p.BluRay.REMUX.MPEG-4.AVC.PCM-WARHD\n 19G\tMovies/The.Lord.Of.The.Rings.The.Return.Of.The.King.2003.1080p.BluRay.x264-SiNNERS\n 16G\tMovies/The.Lord.Of.The.Rings.The.Fellowship.Of.The.Ring.2001.1080p.BluRay.x264-SiNNERS\n 15G\tMovies/Interstellar..2014.1080p.BluRay.x264.DTS-RARBG\n 14G\tMovies/Witness.for.the.Prosecution..1957.1080p.BluRay.x264.DTS-WiKi\n 14G\tMovies/Se7en..1995.REMASTERED.1080p.BluRay.x264.DTS-ES-FGT\n 14G\tMovies/In.Bruges..2008.1080p.BluRay.x264.DTS-FGT\n 13G\tMovies/Saving.Private.Ryan..1998.1080p.BluRay.x264-LEVERAGE\n 13G\tMovies/Braveheart..1995.1080p.BluRay.x264-CiNEFiLE\n 12G\tMovies/The.Hunt..2012.DANISH.1080p.BluRay.x264.DTS-FGT\n 12G\tMovies/The.Dark.Knight.Rises...2012.1080p.BluRay.x264-ALLiANCE\n 12G\tMovies/Life.of.Pi..2012.1080p.BluRay.x264.DTS-FGT\n 11G\tMovies/The.Lost.City.of.Z.Z.2016.1080p.BluRay.x264-GECKOS[rarbg]\n 11G\tMovies/Manhattan.Murder.Mystery..1993.1080p.BluRay.X264-AMIABLE[rarbg]\n 11G\tMovies/Like.Father.Like.Son..2013.1080p.BluRay.DTS.x264-PublicHD\n```\n\n#### \n\n``` bash\ntelnet zk_ip 2181 | tee -a  -i someFile\n\nenvi\n```\n\n#### \n\n``` bash\nnmon\n```\n\n#### PID\n``` bash\n$ lsof -i:9696\nCOMMAND    PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME\nkingshard 4994 eric   24u  IPv6 0x2dd5bc594d052b1f      0t0  TCP *:9696 (LISTEN)\n\n```\n\n#### \nhttp://blog.csdn.net/weiweicao0429/article/details/17578011\n``` bash\n# tc qdisc add dev eth0 root netem delay 100ms\n# tc qdisc del dev eth0 root netem delay 100ms\n# tc qdisc del dev eth0 root\n```\n\n#### \ndmesg","source":"_posts/Linux-Useful-command.md","raw":"---\ntitle: Linux\ndate: 2017-09-09 17:16:00\ntags: Linux\n---\n\n#### \n\n``` bash\nsudo sed -i 's/aaa/bbb/g' `grep -Rl aaa order_migrate_conf/`\n```\n\n#### ,\n\n``` bash\ngrep -Rl 1496628000000 order_migrate_conf/\n```\n\n#### vim \n\n``` bash\nless file.log\n```\n\n\n#### kind_pay\n\n``` bash\ntac file_path | grep kind_pay\n```\n\nless file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)\n\n#### TCP\n\n``` bash\nss  -tan|awk 'NR>1{++S[$1]}END{for (a in S) print a,S[a]}'\n```\n\n#### logs\n\n``` bash\ndu -sh logs/*\n```\n```\n$ du -sh Movies/* | sort -nr\n 28G\tMovies/Pan's.Labyrinth..2006.1080p.BluRay.REMUX.MPEG-4.AVC.PCM-WARHD\n 19G\tMovies/The.Lord.Of.The.Rings.The.Return.Of.The.King.2003.1080p.BluRay.x264-SiNNERS\n 16G\tMovies/The.Lord.Of.The.Rings.The.Fellowship.Of.The.Ring.2001.1080p.BluRay.x264-SiNNERS\n 15G\tMovies/Interstellar..2014.1080p.BluRay.x264.DTS-RARBG\n 14G\tMovies/Witness.for.the.Prosecution..1957.1080p.BluRay.x264.DTS-WiKi\n 14G\tMovies/Se7en..1995.REMASTERED.1080p.BluRay.x264.DTS-ES-FGT\n 14G\tMovies/In.Bruges..2008.1080p.BluRay.x264.DTS-FGT\n 13G\tMovies/Saving.Private.Ryan..1998.1080p.BluRay.x264-LEVERAGE\n 13G\tMovies/Braveheart..1995.1080p.BluRay.x264-CiNEFiLE\n 12G\tMovies/The.Hunt..2012.DANISH.1080p.BluRay.x264.DTS-FGT\n 12G\tMovies/The.Dark.Knight.Rises...2012.1080p.BluRay.x264-ALLiANCE\n 12G\tMovies/Life.of.Pi..2012.1080p.BluRay.x264.DTS-FGT\n 11G\tMovies/The.Lost.City.of.Z.Z.2016.1080p.BluRay.x264-GECKOS[rarbg]\n 11G\tMovies/Manhattan.Murder.Mystery..1993.1080p.BluRay.X264-AMIABLE[rarbg]\n 11G\tMovies/Like.Father.Like.Son..2013.1080p.BluRay.DTS.x264-PublicHD\n```\n\n#### \n\n``` bash\ntelnet zk_ip 2181 | tee -a  -i someFile\n\nenvi\n```\n\n#### \n\n``` bash\nnmon\n```\n\n#### PID\n``` bash\n$ lsof -i:9696\nCOMMAND    PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME\nkingshard 4994 eric   24u  IPv6 0x2dd5bc594d052b1f      0t0  TCP *:9696 (LISTEN)\n\n```\n\n#### \nhttp://blog.csdn.net/weiweicao0429/article/details/17578011\n``` bash\n# tc qdisc add dev eth0 root netem delay 100ms\n# tc qdisc del dev eth0 root netem delay 100ms\n# tc qdisc del dev eth0 root\n```\n\n#### \ndmesg","slug":"Linux-Useful-command","published":1,"updated":"2018-05-19T04:07:41.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz0001p3iq2blqyektp","content":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo sed -i <span class=\"string\">'s/aaa/bbb/g'</span> `grep -Rl aaa order_migrate_conf/`</div></pre></td></tr></table></figure>\n<h4 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">grep -Rl 1496628000000 order_migrate_conf/</div></pre></td></tr></table></figure>\n<h4 id=\"vim-\"><a href=\"#vim-\" class=\"headerlink\" title=\"vim \"></a>vim </h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">less file.log</div></pre></td></tr></table></figure>\n<h4 id=\"kind-pay\"><a href=\"#kind-pay\" class=\"headerlink\" title=\"kind_pay\"></a>kind_pay</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tac file_path | grep kind_pay</div></pre></td></tr></table></figure>\n<p>less file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)</p>\n<h4 id=\"TCP\"><a href=\"#TCP\" class=\"headerlink\" title=\"TCP\"></a>TCP</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ss  -tan|awk <span class=\"string\">'NR&gt;1&#123;++S[$1]&#125;END&#123;for (a in S) print a,S[a]&#125;'</span></div></pre></td></tr></table></figure>\n<h4 id=\"logs\"><a href=\"#logs\" class=\"headerlink\" title=\"logs\"></a>logs</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">du -sh logs/*</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ du -sh Movies/* | sort -nr</div><div class=\"line\"> 28G\tMovies/Pan&apos;s.Labyrinth..2006.1080p.BluRay.REMUX.MPEG-4.AVC.PCM-WARHD</div><div class=\"line\"> 19G\tMovies/The.Lord.Of.The.Rings.The.Return.Of.The.King.2003.1080p.BluRay.x264-SiNNERS</div><div class=\"line\"> 16G\tMovies/The.Lord.Of.The.Rings.The.Fellowship.Of.The.Ring.2001.1080p.BluRay.x264-SiNNERS</div><div class=\"line\"> 15G\tMovies/Interstellar..2014.1080p.BluRay.x264.DTS-RARBG</div><div class=\"line\"> 14G\tMovies/Witness.for.the.Prosecution..1957.1080p.BluRay.x264.DTS-WiKi</div><div class=\"line\"> 14G\tMovies/Se7en..1995.REMASTERED.1080p.BluRay.x264.DTS-ES-FGT</div><div class=\"line\"> 14G\tMovies/In.Bruges..2008.1080p.BluRay.x264.DTS-FGT</div><div class=\"line\"> 13G\tMovies/Saving.Private.Ryan..1998.1080p.BluRay.x264-LEVERAGE</div><div class=\"line\"> 13G\tMovies/Braveheart..1995.1080p.BluRay.x264-CiNEFiLE</div><div class=\"line\"> 12G\tMovies/The.Hunt..2012.DANISH.1080p.BluRay.x264.DTS-FGT</div><div class=\"line\"> 12G\tMovies/The.Dark.Knight.Rises...2012.1080p.BluRay.x264-ALLiANCE</div><div class=\"line\"> 12G\tMovies/Life.of.Pi..2012.1080p.BluRay.x264.DTS-FGT</div><div class=\"line\"> 11G\tMovies/The.Lost.City.of.Z.Z.2016.1080p.BluRay.x264-GECKOS[rarbg]</div><div class=\"line\"> 11G\tMovies/Manhattan.Murder.Mystery..1993.1080p.BluRay.X264-AMIABLE[rarbg]</div><div class=\"line\"> 11G\tMovies/Like.Father.Like.Son..2013.1080p.BluRay.DTS.x264-PublicHD</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">telnet zk_ip 2181 | tee -a  -i someFile</div><div class=\"line\"></div><div class=\"line\">envi</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">nmon</div></pre></td></tr></table></figure>\n<h4 id=\"PID\"><a href=\"#PID\" class=\"headerlink\" title=\"PID\"></a>PID</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ lsof -i:9696</div><div class=\"line\">COMMAND    PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class=\"line\">kingshard 4994 eric   24u  IPv6 0x2dd5bc594d052b1f      0t0  TCP *:9696 (LISTEN)</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"http://blog.csdn.net/weiweicao0429/article/details/17578011\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/weiweicao0429/article/details/17578011</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># tc qdisc add dev eth0 root netem delay 100ms</span></div><div class=\"line\"><span class=\"comment\"># tc qdisc del dev eth0 root netem delay 100ms</span></div><div class=\"line\"><span class=\"comment\"># tc qdisc del dev eth0 root</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>dmesg</p>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo sed -i <span class=\"string\">'s/aaa/bbb/g'</span> `grep -Rl aaa order_migrate_conf/`</div></pre></td></tr></table></figure>\n<h4 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">grep -Rl 1496628000000 order_migrate_conf/</div></pre></td></tr></table></figure>\n<h4 id=\"vim-\"><a href=\"#vim-\" class=\"headerlink\" title=\"vim \"></a>vim </h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">less file.log</div></pre></td></tr></table></figure>\n<h4 id=\"kind-pay\"><a href=\"#kind-pay\" class=\"headerlink\" title=\"kind_pay\"></a>kind_pay</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tac file_path | grep kind_pay</div></pre></td></tr></table></figure>\n<p>less file_path, G(go to file end), /kind_pay + enter, N(search key word reversely)</p>\n<h4 id=\"TCP\"><a href=\"#TCP\" class=\"headerlink\" title=\"TCP\"></a>TCP</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ss  -tan|awk <span class=\"string\">'NR&gt;1&#123;++S[$1]&#125;END&#123;for (a in S) print a,S[a]&#125;'</span></div></pre></td></tr></table></figure>\n<h4 id=\"logs\"><a href=\"#logs\" class=\"headerlink\" title=\"logs\"></a>logs</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">du -sh logs/*</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ du -sh Movies/* | sort -nr</div><div class=\"line\"> 28G\tMovies/Pan&apos;s.Labyrinth..2006.1080p.BluRay.REMUX.MPEG-4.AVC.PCM-WARHD</div><div class=\"line\"> 19G\tMovies/The.Lord.Of.The.Rings.The.Return.Of.The.King.2003.1080p.BluRay.x264-SiNNERS</div><div class=\"line\"> 16G\tMovies/The.Lord.Of.The.Rings.The.Fellowship.Of.The.Ring.2001.1080p.BluRay.x264-SiNNERS</div><div class=\"line\"> 15G\tMovies/Interstellar..2014.1080p.BluRay.x264.DTS-RARBG</div><div class=\"line\"> 14G\tMovies/Witness.for.the.Prosecution..1957.1080p.BluRay.x264.DTS-WiKi</div><div class=\"line\"> 14G\tMovies/Se7en..1995.REMASTERED.1080p.BluRay.x264.DTS-ES-FGT</div><div class=\"line\"> 14G\tMovies/In.Bruges..2008.1080p.BluRay.x264.DTS-FGT</div><div class=\"line\"> 13G\tMovies/Saving.Private.Ryan..1998.1080p.BluRay.x264-LEVERAGE</div><div class=\"line\"> 13G\tMovies/Braveheart..1995.1080p.BluRay.x264-CiNEFiLE</div><div class=\"line\"> 12G\tMovies/The.Hunt..2012.DANISH.1080p.BluRay.x264.DTS-FGT</div><div class=\"line\"> 12G\tMovies/The.Dark.Knight.Rises...2012.1080p.BluRay.x264-ALLiANCE</div><div class=\"line\"> 12G\tMovies/Life.of.Pi..2012.1080p.BluRay.x264.DTS-FGT</div><div class=\"line\"> 11G\tMovies/The.Lost.City.of.Z.Z.2016.1080p.BluRay.x264-GECKOS[rarbg]</div><div class=\"line\"> 11G\tMovies/Manhattan.Murder.Mystery..1993.1080p.BluRay.X264-AMIABLE[rarbg]</div><div class=\"line\"> 11G\tMovies/Like.Father.Like.Son..2013.1080p.BluRay.DTS.x264-PublicHD</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">telnet zk_ip 2181 | tee -a  -i someFile</div><div class=\"line\"></div><div class=\"line\">envi</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">nmon</div></pre></td></tr></table></figure>\n<h4 id=\"PID\"><a href=\"#PID\" class=\"headerlink\" title=\"PID\"></a>PID</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ lsof -i:9696</div><div class=\"line\">COMMAND    PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class=\"line\">kingshard 4994 eric   24u  IPv6 0x2dd5bc594d052b1f      0t0  TCP *:9696 (LISTEN)</div></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"http://blog.csdn.net/weiweicao0429/article/details/17578011\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/weiweicao0429/article/details/17578011</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># tc qdisc add dev eth0 root netem delay 100ms</span></div><div class=\"line\"><span class=\"comment\"># tc qdisc del dev eth0 root netem delay 100ms</span></div><div class=\"line\"><span class=\"comment\"># tc qdisc del dev eth0 root</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>dmesg</p>\n"},{"title":"OS-Kernel-space-and-User-space","date":"2017-11-14T03:17:59.000Z","_content":"\nhttp://www.cnblogs.com/Anker/p/3269106.html\n","source":"_posts/Linux-Kernel-space-and-User-space.md","raw":"---\ntitle: OS-Kernel-space-and-User-space\ndate: 2017-11-14 11:17:59\ntags: Linux\n---\n\nhttp://www.cnblogs.com/Anker/p/3269106.html\n","slug":"Linux-Kernel-space-and-User-space","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz1001q3iq277vqqfxa","content":"<p><a href=\"http://www.cnblogs.com/Anker/p/3269106.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/Anker/p/3269106.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.cnblogs.com/Anker/p/3269106.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/Anker/p/3269106.html</a></p>\n"},{"title":"KafkaPage Cache","date":"2017-11-12T14:47:44.000Z","_content":"\n\n> \n\nhttp://blog.csdn.net/tototuzuoquan/article/details/73437890\n\nhttp://www.jianshu.com/p/eba0067b1e1a\n\n\nhttps://tech.meituan.com/kafka-fs-design-theory.html\n\n\n_java.nio.channels.FileChannel_\n`public abstract void force(boolean metaData) throws java.io.IOException`\nForces any updates to this channel's file to be written to the storage device that contains it.\nIf this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\nIf the file does not reside on a local device then no such guarantee is made.\nThe metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\nInvoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\nThis method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n\n_java.nio.MappedByteBuffer_\n`public final MappedByteBuffer force()`\nForces any changes made to this buffer's content to be written to the storage device containing the mapped file.\nIf the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\nIf the file does not reside on a local device then no such guarantee is made.\nIf this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n\n\n### Don't fear the filesystem!\n\nKafka relies heavily on the filesystem for storing and caching messages. There is a general perception that \"disks are slow\" which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.\n\nThe key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!\n\n![](Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg)\n\nTo compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.\n\nFurthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:\n\nThe memory overhead of objects is very high, often doubling the size of the data stored (or worse).\nJava garbage collection becomes increasingly fiddly and slow as the in-heap data increases.\nAs a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.\n\nThis suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernel's pagecache.\n\nThis style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).\n\n### sendfile\n\nsendfile() copies data between one file descriptor and another.\n\nBecause this copying is done within the kernel, sendfile() is more\nefficient than the combination of read(2) and write(2), which would\nrequire transferring data to and from user space.\n\n![](Kafka-High-performance-design-with-pagecache/read_write.gif)\n\nconventional read and write\n\n\n\n\nhttp://blog.csdn.net/stark_summer/article/details/50144591\n\nTips\n1. KafkaBrokerlog.flush.interval.messageslog.flush.interval.msReplicaFlush\n2. /proc/sys/vm/dirty_background_ratio/proc/sys/vm/dirty_ratio\na. pdflushFlush Dirty PageCache\nb. Flush\nc. dirty_background_ratiodirty_ratio","source":"_posts/Kafka-High-performance-design-with-pagecache.md","raw":"---\ntitle: KafkaPage Cache\ndate: 2017-11-12 22:47:44\ntags: Kafka\n---\n\n\n> \n\nhttp://blog.csdn.net/tototuzuoquan/article/details/73437890\n\nhttp://www.jianshu.com/p/eba0067b1e1a\n\n\nhttps://tech.meituan.com/kafka-fs-design-theory.html\n\n\n_java.nio.channels.FileChannel_\n`public abstract void force(boolean metaData) throws java.io.IOException`\nForces any updates to this channel's file to be written to the storage device that contains it.\nIf this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\nIf the file does not reside on a local device then no such guarantee is made.\nThe metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\nInvoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\nThis method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n\n_java.nio.MappedByteBuffer_\n`public final MappedByteBuffer force()`\nForces any changes made to this buffer's content to be written to the storage device containing the mapped file.\nIf the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\nIf the file does not reside on a local device then no such guarantee is made.\nIf this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n\n\n### Don't fear the filesystem!\n\nKafka relies heavily on the filesystem for storing and caching messages. There is a general perception that \"disks are slow\" which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.\n\nThe key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!\n\n![](Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg)\n\nTo compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.\n\nFurthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:\n\nThe memory overhead of objects is very high, often doubling the size of the data stored (or worse).\nJava garbage collection becomes increasingly fiddly and slow as the in-heap data increases.\nAs a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.\n\nThis suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernel's pagecache.\n\nThis style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).\n\n### sendfile\n\nsendfile() copies data between one file descriptor and another.\n\nBecause this copying is done within the kernel, sendfile() is more\nefficient than the combination of read(2) and write(2), which would\nrequire transferring data to and from user space.\n\n![](Kafka-High-performance-design-with-pagecache/read_write.gif)\n\nconventional read and write\n\n\n\n\nhttp://blog.csdn.net/stark_summer/article/details/50144591\n\nTips\n1. KafkaBrokerlog.flush.interval.messageslog.flush.interval.msReplicaFlush\n2. /proc/sys/vm/dirty_background_ratio/proc/sys/vm/dirty_ratio\na. pdflushFlush Dirty PageCache\nb. Flush\nc. dirty_background_ratiodirty_ratio","slug":"Kafka-High-performance-design-with-pagecache","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz2001s3iq2vlvq2mg0","content":"<blockquote>\n<p></p>\n</blockquote>\n<p><a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a></p>\n<p><a href=\"http://www.jianshu.com/p/eba0067b1e1a\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/eba0067b1e1a</a><br></p>\n<p><a href=\"https://tech.meituan.com/kafka-fs-design-theory.html\" target=\"_blank\" rel=\"external\">https://tech.meituan.com/kafka-fs-design-theory.html</a></p>\n<p><em>java.nio.channels.FileChannel</em><br><code>public abstract void force(boolean metaData) throws java.io.IOException</code><br>Forces any updates to this channels file to be written to the storage device that contains it.<br>If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br>If the file does not reside on a local device then no such guarantee is made.<br>The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br>Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br>This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p><em>java.nio.MappedByteBuffer</em><br><code>public final MappedByteBuffer force()</code><br>Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br>If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br>If the file does not reside on a local device then no such guarantee is made.<br>If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"Dont-fear-the-filesystem\"><a href=\"#Dont-fear-the-filesystem\" class=\"headerlink\" title=\"Dont fear the filesystem!\"></a>Dont fear the filesystem!</h3><p>Kafka relies heavily on the filesystem for storing and caching messages. There is a general perception that disks are slow which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.</p>\n<p>The key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg\" alt=\"\"></p>\n<p>To compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.</p>\n<p>Furthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:</p>\n<p>The memory overhead of objects is very high, often doubling the size of the data stored (or worse).<br>Java garbage collection becomes increasingly fiddly and slow as the in-heap data increases.<br>As a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.</p>\n<p>This suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernels pagecache.</p>\n<p>This style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).</p>\n<h3 id=\"sendfile\"><a href=\"#sendfile\" class=\"headerlink\" title=\"sendfile\"></a>sendfile</h3><p>sendfile() copies data between one file descriptor and another.</p>\n<p>Because this copying is done within the kernel, sendfile() is more<br>efficient than the combination of read(2) and write(2), which would<br>require transferring data to and from user space.</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/read_write.gif\" alt=\"\"></p>\n<p>conventional read and write</p>\n<p></p>\n<p><a href=\"http://blog.csdn.net/stark_summer/article/details/50144591\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/stark_summer/article/details/50144591</a></p>\n<p>Tips</p>\n<ol>\n<li>KafkaBrokerlog.flush.interval.messageslog.flush.interval.msReplicaFlush</li>\n<li>/proc/sys/vm/dirty_background_ratio/proc/sys/vm/dirty_ratio<br>a. pdflushFlush Dirty PageCache<br>b. Flush<br>c. dirty_background_ratiodirty_ratio</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p></p>\n</blockquote>\n<p><a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a></p>\n<p><a href=\"http://www.jianshu.com/p/eba0067b1e1a\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/eba0067b1e1a</a><br></p>\n<p><a href=\"https://tech.meituan.com/kafka-fs-design-theory.html\" target=\"_blank\" rel=\"external\">https://tech.meituan.com/kafka-fs-design-theory.html</a></p>\n<p><em>java.nio.channels.FileChannel</em><br><code>public abstract void force(boolean metaData) throws java.io.IOException</code><br>Forces any updates to this channels file to be written to the storage device that contains it.<br>If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br>If the file does not reside on a local device then no such guarantee is made.<br>The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br>Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br>This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p><em>java.nio.MappedByteBuffer</em><br><code>public final MappedByteBuffer force()</code><br>Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br>If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br>If the file does not reside on a local device then no such guarantee is made.<br>If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"Dont-fear-the-filesystem\"><a href=\"#Dont-fear-the-filesystem\" class=\"headerlink\" title=\"Dont fear the filesystem!\"></a>Dont fear the filesystem!</h3><p>Kafka relies heavily on the filesystem for storing and caching messages. There is a general perception that disks are slow which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.</p>\n<p>The key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a JBOD configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/seca difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this ACM Queue article; they actually find that sequential disk access can in some cases be faster than random memory access!</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg\" alt=\"\"></p>\n<p>To compensate for this performance divergence, modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.</p>\n<p>Furthermore, we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:</p>\n<p>The memory overhead of objects is very high, often doubling the size of the data stored (or worse).<br>Java garbage collection becomes increasingly fiddly and slow as the in-heap data increases.<br>As a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structurewe at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore, this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.</p>\n<p>This suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernels pagecache.</p>\n<p>This style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).</p>\n<h3 id=\"sendfile\"><a href=\"#sendfile\" class=\"headerlink\" title=\"sendfile\"></a>sendfile</h3><p>sendfile() copies data between one file descriptor and another.</p>\n<p>Because this copying is done within the kernel, sendfile() is more<br>efficient than the combination of read(2) and write(2), which would<br>require transferring data to and from user space.</p>\n<p><img src=\"/2017/11/12/Kafka-High-performance-design-with-pagecache/read_write.gif\" alt=\"\"></p>\n<p>conventional read and write</p>\n<p></p>\n<p><a href=\"http://blog.csdn.net/stark_summer/article/details/50144591\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/stark_summer/article/details/50144591</a></p>\n<p>Tips</p>\n<ol>\n<li>KafkaBrokerlog.flush.interval.messageslog.flush.interval.msReplicaFlush</li>\n<li>/proc/sys/vm/dirty_background_ratio/proc/sys/vm/dirty_ratio<br>a. pdflushFlush Dirty PageCache<br>b. Flush<br>c. dirty_background_ratiodirty_ratio</li>\n</ol>\n"},{"title":"Linux-Mmap","date":"2017-11-20T09:22:52.000Z","_content":"\nhttp://xiaoz5919.iteye.com/blog/2093323","source":"_posts/Linux-Mmap.md","raw":"---\ntitle: Linux-Mmap\ndate: 2017-11-20 17:22:52\ntags: Linux\n---\n\nhttp://xiaoz5919.iteye.com/blog/2093323","slug":"Linux-Mmap","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz2001u3iq25sb2tc7q","content":"<p><a href=\"http://xiaoz5919.iteye.com/blog/2093323\" target=\"_blank\" rel=\"external\">http://xiaoz5919.iteye.com/blog/2093323</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://xiaoz5919.iteye.com/blog/2093323\" target=\"_blank\" rel=\"external\">http://xiaoz5919.iteye.com/blog/2093323</a></p>\n"},{"title":"Linux-Zero-Copy","date":"2017-11-16T07:26:51.000Z","_content":"\n Zero copy \n\n\n### \nhttps://www.ibm.com/developerworks/library/j-zerocopy/\nhttp://www.cnblogs.com/zemliu/p/3695549.html","source":"_posts/Linux-Zero-Copy.md","raw":"---\ntitle: Linux-Zero-Copy\ndate: 2017-11-16 15:26:51\ntags: Linux\n---\n\n Zero copy \n\n\n### \nhttps://www.ibm.com/developerworks/library/j-zerocopy/\nhttp://www.cnblogs.com/zemliu/p/3695549.html","slug":"Linux-Zero-Copy","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz4001w3iq2ekv8tzku","content":"<p> Zero copy </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://www.ibm.com/developerworks/library/j-zerocopy/\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/library/j-zerocopy/</a><br><a href=\"http://www.cnblogs.com/zemliu/p/3695549.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/zemliu/p/3695549.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p> Zero copy </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://www.ibm.com/developerworks/library/j-zerocopy/\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/library/j-zerocopy/</a><br><a href=\"http://www.cnblogs.com/zemliu/p/3695549.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/zemliu/p/3695549.html</a></p>\n"},{"title":"OS-sync-async-blocking-noblocking","date":"2017-11-01T07:01:02.000Z","_content":"\nhttps://github.com/calidion/calidion.github.io/issues/40","source":"_posts/Linux-sync-async-blocking-noblocking.md","raw":"---\ntitle: OS-sync-async-blocking-noblocking\ndate: 2017-11-01 15:01:02\ntags: Linux\n---\n\nhttps://github.com/calidion/calidion.github.io/issues/40","slug":"Linux-sync-async-blocking-noblocking","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz4001y3iq21upnlcfx","content":"<p><a href=\"https://github.com/calidion/calidion.github.io/issues/40\" target=\"_blank\" rel=\"external\">https://github.com/calidion/calidion.github.io/issues/40</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://github.com/calidion/calidion.github.io/issues/40\" target=\"_blank\" rel=\"external\">https://github.com/calidion/calidion.github.io/issues/40</a></p>\n"},{"title":"MySQL Explain ","date":"2017-09-10T05:11:34.000Z","_content":"\n## select id\n\n``` sql\nexplain select * from student where stu_id = '1000003';\nexplain delete from student where stu_id = '11111';\n#\nexplain select * from (select * from student where stu_id = '1000003') tmp; \n#union select id \nexplain select * from student where stu_id = '1000003' union select * from student where stu_id = '1000004';\n```\n\nMore info: [MySQL DOC](https://dev.mysql.com/doc/refman/5.7/en/explain-output.html)","source":"_posts/MySQL-Explain.md","raw":"---\ntitle: MySQL Explain \ndate: 2017-09-10 13:11:34\ntags: MySQL\n---\n\n## select id\n\n``` sql\nexplain select * from student where stu_id = '1000003';\nexplain delete from student where stu_id = '11111';\n#\nexplain select * from (select * from student where stu_id = '1000003') tmp; \n#union select id \nexplain select * from student where stu_id = '1000003' union select * from student where stu_id = '1000004';\n```\n\nMore info: [MySQL DOC](https://dev.mysql.com/doc/refman/5.7/en/explain-output.html)","slug":"MySQL-Explain","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz600203iq26rajsf3m","content":"<h2 id=\"select-id\"><a href=\"#select-id\" class=\"headerlink\" title=\"select id\"></a>select id</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>;</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'11111'</span>;</div><div class=\"line\">#</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>) tmp; </div><div class=\"line\">#union select id </div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000004'</span>;</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html\" target=\"_blank\" rel=\"external\">MySQL DOC</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"select-id\"><a href=\"#select-id\" class=\"headerlink\" title=\"select id\"></a>select id</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>;</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'11111'</span>;</div><div class=\"line\">#</div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span>) tmp; </div><div class=\"line\">#union select id </div><div class=\"line\"><span class=\"keyword\">explain</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000003'</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> stu_id = <span class=\"string\">'1000004'</span>;</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html\" target=\"_blank\" rel=\"external\">MySQL DOC</a></p>\n"},{"title":"Netty-Bind-Port","date":"2017-12-04T02:05:04.000Z","_content":"\n``` java\n@Override\npublic void execute(Runnable task) {\n    if (task == null) {\n        throw new NullPointerException(\"task\");\n    }\n\n    boolean inEventLoop = inEventLoop();\n    if (inEventLoop) {\n        addTask(task);\n    } else {\n        //  eventLoop\n        startThread();\n        addTask(task);\n        if (isShutdown() && removeTask(task)) {\n            reject();\n        }\n    }\n\n    if (!addTaskWakesUp && wakesUpForTask(task)) {\n        wakeup(inEventLoop);\n    }\n}\n\nprivate void doStartThread() {\n    assert thread == null;\n    executor.execute(new Runnable() {\n        @Override\n        public void run() {\n            thread = Thread.currentThread();\n            if (interrupted) {\n                thread.interrupt();\n            }\n\n            boolean success = false;\n            updateLastExecutionTime();\n            try {\n                SingleThreadEventExecutor.this.run();\n                success = true;\n            } catch (Throwable t) {\n                logger.warn(\"Unexpected exception from an event executor: \", t);\n            } finally {\n                for (;;) {\n                    int oldState = STATE_UPDATER.get(SingleThreadEventExecutor.this);\n                    if (oldState >= ST_SHUTTING_DOWN || STATE_UPDATER.compareAndSet(\n                            SingleThreadEventExecutor.this, oldState, ST_SHUTTING_DOWN)) {\n                        break;\n                    }\n                }\n\n                // Check if confirmShutdown() was called at the end of the loop.\n                if (success && gracefulShutdownStartTime == 0) {\n                    logger.error(\"Buggy \" + EventExecutor.class.getSimpleName() + \" implementation; \" +\n                            SingleThreadEventExecutor.class.getSimpleName() + \".confirmShutdown() must be called \" +\n                            \"before run() implementation terminates.\");\n                }\n\n                try {\n                    // Run all remaining tasks and shutdown hooks.\n                    for (;;) {\n                        if (confirmShutdown()) {\n                            break;\n                        }\n                    }\n                } finally {\n                    try {\n                        cleanup();\n                    } finally {\n                        STATE_UPDATER.set(SingleThreadEventExecutor.this, ST_TERMINATED);\n                        threadLock.release();\n                        if (!taskQueue.isEmpty()) {\n                            logger.warn(\n                                    \"An event executor terminated with \" +\n                                            \"non-empty task queue (\" + taskQueue.size() + ')');\n                        }\n\n                        terminationFuture.setSuccess(null);\n                    }\n                }\n            }\n        }\n    });\n}\n\n\n@Override\nprotected void run() {\n    for (;;) {\n        try {\n            switch (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) {\n                case SelectStrategy.CONTINUE:\n                    continue;\n                case SelectStrategy.SELECT:\n                    select(wakenUp.getAndSet(false));\n\n                    // 'wakenUp.compareAndSet(false, true)' is always evaluated\n                    // before calling 'selector.wakeup()' to reduce the wake-up\n                    // overhead. (Selector.wakeup() is an expensive operation.)\n                    //\n                    // However, there is a race condition in this approach.\n                    // The race condition is triggered when 'wakenUp' is set to\n                    // true too early.\n                    //\n                    // 'wakenUp' is set to true too early if:\n                    // 1) Selector is waken up between 'wakenUp.set(false)' and\n                    //    'selector.select(...)'. (BAD)\n                    // 2) Selector is waken up between 'selector.select(...)' and\n                    //    'if (wakenUp.get()) { ... }'. (OK)\n                    //\n                    // In the first case, 'wakenUp' is set to true and the\n                    // following 'selector.select(...)' will wake up immediately.\n                    // Until 'wakenUp' is set to false again in the next round,\n                    // 'wakenUp.compareAndSet(false, true)' will fail, and therefore\n                    // any attempt to wake up the Selector will fail, too, causing\n                    // the following 'selector.select(...)' call to block\n                    // unnecessarily.\n                    //\n                    // To fix this problem, we wake up the selector again if wakenUp\n                    // is true immediately after selector.select(...).\n                    // It is inefficient in that it wakes up the selector for both\n                    // the first case (BAD - wake-up required) and the second case\n                    // (OK - no wake-up required).\n\n                    if (wakenUp.get()) {\n                        selector.wakeup();\n                    }\n                default:\n                    // fallthrough\n            }\n\n            cancelledKeys = 0;\n            needsToSelectAgain = false;\n            final int ioRatio = this.ioRatio;\n            if (ioRatio == 100) {\n                try {\n                    processSelectedKeys();\n                } finally {\n                    // Ensure we always run tasks.\n                    runAllTasks();\n                }\n            } else {\n                final long ioStartTime = System.nanoTime();\n                try {\n                    processSelectedKeys();\n                } finally {\n                    // Ensure we always run tasks.\n                    final long ioTime = System.nanoTime() - ioStartTime;\n                    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);\n                }\n            }\n        } catch (Throwable t) {\n            handleLoopException(t);\n        }\n        // Always handle shutdown even if the loop processing threw an exception.\n        try {\n            if (isShuttingDown()) {\n                closeAll();\n                if (confirmShutdown()) {\n                    return;\n                }\n            }\n        } catch (Throwable t) {\n            handleLoopException(t);\n        }\n    }\n}\n```\n\n``` java\nfinal long ioStartTime = System.nanoTime();\ntry {\n    processSelectedKeys();\n} finally {\n    // Ensure we always run tasks.\n    final long ioTime = System.nanoTime() - ioStartTime;\n    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);\n}\n```\n\nhttps://github.com/netty/netty/issues/6058\nprocessSelectedKeys();IO\nrunAllTasks();IO\n\nioTime / (n + ioTime) = ioRatio / (100)\n=> n = ioTime * (100 - ioRatio) / ioRatio\n\nhttp://budairenqin.iteye.com/blog/2215896","source":"_posts/Netty-Bind-Port.md","raw":"---\ntitle: Netty-Bind-Port\ndate: 2017-12-04 10:05:04\ntags: Netty\n---\n\n``` java\n@Override\npublic void execute(Runnable task) {\n    if (task == null) {\n        throw new NullPointerException(\"task\");\n    }\n\n    boolean inEventLoop = inEventLoop();\n    if (inEventLoop) {\n        addTask(task);\n    } else {\n        //  eventLoop\n        startThread();\n        addTask(task);\n        if (isShutdown() && removeTask(task)) {\n            reject();\n        }\n    }\n\n    if (!addTaskWakesUp && wakesUpForTask(task)) {\n        wakeup(inEventLoop);\n    }\n}\n\nprivate void doStartThread() {\n    assert thread == null;\n    executor.execute(new Runnable() {\n        @Override\n        public void run() {\n            thread = Thread.currentThread();\n            if (interrupted) {\n                thread.interrupt();\n            }\n\n            boolean success = false;\n            updateLastExecutionTime();\n            try {\n                SingleThreadEventExecutor.this.run();\n                success = true;\n            } catch (Throwable t) {\n                logger.warn(\"Unexpected exception from an event executor: \", t);\n            } finally {\n                for (;;) {\n                    int oldState = STATE_UPDATER.get(SingleThreadEventExecutor.this);\n                    if (oldState >= ST_SHUTTING_DOWN || STATE_UPDATER.compareAndSet(\n                            SingleThreadEventExecutor.this, oldState, ST_SHUTTING_DOWN)) {\n                        break;\n                    }\n                }\n\n                // Check if confirmShutdown() was called at the end of the loop.\n                if (success && gracefulShutdownStartTime == 0) {\n                    logger.error(\"Buggy \" + EventExecutor.class.getSimpleName() + \" implementation; \" +\n                            SingleThreadEventExecutor.class.getSimpleName() + \".confirmShutdown() must be called \" +\n                            \"before run() implementation terminates.\");\n                }\n\n                try {\n                    // Run all remaining tasks and shutdown hooks.\n                    for (;;) {\n                        if (confirmShutdown()) {\n                            break;\n                        }\n                    }\n                } finally {\n                    try {\n                        cleanup();\n                    } finally {\n                        STATE_UPDATER.set(SingleThreadEventExecutor.this, ST_TERMINATED);\n                        threadLock.release();\n                        if (!taskQueue.isEmpty()) {\n                            logger.warn(\n                                    \"An event executor terminated with \" +\n                                            \"non-empty task queue (\" + taskQueue.size() + ')');\n                        }\n\n                        terminationFuture.setSuccess(null);\n                    }\n                }\n            }\n        }\n    });\n}\n\n\n@Override\nprotected void run() {\n    for (;;) {\n        try {\n            switch (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) {\n                case SelectStrategy.CONTINUE:\n                    continue;\n                case SelectStrategy.SELECT:\n                    select(wakenUp.getAndSet(false));\n\n                    // 'wakenUp.compareAndSet(false, true)' is always evaluated\n                    // before calling 'selector.wakeup()' to reduce the wake-up\n                    // overhead. (Selector.wakeup() is an expensive operation.)\n                    //\n                    // However, there is a race condition in this approach.\n                    // The race condition is triggered when 'wakenUp' is set to\n                    // true too early.\n                    //\n                    // 'wakenUp' is set to true too early if:\n                    // 1) Selector is waken up between 'wakenUp.set(false)' and\n                    //    'selector.select(...)'. (BAD)\n                    // 2) Selector is waken up between 'selector.select(...)' and\n                    //    'if (wakenUp.get()) { ... }'. (OK)\n                    //\n                    // In the first case, 'wakenUp' is set to true and the\n                    // following 'selector.select(...)' will wake up immediately.\n                    // Until 'wakenUp' is set to false again in the next round,\n                    // 'wakenUp.compareAndSet(false, true)' will fail, and therefore\n                    // any attempt to wake up the Selector will fail, too, causing\n                    // the following 'selector.select(...)' call to block\n                    // unnecessarily.\n                    //\n                    // To fix this problem, we wake up the selector again if wakenUp\n                    // is true immediately after selector.select(...).\n                    // It is inefficient in that it wakes up the selector for both\n                    // the first case (BAD - wake-up required) and the second case\n                    // (OK - no wake-up required).\n\n                    if (wakenUp.get()) {\n                        selector.wakeup();\n                    }\n                default:\n                    // fallthrough\n            }\n\n            cancelledKeys = 0;\n            needsToSelectAgain = false;\n            final int ioRatio = this.ioRatio;\n            if (ioRatio == 100) {\n                try {\n                    processSelectedKeys();\n                } finally {\n                    // Ensure we always run tasks.\n                    runAllTasks();\n                }\n            } else {\n                final long ioStartTime = System.nanoTime();\n                try {\n                    processSelectedKeys();\n                } finally {\n                    // Ensure we always run tasks.\n                    final long ioTime = System.nanoTime() - ioStartTime;\n                    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);\n                }\n            }\n        } catch (Throwable t) {\n            handleLoopException(t);\n        }\n        // Always handle shutdown even if the loop processing threw an exception.\n        try {\n            if (isShuttingDown()) {\n                closeAll();\n                if (confirmShutdown()) {\n                    return;\n                }\n            }\n        } catch (Throwable t) {\n            handleLoopException(t);\n        }\n    }\n}\n```\n\n``` java\nfinal long ioStartTime = System.nanoTime();\ntry {\n    processSelectedKeys();\n} finally {\n    // Ensure we always run tasks.\n    final long ioTime = System.nanoTime() - ioStartTime;\n    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);\n}\n```\n\nhttps://github.com/netty/netty/issues/6058\nprocessSelectedKeys();IO\nrunAllTasks();IO\n\nioTime / (n + ioTime) = ioRatio / (100)\n=> n = ioTime * (100 - ioRatio) / ioRatio\n\nhttp://budairenqin.iteye.com/blog/2215896","slug":"Netty-Bind-Port","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz600223iq21j7hapdn","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable task)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (task == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException(<span class=\"string\">\"task\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">boolean</span> inEventLoop = inEventLoop();</div><div class=\"line\">    <span class=\"keyword\">if</span> (inEventLoop) &#123;</div><div class=\"line\">        addTask(task);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        <span class=\"comment\">//  eventLoop</span></div><div class=\"line\">        startThread();</div><div class=\"line\">        addTask(task);</div><div class=\"line\">        <span class=\"keyword\">if</span> (isShutdown() &amp;&amp; removeTask(task)) &#123;</div><div class=\"line\">            reject();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (!addTaskWakesUp &amp;&amp; wakesUpForTask(task)) &#123;</div><div class=\"line\">        wakeup(inEventLoop);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doStartThread</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">assert</span> thread == <span class=\"keyword\">null</span>;</div><div class=\"line\">    executor.execute(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">        <span class=\"meta\">@Override</span></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">            thread = Thread.currentThread();</div><div class=\"line\">            <span class=\"keyword\">if</span> (interrupted) &#123;</div><div class=\"line\">                thread.interrupt();</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">boolean</span> success = <span class=\"keyword\">false</span>;</div><div class=\"line\">            updateLastExecutionTime();</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                SingleThreadEventExecutor.<span class=\"keyword\">this</span>.run();</div><div class=\"line\">                success = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</div><div class=\"line\">                logger.warn(<span class=\"string\">\"Unexpected exception from an event executor: \"</span>, t);</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                    <span class=\"keyword\">int</span> oldState = STATE_UPDATER.get(SingleThreadEventExecutor.<span class=\"keyword\">this</span>);</div><div class=\"line\">                    <span class=\"keyword\">if</span> (oldState &gt;= ST_SHUTTING_DOWN || STATE_UPDATER.compareAndSet(</div><div class=\"line\">                            SingleThreadEventExecutor.<span class=\"keyword\">this</span>, oldState, ST_SHUTTING_DOWN)) &#123;</div><div class=\"line\">                        <span class=\"keyword\">break</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"comment\">// Check if confirmShutdown() was called at the end of the loop.</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (success &amp;&amp; gracefulShutdownStartTime == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    logger.error(<span class=\"string\">\"Buggy \"</span> + EventExecutor.class.getSimpleName() + <span class=\"string\">\" implementation; \"</span> +</div><div class=\"line\">                            SingleThreadEventExecutor.class.getSimpleName() + <span class=\"string\">\".confirmShutdown() must be called \"</span> +</div><div class=\"line\">                            <span class=\"string\">\"before run() implementation terminates.\"</span>);</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    <span class=\"comment\">// Run all remaining tasks and shutdown hooks.</span></div><div class=\"line\">                    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                        <span class=\"keyword\">if</span> (confirmShutdown()) &#123;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        cleanup();</div><div class=\"line\">                    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                        STATE_UPDATER.set(SingleThreadEventExecutor.<span class=\"keyword\">this</span>, ST_TERMINATED);</div><div class=\"line\">                        threadLock.release();</div><div class=\"line\">                        <span class=\"keyword\">if</span> (!taskQueue.isEmpty()) &#123;</div><div class=\"line\">                            logger.warn(</div><div class=\"line\">                                    <span class=\"string\">\"An event executor terminated with \"</span> +</div><div class=\"line\">                                            <span class=\"string\">\"non-empty task queue (\"</span> + taskQueue.size() + <span class=\"string\">')'</span>);</div><div class=\"line\">                        &#125;</div><div class=\"line\"></div><div class=\"line\">                        terminationFuture.setSuccess(<span class=\"keyword\">null</span>);</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;</div><div class=\"line\">                <span class=\"keyword\">case</span> SelectStrategy.CONTINUE:</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                <span class=\"keyword\">case</span> SelectStrategy.SELECT:</div><div class=\"line\">                    select(wakenUp.getAndSet(<span class=\"keyword\">false</span>));</div><div class=\"line\"></div><div class=\"line\">                    <span class=\"comment\">// 'wakenUp.compareAndSet(false, true)' is always evaluated</span></div><div class=\"line\">                    <span class=\"comment\">// before calling 'selector.wakeup()' to reduce the wake-up</span></div><div class=\"line\">                    <span class=\"comment\">// overhead. (Selector.wakeup() is an expensive operation.)</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// However, there is a race condition in this approach.</span></div><div class=\"line\">                    <span class=\"comment\">// The race condition is triggered when 'wakenUp' is set to</span></div><div class=\"line\">                    <span class=\"comment\">// true too early.</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// 'wakenUp' is set to true too early if:</span></div><div class=\"line\">                    <span class=\"comment\">// 1) Selector is waken up between 'wakenUp.set(false)' and</span></div><div class=\"line\">                    <span class=\"comment\">//    'selector.select(...)'. (BAD)</span></div><div class=\"line\">                    <span class=\"comment\">// 2) Selector is waken up between 'selector.select(...)' and</span></div><div class=\"line\">                    <span class=\"comment\">//    'if (wakenUp.get()) &#123; ... &#125;'. (OK)</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// In the first case, 'wakenUp' is set to true and the</span></div><div class=\"line\">                    <span class=\"comment\">// following 'selector.select(...)' will wake up immediately.</span></div><div class=\"line\">                    <span class=\"comment\">// Until 'wakenUp' is set to false again in the next round,</span></div><div class=\"line\">                    <span class=\"comment\">// 'wakenUp.compareAndSet(false, true)' will fail, and therefore</span></div><div class=\"line\">                    <span class=\"comment\">// any attempt to wake up the Selector will fail, too, causing</span></div><div class=\"line\">                    <span class=\"comment\">// the following 'selector.select(...)' call to block</span></div><div class=\"line\">                    <span class=\"comment\">// unnecessarily.</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// To fix this problem, we wake up the selector again if wakenUp</span></div><div class=\"line\">                    <span class=\"comment\">// is true immediately after selector.select(...).</span></div><div class=\"line\">                    <span class=\"comment\">// It is inefficient in that it wakes up the selector for both</span></div><div class=\"line\">                    <span class=\"comment\">// the first case (BAD - wake-up required) and the second case</span></div><div class=\"line\">                    <span class=\"comment\">// (OK - no wake-up required).</span></div><div class=\"line\"></div><div class=\"line\">                    <span class=\"keyword\">if</span> (wakenUp.get()) &#123;</div><div class=\"line\">                        selector.wakeup();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                <span class=\"keyword\">default</span>:</div><div class=\"line\">                    <span class=\"comment\">// fallthrough</span></div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            cancelledKeys = <span class=\"number\">0</span>;</div><div class=\"line\">            needsToSelectAgain = <span class=\"keyword\">false</span>;</div><div class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ioRatio = <span class=\"keyword\">this</span>.ioRatio;</div><div class=\"line\">            <span class=\"keyword\">if</span> (ioRatio == <span class=\"number\">100</span>) &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    processSelectedKeys();</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    <span class=\"comment\">// Ensure we always run tasks.</span></div><div class=\"line\">                    runAllTasks();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioStartTime = System.nanoTime();</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    processSelectedKeys();</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    <span class=\"comment\">// Ensure we always run tasks.</span></div><div class=\"line\">                    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioTime = System.nanoTime() - ioStartTime;</div><div class=\"line\">                    runAllTasks(ioTime * (<span class=\"number\">100</span> - ioRatio) / ioRatio);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</div><div class=\"line\">            handleLoopException(t);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">// Always handle shutdown even if the loop processing threw an exception.</span></div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (isShuttingDown()) &#123;</div><div class=\"line\">                closeAll();</div><div class=\"line\">                <span class=\"keyword\">if</span> (confirmShutdown()) &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</div><div class=\"line\">            handleLoopException(t);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioStartTime = System.nanoTime();</div><div class=\"line\"><span class=\"keyword\">try</span> &#123;</div><div class=\"line\">    processSelectedKeys();</div><div class=\"line\">&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">    <span class=\"comment\">// Ensure we always run tasks.</span></div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioTime = System.nanoTime() - ioStartTime;</div><div class=\"line\">    runAllTasks(ioTime * (<span class=\"number\">100</span> - ioRatio) / ioRatio);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/netty/netty/issues/6058\" target=\"_blank\" rel=\"external\">https://github.com/netty/netty/issues/6058</a><br>processSelectedKeys();IO<br>runAllTasks();IO</p>\n<p>ioTime / (n + ioTime) = ioRatio / (100)<br>=&gt; n = ioTime * (100 - ioRatio) / ioRatio</p>\n<p><a href=\"http://budairenqin.iteye.com/blog/2215896\" target=\"_blank\" rel=\"external\">http://budairenqin.iteye.com/blog/2215896</a></p>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable task)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (task == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException(<span class=\"string\">\"task\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">boolean</span> inEventLoop = inEventLoop();</div><div class=\"line\">    <span class=\"keyword\">if</span> (inEventLoop) &#123;</div><div class=\"line\">        addTask(task);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        <span class=\"comment\">//  eventLoop</span></div><div class=\"line\">        startThread();</div><div class=\"line\">        addTask(task);</div><div class=\"line\">        <span class=\"keyword\">if</span> (isShutdown() &amp;&amp; removeTask(task)) &#123;</div><div class=\"line\">            reject();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (!addTaskWakesUp &amp;&amp; wakesUpForTask(task)) &#123;</div><div class=\"line\">        wakeup(inEventLoop);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doStartThread</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">assert</span> thread == <span class=\"keyword\">null</span>;</div><div class=\"line\">    executor.execute(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">        <span class=\"meta\">@Override</span></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">            thread = Thread.currentThread();</div><div class=\"line\">            <span class=\"keyword\">if</span> (interrupted) &#123;</div><div class=\"line\">                thread.interrupt();</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">boolean</span> success = <span class=\"keyword\">false</span>;</div><div class=\"line\">            updateLastExecutionTime();</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                SingleThreadEventExecutor.<span class=\"keyword\">this</span>.run();</div><div class=\"line\">                success = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</div><div class=\"line\">                logger.warn(<span class=\"string\">\"Unexpected exception from an event executor: \"</span>, t);</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                    <span class=\"keyword\">int</span> oldState = STATE_UPDATER.get(SingleThreadEventExecutor.<span class=\"keyword\">this</span>);</div><div class=\"line\">                    <span class=\"keyword\">if</span> (oldState &gt;= ST_SHUTTING_DOWN || STATE_UPDATER.compareAndSet(</div><div class=\"line\">                            SingleThreadEventExecutor.<span class=\"keyword\">this</span>, oldState, ST_SHUTTING_DOWN)) &#123;</div><div class=\"line\">                        <span class=\"keyword\">break</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"comment\">// Check if confirmShutdown() was called at the end of the loop.</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (success &amp;&amp; gracefulShutdownStartTime == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    logger.error(<span class=\"string\">\"Buggy \"</span> + EventExecutor.class.getSimpleName() + <span class=\"string\">\" implementation; \"</span> +</div><div class=\"line\">                            SingleThreadEventExecutor.class.getSimpleName() + <span class=\"string\">\".confirmShutdown() must be called \"</span> +</div><div class=\"line\">                            <span class=\"string\">\"before run() implementation terminates.\"</span>);</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    <span class=\"comment\">// Run all remaining tasks and shutdown hooks.</span></div><div class=\"line\">                    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                        <span class=\"keyword\">if</span> (confirmShutdown()) &#123;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        cleanup();</div><div class=\"line\">                    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                        STATE_UPDATER.set(SingleThreadEventExecutor.<span class=\"keyword\">this</span>, ST_TERMINATED);</div><div class=\"line\">                        threadLock.release();</div><div class=\"line\">                        <span class=\"keyword\">if</span> (!taskQueue.isEmpty()) &#123;</div><div class=\"line\">                            logger.warn(</div><div class=\"line\">                                    <span class=\"string\">\"An event executor terminated with \"</span> +</div><div class=\"line\">                                            <span class=\"string\">\"non-empty task queue (\"</span> + taskQueue.size() + <span class=\"string\">')'</span>);</div><div class=\"line\">                        &#125;</div><div class=\"line\"></div><div class=\"line\">                        terminationFuture.setSuccess(<span class=\"keyword\">null</span>);</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;</div><div class=\"line\">                <span class=\"keyword\">case</span> SelectStrategy.CONTINUE:</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                <span class=\"keyword\">case</span> SelectStrategy.SELECT:</div><div class=\"line\">                    select(wakenUp.getAndSet(<span class=\"keyword\">false</span>));</div><div class=\"line\"></div><div class=\"line\">                    <span class=\"comment\">// 'wakenUp.compareAndSet(false, true)' is always evaluated</span></div><div class=\"line\">                    <span class=\"comment\">// before calling 'selector.wakeup()' to reduce the wake-up</span></div><div class=\"line\">                    <span class=\"comment\">// overhead. (Selector.wakeup() is an expensive operation.)</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// However, there is a race condition in this approach.</span></div><div class=\"line\">                    <span class=\"comment\">// The race condition is triggered when 'wakenUp' is set to</span></div><div class=\"line\">                    <span class=\"comment\">// true too early.</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// 'wakenUp' is set to true too early if:</span></div><div class=\"line\">                    <span class=\"comment\">// 1) Selector is waken up between 'wakenUp.set(false)' and</span></div><div class=\"line\">                    <span class=\"comment\">//    'selector.select(...)'. (BAD)</span></div><div class=\"line\">                    <span class=\"comment\">// 2) Selector is waken up between 'selector.select(...)' and</span></div><div class=\"line\">                    <span class=\"comment\">//    'if (wakenUp.get()) &#123; ... &#125;'. (OK)</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// In the first case, 'wakenUp' is set to true and the</span></div><div class=\"line\">                    <span class=\"comment\">// following 'selector.select(...)' will wake up immediately.</span></div><div class=\"line\">                    <span class=\"comment\">// Until 'wakenUp' is set to false again in the next round,</span></div><div class=\"line\">                    <span class=\"comment\">// 'wakenUp.compareAndSet(false, true)' will fail, and therefore</span></div><div class=\"line\">                    <span class=\"comment\">// any attempt to wake up the Selector will fail, too, causing</span></div><div class=\"line\">                    <span class=\"comment\">// the following 'selector.select(...)' call to block</span></div><div class=\"line\">                    <span class=\"comment\">// unnecessarily.</span></div><div class=\"line\">                    <span class=\"comment\">//</span></div><div class=\"line\">                    <span class=\"comment\">// To fix this problem, we wake up the selector again if wakenUp</span></div><div class=\"line\">                    <span class=\"comment\">// is true immediately after selector.select(...).</span></div><div class=\"line\">                    <span class=\"comment\">// It is inefficient in that it wakes up the selector for both</span></div><div class=\"line\">                    <span class=\"comment\">// the first case (BAD - wake-up required) and the second case</span></div><div class=\"line\">                    <span class=\"comment\">// (OK - no wake-up required).</span></div><div class=\"line\"></div><div class=\"line\">                    <span class=\"keyword\">if</span> (wakenUp.get()) &#123;</div><div class=\"line\">                        selector.wakeup();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                <span class=\"keyword\">default</span>:</div><div class=\"line\">                    <span class=\"comment\">// fallthrough</span></div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            cancelledKeys = <span class=\"number\">0</span>;</div><div class=\"line\">            needsToSelectAgain = <span class=\"keyword\">false</span>;</div><div class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ioRatio = <span class=\"keyword\">this</span>.ioRatio;</div><div class=\"line\">            <span class=\"keyword\">if</span> (ioRatio == <span class=\"number\">100</span>) &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    processSelectedKeys();</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    <span class=\"comment\">// Ensure we always run tasks.</span></div><div class=\"line\">                    runAllTasks();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioStartTime = System.nanoTime();</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    processSelectedKeys();</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    <span class=\"comment\">// Ensure we always run tasks.</span></div><div class=\"line\">                    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioTime = System.nanoTime() - ioStartTime;</div><div class=\"line\">                    runAllTasks(ioTime * (<span class=\"number\">100</span> - ioRatio) / ioRatio);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</div><div class=\"line\">            handleLoopException(t);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">// Always handle shutdown even if the loop processing threw an exception.</span></div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (isShuttingDown()) &#123;</div><div class=\"line\">                closeAll();</div><div class=\"line\">                <span class=\"keyword\">if</span> (confirmShutdown()) &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</div><div class=\"line\">            handleLoopException(t);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioStartTime = System.nanoTime();</div><div class=\"line\"><span class=\"keyword\">try</span> &#123;</div><div class=\"line\">    processSelectedKeys();</div><div class=\"line\">&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">    <span class=\"comment\">// Ensure we always run tasks.</span></div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioTime = System.nanoTime() - ioStartTime;</div><div class=\"line\">    runAllTasks(ioTime * (<span class=\"number\">100</span> - ioRatio) / ioRatio);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/netty/netty/issues/6058\" target=\"_blank\" rel=\"external\">https://github.com/netty/netty/issues/6058</a><br>processSelectedKeys();IO<br>runAllTasks();IO</p>\n<p>ioTime / (n + ioTime) = ioRatio / (100)<br>=&gt; n = ioTime * (100 - ioRatio) / ioRatio</p>\n<p><a href=\"http://budairenqin.iteye.com/blog/2215896\" target=\"_blank\" rel=\"external\">http://budairenqin.iteye.com/blog/2215896</a></p>\n"},{"title":"Netty-Buffer-Allocator","date":"2017-11-15T02:05:55.000Z","_content":"\npage  - a page is the smallest unit of memory chunk that can be allocated\n\npage4kb         byte a = 1; byte???\n\nhttp://www.jianshu.com/p/cec977b28079\n\nhttp://www.jianshu.com/u/dbcfb30ec5e4","source":"_posts/Netty-Buffer-Allocator.md","raw":"---\ntitle: Netty-Buffer-Allocator\ndate: 2017-11-15 10:05:55\ntags: Netty\n---\n\npage  - a page is the smallest unit of memory chunk that can be allocated\n\npage4kb         byte a = 1; byte???\n\nhttp://www.jianshu.com/p/cec977b28079\n\nhttp://www.jianshu.com/u/dbcfb30ec5e4","slug":"Netty-Buffer-Allocator","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz700243iq2rifp8qvr","content":"<p>page  - a page is the smallest unit of memory chunk that can be allocated</p>\n<p>page4kb         byte a = 1; byte???</p>\n<p><a href=\"http://www.jianshu.com/p/cec977b28079\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/cec977b28079</a></p>\n<p><a href=\"http://www.jianshu.com/u/dbcfb30ec5e4\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/u/dbcfb30ec5e4</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>page  - a page is the smallest unit of memory chunk that can be allocated</p>\n<p>page4kb         byte a = 1; byte???</p>\n<p><a href=\"http://www.jianshu.com/p/cec977b28079\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/cec977b28079</a></p>\n<p><a href=\"http://www.jianshu.com/u/dbcfb30ec5e4\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/u/dbcfb30ec5e4</a></p>\n"},{"title":"Netty-ChannelOption-Backlog","date":"2017-12-07T09:34:59.000Z","_content":"\nhttp://www.jianshu.com/p/e6f2036621f4","source":"_posts/Netty-ChannelOption-Backlog.md","raw":"---\ntitle: Netty-ChannelOption-Backlog\ndate: 2017-12-07 17:34:59\ntags:\n---\n\nhttp://www.jianshu.com/p/e6f2036621f4","slug":"Netty-ChannelOption-Backlog","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz800263iq2bmpvjcw5","content":"<p><a href=\"http://www.jianshu.com/p/e6f2036621f4\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/e6f2036621f4</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.jianshu.com/p/e6f2036621f4\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/e6f2036621f4</a></p>\n"},{"title":"Netty-ChannelOption","date":"2017-11-20T07:53:52.000Z","_content":"\n\nnettyChannelOptionlinuxChannelOption\n\nChannelOption\n\n1ChannelOption.SO_BACKLOG\n\nhttp://budairenqin.iteye.com/blog/2215899\n\nChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)\n\nbacklog\n\n2ChannelOption.SO_REUSEADDR\n\nChanneOption.SO_REUSEADDRSO_REUSEADDR\n\nTCP80\n\nSO_REUSEADDR\n\n\n\n3ChannelOption.SO_KEEPALIVE\n\nChanneloption.SO_KEEPALIVESO_KEEPALIVETCP\n\nTCP\n\n4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF\n\nChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF\n\n\n\n5ChannelOption.SO_LINGER\n\nChannelOption.SO_LINGERSO_LINGER,Linuxclose\n\nSO_LINGERclose()\n\n6ChannelOption.TCP_NODELAY\n\nChannelOption.TCP_NODELAYTCP_NODELAY,Nagle\n\nNagle,\n\nNagleTCP_NODELAYTCP_CORK\n\n\n\n","source":"_posts/Netty-ChannelOption.md","raw":"---\ntitle: Netty-ChannelOption\ndate: 2017-11-20 15:53:52\ntags: Netty\n---\n\n\nnettyChannelOptionlinuxChannelOption\n\nChannelOption\n\n1ChannelOption.SO_BACKLOG\n\nhttp://budairenqin.iteye.com/blog/2215899\n\nChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)\n\nbacklog\n\n2ChannelOption.SO_REUSEADDR\n\nChanneOption.SO_REUSEADDRSO_REUSEADDR\n\nTCP80\n\nSO_REUSEADDR\n\n\n\n3ChannelOption.SO_KEEPALIVE\n\nChanneloption.SO_KEEPALIVESO_KEEPALIVETCP\n\nTCP\n\n4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF\n\nChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF\n\n\n\n5ChannelOption.SO_LINGER\n\nChannelOption.SO_LINGERSO_LINGER,Linuxclose\n\nSO_LINGERclose()\n\n6ChannelOption.TCP_NODELAY\n\nChannelOption.TCP_NODELAYTCP_NODELAY,Nagle\n\nNagle,\n\nNagleTCP_NODELAYTCP_CORK\n\n\n\n","slug":"Netty-ChannelOption","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsz900283iq2sa3t8x1m","content":"<p>nettyChannelOptionlinuxChannelOption</p>\n<p>ChannelOption</p>\n<p>1ChannelOption.SO_BACKLOG</p>\n<p><a href=\"http://budairenqin.iteye.com/blog/2215899\" target=\"_blank\" rel=\"external\">http://budairenqin.iteye.com/blog/2215899</a></p>\n<p>ChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)</p>\n<p>backlog</p>\n<p>2ChannelOption.SO_REUSEADDR</p>\n<p>ChanneOption.SO_REUSEADDRSO_REUSEADDR</p>\n<p>TCP80</p>\n<p>SO_REUSEADDR</p>\n<p></p>\n<p>3ChannelOption.SO_KEEPALIVE</p>\n<p>Channeloption.SO_KEEPALIVESO_KEEPALIVETCP</p>\n<p>TCP</p>\n<p>4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF</p>\n<p>ChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF</p>\n<p></p>\n<p>5ChannelOption.SO_LINGER</p>\n<p>ChannelOption.SO_LINGERSO_LINGER,Linuxclose</p>\n<p>SO_LINGERclose()</p>\n<p>6ChannelOption.TCP_NODELAY</p>\n<p>ChannelOption.TCP_NODELAYTCP_NODELAY,Nagle</p>\n<p>Nagle,</p>\n<p>NagleTCP_NODELAYTCP_CORK</p>\n<p></p>\n","site":{"data":{}},"excerpt":"","more":"<p>nettyChannelOptionlinuxChannelOption</p>\n<p>ChannelOption</p>\n<p>1ChannelOption.SO_BACKLOG</p>\n<p><a href=\"http://budairenqin.iteye.com/blog/2215899\" target=\"_blank\" rel=\"external\">http://budairenqin.iteye.com/blog/2215899</a></p>\n<p>ChannelOption.SO_BACKLOGtcp/iplistenbackloglisten(int socketfd,int backlog)</p>\n<p>backlog</p>\n<p>2ChannelOption.SO_REUSEADDR</p>\n<p>ChanneOption.SO_REUSEADDRSO_REUSEADDR</p>\n<p>TCP80</p>\n<p>SO_REUSEADDR</p>\n<p></p>\n<p>3ChannelOption.SO_KEEPALIVE</p>\n<p>Channeloption.SO_KEEPALIVESO_KEEPALIVETCP</p>\n<p>TCP</p>\n<p>4ChannelOption.SO_SNDBUFChannelOpSNDBUFChannelOptiontion.SO_RCVBUF</p>\n<p>ChannelOption.SO_SNDBUFSO_SNDBUFChannelOption.SO_RCVBUFSO_RCVBUF</p>\n<p></p>\n<p>5ChannelOption.SO_LINGER</p>\n<p>ChannelOption.SO_LINGERSO_LINGER,Linuxclose</p>\n<p>SO_LINGERclose()</p>\n<p>6ChannelOption.TCP_NODELAY</p>\n<p>ChannelOption.TCP_NODELAYTCP_NODELAY,Nagle</p>\n<p>Nagle,</p>\n<p>NagleTCP_NODELAYTCP_CORK</p>\n<p></p>\n"},{"title":"Netty-","date":"2017-10-16T06:25:04.000Z","_content":"\n### Netty \nByteToMessageDecoderLengthFieldBasedFrameDecoder\n\n###  Future and Promise\n\n### Netty\n\nbytes and messages.\n\n### \ndebugnetty serverbossbossboss\n\nboss\n``` java\n NioEventLoopGroup boss = new NioEventLoopGroup(0, new ThreadFactory() {\n    @Override\n    public Thread newThread(Runnable r) {\n        return new Thread(r, \"boss-event-loop\");\n    }\n});\n```\nIntellijdebugnetty serverdebug tagThreads**Thread Group \"main\"****boss-event-loop**Running**boss-event-loop****suspend****Frames**tab\n\n### \nWeb Socket\nLong Pooling\n\n### NIO\n\n### Netty(watermark)\nhttps://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\nhttp://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\n\nNetty\n\n### NettyNettyInbound()Outbound() Handler\n\n### Netty\n\nio\nmqmaster slave\nmysql\n\n\n### Netty bind()\n\n``` java\n@Override\nprotected void doRegister() throws Exception {\n    boolean selected = false;\n    for (;;) {\n        try {\n            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), 0, this);\n            return;\n        } catch (CancelledKeyException e) {\n            if (!selected) {\n                // Force the Selector to select now as the \"canceled\" SelectionKey may still be\n                // cached and not removed because no Select.select(..) operation was called yet.\n                eventLoop().selectNow();\n                selected = true;\n            } else {\n                // We forced a select operation on the selector before but the SelectionKey is still cached\n                // for whatever reason. JDK bug ?\n                throw e;\n            }\n        }\n    }\n}\n```\nregister0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT\n\n### sendBufRecBuf\n\n### Netty\nhttp://blog.csdn.net/asdfayw/article/details/71730543\n\n### Netty\nhttp://www.jianshu.com/p/890525ff73cb\nhttp://www.jianshu.com/p/8f22675d71ac\n\n### Netty\nhttp://blog.csdn.net/dc_726/article/details/48978891\n\n### handlerchildHandler\n\n### \n\n``` java\nprivate static ServerSocketChannel newSocket(SelectorProvider provider) {\n        try {\n            /**\n             *  Use the {@link SelectorProvider} to open {@link SocketChannel} and so remove condition in\n             *  {@link SelectorProvider#provider()} which is called by each ServerSocketChannel.open() otherwise.\n             *\n             *  See <a href=\"https://github.com/netty/netty/issues/2308\">#2308</a>.\n             */\n            return provider.openServerSocketChannel();\n        } catch (IOException e) {\n            throw new ChannelException(\n                    \"Failed to open a server socket.\", e);\n        }\n    }\n```","source":"_posts/Netty-FAQ.md","raw":"---\ntitle: Netty-\ndate: 2017-10-16 14:25:04\ntags: Netty\n---\n\n### Netty \nByteToMessageDecoderLengthFieldBasedFrameDecoder\n\n###  Future and Promise\n\n### Netty\n\nbytes and messages.\n\n### \ndebugnetty serverbossbossboss\n\nboss\n``` java\n NioEventLoopGroup boss = new NioEventLoopGroup(0, new ThreadFactory() {\n    @Override\n    public Thread newThread(Runnable r) {\n        return new Thread(r, \"boss-event-loop\");\n    }\n});\n```\nIntellijdebugnetty serverdebug tagThreads**Thread Group \"main\"****boss-event-loop**Running**boss-event-loop****suspend****Frames**tab\n\n### \nWeb Socket\nLong Pooling\n\n### NIO\n\n### Netty(watermark)\nhttps://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\nhttp://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\n\nNetty\n\n### NettyNettyInbound()Outbound() Handler\n\n### Netty\n\nio\nmqmaster slave\nmysql\n\n\n### Netty bind()\n\n``` java\n@Override\nprotected void doRegister() throws Exception {\n    boolean selected = false;\n    for (;;) {\n        try {\n            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), 0, this);\n            return;\n        } catch (CancelledKeyException e) {\n            if (!selected) {\n                // Force the Selector to select now as the \"canceled\" SelectionKey may still be\n                // cached and not removed because no Select.select(..) operation was called yet.\n                eventLoop().selectNow();\n                selected = true;\n            } else {\n                // We forced a select operation on the selector before but the SelectionKey is still cached\n                // for whatever reason. JDK bug ?\n                throw e;\n            }\n        }\n    }\n}\n```\nregister0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT\n\n### sendBufRecBuf\n\n### Netty\nhttp://blog.csdn.net/asdfayw/article/details/71730543\n\n### Netty\nhttp://www.jianshu.com/p/890525ff73cb\nhttp://www.jianshu.com/p/8f22675d71ac\n\n### Netty\nhttp://blog.csdn.net/dc_726/article/details/48978891\n\n### handlerchildHandler\n\n### \n\n``` java\nprivate static ServerSocketChannel newSocket(SelectorProvider provider) {\n        try {\n            /**\n             *  Use the {@link SelectorProvider} to open {@link SocketChannel} and so remove condition in\n             *  {@link SelectorProvider#provider()} which is called by each ServerSocketChannel.open() otherwise.\n             *\n             *  See <a href=\"https://github.com/netty/netty/issues/2308\">#2308</a>.\n             */\n            return provider.openServerSocketChannel();\n        } catch (IOException e) {\n            throw new ChannelException(\n                    \"Failed to open a server socket.\", e);\n        }\n    }\n```","slug":"Netty-FAQ","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsza002a3iq29m143btj","content":"<h3 id=\"Netty-\"><a href=\"#Netty-\" class=\"headerlink\" title=\"Netty \"></a>Netty </h3><p>ByteToMessageDecoderLengthFieldBasedFrameDecoder</p>\n<h3 id=\"-Future-and-Promise\"><a href=\"#-Future-and-Promise\" class=\"headerlink\" title=\" Future and Promise\"></a> Future and Promise</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>bytes and messages.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>debugnetty serverbossbossboss</p>\n<p>boss<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"> NioEventLoopGroup boss = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">0</span>, <span class=\"keyword\">new</span> ThreadFactory() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Thread(r, <span class=\"string\">\"boss-event-loop\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<p>Intellijdebugnetty serverdebug tagThreads<strong>Thread Group main</strong><strong>boss-event-loop</strong>Running<strong>boss-event-loop</strong><strong>suspend</strong><strong>Frames</strong>tab</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Web Socket<br>Long Pooling</p>\n<h3 id=\"NIO\"><a href=\"#NIO\" class=\"headerlink\" title=\"NIO\"></a>NIO</h3><h3 id=\"Netty-watermark-\"><a href=\"#Netty-watermark-\" class=\"headerlink\" title=\"Netty(watermark)\"></a>Netty(watermark)</h3><p><a href=\"https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\" target=\"_blank\" rel=\"external\">https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks</a><br><a href=\"http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\" target=\"_blank\" rel=\"external\">http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard</a></p>\n<p>Netty</p>\n<h3 id=\"NettyNettyInbound--Outbound--Handler\"><a href=\"#NettyNettyInbound--Outbound--Handler\" class=\"headerlink\" title=\"NettyNettyInbound()Outbound() Handler\"></a>NettyNettyInbound()Outbound() Handler</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>io<br>mqmaster slave<br>mysql</p>\n<h3 id=\"Netty-bind-\"><a href=\"#Netty-bind-\" class=\"headerlink\" title=\"Netty bind()\"></a>Netty bind()</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doRegister</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> selected = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class=\"number\">0</span>, <span class=\"keyword\">this</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (CancelledKeyException e) &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (!selected) &#123;</div><div class=\"line\">                <span class=\"comment\">// Force the Selector to select now as the \"canceled\" SelectionKey may still be</span></div><div class=\"line\">                <span class=\"comment\">// cached and not removed because no Select.select(..) operation was called yet.</span></div><div class=\"line\">                eventLoop().selectNow();</div><div class=\"line\">                selected = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"comment\">// We forced a select operation on the selector before but the SelectionKey is still cached</span></div><div class=\"line\">                <span class=\"comment\">// for whatever reason. JDK bug ?</span></div><div class=\"line\">                <span class=\"keyword\">throw</span> e;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>register0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT</p>\n<h3 id=\"sendBufRecBuf\"><a href=\"#sendBufRecBuf\" class=\"headerlink\" title=\"sendBufRecBuf\"></a>sendBufRecBuf</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/asdfayw/article/details/71730543\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/asdfayw/article/details/71730543</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://www.jianshu.com/p/890525ff73cb\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/890525ff73cb</a><br><a href=\"http://www.jianshu.com/p/8f22675d71ac\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/8f22675d71ac</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/dc_726/article/details/48978891\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/dc_726/article/details/48978891</a></p>\n<h3 id=\"handlerchildHandler\"><a href=\"#handlerchildHandler\" class=\"headerlink\" title=\"handlerchildHandler\"></a>handlerchildHandler</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ServerSocketChannel <span class=\"title\">newSocket</span><span class=\"params\">(SelectorProvider provider)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">             *  Use the &#123;<span class=\"doctag\">@link</span> SelectorProvider&#125; to open &#123;<span class=\"doctag\">@link</span> SocketChannel&#125; and so remove condition in</span></div><div class=\"line\"><span class=\"comment\">             *  &#123;<span class=\"doctag\">@link</span> SelectorProvider#provider()&#125; which is called by each ServerSocketChannel.open() otherwise.</span></div><div class=\"line\"><span class=\"comment\">             *</span></div><div class=\"line\"><span class=\"comment\">             *  See &lt;a href=\"https://github.com/netty/netty/issues/2308\"&gt;#2308&lt;/a&gt;.</span></div><div class=\"line\"><span class=\"comment\">             */</span></div><div class=\"line\">            <span class=\"keyword\">return</span> provider.openServerSocketChannel();</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ChannelException(</div><div class=\"line\">                    <span class=\"string\">\"Failed to open a server socket.\"</span>, e);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Netty-\"><a href=\"#Netty-\" class=\"headerlink\" title=\"Netty \"></a>Netty </h3><p>ByteToMessageDecoderLengthFieldBasedFrameDecoder</p>\n<h3 id=\"-Future-and-Promise\"><a href=\"#-Future-and-Promise\" class=\"headerlink\" title=\" Future and Promise\"></a> Future and Promise</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>bytes and messages.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>debugnetty serverbossbossboss</p>\n<p>boss<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"> NioEventLoopGroup boss = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">0</span>, <span class=\"keyword\">new</span> ThreadFactory() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Thread(r, <span class=\"string\">\"boss-event-loop\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<p>Intellijdebugnetty serverdebug tagThreads<strong>Thread Group main</strong><strong>boss-event-loop</strong>Running<strong>boss-event-loop</strong><strong>suspend</strong><strong>Frames</strong>tab</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Web Socket<br>Long Pooling</p>\n<h3 id=\"NIO\"><a href=\"#NIO\" class=\"headerlink\" title=\"NIO\"></a>NIO</h3><h3 id=\"Netty-watermark-\"><a href=\"#Netty-watermark-\" class=\"headerlink\" title=\"Netty(watermark)\"></a>Netty(watermark)</h3><p><a href=\"https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks\" target=\"_blank\" rel=\"external\">https://stackoverflow.com/questions/25281124/netty-4-high-and-low-write-watermarks</a><br><a href=\"http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard\" target=\"_blank\" rel=\"external\">http://adolgarev.blogspot.ru/2013/12/pipelining-and-flow-control.html?view=flipcard</a></p>\n<p>Netty</p>\n<h3 id=\"NettyNettyInbound--Outbound--Handler\"><a href=\"#NettyNettyInbound--Outbound--Handler\" class=\"headerlink\" title=\"NettyNettyInbound()Outbound() Handler\"></a>NettyNettyInbound()Outbound() Handler</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>io<br>mqmaster slave<br>mysql</p>\n<h3 id=\"Netty-bind-\"><a href=\"#Netty-bind-\" class=\"headerlink\" title=\"Netty bind()\"></a>Netty bind()</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doRegister</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> selected = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class=\"number\">0</span>, <span class=\"keyword\">this</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (CancelledKeyException e) &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (!selected) &#123;</div><div class=\"line\">                <span class=\"comment\">// Force the Selector to select now as the \"canceled\" SelectionKey may still be</span></div><div class=\"line\">                <span class=\"comment\">// cached and not removed because no Select.select(..) operation was called yet.</span></div><div class=\"line\">                eventLoop().selectNow();</div><div class=\"line\">                selected = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"comment\">// We forced a select operation on the selector before but the SelectionKey is still cached</span></div><div class=\"line\">                <span class=\"comment\">// for whatever reason. JDK bug ?</span></div><div class=\"line\">                <span class=\"keyword\">throw</span> e;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>register0selectorserverSocketChannelselectorinterestselectorserverSocketChannelOP_ACCEPT</p>\n<h3 id=\"sendBufRecBuf\"><a href=\"#sendBufRecBuf\" class=\"headerlink\" title=\"sendBufRecBuf\"></a>sendBufRecBuf</h3><h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/asdfayw/article/details/71730543\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/asdfayw/article/details/71730543</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://www.jianshu.com/p/890525ff73cb\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/890525ff73cb</a><br><a href=\"http://www.jianshu.com/p/8f22675d71ac\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/8f22675d71ac</a></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p><a href=\"http://blog.csdn.net/dc_726/article/details/48978891\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/dc_726/article/details/48978891</a></p>\n<h3 id=\"handlerchildHandler\"><a href=\"#handlerchildHandler\" class=\"headerlink\" title=\"handlerchildHandler\"></a>handlerchildHandler</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ServerSocketChannel <span class=\"title\">newSocket</span><span class=\"params\">(SelectorProvider provider)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">             *  Use the &#123;<span class=\"doctag\">@link</span> SelectorProvider&#125; to open &#123;<span class=\"doctag\">@link</span> SocketChannel&#125; and so remove condition in</span></div><div class=\"line\"><span class=\"comment\">             *  &#123;<span class=\"doctag\">@link</span> SelectorProvider#provider()&#125; which is called by each ServerSocketChannel.open() otherwise.</span></div><div class=\"line\"><span class=\"comment\">             *</span></div><div class=\"line\"><span class=\"comment\">             *  See &lt;a href=\"https://github.com/netty/netty/issues/2308\"&gt;#2308&lt;/a&gt;.</span></div><div class=\"line\"><span class=\"comment\">             */</span></div><div class=\"line\">            <span class=\"keyword\">return</span> provider.openServerSocketChannel();</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ChannelException(</div><div class=\"line\">                    <span class=\"string\">\"Failed to open a server socket.\"</span>, e);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>"},{"title":"OSAHS","date":"2018-07-02T02:32:32.000Z","_content":"\n### OSAHS\nOSAHS\n\n## 2018-06-25\n\n\n210\n\n## 2018-06-26\n68\n\n\n\n2000ml\n\n## 2018-06-27\n10cm\n\n## 2018-06-28\n\n\n## 2018-06-29\nOSAHS40+\n\n## 2018-06-30\n6\n\n## 2018-07-01\n3\n\n## 2018-07-02\n712/2018-07-09","source":"_posts/OSAHS.md","raw":"---\ntitle: OSAHS\ndate: 2018-07-02 10:32:32\ntags:\n---\n\n### OSAHS\nOSAHS\n\n## 2018-06-25\n\n\n210\n\n## 2018-06-26\n68\n\n\n\n2000ml\n\n## 2018-06-27\n10cm\n\n## 2018-06-28\n\n\n## 2018-06-29\nOSAHS40+\n\n## 2018-06-30\n6\n\n## 2018-07-01\n3\n\n## 2018-07-02\n712/2018-07-09","slug":"OSAHS","published":1,"updated":"2018-07-02T07:32:10.000Z","_id":"cjj3wcszb002c3iq2v7h2mb46","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"OSAHS\"><a href=\"#OSAHS\" class=\"headerlink\" title=\"OSAHS\"></a>OSAHS</h3><p>OSAHS</p>\n<h2 id=\"2018-06-25\"><a href=\"#2018-06-25\" class=\"headerlink\" title=\"2018-06-25\"></a>2018-06-25</h2><p></p>\n<p>210</p>\n<h2 id=\"2018-06-26\"><a href=\"#2018-06-26\" class=\"headerlink\" title=\"2018-06-26\"></a>2018-06-26</h2><p>68</p>\n<p></p>\n<p>2000ml</p>\n<h2 id=\"2018-06-27\"><a href=\"#2018-06-27\" class=\"headerlink\" title=\"2018-06-27\"></a>2018-06-27</h2><p>10cm</p>\n<h2 id=\"2018-06-28\"><a href=\"#2018-06-28\" class=\"headerlink\" title=\"2018-06-28\"></a>2018-06-28</h2><p></p>\n<h2 id=\"2018-06-29\"><a href=\"#2018-06-29\" class=\"headerlink\" title=\"2018-06-29\"></a>2018-06-29</h2><p>OSAHS40+</p>\n<h2 id=\"2018-06-30\"><a href=\"#2018-06-30\" class=\"headerlink\" title=\"2018-06-30\"></a>2018-06-30</h2><p>6</p>\n<h2 id=\"2018-07-01\"><a href=\"#2018-07-01\" class=\"headerlink\" title=\"2018-07-01\"></a>2018-07-01</h2><p>3</p>\n<h2 id=\"2018-07-02\"><a href=\"#2018-07-02\" class=\"headerlink\" title=\"2018-07-02\"></a>2018-07-02</h2><p>712/2018-07-09</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"OSAHS\"><a href=\"#OSAHS\" class=\"headerlink\" title=\"OSAHS\"></a>OSAHS</h3><p>OSAHS</p>\n<h2 id=\"2018-06-25\"><a href=\"#2018-06-25\" class=\"headerlink\" title=\"2018-06-25\"></a>2018-06-25</h2><p></p>\n<p>210</p>\n<h2 id=\"2018-06-26\"><a href=\"#2018-06-26\" class=\"headerlink\" title=\"2018-06-26\"></a>2018-06-26</h2><p>68</p>\n<p></p>\n<p>2000ml</p>\n<h2 id=\"2018-06-27\"><a href=\"#2018-06-27\" class=\"headerlink\" title=\"2018-06-27\"></a>2018-06-27</h2><p>10cm</p>\n<h2 id=\"2018-06-28\"><a href=\"#2018-06-28\" class=\"headerlink\" title=\"2018-06-28\"></a>2018-06-28</h2><p></p>\n<h2 id=\"2018-06-29\"><a href=\"#2018-06-29\" class=\"headerlink\" title=\"2018-06-29\"></a>2018-06-29</h2><p>OSAHS40+</p>\n<h2 id=\"2018-06-30\"><a href=\"#2018-06-30\" class=\"headerlink\" title=\"2018-06-30\"></a>2018-06-30</h2><p>6</p>\n<h2 id=\"2018-07-01\"><a href=\"#2018-07-01\" class=\"headerlink\" title=\"2018-07-01\"></a>2018-07-01</h2><p>3</p>\n<h2 id=\"2018-07-02\"><a href=\"#2018-07-02\" class=\"headerlink\" title=\"2018-07-02\"></a>2018-07-02</h2><p>712/2018-07-09</p>\n"},{"title":"Netty-Performance-Test","date":"2017-12-07T04:52:29.000Z","_content":"\nhttps://www.infoq.com/news/2013/11/netty4-twitter","source":"_posts/Netty-Performance-Test.md","raw":"---\ntitle: Netty-Performance-Test\ndate: 2017-12-07 12:52:29\ntags: Netty\n---\n\nhttps://www.infoq.com/news/2013/11/netty4-twitter","slug":"Netty-Performance-Test","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszb002e3iq2xb0uzft0","content":"<p><a href=\"https://www.infoq.com/news/2013/11/netty4-twitter\" target=\"_blank\" rel=\"external\">https://www.infoq.com/news/2013/11/netty4-twitter</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://www.infoq.com/news/2013/11/netty4-twitter\" target=\"_blank\" rel=\"external\">https://www.infoq.com/news/2013/11/netty4-twitter</a></p>\n"},{"title":"Netty-Jemalloc","date":"2017-12-06T06:07:49.000Z","_content":"\nhttp://wangkaisino.blog.163.com/blog/static/1870444202011431112323846\n\n:\n\nNetty4\n\n[](http://www.infoq.com/news/2013/11/netty4-twitter)(Twitter)\nNettyNetty4\n\n<!--more-->\n\nNetty4`PooledByteBufAllocator`[jemalloc](http://www.canonware.com/jemalloc/)\nNetty4.04.0\n`jemalloc`\n\n# jemalloc\n\n**jemalloc** Jason EvansFreeBSD\n`malloc`malloc\n248jemallocGoogle[tcmalloc](https://code.google.com/p/gperftools/)\njemalloc\n\n## jemalloc\n\njemallocmallocmalloc\njemalloc()\n\n\n> **Arena**\n\nArena(Page)\n\njemalloc\n\n![jemalloc allocation size category](http://farm4.staticflickr.com/3749/12402575993_30e006725c_o.png)\n\nPage4KBsmalllargehugesmall\n:(smallTinyQuantum-SpacedSub-page\nNetty\n\nArenaround-robinArena\n\n> ArenaArena\n> Arena\n> \n> jemalloc\n\njemallocNetty4jemalloc\njemallocNetty4\n\n# Netty4\n\n`netty-4.0.15.Final`\n\nNetty4`PooledByteBufAllocator`ArenaPage\nChunkArenaChunkChunkNPage\n\n\n\n\n``` java\n// 8KB\nint defaultPageSize = SystemPropertyUtil.getInt(\"io.netty.allocator.pageSize\", 8192); \n\n// Chunk16MB2048\nint defaultMaxOrder = SystemPropertyUtil.getInt(\"io.netty.allocator.maxOrder\", 11);\nfinal int defaultChunkSize = DEFAULT_PAGE_SIZE << DEFAULT_MAX_ORDER;\n\n// Arena3ChunkArena\n// (50%)\n\nDEFAULT_NUM_HEAP_ARENA = Math.max(0,\n        SystemPropertyUtil.getInt(\n                \"io.netty.allocator.numHeapArenas\",\n                (int) Math.min(\n                        runtime.availableProcessors(),\n                        Runtime.getRuntime().maxMemory() / defaultChunkSize / 2 / 3)));\nDEFAULT_NUM_DIRECT_ARENA = Math.max(0,\n        SystemPropertyUtil.getInt(\n                \"io.netty.allocator.numDirectArenas\",\n                (int) Math.min(\n                        runtime.availableProcessors(),\n                        PlatformDependent.maxDirectMemory() / defaultChunkSize / 2 / 3)));\n```\n\n\nArenaDirect\nDirect\nJVM`Unsafe``PlatformDependent.hasUnsafe()`\n\n> \n\n\nN\n\n``` java\nif N < PAGE_SIZE:\n\tif N < 512:\n\t\treturn TINY;\n\telse\n\t\treturn SMALL;\nelif N > CHUNK_SIZE:\n\treturn HUGE;\nelse\n\treturn LARGE;\n```\n\n## \n\n\n\n\n``` java\nPooledByteBufAllocator alloc = new PooledByteBufAllocator(PlatformDependent.directBufferPreferred());\nByteBuf buff = alloc.ioBuffer(N);\n```\n\n\nJVMDirectN\n\n1.  ByteBuf\n2.  NN\n3.  \n\n\nN\n\n``` java\nprivate int normalizeCapacity(int reqCapacity) {\n    if (reqCapacity < 0) {\n        throw new IllegalArgumentException(\"capacity: \" + reqCapacity + \" (expected: 0+)\");\n    }\n    if (reqCapacity >= chunkSize) {\n        return reqCapacity;\n    }\n\n    if ((reqCapacity & 0xFFFFFE00) != 0) { // >= 512\n        // Doubled\n\n        int normalizedCapacity = reqCapacity;\n        normalizedCapacity |= normalizedCapacity >>>  1;\n        normalizedCapacity |= normalizedCapacity >>>  2;\n        normalizedCapacity |= normalizedCapacity >>>  4;\n        normalizedCapacity |= normalizedCapacity >>>  8;\n        normalizedCapacity |= normalizedCapacity >>> 16;\n        normalizedCapacity ++;\n\n        if (normalizedCapacity < 0) {\n            normalizedCapacity >>>= 1;\n        }\n\n        return normalizedCapacity;\n    }\n\n    // Quantum-spaced\n    if ((reqCapacity & 15) == 0) {\n        return reqCapacity;\n    }\n\n    return (reqCapacity & ~15) + 16;\n}\n```\n\n\n\n### \n\nNetty4ChunkN\nNetty4`2N`\n\n``` java\nint[] memoryMap = new int[N << 1]\n```\n\nN=4`memoryMap`4567\n4231Chunk\n\n![](http://farm3.staticflickr.com/2805/12403894375_2ee7cf93a4_o.png)\n\n\n\n``` java\nprivate static final int ST_UNUSED = 0;  // \n\nprivate static final int ST_BRANCH = 1;  // \n\n// \n// \nprivate static final int ST_ALLOCATED = 2; \n\n// Tiny\nprivate static final int ST_ALLOCATED_SUBPAGE = ST_ALLOCATED | 1;\n```\n\n### \n\n1\n`PooledByteBufAllocator``memoryMap`\n\n1. 1ChunkChunk\n2. 23\n3. 2\n\n> `memoryMap`,\n> \n> \n> \n\n### \n\n# \n\n## \n\n## \n\n# \n\n## ByteBuf","source":"_posts/Netty-Jemalloc.md","raw":"---\ntitle: Netty-Jemalloc\ndate: 2017-12-06 14:07:49\ntags: Netty\n---\n\nhttp://wangkaisino.blog.163.com/blog/static/1870444202011431112323846\n\n:\n\nNetty4\n\n[](http://www.infoq.com/news/2013/11/netty4-twitter)(Twitter)\nNettyNetty4\n\n<!--more-->\n\nNetty4`PooledByteBufAllocator`[jemalloc](http://www.canonware.com/jemalloc/)\nNetty4.04.0\n`jemalloc`\n\n# jemalloc\n\n**jemalloc** Jason EvansFreeBSD\n`malloc`malloc\n248jemallocGoogle[tcmalloc](https://code.google.com/p/gperftools/)\njemalloc\n\n## jemalloc\n\njemallocmallocmalloc\njemalloc()\n\n\n> **Arena**\n\nArena(Page)\n\njemalloc\n\n![jemalloc allocation size category](http://farm4.staticflickr.com/3749/12402575993_30e006725c_o.png)\n\nPage4KBsmalllargehugesmall\n:(smallTinyQuantum-SpacedSub-page\nNetty\n\nArenaround-robinArena\n\n> ArenaArena\n> Arena\n> \n> jemalloc\n\njemallocNetty4jemalloc\njemallocNetty4\n\n# Netty4\n\n`netty-4.0.15.Final`\n\nNetty4`PooledByteBufAllocator`ArenaPage\nChunkArenaChunkChunkNPage\n\n\n\n\n``` java\n// 8KB\nint defaultPageSize = SystemPropertyUtil.getInt(\"io.netty.allocator.pageSize\", 8192); \n\n// Chunk16MB2048\nint defaultMaxOrder = SystemPropertyUtil.getInt(\"io.netty.allocator.maxOrder\", 11);\nfinal int defaultChunkSize = DEFAULT_PAGE_SIZE << DEFAULT_MAX_ORDER;\n\n// Arena3ChunkArena\n// (50%)\n\nDEFAULT_NUM_HEAP_ARENA = Math.max(0,\n        SystemPropertyUtil.getInt(\n                \"io.netty.allocator.numHeapArenas\",\n                (int) Math.min(\n                        runtime.availableProcessors(),\n                        Runtime.getRuntime().maxMemory() / defaultChunkSize / 2 / 3)));\nDEFAULT_NUM_DIRECT_ARENA = Math.max(0,\n        SystemPropertyUtil.getInt(\n                \"io.netty.allocator.numDirectArenas\",\n                (int) Math.min(\n                        runtime.availableProcessors(),\n                        PlatformDependent.maxDirectMemory() / defaultChunkSize / 2 / 3)));\n```\n\n\nArenaDirect\nDirect\nJVM`Unsafe``PlatformDependent.hasUnsafe()`\n\n> \n\n\nN\n\n``` java\nif N < PAGE_SIZE:\n\tif N < 512:\n\t\treturn TINY;\n\telse\n\t\treturn SMALL;\nelif N > CHUNK_SIZE:\n\treturn HUGE;\nelse\n\treturn LARGE;\n```\n\n## \n\n\n\n\n``` java\nPooledByteBufAllocator alloc = new PooledByteBufAllocator(PlatformDependent.directBufferPreferred());\nByteBuf buff = alloc.ioBuffer(N);\n```\n\n\nJVMDirectN\n\n1.  ByteBuf\n2.  NN\n3.  \n\n\nN\n\n``` java\nprivate int normalizeCapacity(int reqCapacity) {\n    if (reqCapacity < 0) {\n        throw new IllegalArgumentException(\"capacity: \" + reqCapacity + \" (expected: 0+)\");\n    }\n    if (reqCapacity >= chunkSize) {\n        return reqCapacity;\n    }\n\n    if ((reqCapacity & 0xFFFFFE00) != 0) { // >= 512\n        // Doubled\n\n        int normalizedCapacity = reqCapacity;\n        normalizedCapacity |= normalizedCapacity >>>  1;\n        normalizedCapacity |= normalizedCapacity >>>  2;\n        normalizedCapacity |= normalizedCapacity >>>  4;\n        normalizedCapacity |= normalizedCapacity >>>  8;\n        normalizedCapacity |= normalizedCapacity >>> 16;\n        normalizedCapacity ++;\n\n        if (normalizedCapacity < 0) {\n            normalizedCapacity >>>= 1;\n        }\n\n        return normalizedCapacity;\n    }\n\n    // Quantum-spaced\n    if ((reqCapacity & 15) == 0) {\n        return reqCapacity;\n    }\n\n    return (reqCapacity & ~15) + 16;\n}\n```\n\n\n\n### \n\nNetty4ChunkN\nNetty4`2N`\n\n``` java\nint[] memoryMap = new int[N << 1]\n```\n\nN=4`memoryMap`4567\n4231Chunk\n\n![](http://farm3.staticflickr.com/2805/12403894375_2ee7cf93a4_o.png)\n\n\n\n``` java\nprivate static final int ST_UNUSED = 0;  // \n\nprivate static final int ST_BRANCH = 1;  // \n\n// \n// \nprivate static final int ST_ALLOCATED = 2; \n\n// Tiny\nprivate static final int ST_ALLOCATED_SUBPAGE = ST_ALLOCATED | 1;\n```\n\n### \n\n1\n`PooledByteBufAllocator``memoryMap`\n\n1. 1ChunkChunk\n2. 23\n3. 2\n\n> `memoryMap`,\n> \n> \n> \n\n### \n\n# \n\n## \n\n## \n\n# \n\n## ByteBuf","slug":"Netty-Jemalloc","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszc002g3iq23ojidxuk","content":"<p><a href=\"http://wangkaisino.blog.163.com/blog/static/1870444202011431112323846\" target=\"_blank\" rel=\"external\">http://wangkaisino.blog.163.com/blog/static/1870444202011431112323846</a></p>\n<p>:</p>\n<p>Netty4</p>\n<p><a href=\"http://www.infoq.com/news/2013/11/netty4-twitter\" target=\"_blank\" rel=\"external\"></a>(Twitter)<br>NettyNetty4</p>\n<a id=\"more\"></a>\n<p>Netty4<code>PooledByteBufAllocator</code><a href=\"http://www.canonware.com/jemalloc/\" target=\"_blank\" rel=\"external\">jemalloc</a><br>Netty4.04.0<br><code>jemalloc</code></p>\n<h1 id=\"jemalloc\"><a href=\"#jemalloc\" class=\"headerlink\" title=\"jemalloc\"></a>jemalloc</h1><p><strong>jemalloc</strong> Jason EvansFreeBSD<br><code>malloc</code>malloc<br>248jemallocGoogle<a href=\"https://code.google.com/p/gperftools/\" target=\"_blank\" rel=\"external\">tcmalloc</a><br>jemalloc</p>\n<h2 id=\"jemalloc\"><a href=\"#jemalloc\" class=\"headerlink\" title=\"jemalloc\"></a>jemalloc</h2><p>jemallocmallocmalloc<br>jemalloc()<br></p>\n<blockquote>\n<p><strong>Arena</strong></p>\n</blockquote>\n<p>Arena(Page)</p>\n<p>jemalloc</p>\n<p><img src=\"http://farm4.staticflickr.com/3749/12402575993_30e006725c_o.png\" alt=\"jemalloc allocation size category\"></p>\n<p>Page4KBsmalllargehugesmall<br>:(smallTinyQuantum-SpacedSub-page<br>Netty</p>\n<p>Arenaround-robinArena</p>\n<blockquote>\n<p>ArenaArena<br>Arena</p>\n<p>jemalloc</p>\n</blockquote>\n<p>jemallocNetty4jemalloc<br>jemallocNetty4</p>\n<h1 id=\"Netty4\"><a href=\"#Netty4\" class=\"headerlink\" title=\"Netty4\"></a>Netty4</h1><p><code>netty-4.0.15.Final</code></p>\n<p>Netty4<code>PooledByteBufAllocator</code>ArenaPage<br>ChunkArenaChunkChunkNPage</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// 8KB</span></div><div class=\"line\"><span class=\"keyword\">int</span> defaultPageSize = SystemPropertyUtil.getInt(<span class=\"string\">\"io.netty.allocator.pageSize\"</span>, <span class=\"number\">8192</span>); </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Chunk16MB2048</span></div><div class=\"line\"><span class=\"keyword\">int</span> defaultMaxOrder = SystemPropertyUtil.getInt(<span class=\"string\">\"io.netty.allocator.maxOrder\"</span>, <span class=\"number\">11</span>);</div><div class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> defaultChunkSize = DEFAULT_PAGE_SIZE &lt;&lt; DEFAULT_MAX_ORDER;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Arena3ChunkArena</span></div><div class=\"line\"><span class=\"comment\">// (50%)</span></div><div class=\"line\"></div><div class=\"line\">DEFAULT_NUM_HEAP_ARENA = Math.max(<span class=\"number\">0</span>,</div><div class=\"line\">        SystemPropertyUtil.getInt(</div><div class=\"line\">                <span class=\"string\">\"io.netty.allocator.numHeapArenas\"</span>,</div><div class=\"line\">                (<span class=\"keyword\">int</span>) Math.min(</div><div class=\"line\">                        runtime.availableProcessors(),</div><div class=\"line\">                        Runtime.getRuntime().maxMemory() / defaultChunkSize / <span class=\"number\">2</span> / <span class=\"number\">3</span>)));</div><div class=\"line\">DEFAULT_NUM_DIRECT_ARENA = Math.max(<span class=\"number\">0</span>,</div><div class=\"line\">        SystemPropertyUtil.getInt(</div><div class=\"line\">                <span class=\"string\">\"io.netty.allocator.numDirectArenas\"</span>,</div><div class=\"line\">                (<span class=\"keyword\">int</span>) Math.min(</div><div class=\"line\">                        runtime.availableProcessors(),</div><div class=\"line\">                        PlatformDependent.maxDirectMemory() / defaultChunkSize / <span class=\"number\">2</span> / <span class=\"number\">3</span>)));</div></pre></td></tr></table></figure>\n<p>ArenaDirect<br>Direct<br>JVM<code>Unsafe</code><code>PlatformDependent.hasUnsafe()</code></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>N</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> N &lt; PAGE_SIZE:</div><div class=\"line\">\t<span class=\"keyword\">if</span> N &lt; <span class=\"number\">512</span>:</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> TINY;</div><div class=\"line\">\t<span class=\"keyword\">else</span></div><div class=\"line\">\t\t<span class=\"keyword\">return</span> SMALL;</div><div class=\"line\">elif N &gt; CHUNK_SIZE:</div><div class=\"line\">\t<span class=\"keyword\">return</span> HUGE;</div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">\t<span class=\"keyword\">return</span> LARGE;</div></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">PooledByteBufAllocator alloc = <span class=\"keyword\">new</span> PooledByteBufAllocator(PlatformDependent.directBufferPreferred());</div><div class=\"line\">ByteBuf buff = alloc.ioBuffer(N);</div></pre></td></tr></table></figure>\n<p>JVMDirectN</p>\n<ol>\n<li>ByteBuf</li>\n<li>NN</li>\n<li></li>\n</ol>\n<p>N</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">normalizeCapacity</span><span class=\"params\">(<span class=\"keyword\">int</span> reqCapacity)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (reqCapacity &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"capacity: \"</span> + reqCapacity + <span class=\"string\">\" (expected: 0+)\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (reqCapacity &gt;= chunkSize) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> reqCapacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> ((reqCapacity &amp; <span class=\"number\">0xFFFFFE00</span>) != <span class=\"number\">0</span>) &#123; <span class=\"comment\">// &gt;= 512</span></div><div class=\"line\">        <span class=\"comment\">// Doubled</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> normalizedCapacity = reqCapacity;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">1</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">2</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">4</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">8</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt; <span class=\"number\">16</span>;</div><div class=\"line\">        normalizedCapacity ++;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (normalizedCapacity &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            normalizedCapacity &gt;&gt;&gt;= <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> normalizedCapacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Quantum-spaced</span></div><div class=\"line\">    <span class=\"keyword\">if</span> ((reqCapacity &amp; <span class=\"number\">15</span>) == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> reqCapacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> (reqCapacity &amp; ~<span class=\"number\">15</span>) + <span class=\"number\">16</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Netty4ChunkN<br>Netty4<code>2N</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">int</span>[] memoryMap = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[N &lt;&lt; <span class=\"number\">1</span>]</div></pre></td></tr></table></figure>\n<p>N=4<code>memoryMap</code>4567<br>4231Chunk</p>\n<p><img src=\"http://farm3.staticflickr.com/2805/12403894375_2ee7cf93a4_o.png\" alt=\"\"></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_UNUSED = <span class=\"number\">0</span>;  <span class=\"comment\">// </span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_BRANCH = <span class=\"number\">1</span>;  <span class=\"comment\">// </span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_ALLOCATED = <span class=\"number\">2</span>; </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Tiny</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_ALLOCATED_SUBPAGE = ST_ALLOCATED | <span class=\"number\">1</span>;</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>1<br><code>PooledByteBufAllocator</code><code>memoryMap</code></p>\n<ol>\n<li>1ChunkChunk</li>\n<li>23</li>\n<li>2</li>\n</ol>\n<blockquote>\n<p><code>memoryMap</code>,<br></p>\n<p></p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"ByteBuf\"><a href=\"#ByteBuf\" class=\"headerlink\" title=\"ByteBuf\"></a>ByteBuf</h2>","site":{"data":{}},"excerpt":"<p><a href=\"http://wangkaisino.blog.163.com/blog/static/1870444202011431112323846\" target=\"_blank\" rel=\"external\">http://wangkaisino.blog.163.com/blog/static/1870444202011431112323846</a></p>\n<p>:</p>\n<p>Netty4</p>\n<p><a href=\"http://www.infoq.com/news/2013/11/netty4-twitter\" target=\"_blank\" rel=\"external\"></a>(Twitter)<br>NettyNetty4</p>","more":"<p>Netty4<code>PooledByteBufAllocator</code><a href=\"http://www.canonware.com/jemalloc/\" target=\"_blank\" rel=\"external\">jemalloc</a><br>Netty4.04.0<br><code>jemalloc</code></p>\n<h1 id=\"jemalloc\"><a href=\"#jemalloc\" class=\"headerlink\" title=\"jemalloc\"></a>jemalloc</h1><p><strong>jemalloc</strong> Jason EvansFreeBSD<br><code>malloc</code>malloc<br>248jemallocGoogle<a href=\"https://code.google.com/p/gperftools/\" target=\"_blank\" rel=\"external\">tcmalloc</a><br>jemalloc</p>\n<h2 id=\"jemalloc\"><a href=\"#jemalloc\" class=\"headerlink\" title=\"jemalloc\"></a>jemalloc</h2><p>jemallocmallocmalloc<br>jemalloc()<br></p>\n<blockquote>\n<p><strong>Arena</strong></p>\n</blockquote>\n<p>Arena(Page)</p>\n<p>jemalloc</p>\n<p><img src=\"http://farm4.staticflickr.com/3749/12402575993_30e006725c_o.png\" alt=\"jemalloc allocation size category\"></p>\n<p>Page4KBsmalllargehugesmall<br>:(smallTinyQuantum-SpacedSub-page<br>Netty</p>\n<p>Arenaround-robinArena</p>\n<blockquote>\n<p>ArenaArena<br>Arena</p>\n<p>jemalloc</p>\n</blockquote>\n<p>jemallocNetty4jemalloc<br>jemallocNetty4</p>\n<h1 id=\"Netty4\"><a href=\"#Netty4\" class=\"headerlink\" title=\"Netty4\"></a>Netty4</h1><p><code>netty-4.0.15.Final</code></p>\n<p>Netty4<code>PooledByteBufAllocator</code>ArenaPage<br>ChunkArenaChunkChunkNPage</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// 8KB</span></div><div class=\"line\"><span class=\"keyword\">int</span> defaultPageSize = SystemPropertyUtil.getInt(<span class=\"string\">\"io.netty.allocator.pageSize\"</span>, <span class=\"number\">8192</span>); </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Chunk16MB2048</span></div><div class=\"line\"><span class=\"keyword\">int</span> defaultMaxOrder = SystemPropertyUtil.getInt(<span class=\"string\">\"io.netty.allocator.maxOrder\"</span>, <span class=\"number\">11</span>);</div><div class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> defaultChunkSize = DEFAULT_PAGE_SIZE &lt;&lt; DEFAULT_MAX_ORDER;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Arena3ChunkArena</span></div><div class=\"line\"><span class=\"comment\">// (50%)</span></div><div class=\"line\"></div><div class=\"line\">DEFAULT_NUM_HEAP_ARENA = Math.max(<span class=\"number\">0</span>,</div><div class=\"line\">        SystemPropertyUtil.getInt(</div><div class=\"line\">                <span class=\"string\">\"io.netty.allocator.numHeapArenas\"</span>,</div><div class=\"line\">                (<span class=\"keyword\">int</span>) Math.min(</div><div class=\"line\">                        runtime.availableProcessors(),</div><div class=\"line\">                        Runtime.getRuntime().maxMemory() / defaultChunkSize / <span class=\"number\">2</span> / <span class=\"number\">3</span>)));</div><div class=\"line\">DEFAULT_NUM_DIRECT_ARENA = Math.max(<span class=\"number\">0</span>,</div><div class=\"line\">        SystemPropertyUtil.getInt(</div><div class=\"line\">                <span class=\"string\">\"io.netty.allocator.numDirectArenas\"</span>,</div><div class=\"line\">                (<span class=\"keyword\">int</span>) Math.min(</div><div class=\"line\">                        runtime.availableProcessors(),</div><div class=\"line\">                        PlatformDependent.maxDirectMemory() / defaultChunkSize / <span class=\"number\">2</span> / <span class=\"number\">3</span>)));</div></pre></td></tr></table></figure>\n<p>ArenaDirect<br>Direct<br>JVM<code>Unsafe</code><code>PlatformDependent.hasUnsafe()</code></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>N</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> N &lt; PAGE_SIZE:</div><div class=\"line\">\t<span class=\"keyword\">if</span> N &lt; <span class=\"number\">512</span>:</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> TINY;</div><div class=\"line\">\t<span class=\"keyword\">else</span></div><div class=\"line\">\t\t<span class=\"keyword\">return</span> SMALL;</div><div class=\"line\">elif N &gt; CHUNK_SIZE:</div><div class=\"line\">\t<span class=\"keyword\">return</span> HUGE;</div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">\t<span class=\"keyword\">return</span> LARGE;</div></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">PooledByteBufAllocator alloc = <span class=\"keyword\">new</span> PooledByteBufAllocator(PlatformDependent.directBufferPreferred());</div><div class=\"line\">ByteBuf buff = alloc.ioBuffer(N);</div></pre></td></tr></table></figure>\n<p>JVMDirectN</p>\n<ol>\n<li>ByteBuf</li>\n<li>NN</li>\n<li></li>\n</ol>\n<p>N</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">normalizeCapacity</span><span class=\"params\">(<span class=\"keyword\">int</span> reqCapacity)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (reqCapacity &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"capacity: \"</span> + reqCapacity + <span class=\"string\">\" (expected: 0+)\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (reqCapacity &gt;= chunkSize) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> reqCapacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> ((reqCapacity &amp; <span class=\"number\">0xFFFFFE00</span>) != <span class=\"number\">0</span>) &#123; <span class=\"comment\">// &gt;= 512</span></div><div class=\"line\">        <span class=\"comment\">// Doubled</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> normalizedCapacity = reqCapacity;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">1</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">2</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">4</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt;  <span class=\"number\">8</span>;</div><div class=\"line\">        normalizedCapacity |= normalizedCapacity &gt;&gt;&gt; <span class=\"number\">16</span>;</div><div class=\"line\">        normalizedCapacity ++;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (normalizedCapacity &lt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            normalizedCapacity &gt;&gt;&gt;= <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> normalizedCapacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Quantum-spaced</span></div><div class=\"line\">    <span class=\"keyword\">if</span> ((reqCapacity &amp; <span class=\"number\">15</span>) == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> reqCapacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> (reqCapacity &amp; ~<span class=\"number\">15</span>) + <span class=\"number\">16</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Netty4ChunkN<br>Netty4<code>2N</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">int</span>[] memoryMap = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[N &lt;&lt; <span class=\"number\">1</span>]</div></pre></td></tr></table></figure>\n<p>N=4<code>memoryMap</code>4567<br>4231Chunk</p>\n<p><img src=\"http://farm3.staticflickr.com/2805/12403894375_2ee7cf93a4_o.png\" alt=\"\"></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_UNUSED = <span class=\"number\">0</span>;  <span class=\"comment\">// </span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_BRANCH = <span class=\"number\">1</span>;  <span class=\"comment\">// </span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_ALLOCATED = <span class=\"number\">2</span>; </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Tiny</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ST_ALLOCATED_SUBPAGE = ST_ALLOCATED | <span class=\"number\">1</span>;</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>1<br><code>PooledByteBufAllocator</code><code>memoryMap</code></p>\n<ol>\n<li>1ChunkChunk</li>\n<li>23</li>\n<li>2</li>\n</ol>\n<blockquote>\n<p><code>memoryMap</code>,<br></p>\n<p></p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"ByteBuf\"><a href=\"#ByteBuf\" class=\"headerlink\" title=\"ByteBuf\"></a>ByteBuf</h2>"},{"title":"Redis-SourceCode-Analysis","date":"2017-12-15T10:20:10.000Z","_content":"\n\nhttp://ningg.top/redis-lesson-2-source-code-review-in-xcode/\n\n\n\nhttps://mp.weixin.qq.com/s?__biz=MjM5ODc5ODgyMw==&mid=211169817&idx=1&sn=d5d0f6b10961bae54e58c7593105e8dd&3rd=MzA3MDU4NTYzMw==&scene=6#rd","source":"_posts/Redis-SourceCode-Analysis.md","raw":"---\ntitle: Redis-SourceCode-Analysis\ndate: 2017-12-15 18:20:10\ntags:\n---\n\n\nhttp://ningg.top/redis-lesson-2-source-code-review-in-xcode/\n\n\n\nhttps://mp.weixin.qq.com/s?__biz=MjM5ODc5ODgyMw==&mid=211169817&idx=1&sn=d5d0f6b10961bae54e58c7593105e8dd&3rd=MzA3MDU4NTYzMw==&scene=6#rd","slug":"Redis-SourceCode-Analysis","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszd002i3iq2pi7rwg9a","content":"<p><a href=\"http://ningg.top/redis-lesson-2-source-code-review-in-xcode/\" target=\"_blank\" rel=\"external\">http://ningg.top/redis-lesson-2-source-code-review-in-xcode/</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5ODc5ODgyMw==&amp;mid=211169817&amp;idx=1&amp;sn=d5d0f6b10961bae54e58c7593105e8dd&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd\" target=\"_blank\" rel=\"external\">https://mp.weixin.qq.com/s?__biz=MjM5ODc5ODgyMw==&amp;mid=211169817&amp;idx=1&amp;sn=d5d0f6b10961bae54e58c7593105e8dd&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://ningg.top/redis-lesson-2-source-code-review-in-xcode/\" target=\"_blank\" rel=\"external\">http://ningg.top/redis-lesson-2-source-code-review-in-xcode/</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5ODc5ODgyMw==&amp;mid=211169817&amp;idx=1&amp;sn=d5d0f6b10961bae54e58c7593105e8dd&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd\" target=\"_blank\" rel=\"external\">https://mp.weixin.qq.com/s?__biz=MjM5ODc5ODgyMw==&amp;mid=211169817&amp;idx=1&amp;sn=d5d0f6b10961bae54e58c7593105e8dd&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd</a></p>\n"},{"title":"RocketMQConsumer Rebalance ","date":"2017-09-25T08:58:43.000Z","_content":"","source":"_posts/RocketMQ-Consumer-rebalance.md","raw":"---\ntitle: RocketMQConsumer Rebalance \ndate: 2017-09-25 16:58:43\ntags: RocketMQ\n---\n","slug":"RocketMQ-Consumer-rebalance","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcsze002k3iq2vee6r50k","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"RocketMQIntellij","date":"2017-08-20T05:28:52.000Z","_content":"\n### \n\n\nMQIntellijRemote debug\n\nMacRocketMQ\n\n### \n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n### Name Server\n\n### Broker\nBroker\nRocketMQBroker\nMasterSlave\n\nstore`System.getProperty(\"user.home\") + File.separator + \"store\"`\nMasterSlave`user.home`\n\nPortbroker-a.propertiesbroker-a-s.properties\n\n#### Master Broker\n\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties\n\nbroker-a.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=0\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SYNC_MASTER\nflushDiskType=ASYNC_FLUSH\nlistenPort=11111\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n#### Slave Broker\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties\n\nbroker-a-s.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\nlistenPort=22222\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n Name Server, Master Broker, Slave Broker Producer\n\nStore\n\n![](https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg)\n\n\n\n1. \n2. RocketMQ + ","source":"_posts/RocketMQ-Debug-with-intellij.md","raw":"---\ntitle: RocketMQIntellij\ndate: 2017-08-20 13:28:52\ntags: RocketMQ\n---\n\n### \n\n\nMQIntellijRemote debug\n\nMacRocketMQ\n\n### \n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n### Name Server\n\n### Broker\nBroker\nRocketMQBroker\nMasterSlave\n\nstore`System.getProperty(\"user.home\") + File.separator + \"store\"`\nMasterSlave`user.home`\n\nPortbroker-a.propertiesbroker-a-s.properties\n\n#### Master Broker\n\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties\n\nbroker-a.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=0\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SYNC_MASTER\nflushDiskType=ASYNC_FLUSH\nlistenPort=11111\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n#### Slave Broker\n```\nVM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave\nProgram arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties\n\nbroker-a-s.properties:\nbrokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\nlistenPort=22222\n```\n\n![image.png](http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n Name Server, Master Broker, Slave Broker Producer\n\nStore\n\n![](https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg)\n\n\n\n1. \n2. RocketMQ + ","slug":"RocketMQ-Debug-with-intellij","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszf002m3iq2kg8i6lo9","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>MQIntellijRemote debug</p>\n<p>MacRocketMQ</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h3 id=\"Name-Server\"><a href=\"#Name-Server\" class=\"headerlink\" title=\"Name Server\"></a>Name Server</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h3><p>Broker<br>RocketMQBroker<br>MasterSlave</p>\n<p>store<code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>MasterSlave<code>user.home</code></p>\n<p>Portbroker-a.propertiesbroker-a-s.properties</p>\n<h4 id=\"Master-Broker\"><a href=\"#Master-Broker\" class=\"headerlink\" title=\"Master Broker\"></a>Master Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties</div><div class=\"line\"></div><div class=\"line\">broker-a.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=0</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SYNC_MASTER</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=11111</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h4 id=\"Slave-Broker\"><a href=\"#Slave-Broker\" class=\"headerlink\" title=\"Slave Broker\"></a>Slave Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties</div><div class=\"line\"></div><div class=\"line\">broker-a-s.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=1</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SLAVE</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=22222</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<p> Name Server, Master Broker, Slave Broker Producer</p>\n<p>Store</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li></li>\n<li>RocketMQ + </li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>MQIntellijRemote debug</p>\n<p>MacRocketMQ</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://upload-images.jianshu.io/upload_images/716353-1c36c4f4f54283e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h3 id=\"Name-Server\"><a href=\"#Name-Server\" class=\"headerlink\" title=\"Name Server\"></a>Name Server</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h3><p>Broker<br>RocketMQBroker<br>MasterSlave</p>\n<p>store<code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>MasterSlave<code>user.home</code></p>\n<p>Portbroker-a.propertiesbroker-a-s.properties</p>\n<h4 id=\"Master-Broker\"><a href=\"#Master-Broker\" class=\"headerlink\" title=\"Master Broker\"></a>Master Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/master</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a.properties</div><div class=\"line\"></div><div class=\"line\">broker-a.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=0</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SYNC_MASTER</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=11111</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-269519f3558de100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<h4 id=\"Slave-Broker\"><a href=\"#Slave-Broker\" class=\"headerlink\" title=\"Slave Broker\"></a>Slave Broker</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">VM options:-Drocketmq.home.dir=/Users/eric/Code/middleware/incubator-rocketmq -Drocketmq.namesrv.addr=mac:9876 -Duser.home=/Users/eric/store/slave</div><div class=\"line\">Program arguments:-c /Users/eric/Code/middleware/incubator-rocketmq/conf/2m-2s-sync/broker-a-s.properties</div><div class=\"line\"></div><div class=\"line\">broker-a-s.properties:</div><div class=\"line\">brokerClusterName=DefaultCluster</div><div class=\"line\">brokerName=broker-a</div><div class=\"line\">brokerId=1</div><div class=\"line\">deleteWhen=04</div><div class=\"line\">fileReservedTime=48</div><div class=\"line\">brokerRole=SLAVE</div><div class=\"line\">flushDiskType=ASYNC_FLUSH</div><div class=\"line\">listenPort=22222</div></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/716353-473218e8e6936674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"></p>\n<p> Name Server, Master Broker, Slave Broker Producer</p>\n<p>Store</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fkedpuigp8j317e1a80zy.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li></li>\n<li>RocketMQ + </li>\n</ol>\n"},{"title":"RocketMQ","date":"2017-10-13T02:38:19.000Z","_content":"\n### \n\n``` java\nconsumer.registerMessageListener(new MessageListenerConcurrently() {\n    @Override\n    public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs,\n        ConsumeConcurrentlyContext context) {\n        // \n        boolean success = doConsume(msgs);\n        \n        if (success) {\n            return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n        } else {\n            return ConsumeConcurrentlyStatus.RECONSUME_LATER;\n        }\n    }\n});\n```\n\n### \n\n``` java\n\n```\n\n###  Best Effort Delivery","source":"_posts/RocketMQ-Delay-message-delivery.md","raw":"---\ntitle: RocketMQ\ndate: 2017-10-13 10:38:19\ntags: RocketMQ\n---\n\n### \n\n``` java\nconsumer.registerMessageListener(new MessageListenerConcurrently() {\n    @Override\n    public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs,\n        ConsumeConcurrentlyContext context) {\n        // \n        boolean success = doConsume(msgs);\n        \n        if (success) {\n            return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n        } else {\n            return ConsumeConcurrentlyStatus.RECONSUME_LATER;\n        }\n    }\n});\n```\n\n### \n\n``` java\n\n```\n\n###  Best Effort Delivery","slug":"RocketMQ-Delay-message-delivery","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszg002o3iq2fon5c2qo","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">        ConsumeConcurrentlyContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// </span></div><div class=\"line\">        <span class=\"keyword\">boolean</span> success = doConsume(msgs);</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<h3 id=\"-Best-Effort-Delivery\"><a href=\"#-Best-Effort-Delivery\" class=\"headerlink\" title=\" Best Effort Delivery\"></a> Best Effort Delivery</h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">        ConsumeConcurrentlyContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// </span></div><div class=\"line\">        <span class=\"keyword\">boolean</span> success = doConsume(msgs);</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<h3 id=\"-Best-Effort-Delivery\"><a href=\"#-Best-Effort-Delivery\" class=\"headerlink\" title=\" Best Effort Delivery\"></a> Best Effort Delivery</h3>"},{"title":"RocketMQIndexService ","date":"2017-10-12T11:29:40.000Z","_content":"\n\n#### RocmetMQIndexService\n\n![](RocketMQ-Index-service/index-file.gif)\n\nRocketMQIndexServiceMQ\n `System.getProperty(\"user.home\") + File.separator + \"store\"`\ntopic\n![image.png](http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\nMQIndexFileindex file\nindex file3IndexHead + HashSlotPart + MsgIndexPart\nIndexHead\n\nHashSlotPart\nhashMsgIndexPart\n4 Byte\nMsgIndexPart\nmsgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int\nMsgIndexPartcapacityappend\n\n\n\n \n`int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);`\n\nCommitLogDispatcherBuildIndexdispatch\n``` java\npublic void dispatch(DispatchRequest request) {\n    if (DefaultMessageStore.this.messageStoreConfig.isMessageIndexEnable()) {\n        DefaultMessageStore.this.indexService.buildIndex(request);\n    }\n}\n```\nbuildIndextopic#msgId=>msgIndex, topic#key1=>msgIndex, topic#key2=>msgIndex\n``` java\npublic void buildIndex(DispatchRequest req) {\n    IndexFile indexFile = retryGetAndCreateIndexFile();\n    if (indexFile != null) {\n        long endPhyOffset = indexFile.getEndPhyOffset();\n        DispatchRequest msg = req;\n        String topic = msg.getTopic();\n        String keys = msg.getKeys();\n\n        ...\n        if (req.getUniqKey() != null) {\n            // UniqKeymsgId\n            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));\n            ...\n        }\n\n        if (keys != null && keys.length() > 0) {\n            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);\n            for (int i = 0; i < keyset.length; i++) {\n                String key = keyset[i];\n                if (key.length() > 0) {\n                    // Key\n                    indexFile = putKey(indexFile, msg, buildKey(topic, key));\n                    ...\n                }\n            }\n        }\n    } else {\n        log.error(\"build index error, stop building index\");\n    }\n}\n```","source":"_posts/RocketMQ-Index-service.md","raw":"---\ntitle: RocketMQIndexService \ndate: 2017-10-12 19:29:40\ntags: RocketMQ\n---\n\n\n#### RocmetMQIndexService\n\n![](RocketMQ-Index-service/index-file.gif)\n\nRocketMQIndexServiceMQ\n `System.getProperty(\"user.home\") + File.separator + \"store\"`\ntopic\n![image.png](http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\nMQIndexFileindex file\nindex file3IndexHead + HashSlotPart + MsgIndexPart\nIndexHead\n\nHashSlotPart\nhashMsgIndexPart\n4 Byte\nMsgIndexPart\nmsgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int\nMsgIndexPartcapacityappend\n\n\n\n \n`int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);`\n\nCommitLogDispatcherBuildIndexdispatch\n``` java\npublic void dispatch(DispatchRequest request) {\n    if (DefaultMessageStore.this.messageStoreConfig.isMessageIndexEnable()) {\n        DefaultMessageStore.this.indexService.buildIndex(request);\n    }\n}\n```\nbuildIndextopic#msgId=>msgIndex, topic#key1=>msgIndex, topic#key2=>msgIndex\n``` java\npublic void buildIndex(DispatchRequest req) {\n    IndexFile indexFile = retryGetAndCreateIndexFile();\n    if (indexFile != null) {\n        long endPhyOffset = indexFile.getEndPhyOffset();\n        DispatchRequest msg = req;\n        String topic = msg.getTopic();\n        String keys = msg.getKeys();\n\n        ...\n        if (req.getUniqKey() != null) {\n            // UniqKeymsgId\n            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));\n            ...\n        }\n\n        if (keys != null && keys.length() > 0) {\n            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);\n            for (int i = 0; i < keyset.length; i++) {\n                String key = keyset[i];\n                if (key.length() > 0) {\n                    // Key\n                    indexFile = putKey(indexFile, msg, buildKey(topic, key));\n                    ...\n                }\n            }\n        }\n    } else {\n        log.error(\"build index error, stop building index\");\n    }\n}\n```","slug":"RocketMQ-Index-service","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszh002q3iq23tzaootq","content":"<h4 id=\"RocmetMQIndexService\"><a href=\"#RocmetMQIndexService\" class=\"headerlink\" title=\"RocmetMQIndexService\"></a>RocmetMQIndexService</h4><p><img src=\"/2017/10/12/RocketMQ-Index-service/index-file.gif\" alt=\"\"></p>\n<p>RocketMQIndexServiceMQ<br> <code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>topic<br><img src=\"http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"><br>MQIndexFileindex file<br>index file3IndexHead + HashSlotPart + MsgIndexPart<br>IndexHead<br><br>HashSlotPart<br>hashMsgIndexPart<br>4 Byte<br>MsgIndexPart<br>msgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int<br>MsgIndexPartcapacityappend</p>\n<p><br><br><code>int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);</code></p>\n<p>CommitLogDispatcherBuildIndexdispatch<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (DefaultMessageStore.<span class=\"keyword\">this</span>.messageStoreConfig.isMessageIndexEnable()) &#123;</div><div class=\"line\">        DefaultMessageStore.<span class=\"keyword\">this</span>.indexService.buildIndex(request);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>buildIndextopic#msgId=&gt;msgIndex, topic#key1=&gt;msgIndex, topic#key2=&gt;msgIndex<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">buildIndex</span><span class=\"params\">(DispatchRequest req)</span> </span>&#123;</div><div class=\"line\">    IndexFile indexFile = retryGetAndCreateIndexFile();</div><div class=\"line\">    <span class=\"keyword\">if</span> (indexFile != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> endPhyOffset = indexFile.getEndPhyOffset();</div><div class=\"line\">        DispatchRequest msg = req;</div><div class=\"line\">        String topic = msg.getTopic();</div><div class=\"line\">        String keys = msg.getKeys();</div><div class=\"line\"></div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">if</span> (req.getUniqKey() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// UniqKeymsgId</span></div><div class=\"line\">            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (keys != <span class=\"keyword\">null</span> &amp;&amp; keys.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; keyset.length; i++) &#123;</div><div class=\"line\">                String key = keyset[i];</div><div class=\"line\">                <span class=\"keyword\">if</span> (key.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    <span class=\"comment\">// Key</span></div><div class=\"line\">                    indexFile = putKey(indexFile, msg, buildKey(topic, key));</div><div class=\"line\">                    ...</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        log.error(<span class=\"string\">\"build index error, stop building index\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"RocmetMQIndexService\"><a href=\"#RocmetMQIndexService\" class=\"headerlink\" title=\"RocmetMQIndexService\"></a>RocmetMQIndexService</h4><p><img src=\"/2017/10/12/RocketMQ-Index-service/index-file.gif\" alt=\"\"></p>\n<p>RocketMQIndexServiceMQ<br> <code>System.getProperty(&quot;user.home&quot;) + File.separator + &quot;store&quot;</code><br>topic<br><img src=\"http://upload-images.jianshu.io/upload_images/716353-2ed415df19a3040b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image.png\"><br>MQIndexFileindex file<br>index file3IndexHead + HashSlotPart + MsgIndexPart<br>IndexHead<br><br>HashSlotPart<br>hashMsgIndexPart<br>4 Byte<br>MsgIndexPart<br>msgIndexCommitLogPhyicOffsetmsgIndex20 Byteint + long + int + int<br>MsgIndexPartcapacityappend</p>\n<p><br><br><code>int fileTotalSize = IndexHeader.INDEX_HEADER_SIZE + (hashSlotNum * hashSlotSize) + (indexNum * indexSize);</code></p>\n<p>CommitLogDispatcherBuildIndexdispatch<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (DefaultMessageStore.<span class=\"keyword\">this</span>.messageStoreConfig.isMessageIndexEnable()) &#123;</div><div class=\"line\">        DefaultMessageStore.<span class=\"keyword\">this</span>.indexService.buildIndex(request);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>buildIndextopic#msgId=&gt;msgIndex, topic#key1=&gt;msgIndex, topic#key2=&gt;msgIndex<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">buildIndex</span><span class=\"params\">(DispatchRequest req)</span> </span>&#123;</div><div class=\"line\">    IndexFile indexFile = retryGetAndCreateIndexFile();</div><div class=\"line\">    <span class=\"keyword\">if</span> (indexFile != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> endPhyOffset = indexFile.getEndPhyOffset();</div><div class=\"line\">        DispatchRequest msg = req;</div><div class=\"line\">        String topic = msg.getTopic();</div><div class=\"line\">        String keys = msg.getKeys();</div><div class=\"line\"></div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">if</span> (req.getUniqKey() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// UniqKeymsgId</span></div><div class=\"line\">            indexFile = putKey(indexFile, msg, buildKey(topic, req.getUniqKey()));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (keys != <span class=\"keyword\">null</span> &amp;&amp; keys.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String[] keyset = keys.split(MessageConst.KEY_SEPARATOR);</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; keyset.length; i++) &#123;</div><div class=\"line\">                String key = keyset[i];</div><div class=\"line\">                <span class=\"keyword\">if</span> (key.length() &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    <span class=\"comment\">// Key</span></div><div class=\"line\">                    indexFile = putKey(indexFile, msg, buildKey(topic, key));</div><div class=\"line\">                    ...</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        log.error(<span class=\"string\">\"build index error, stop building index\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n"},{"title":"RocketMQ","date":"2017-08-09T06:42:53.000Z","_content":"\nRocketMQ\n\n### RocketMQ\n\n\n\n### MQ\n\n1. send\nconsume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend message\n2. consume\nconsumerQueuepull message\n\n### MQNameServerZookeeper\n\n### MQtopic\n\nMessageQueueSelectorList<MessageQueue> mqsbroker\n\n### Brokertopicsendbroker\n\nClienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);\nMQpushlistenerack\n\n### rebalance?    \n\nmq\n\n### Netty\n\nCountDownLatch\n\n### NameServerproducerconsumergetTopicRouteInfo\n\n1. UpdateRouteInfoTopic\n\n### RocketMQ+\n\n+500ms\n\nClientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable\n\nSubscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest\n\nRebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset\n\n### producerconsumer\n\n1. consumerholdserver\n2. commit logmax offsetReputMessageServiceconsume queuemessageArrivingListenerprocessRequestpull\n\n\n\n### BrokerprotectBroker\n\n### CommitLogConsumerQueue\n\n### RocketMQ\n\n1. consume_group*tag\n\n### afkaOnewayproducerbrokerproducer\n\n### RocketMQ\nProducerBrokerProducer GroupProducer\n2. Commit Log  MysqlOracle  redolog Commit\n   Log Consume Queue \n3. BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService\n\n### DebugProducerProducerProducer3CommitLog\n\n### MQCommitLogConsumeQueueCheckPoint\n\n### \n\n\n\n### Page Cache\n\n### Consume QueueConsumer rebalance\n\nConsumerConsumer\n\n### topicreadQ, writeQ, topic\n\n### namesrv\n\n### topicconsume queue0\n\n### Consume queueDefaultMessageStore.ReputMessageServiceTopic\n\n### namesrvBrokernamesrv\n\n### topictagtopicconsumertag\n\nqueueIdconsume offset\n\n### ConsumerQueue\n\n\n\n### index file\n\n\n\n### ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\n5. 4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS\n6. PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker\n\n### MappedByteBuffer\n\nA MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer\n\n### RocketMQ\n\nkafka\n\n### \n\n### 1s,5s,ns\n\n### IndexService\n\n\n\n### Netty\nnettychannelRead0workEventLoopGroup\nnettyClientWorkerThread\n\n### netty eventLoopGroup \n\n### \nServer:8080\ncurl 'localhost:8080'\nlsof -i:8080\n\n### \n```\norg.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg\nSee http://rocketmq.apache.org/docs/faq/ for further details.\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)\n\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)\n\tat org.apache.rock\n```\n\n### \n2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1\n2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure. \njava.lang.ArrayIndexOutOfBoundsException: -521875234\n\nrocketmq\n\n\n### RocketMQ\n\n\n\n### RocketMQ KEY\n\n### RocketMQ\n\nRocketMQ LengthBasedField\n\n### MQFlow Control\n\n### RocketMQNameServer\n\n### MasterSlaveMaster\n\n\n### RocketMQ\n\nlinux \n\n\n\n### RocketMQpoll,epoll,\nhttp://www.jianshu.com/p/7835726dc78b?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation\n\nhttp://www.jianshu.com/p/5ab57182af89?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation\n\n\n\n","source":"_posts/RocketMQ-FAQ.md","raw":"---\ntitle: RocketMQ\ndate: 2017-08-09 14:42:53\ntags: RocketMQ\n---\n\nRocketMQ\n\n### RocketMQ\n\n\n\n### MQ\n\n1. send\nconsume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend message\n2. consume\nconsumerQueuepull message\n\n### MQNameServerZookeeper\n\n### MQtopic\n\nMessageQueueSelectorList<MessageQueue> mqsbroker\n\n### Brokertopicsendbroker\n\nClienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);\nMQpushlistenerack\n\n### rebalance?    \n\nmq\n\n### Netty\n\nCountDownLatch\n\n### NameServerproducerconsumergetTopicRouteInfo\n\n1. UpdateRouteInfoTopic\n\n### RocketMQ+\n\n+500ms\n\nClientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable\n\nSubscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest\n\nRebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset\n\n### producerconsumer\n\n1. consumerholdserver\n2. commit logmax offsetReputMessageServiceconsume queuemessageArrivingListenerprocessRequestpull\n\n\n\n### BrokerprotectBroker\n\n### CommitLogConsumerQueue\n\n### RocketMQ\n\n1. consume_group*tag\n\n### afkaOnewayproducerbrokerproducer\n\n### RocketMQ\nProducerBrokerProducer GroupProducer\n2. Commit Log  MysqlOracle  redolog Commit\n   Log Consume Queue \n3. BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService\n\n### DebugProducerProducerProducer3CommitLog\n\n### MQCommitLogConsumeQueueCheckPoint\n\n### \n\n\n\n### Page Cache\n\n### Consume QueueConsumer rebalance\n\nConsumerConsumer\n\n### topicreadQ, writeQ, topic\n\n### namesrv\n\n### topicconsume queue0\n\n### Consume queueDefaultMessageStore.ReputMessageServiceTopic\n\n### namesrvBrokernamesrv\n\n### topictagtopicconsumertag\n\nqueueIdconsume offset\n\n### ConsumerQueue\n\n\n\n### index file\n\n\n\n### ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\n5. 4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS\n6. PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker\n\n### MappedByteBuffer\n\nA MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer\n\n### RocketMQ\n\nkafka\n\n### \n\n### 1s,5s,ns\n\n### IndexService\n\n\n\n### Netty\nnettychannelRead0workEventLoopGroup\nnettyClientWorkerThread\n\n### netty eventLoopGroup \n\n### \nServer:8080\ncurl 'localhost:8080'\nlsof -i:8080\n\n### \n```\norg.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg\nSee http://rocketmq.apache.org/docs/faq/ for further details.\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)\n\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)\n\tat org.apache.rock\n```\n\n### \n2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1\n2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure. \njava.lang.ArrayIndexOutOfBoundsException: -521875234\n\nrocketmq\n\n\n### RocketMQ\n\n\n\n### RocketMQ KEY\n\n### RocketMQ\n\nRocketMQ LengthBasedField\n\n### MQFlow Control\n\n### RocketMQNameServer\n\n### MasterSlaveMaster\n\n\n### RocketMQ\n\nlinux \n\n\n\n### RocketMQpoll,epoll,\nhttp://www.jianshu.com/p/7835726dc78b?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation\n\nhttp://www.jianshu.com/p/5ab57182af89?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation\n\n\n\n","slug":"RocketMQ-FAQ","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszi002r3iq29xlel3d5","content":"<p>RocketMQ</p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p></p>\n<h3 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h3><ol>\n<li>send<br>consume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend message</li>\n<li>consume<br>consumerQueuepull message</li>\n</ol>\n<h3 id=\"MQNameServerZookeeper\"><a href=\"#MQNameServerZookeeper\" class=\"headerlink\" title=\"MQNameServerZookeeper\"></a>MQNameServerZookeeper</h3><h3 id=\"MQtopic\"><a href=\"#MQtopic\" class=\"headerlink\" title=\"MQtopic\"></a>MQtopic</h3><p>MessageQueueSelectorList<messagequeue> mqsbroker</messagequeue></p>\n<h3 id=\"Brokertopicsendbroker\"><a href=\"#Brokertopicsendbroker\" class=\"headerlink\" title=\"Brokertopicsendbroker\"></a>Brokertopicsendbroker</h3><p>Clienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);<br>MQpushlistenerack</p>\n<h3 id=\"rebalance\"><a href=\"#rebalance\" class=\"headerlink\" title=\"rebalance?\"></a>rebalance?</h3><p>mq</p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>CountDownLatch</p>\n<h3 id=\"NameServerproducerconsumergetTopicRouteInfo\"><a href=\"#NameServerproducerconsumergetTopicRouteInfo\" class=\"headerlink\" title=\"NameServerproducerconsumergetTopicRouteInfo\"></a>NameServerproducerconsumergetTopicRouteInfo</h3><ol>\n<li>UpdateRouteInfoTopic</li>\n</ol>\n<h3 id=\"RocketMQ-\"><a href=\"#RocketMQ-\" class=\"headerlink\" title=\"RocketMQ+\"></a>RocketMQ+</h3><p>+500ms</p>\n<p>Clientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable</p>\n<p>Subscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest</p>\n<p>RebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset</p>\n<h3 id=\"producerconsumer\"><a href=\"#producerconsumer\" class=\"headerlink\" title=\"producerconsumer\"></a>producerconsumer</h3><ol>\n<li>consumerholdserver</li>\n<li>commit logmax offsetReputMessageServiceconsume queuemessageArrivingListenerprocessRequestpull</li>\n</ol>\n<p></p>\n<h3 id=\"BrokerprotectBroker\"><a href=\"#BrokerprotectBroker\" class=\"headerlink\" title=\"BrokerprotectBroker\"></a>BrokerprotectBroker</h3><h3 id=\"CommitLogConsumerQueue\"><a href=\"#CommitLogConsumerQueue\" class=\"headerlink\" title=\"CommitLogConsumerQueue\"></a>CommitLogConsumerQueue</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><ol>\n<li>consume_group*tag</li>\n</ol>\n<h3 id=\"afkaOnewayproducerbrokerproducer\"><a href=\"#afkaOnewayproducerbrokerproducer\" class=\"headerlink\" title=\"afkaOnewayproducerbrokerproducer\"></a>afkaOnewayproducerbrokerproducer</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>ProducerBrokerProducer GroupProducer</p>\n<ol>\n<li>Commit Log  MysqlOracle  redolog Commit<br>Log Consume Queue </li>\n<li>BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService</li>\n</ol>\n<h3 id=\"DebugProducerProducerProducer3CommitLog\"><a href=\"#DebugProducerProducerProducer3CommitLog\" class=\"headerlink\" title=\"DebugProducerProducerProducer3CommitLog\"></a>DebugProducerProducerProducer3CommitLog</h3><h3 id=\"MQCommitLogConsumeQueueCheckPoint\"><a href=\"#MQCommitLogConsumeQueueCheckPoint\" class=\"headerlink\" title=\"MQCommitLogConsumeQueueCheckPoint\"></a>MQCommitLogConsumeQueueCheckPoint</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"Page-Cache\"><a href=\"#Page-Cache\" class=\"headerlink\" title=\"Page Cache\"></a>Page Cache</h3><h3 id=\"Consume-QueueConsumer-rebalance\"><a href=\"#Consume-QueueConsumer-rebalance\" class=\"headerlink\" title=\"Consume QueueConsumer rebalance\"></a>Consume QueueConsumer rebalance</h3><p>ConsumerConsumer</p>\n<h3 id=\"topicreadQ-writeQ-topic\"><a href=\"#topicreadQ-writeQ-topic\" class=\"headerlink\" title=\"topicreadQ, writeQ, topic\"></a>topicreadQ, writeQ, topic</h3><h3 id=\"namesrv\"><a href=\"#namesrv\" class=\"headerlink\" title=\"namesrv\"></a>namesrv</h3><h3 id=\"topicconsume-queue0\"><a href=\"#topicconsume-queue0\" class=\"headerlink\" title=\"topicconsume queue0\"></a>topicconsume queue0</h3><h3 id=\"Consume-queueDefaultMessageStore-ReputMessageServiceTopic\"><a href=\"#Consume-queueDefaultMessageStore-ReputMessageServiceTopic\" class=\"headerlink\" title=\"Consume queueDefaultMessageStore.ReputMessageServiceTopic\"></a>Consume queueDefaultMessageStore.ReputMessageServiceTopic</h3><h3 id=\"namesrvBrokernamesrv\"><a href=\"#namesrvBrokernamesrv\" class=\"headerlink\" title=\"namesrvBrokernamesrv\"></a>namesrvBrokernamesrv</h3><h3 id=\"topictagtopicconsumertag\"><a href=\"#topictagtopicconsumertag\" class=\"headerlink\" title=\"topictagtopicconsumertag\"></a>topictagtopicconsumertag</h3><p>queueIdconsume offset</p>\n<h3 id=\"ConsumerQueue\"><a href=\"#ConsumerQueue\" class=\"headerlink\" title=\"ConsumerQueue\"></a>ConsumerQueue</h3><p></p>\n<h3 id=\"index-file\"><a href=\"#index-file\" class=\"headerlink\" title=\"index file\"></a>index file</h3><p></p>\n<h3 id=\"ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\"><a href=\"#ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\" class=\"headerlink\" title=\"ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\"></a>ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash</h3><ol>\n<li>4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS</li>\n<li>PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker</li>\n</ol>\n<h3 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h3><p>A MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer</p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>kafka</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"1s-5s-ns\"><a href=\"#1s-5s-ns\" class=\"headerlink\" title=\"1s,5s,ns\"></a>1s,5s,ns</h3><h3 id=\"IndexService\"><a href=\"#IndexService\" class=\"headerlink\" title=\"IndexService\"></a>IndexService</h3><p></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>nettychannelRead0workEventLoopGroup<br>nettyClientWorkerThread</p>\n<h3 id=\"netty-eventLoopGroup-\"><a href=\"#netty-eventLoopGroup-\" class=\"headerlink\" title=\"netty eventLoopGroup \"></a>netty eventLoopGroup </h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Server:8080<br>curl localhost:8080<br>lsof -i:8080</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">org.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg</div><div class=\"line\">See http://rocketmq.apache.org/docs/faq/ for further details.</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)</div><div class=\"line\">\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)</div><div class=\"line\">\tat org.apache.rock</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1<br>2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure.<br>java.lang.ArrayIndexOutOfBoundsException: -521875234</p>\n<p>rocketmq</p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p></p>\n<h3 id=\"RocketMQ-KEY\"><a href=\"#RocketMQ-KEY\" class=\"headerlink\" title=\"RocketMQ KEY\"></a>RocketMQ KEY</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>RocketMQ LengthBasedField</p>\n<h3 id=\"MQFlow-Control\"><a href=\"#MQFlow-Control\" class=\"headerlink\" title=\"MQFlow Control\"></a>MQFlow Control</h3><h3 id=\"RocketMQNameServer\"><a href=\"#RocketMQNameServer\" class=\"headerlink\" title=\"RocketMQNameServer\"></a>RocketMQNameServer</h3><h3 id=\"MasterSlaveMaster\"><a href=\"#MasterSlaveMaster\" class=\"headerlink\" title=\"MasterSlaveMaster\"></a>MasterSlaveMaster</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>linux </p>\n<p></p>\n<h3 id=\"RocketMQpoll-epoll-\"><a href=\"#RocketMQpoll-epoll-\" class=\"headerlink\" title=\"RocketMQpoll,epoll,\"></a>RocketMQpoll,epoll,</h3><p><a href=\"http://www.jianshu.com/p/7835726dc78b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/7835726dc78b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>\n<p><a href=\"http://www.jianshu.com/p/5ab57182af89?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/5ab57182af89?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>RocketMQ</p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p></p>\n<h3 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h3><ol>\n<li>send<br>consume queuecommit logsendMessagesynccommit logtopicconsumer groupconsumerQueueconsumerQueueReputMessageServiceconsumerQueuesend message</li>\n<li>consume<br>consumerQueuepull message</li>\n</ol>\n<h3 id=\"MQNameServerZookeeper\"><a href=\"#MQNameServerZookeeper\" class=\"headerlink\" title=\"MQNameServerZookeeper\"></a>MQNameServerZookeeper</h3><h3 id=\"MQtopic\"><a href=\"#MQtopic\" class=\"headerlink\" title=\"MQtopic\"></a>MQtopic</h3><p>MessageQueueSelectorList<messagequeue> mqsbroker</messagequeue></p>\n<h3 id=\"Brokertopicsendbroker\"><a href=\"#Brokertopicsendbroker\" class=\"headerlink\" title=\"Brokertopicsendbroker\"></a>Brokertopicsendbroker</h3><p>Clienttopicname serverMapBrokername serverTopic route infocheckMsgthis.brokerController.registerBrokerAll(false, true);<br>MQpushlistenerack</p>\n<h3 id=\"rebalance\"><a href=\"#rebalance\" class=\"headerlink\" title=\"rebalance?\"></a>rebalance?</h3><p>mq</p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>CountDownLatch</p>\n<h3 id=\"NameServerproducerconsumergetTopicRouteInfo\"><a href=\"#NameServerproducerconsumergetTopicRouteInfo\" class=\"headerlink\" title=\"NameServerproducerconsumergetTopicRouteInfo\"></a>NameServerproducerconsumergetTopicRouteInfo</h3><ol>\n<li>UpdateRouteInfoTopic</li>\n</ol>\n<h3 id=\"RocketMQ-\"><a href=\"#RocketMQ-\" class=\"headerlink\" title=\"RocketMQ+\"></a>RocketMQ+</h3><p>+500ms</p>\n<p>Clientbroker pull message queueprocessQueueTablequeuebrokerbrokerqueueprocessQueueTable</p>\n<p>Subscriptionrebalancentopic+1Retry topicrebalancetopicbrokerMQnnPullRequest</p>\n<p>RebalanceServer PullRequest PullMessageService  PullRequestpullRequestQueuePullMessageServicepullRequestQueuetakePullRequestNettyPullCallbackConsumeMessageServiceConsumeRequest Re-consume-later, successBrokerconsumerOffset</p>\n<h3 id=\"producerconsumer\"><a href=\"#producerconsumer\" class=\"headerlink\" title=\"producerconsumer\"></a>producerconsumer</h3><ol>\n<li>consumerholdserver</li>\n<li>commit logmax offsetReputMessageServiceconsume queuemessageArrivingListenerprocessRequestpull</li>\n</ol>\n<p></p>\n<h3 id=\"BrokerprotectBroker\"><a href=\"#BrokerprotectBroker\" class=\"headerlink\" title=\"BrokerprotectBroker\"></a>BrokerprotectBroker</h3><h3 id=\"CommitLogConsumerQueue\"><a href=\"#CommitLogConsumerQueue\" class=\"headerlink\" title=\"CommitLogConsumerQueue\"></a>CommitLogConsumerQueue</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><ol>\n<li>consume_group*tag</li>\n</ol>\n<h3 id=\"afkaOnewayproducerbrokerproducer\"><a href=\"#afkaOnewayproducerbrokerproducer\" class=\"headerlink\" title=\"afkaOnewayproducerbrokerproducer\"></a>afkaOnewayproducerbrokerproducer</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>ProducerBrokerProducer GroupProducer</p>\n<ol>\n<li>Commit Log  MysqlOracle  redolog Commit<br>Log Consume Queue </li>\n<li>BrokerSendMessageProcessorAppendCommitLogFlushforce() mmapConsumeQueue DispatcherReputMessageService</li>\n</ol>\n<h3 id=\"DebugProducerProducerProducer3CommitLog\"><a href=\"#DebugProducerProducerProducer3CommitLog\" class=\"headerlink\" title=\"DebugProducerProducerProducer3CommitLog\"></a>DebugProducerProducerProducer3CommitLog</h3><h3 id=\"MQCommitLogConsumeQueueCheckPoint\"><a href=\"#MQCommitLogConsumeQueueCheckPoint\" class=\"headerlink\" title=\"MQCommitLogConsumeQueueCheckPoint\"></a>MQCommitLogConsumeQueueCheckPoint</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"Page-Cache\"><a href=\"#Page-Cache\" class=\"headerlink\" title=\"Page Cache\"></a>Page Cache</h3><h3 id=\"Consume-QueueConsumer-rebalance\"><a href=\"#Consume-QueueConsumer-rebalance\" class=\"headerlink\" title=\"Consume QueueConsumer rebalance\"></a>Consume QueueConsumer rebalance</h3><p>ConsumerConsumer</p>\n<h3 id=\"topicreadQ-writeQ-topic\"><a href=\"#topicreadQ-writeQ-topic\" class=\"headerlink\" title=\"topicreadQ, writeQ, topic\"></a>topicreadQ, writeQ, topic</h3><h3 id=\"namesrv\"><a href=\"#namesrv\" class=\"headerlink\" title=\"namesrv\"></a>namesrv</h3><h3 id=\"topicconsume-queue0\"><a href=\"#topicconsume-queue0\" class=\"headerlink\" title=\"topicconsume queue0\"></a>topicconsume queue0</h3><h3 id=\"Consume-queueDefaultMessageStore-ReputMessageServiceTopic\"><a href=\"#Consume-queueDefaultMessageStore-ReputMessageServiceTopic\" class=\"headerlink\" title=\"Consume queueDefaultMessageStore.ReputMessageServiceTopic\"></a>Consume queueDefaultMessageStore.ReputMessageServiceTopic</h3><h3 id=\"namesrvBrokernamesrv\"><a href=\"#namesrvBrokernamesrv\" class=\"headerlink\" title=\"namesrvBrokernamesrv\"></a>namesrvBrokernamesrv</h3><h3 id=\"topictagtopicconsumertag\"><a href=\"#topictagtopicconsumertag\" class=\"headerlink\" title=\"topictagtopicconsumertag\"></a>topictagtopicconsumertag</h3><p>queueIdconsume offset</p>\n<h3 id=\"ConsumerQueue\"><a href=\"#ConsumerQueue\" class=\"headerlink\" title=\"ConsumerQueue\"></a>ConsumerQueue</h3><p></p>\n<h3 id=\"index-file\"><a href=\"#index-file\" class=\"headerlink\" title=\"index file\"></a>index file</h3><p></p>\n<h3 id=\"ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\"><a href=\"#ReputMessageServiceCommitogoffsetconsume-queuePullMessageHoldServicetagconsume-queuetaghash\" class=\"headerlink\" title=\"ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash\"></a>ReputMessageServiceCommitogoffsetconsume queuePullMessageHoldServicetagconsume queuetaghash</h3><ol>\n<li>4GmmapJavaMappedByteBufferByteBufferbytepositionOSOS</li>\n<li>PullConsumerconsumer.pull(MessageQueue mq, String subExpression, long offset, int maxNums)Brokeroffset00BrokerconsumerOffset.jsonPullPushpersistconfig/consumerOffset.json?MQClientInstance.persistAllConsumerOffsetoffsetTableBroker</li>\n</ol>\n<h3 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h3><p>A MemoryMappedBuffer has a fixed size, but the file its mapped to is elastic.MappedByteBufferMappedByteBuffer</p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>kafka</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"1s-5s-ns\"><a href=\"#1s-5s-ns\" class=\"headerlink\" title=\"1s,5s,ns\"></a>1s,5s,ns</h3><h3 id=\"IndexService\"><a href=\"#IndexService\" class=\"headerlink\" title=\"IndexService\"></a>IndexService</h3><p></p>\n<h3 id=\"Netty\"><a href=\"#Netty\" class=\"headerlink\" title=\"Netty\"></a>Netty</h3><p>nettychannelRead0workEventLoopGroup<br>nettyClientWorkerThread</p>\n<h3 id=\"netty-eventLoopGroup-\"><a href=\"#netty-eventLoopGroup-\" class=\"headerlink\" title=\"netty eventLoopGroup \"></a>netty eventLoopGroup </h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Server:8080<br>curl localhost:8080<br>lsof -i:8080</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">org.apache.rocketmq.client.exception.MQClientException: No route info of this topic, binlog-msg</div><div class=\"line\">See http://rocketmq.apache.org/docs/faq/ for further details.</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:537)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1038)</div><div class=\"line\">\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:996)</div><div class=\"line\">\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:212)</div><div class=\"line\">\tat org.apache.rock</div></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>2017-10-11 07:21:38 WARN SendMessageThread_1 - Offset for /root/store/commitlog/00000000002147483648 not matched. Request offset: 4051326754958557513, index: -521875234, mappedFileSize: 1073741824, mappedFiles count: 1<br>2017-10-11 07:21:38 WARN SendMessageThread_1 - findMappedFileByOffset failure.<br>java.lang.ArrayIndexOutOfBoundsException: -521875234</p>\n<p>rocketmq</p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p></p>\n<h3 id=\"RocketMQ-KEY\"><a href=\"#RocketMQ-KEY\" class=\"headerlink\" title=\"RocketMQ KEY\"></a>RocketMQ KEY</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>RocketMQ LengthBasedField</p>\n<h3 id=\"MQFlow-Control\"><a href=\"#MQFlow-Control\" class=\"headerlink\" title=\"MQFlow Control\"></a>MQFlow Control</h3><h3 id=\"RocketMQNameServer\"><a href=\"#RocketMQNameServer\" class=\"headerlink\" title=\"RocketMQNameServer\"></a>RocketMQNameServer</h3><h3 id=\"MasterSlaveMaster\"><a href=\"#MasterSlaveMaster\" class=\"headerlink\" title=\"MasterSlaveMaster\"></a>MasterSlaveMaster</h3><h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>linux </p>\n<p></p>\n<h3 id=\"RocketMQpoll-epoll-\"><a href=\"#RocketMQpoll-epoll-\" class=\"headerlink\" title=\"RocketMQpoll,epoll,\"></a>RocketMQpoll,epoll,</h3><p><a href=\"http://www.jianshu.com/p/7835726dc78b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/7835726dc78b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>\n<p><a href=\"http://www.jianshu.com/p/5ab57182af89?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/5ab57182af89?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>\n"},{"title":"RocketMQBroker","date":"2017-10-12T08:28:24.000Z","_content":"\n``` java\n\n```\n![](https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg)","source":"_posts/RocketMQ-Master-slave-high-availability.md","raw":"---\ntitle: RocketMQBroker\ndate: 2017-10-12 16:28:24\ntags: RocketMQ\n---\n\n``` java\n\n```\n![](https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg)","slug":"RocketMQ-Master-slave-high-availability","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszj002u3iq2qxnyww2i","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<p><img src=\"https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\"></div></pre></td></tr></table></figure>\n<p><img src=\"https://ws3.sinaimg.cn/large/006tNbRwgy1fkfij3xtx8j31kw1514e0.jpg\" alt=\"\"></p>\n"},{"title":"RocketMQNetty","date":"2017-08-21T04:36:42.000Z","_content":"\n### Netty IO\nnettyIOAPInetty\n\n### Remote\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png)\n\n### Remote\nCaller\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png)\n\n###","source":"_posts/RocketMQ-Netty-imp-sync-and-async-invoke.md","raw":"---\ntitle: RocketMQNetty\ndate: 2017-08-21 12:36:42\ntags: RocketMQ\n---\n\n### Netty IO\nnettyIOAPInetty\n\n### Remote\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png)\n\n### Remote\nCaller\n![](RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png)\n\n###","slug":"RocketMQ-Netty-imp-sync-and-async-invoke","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszk002v3iq20wk995eu","content":"<h3 id=\"Netty-IO\"><a href=\"#Netty-IO\" class=\"headerlink\" title=\"Netty IO\"></a>Netty IO</h3><p>nettyIOAPInetty</p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png\" alt=\"\"></p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p>Caller<br><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png\" alt=\"\"></p>\n<p>###</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Netty-IO\"><a href=\"#Netty-IO\" class=\"headerlink\" title=\"Netty IO\"></a>Netty IO</h3><p>nettyIOAPInetty</p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png\" alt=\"\"></p>\n<h3 id=\"Remote\"><a href=\"#Remote\" class=\"headerlink\" title=\"Remote\"></a>Remote</h3><p>Caller<br><img src=\"/2017/08/21/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png\" alt=\"\"></p>\n<p>###</p>\n"},{"title":"RocketMQ","date":"2017-11-03T06:38:10.000Z","_content":"\n\nproducer\n1.consume queuepagecachepagecache\n2.commit logpagecacheIO\n\npagecachepagecachepagecachesocketconsumer\n\n### \n\n``` java\n// Synchronization flush\nif (FlushDiskType.SYNC_FLUSH == this.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) {\n    final GroupCommitService service = (GroupCommitService) this.flushCommitLogService;\n}\n// Asynchronous flush\nelse {\n    if (!this.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) {\n        // FlushRealTimeService\n        flushCommitLogService.wakeup();\n    } else {\n        // CommitRealTimeService\n        commitLogService.wakeup();\n    }\n}\n```\n\n``` java\npublic boolean isTransientStorePoolEnable() {\n    return transientStorePoolEnable && FlushDiskType.ASYNC_FLUSH == getFlushDiskType()\n        && BrokerRole.SLAVE != getBrokerRole();\n}\n```\n\ntransientStorePoolEnable\nFlushRealTimeServiceCommitRealTimeService\n\n![](RocketMQ-Message-send-and-persistence/disc-fall.gif)\n\n### Offset: ConsumerQueue\n\n\n### Offset: CommitLog\n\n### MappedByteBuffer\n\nMappedByteBufferBuffer\nCommitLogCommitLogAppend\n\n*synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n*JDK1.6BownAAJVMAJVMBBAAhttp://blog.csdn.net/u013080921/article/details/42676231\n\n#### Spin Lock()\n\n#### ReentrantLock()\n\n\n### \n\nhttp://blog.csdn.net/vonzhoufz/article/details/47248777\n\n#### \n\nhttps://kafka.apache.org/documentation/#design_filesystem\n\nhttp://blog.csdn.net/evankaka/article/details/48464013\n\nhttp://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&fps=1\nkafkahttp://blog.csdn.net/tototuzuoquan/article/details/73437890\npagecache\n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\n PAGESIZE\n``` bash\ngetconf PAGESIZE\n```\n\n KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache \n\n commit(atLeastSize)pagecache\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\nConsume Queue  Page Cache\nCommit Log \n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\n1).page cache. page cache, IO, . , , .\npage cache , 1k, , , .\nCommit Log, IONOOP, , 5.\n4k, 8K.\nConsume Queue, , PAGECACHE, Consume Queue, . Consume Queue.\n2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .\n\nhttps://segmentfault.com/a/1190000003985468\nkafka\n\n\n\nlinuxlinuxlinux\n\n### \n\npage cachepage cachepage cachedisc\n\nMQpagecachejvm crash\n\ncommit logconsume queuepagecachejava heappagecachepagecachedisc\n\nproducer\n1.consume queuepagecachepagecache\n2.commit logpagecacheIO\n\npagecachepagecachepagecachesocketconsumer\n\nMappedByteBuffer \nMappedByteBuffer\n\nhttp://www.iocoder.cn/RocketMQ/message-store/\nCommitRealTimeService\t && \t\nFlushRealTimeService\t && \t\nGroupCommitService\t\t\n\n\nhttp://blog.csdn.net/iie_libi/article/details/54289580\n\n\nConsumer  sendfile RocketMQmmap+write\n \n  DMA  sendfile CPUJVM Crash\n\n\n\next4\niodeadlinedeadline IO \n\n\n\n\n+ \n\npagecache\n\nRocketMQFileChannel.map()MappedByteBufferBufferMQ\n``` java\npublic static void clean(final ByteBuffer buffer) {\n    if (buffer == null || !buffer.isDirect() || buffer.capacity() == 0)\n        return;\n    invoke(invoke(viewed(buffer), \"cleaner\"), \"clean\");\n}\n```\n\n``` java\nprivate static class Deallocator\n        implements Runnable {\n    private static Unsafe unsafe = Unsafe.getUnsafe();\n\n    private long address;\n    private long size;\n    private int capacity;\n\n    private Deallocator(long address, long size, int capacity) {\n        assert (address != 0);\n        this.address = address;\n        this.size = size;\n        this.capacity = capacity;\n    }\n\n    public void run() {\n        if (address == 0) {\n            // Paranoia\n            return;\n        }\n        unsafe.freeMemory(address);\n        address = 0;\n        Bits.unreserveMemory(size, capacity);\n    }\n\n}\n```\n\nFull GCFull GCDisableExplicitGCGCFull GC\n\n  pagecacheIO \nrocketmq\n\n \n PAGECACHE  1k \n  Commit Log  IO NOOP 5 \n \n \n \n 1+\n a) \n b) \n 2\n a) \n 3xxhashcrc\n a) https://cyan4973.github.io/xxHash/\n 4topic\n a) topic\n 5STLdequeMESA list\n a) Dequevector\n b) \n 6MESA list\n a) +logn\n b)  \n i. leveldbhbase\n \n _java.nio.channels.FileChannel_\n `public abstract void force(boolean metaData) throws java.io.IOException`\n Forces any updates to this channel's file to be written to the storage device that contains it.\n If this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\n If the file does not reside on a local device then no such guarantee is made.\n The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\n Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\n This method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n \n _java.nio.MappedByteBuffer_\n `public final MappedByteBuffer force()`\n Forces any changes made to this buffer's content to be written to the storage device containing the mapped file.\n If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\n If the file does not reside on a local device then no such guarantee is made.\n If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n \n \n ### \n \n http://blog.csdn.net/a417930422/article/details/52585862\n\n\n\nwangbin00162017-08-08 17:011\n -sendfile java\nFileChannel.transferTo(long position, long count, WritableByteChannel target)//\n\nrocketmq  RocketMQmmap+writesendfile\n\nnettyFileRegion FileChannel.transferTo\n\nFileRegion fileRegion =\nnew ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);\nchannel.writeAndFlush(fileRegion)\n              2\n             a417930422\n            a4179304222017-09-21 10:35\n            wangbin0016rocketmqmmapjavaMappedByteBuffer\n             a417930422\n            a4179304222017-09-21 10:32\n            wangbin0016rocketmqConsumer mmap+writerocketmqhttp://blog.csdn.net/a417930422/article/details/52585180.\n            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket\n            GetMessageResultmmap\n             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage\n            \n            \n            \n            \n            \nrocketmq\n\n1. io\n   \n   1. \n   2. DMA\n2. \n   1. \n      \n      \n      \n      1. \n      2. cpu\n      3. cpuio(ide,scsi)io\n      4. iocpu\n      5. cpu\n      6. io\n      7. cpu\n      8. cpu\n   2. \n3. DMA  \n   1. DMA\n      \n      \n      \n      1. \n      2. cpu\n      3. cpuDMAio\n      4. iocpu\n      5. cpu\n      6. io\n      7. DMAcpu\n      8. cpu\n      9. cpu\n   2. cpucpu\n4. \n   1.   \n      \n      \n      \n      1. readDMA\n      2. readcpu\n      3. sendcpucpu(socket)\n      4. sendDMA\n      5. \n   2. \n   3. \n5. -sendfile java\n   \n   FileChannel.transferTo(long position, long count, WritableByteChannel target)//\n   \n   1. 23\n      \n      \n      \n      1. DMA\n      2. cpu(socket)\n      3. DMA\n      4. 2\n   2. cpu\n   3. linux2.4socketDMA\n      \n      \n      \n      1. DMA\n      2. (socket)\n      3. DMA\n6. -mmap java\n   \n   MappedByteBuffer//\n   1. sendfile\n7. \n   1. http://blog.chinaunix.net/uid-25314474-id-3325879.html\n   2. http://blog.chinaunix.net/uid-28874972-id-3725082.html\n   3. https://www.ibm.com/developerworks/cn/java/j-zerocopy/#fig1\n   4. http://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/\n   5. https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/\n","source":"_posts/RocketMQ-Message-send-and-persistence.md","raw":"---\ntitle: RocketMQ\ndate: 2017-11-03 14:38:10\ntags: RocketMQ\n---\n\n\nproducer\n1.consume queuepagecachepagecache\n2.commit logpagecacheIO\n\npagecachepagecachepagecachesocketconsumer\n\n### \n\n``` java\n// Synchronization flush\nif (FlushDiskType.SYNC_FLUSH == this.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) {\n    final GroupCommitService service = (GroupCommitService) this.flushCommitLogService;\n}\n// Asynchronous flush\nelse {\n    if (!this.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) {\n        // FlushRealTimeService\n        flushCommitLogService.wakeup();\n    } else {\n        // CommitRealTimeService\n        commitLogService.wakeup();\n    }\n}\n```\n\n``` java\npublic boolean isTransientStorePoolEnable() {\n    return transientStorePoolEnable && FlushDiskType.ASYNC_FLUSH == getFlushDiskType()\n        && BrokerRole.SLAVE != getBrokerRole();\n}\n```\n\ntransientStorePoolEnable\nFlushRealTimeServiceCommitRealTimeService\n\n![](RocketMQ-Message-send-and-persistence/disc-fall.gif)\n\n### Offset: ConsumerQueue\n\n\n### Offset: CommitLog\n\n### MappedByteBuffer\n\nMappedByteBufferBuffer\nCommitLogCommitLogAppend\n\n*synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n*JDK1.6BownAAJVMAJVMBBAAhttp://blog.csdn.net/u013080921/article/details/42676231\n\n#### Spin Lock()\n\n#### ReentrantLock()\n\n\n### \n\nhttp://blog.csdn.net/vonzhoufz/article/details/47248777\n\n#### \n\nhttps://kafka.apache.org/documentation/#design_filesystem\n\nhttp://blog.csdn.net/evankaka/article/details/48464013\n\nhttp://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&fps=1\nkafkahttp://blog.csdn.net/tototuzuoquan/article/details/73437890\npagecache\n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\n PAGESIZE\n``` bash\ngetconf PAGESIZE\n```\n\n KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache \n\n commit(atLeastSize)pagecache\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\nConsume Queue  Page Cache\nCommit Log \n\nhttp://blog.csdn.net/mg0832058/article/details/5890688\n\n\n\nhttp://www.jianshu.com/p/6494e33c9b1f\n1).page cache. page cache, IO, . , , .\npage cache , 1k, , , .\nCommit Log, IONOOP, , 5.\n4k, 8K.\nConsume Queue, , PAGECACHE, Consume Queue, . Consume Queue.\n2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .\n\nhttps://segmentfault.com/a/1190000003985468\nkafka\n\n\n\nlinuxlinuxlinux\n\n### \n\npage cachepage cachepage cachedisc\n\nMQpagecachejvm crash\n\ncommit logconsume queuepagecachejava heappagecachepagecachedisc\n\nproducer\n1.consume queuepagecachepagecache\n2.commit logpagecacheIO\n\npagecachepagecachepagecachesocketconsumer\n\nMappedByteBuffer \nMappedByteBuffer\n\nhttp://www.iocoder.cn/RocketMQ/message-store/\nCommitRealTimeService\t && \t\nFlushRealTimeService\t && \t\nGroupCommitService\t\t\n\n\nhttp://blog.csdn.net/iie_libi/article/details/54289580\n\n\nConsumer  sendfile RocketMQmmap+write\n \n  DMA  sendfile CPUJVM Crash\n\n\n\next4\niodeadlinedeadline IO \n\n\n\n\n+ \n\npagecache\n\nRocketMQFileChannel.map()MappedByteBufferBufferMQ\n``` java\npublic static void clean(final ByteBuffer buffer) {\n    if (buffer == null || !buffer.isDirect() || buffer.capacity() == 0)\n        return;\n    invoke(invoke(viewed(buffer), \"cleaner\"), \"clean\");\n}\n```\n\n``` java\nprivate static class Deallocator\n        implements Runnable {\n    private static Unsafe unsafe = Unsafe.getUnsafe();\n\n    private long address;\n    private long size;\n    private int capacity;\n\n    private Deallocator(long address, long size, int capacity) {\n        assert (address != 0);\n        this.address = address;\n        this.size = size;\n        this.capacity = capacity;\n    }\n\n    public void run() {\n        if (address == 0) {\n            // Paranoia\n            return;\n        }\n        unsafe.freeMemory(address);\n        address = 0;\n        Bits.unreserveMemory(size, capacity);\n    }\n\n}\n```\n\nFull GCFull GCDisableExplicitGCGCFull GC\n\n  pagecacheIO \nrocketmq\n\n \n PAGECACHE  1k \n  Commit Log  IO NOOP 5 \n \n \n \n 1+\n a) \n b) \n 2\n a) \n 3xxhashcrc\n a) https://cyan4973.github.io/xxHash/\n 4topic\n a) topic\n 5STLdequeMESA list\n a) Dequevector\n b) \n 6MESA list\n a) +logn\n b)  \n i. leveldbhbase\n \n _java.nio.channels.FileChannel_\n `public abstract void force(boolean metaData) throws java.io.IOException`\n Forces any updates to this channel's file to be written to the storage device that contains it.\n If this channel's file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.\n If the file does not reside on a local device then no such guarantee is made.\n The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the file's content need be written to storage; passing true indicates that updates to both the file's content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.\n Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a file's metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.\n This method is only guaranteed to force changes that were made to this channel's file via the methods defined in this class. **It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffer's content to be written.**\n \n _java.nio.MappedByteBuffer_\n `public final MappedByteBuffer force()`\n Forces any changes made to this buffer's content to be written to the storage device containing the mapped file.\n If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.\n If the file does not reside on a local device then no such guarantee is made.\n If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.\n \n \n ### \n \n http://blog.csdn.net/a417930422/article/details/52585862\n\n\n\nwangbin00162017-08-08 17:011\n -sendfile java\nFileChannel.transferTo(long position, long count, WritableByteChannel target)//\n\nrocketmq  RocketMQmmap+writesendfile\n\nnettyFileRegion FileChannel.transferTo\n\nFileRegion fileRegion =\nnew ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);\nchannel.writeAndFlush(fileRegion)\n              2\n             a417930422\n            a4179304222017-09-21 10:35\n            wangbin0016rocketmqmmapjavaMappedByteBuffer\n             a417930422\n            a4179304222017-09-21 10:32\n            wangbin0016rocketmqConsumer mmap+writerocketmqhttp://blog.csdn.net/a417930422/article/details/52585180.\n            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket\n            GetMessageResultmmap\n             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage\n            \n            \n            \n            \n            \nrocketmq\n\n1. io\n   \n   1. \n   2. DMA\n2. \n   1. \n      \n      \n      \n      1. \n      2. cpu\n      3. cpuio(ide,scsi)io\n      4. iocpu\n      5. cpu\n      6. io\n      7. cpu\n      8. cpu\n   2. \n3. DMA  \n   1. DMA\n      \n      \n      \n      1. \n      2. cpu\n      3. cpuDMAio\n      4. iocpu\n      5. cpu\n      6. io\n      7. DMAcpu\n      8. cpu\n      9. cpu\n   2. cpucpu\n4. \n   1.   \n      \n      \n      \n      1. readDMA\n      2. readcpu\n      3. sendcpucpu(socket)\n      4. sendDMA\n      5. \n   2. \n   3. \n5. -sendfile java\n   \n   FileChannel.transferTo(long position, long count, WritableByteChannel target)//\n   \n   1. 23\n      \n      \n      \n      1. DMA\n      2. cpu(socket)\n      3. DMA\n      4. 2\n   2. cpu\n   3. linux2.4socketDMA\n      \n      \n      \n      1. DMA\n      2. (socket)\n      3. DMA\n6. -mmap java\n   \n   MappedByteBuffer//\n   1. sendfile\n7. \n   1. http://blog.chinaunix.net/uid-25314474-id-3325879.html\n   2. http://blog.chinaunix.net/uid-28874972-id-3725082.html\n   3. https://www.ibm.com/developerworks/cn/java/j-zerocopy/#fig1\n   4. http://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/\n   5. https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/\n","slug":"RocketMQ-Message-send-and-persistence","published":1,"updated":"2018-07-12T03:31:15.000Z","_id":"cjj3wcszl002y3iq2nubws3qo","comments":1,"layout":"post","photos":[],"link":"","content":"<p>producer<br>1.consume queuepagecachepagecache<br>2.commit logpagecacheIO</p>\n<p>pagecachepagecachepagecachesocketconsumer</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Synchronization flush</span></div><div class=\"line\"><span class=\"keyword\">if</span> (FlushDiskType.SYNC_FLUSH == <span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> GroupCommitService service = (GroupCommitService) <span class=\"keyword\">this</span>.flushCommitLogService;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">// Asynchronous flush</span></div><div class=\"line\"><span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) &#123;</div><div class=\"line\">        <span class=\"comment\">// FlushRealTimeService</span></div><div class=\"line\">        flushCommitLogService.wakeup();</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// CommitRealTimeService</span></div><div class=\"line\">        commitLogService.wakeup();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTransientStorePoolEnable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> transientStorePoolEnable &amp;&amp; FlushDiskType.ASYNC_FLUSH == getFlushDiskType()</div><div class=\"line\">        &amp;&amp; BrokerRole.SLAVE != getBrokerRole();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>transientStorePoolEnable<br>FlushRealTimeServiceCommitRealTimeService</p>\n<p><img src=\"/2017/11/03/RocketMQ-Message-send-and-persistence/disc-fall.gif\" alt=\"\"></p>\n<h3 id=\"Offset-ConsumerQueue\"><a href=\"#Offset-ConsumerQueue\" class=\"headerlink\" title=\"Offset: ConsumerQueue\"></a>Offset: ConsumerQueue</h3><h3 id=\"Offset-CommitLog\"><a href=\"#Offset-CommitLog\" class=\"headerlink\" title=\"Offset: CommitLog\"></a>Offset: CommitLog</h3><h3 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h3><p>MappedByteBufferBuffer<br>CommitLogCommitLogAppend</p>\n<p><em>synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n</em>JDK1.6BownAAJVMAJVMBBAA<a href=\"http://blog.csdn.net/u013080921/article/details/42676231\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/u013080921/article/details/42676231</a></p>\n<h4 id=\"Spin-Lock-\"><a href=\"#Spin-Lock-\" class=\"headerlink\" title=\"Spin Lock()\"></a>Spin Lock()</h4><h4 id=\"ReentrantLock-\"><a href=\"#ReentrantLock-\" class=\"headerlink\" title=\"ReentrantLock()\"></a>ReentrantLock()</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/vonzhoufz/article/details/47248777\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/vonzhoufz/article/details/47248777</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://kafka.apache.org/documentation/#design_filesystem\" target=\"_blank\" rel=\"external\">https://kafka.apache.org/documentation/#design_filesystem</a></p>\n<p><a href=\"http://blog.csdn.net/evankaka/article/details/48464013\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/evankaka/article/details/48464013</a></p>\n<p><a href=\"http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1</a><br>kafka<a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a><br>pagecache</p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p> PAGESIZE<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">getconf PAGESIZE</div></pre></td></tr></table></figure></p>\n<p> KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache </p>\n<p> commit(atLeastSize)pagecache</p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>Consume Queue  Page Cache<br>Commit Log </p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>1).page cache. page cache, IO, . , , .<br>page cache , 1k, , , .<br>Commit Log, IONOOP, , 5.<br>4k, 8K.<br>Consume Queue, , PAGECACHE, Consume Queue, . Consume Queue.<br>2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .</p>\n<p><a href=\"https://segmentfault.com/a/1190000003985468\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000003985468</a><br>kafka</p>\n<p>linuxlinuxlinux</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>page cachepage cachepage cachedisc</p>\n<p>MQpagecachejvm crash</p>\n<p>commit logconsume queuepagecachejava heappagecachepagecachedisc</p>\n<p>producer<br>1.consume queuepagecachepagecache<br>2.commit logpagecacheIO</p>\n<p>pagecachepagecachepagecachesocketconsumer</p>\n<p>MappedByteBuffer <br>MappedByteBuffer</p>\n<p><a href=\"http://www.iocoder.cn/RocketMQ/message-store/\" target=\"_blank\" rel=\"external\">http://www.iocoder.cn/RocketMQ/message-store/</a><br>CommitRealTimeService     &amp;&amp;     <br>FlushRealTimeService     &amp;&amp;     <br>GroupCommitService        <br></p>\n<p><a href=\"http://blog.csdn.net/iie_libi/article/details/54289580\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/iie_libi/article/details/54289580</a><br></p>\n<p>Consumer  sendfile RocketMQmmap+write<br> <br>  DMA  sendfile CPUJVM Crash</p>\n<p></p>\n<p>ext4<br>iodeadlinedeadline IO </p>\n<p></p>\n<p><br>+ </p>\n<p>pagecache</p>\n<p>RocketMQFileChannel.map()MappedByteBufferBufferMQ<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">clean</span><span class=\"params\">(<span class=\"keyword\">final</span> ByteBuffer buffer)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (buffer == <span class=\"keyword\">null</span> || !buffer.isDirect() || buffer.capacity() == <span class=\"number\">0</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    invoke(invoke(viewed(buffer), <span class=\"string\">\"cleaner\"</span>), <span class=\"string\">\"clean\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Deallocator</span></span></div><div class=\"line\"><span class=\"class\">        <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Unsafe unsafe = Unsafe.getUnsafe();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> address;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> size;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> capacity;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Deallocator</span><span class=\"params\">(<span class=\"keyword\">long</span> address, <span class=\"keyword\">long</span> size, <span class=\"keyword\">int</span> capacity)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">assert</span> (address != <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">        <span class=\"keyword\">this</span>.size = size;</div><div class=\"line\">        <span class=\"keyword\">this</span>.capacity = capacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (address == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// Paranoia</span></div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        unsafe.freeMemory(address);</div><div class=\"line\">        address = <span class=\"number\">0</span>;</div><div class=\"line\">        Bits.unreserveMemory(size, capacity);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Full GCFull GCDisableExplicitGCGCFull GC</p>\n<p>  pagecacheIO <br>rocketmq<br><br> <br> PAGECACHE  1k <br>  Commit Log  IO NOOP 5 </p>\n<p> </p>\n<p> 1+<br> a) <br> b) <br> 2<br> a) <br> 3xxhashcrc<br> a) <a href=\"https://cyan4973.github.io/xxHash/\" target=\"_blank\" rel=\"external\">https://cyan4973.github.io/xxHash/</a><br> 4topic<br> a) topic<br> 5STLdequeMESA list<br> a) Dequevector<br> b) <br> 6MESA list<br> a) +logn<br> b) <br> i. leveldbhbase</p>\n<p> <em>java.nio.channels.FileChannel</em><br> <code>public abstract void force(boolean metaData) throws java.io.IOException</code><br> Forces any updates to this channels file to be written to the storage device that contains it.<br> If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br> If the file does not reside on a local device then no such guarantee is made.<br> The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br> Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br> This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p> <em>java.nio.MappedByteBuffer</em><br> <code>public final MappedByteBuffer force()</code><br> Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br> If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br> If the file does not reside on a local device then no such guarantee is made.<br> If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <a href=\"http://blog.csdn.net/a417930422/article/details/52585862\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585862</a></p>\n<p></p>\n<p>wangbin00162017-08-08 17:011<br> -sendfile java<br>FileChannel.transferTo(long position, long count, WritableByteChannel target)//</p>\n<p>rocketmq  RocketMQmmap+writesendfile</p>\n<p>nettyFileRegion FileChannel.transferTo</p>\n<p>FileRegion fileRegion =<br>new ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);<br>channel.writeAndFlush(fileRegion)<br>              2<br>             a417930422<br>            a4179304222017-09-21 10:35<br>            wangbin0016rocketmqmmapjavaMappedByteBuffer<br>             a417930422<br>            a4179304222017-09-21 10:32<br>            wangbin0016rocketmqConsumer mmap+writerocketmq<a href=\"http://blog.csdn.net/a417930422/article/details/52585180\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585180</a>.<br>            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket<br>            GetMessageResultmmap<br>             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage</p>\n<p>rocketmq</p>\n<ol>\n<li><p>io</p>\n<ol>\n<li></li>\n<li>DMA</li>\n</ol>\n</li>\n<li><ol>\n<li></li>\n</ol>\n</li>\n</ol>\n<pre><code>1. \n2. cpu\n3. cpuio(ide,scsi)io\n4. iocpu\n5. cpu\n6. io\n7. cpu\n8. cpu\n</code></pre><ol>\n<li><ol>\n<li>DMA  </li>\n</ol>\n</li>\n<li>DMA</li>\n</ol>\n<pre><code>1. \n2. cpu\n3. cpuDMAio\n4. iocpu\n5. cpu\n6. io\n7. DMAcpu\n8. cpu\n9. cpu\n</code></pre><ol>\n<li>cpucpu<ol>\n<li></li>\n</ol>\n</li>\n<li>  </li>\n</ol>\n<pre><code>1. readDMA\n2. readcpu\n3. sendcpucpu(socket)\n4. sendDMA\n5. \n</code></pre><ol>\n<li></li>\n<li><p></p>\n<ol>\n<li>-sendfile java</li>\n</ol>\n<p>FileChannel.transferTo(long position, long count, WritableByteChannel target)//<br></p>\n</li>\n<li>23</li>\n</ol>\n<pre><code>1. DMA\n2. cpu(socket)\n3. DMA\n4. 2\n</code></pre><ol>\n<li>cpu</li>\n<li>linux2.4socketDMA</li>\n</ol>\n<pre><code>1. DMA\n2. (socket)\n3. DMA\n</code></pre><ol>\n<li><p>-mmap java</p>\n<p>MappedByteBuffer//</p>\n<ol>\n<li>sendfile</li>\n</ol>\n</li>\n<li><ol>\n<li><a href=\"http://blog.chinaunix.net/uid-25314474-id-3325879.html\" target=\"_blank\" rel=\"external\">http://blog.chinaunix.net/uid-25314474-id-3325879.html</a></li>\n<li><a href=\"http://blog.chinaunix.net/uid-28874972-id-3725082.html\" target=\"_blank\" rel=\"external\">http://blog.chinaunix.net/uid-28874972-id-3725082.html</a></li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/java/j-zerocopy/#fig1\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-zerocopy/#fig1</a></li>\n<li><a href=\"http://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/\" target=\"_blank\" rel=\"external\">http://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/</a></li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/</a></li>\n</ol>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>producer<br>1.consume queuepagecachepagecache<br>2.commit logpagecacheIO</p>\n<p>pagecachepagecachepagecachesocketconsumer</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Synchronization flush</span></div><div class=\"line\"><span class=\"keyword\">if</span> (FlushDiskType.SYNC_FLUSH == <span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().getFlushDiskType()) &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> GroupCommitService service = (GroupCommitService) <span class=\"keyword\">this</span>.flushCommitLogService;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">// Asynchronous flush</span></div><div class=\"line\"><span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.defaultMessageStore.getMessageStoreConfig().isTransientStorePoolEnable()) &#123;</div><div class=\"line\">        <span class=\"comment\">// FlushRealTimeService</span></div><div class=\"line\">        flushCommitLogService.wakeup();</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// CommitRealTimeService</span></div><div class=\"line\">        commitLogService.wakeup();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTransientStorePoolEnable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> transientStorePoolEnable &amp;&amp; FlushDiskType.ASYNC_FLUSH == getFlushDiskType()</div><div class=\"line\">        &amp;&amp; BrokerRole.SLAVE != getBrokerRole();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>transientStorePoolEnable<br>FlushRealTimeServiceCommitRealTimeService</p>\n<p><img src=\"/2017/11/03/RocketMQ-Message-send-and-persistence/disc-fall.gif\" alt=\"\"></p>\n<h3 id=\"Offset-ConsumerQueue\"><a href=\"#Offset-ConsumerQueue\" class=\"headerlink\" title=\"Offset: ConsumerQueue\"></a>Offset: ConsumerQueue</h3><h3 id=\"Offset-CommitLog\"><a href=\"#Offset-CommitLog\" class=\"headerlink\" title=\"Offset: CommitLog\"></a>Offset: CommitLog</h3><h3 id=\"MappedByteBuffer\"><a href=\"#MappedByteBuffer\" class=\"headerlink\" title=\"MappedByteBuffer\"></a>MappedByteBuffer</h3><p>MappedByteBufferBuffer<br>CommitLogCommitLogAppend</p>\n<p><em>synchronizedmonitor locksynchronizedownmonitor lockmutual exclusive\n</em>JDK1.6BownAAJVMAJVMBBAA<a href=\"http://blog.csdn.net/u013080921/article/details/42676231\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/u013080921/article/details/42676231</a></p>\n<h4 id=\"Spin-Lock-\"><a href=\"#Spin-Lock-\" class=\"headerlink\" title=\"Spin Lock()\"></a>Spin Lock()</h4><h4 id=\"ReentrantLock-\"><a href=\"#ReentrantLock-\" class=\"headerlink\" title=\"ReentrantLock()\"></a>ReentrantLock()</h4><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/vonzhoufz/article/details/47248777\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/vonzhoufz/article/details/47248777</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://kafka.apache.org/documentation/#design_filesystem\" target=\"_blank\" rel=\"external\">https://kafka.apache.org/documentation/#design_filesystem</a></p>\n<p><a href=\"http://blog.csdn.net/evankaka/article/details/48464013\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/evankaka/article/details/48464013</a></p>\n<p><a href=\"http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/javahongxi/article/details/72956619?locationNum=2&amp;fps=1</a><br>kafka<a href=\"http://blog.csdn.net/tototuzuoquan/article/details/73437890\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/tototuzuoquan/article/details/73437890</a><br>pagecache</p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p> PAGESIZE<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">getconf PAGESIZE</div></pre></td></tr></table></figure></p>\n<p> KafkaPageCachePageCachePageDirtyPageCachePageCachePageCacheOSPageCache </p>\n<p> commit(atLeastSize)pagecache</p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>Consume Queue  Page Cache<br>Commit Log </p>\n<p><a href=\"http://blog.csdn.net/mg0832058/article/details/5890688\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/mg0832058/article/details/5890688</a><br></p>\n<p><a href=\"http://www.jianshu.com/p/6494e33c9b1f\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/6494e33c9b1f</a><br>1).page cache. page cache, IO, . , , .<br>page cache , 1k, , , .<br>Commit Log, IONOOP, , 5.<br>4k, 8K.<br>Consume Queue, , PAGECACHE, Consume Queue, . Consume Queue.<br>2).Commit Log, , MysqlOracleredolog, Commit Log, Consume Queue, .</p>\n<p><a href=\"https://segmentfault.com/a/1190000003985468\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000003985468</a><br>kafka</p>\n<p>linuxlinuxlinux</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>page cachepage cachepage cachedisc</p>\n<p>MQpagecachejvm crash</p>\n<p>commit logconsume queuepagecachejava heappagecachepagecachedisc</p>\n<p>producer<br>1.consume queuepagecachepagecache<br>2.commit logpagecacheIO</p>\n<p>pagecachepagecachepagecachesocketconsumer</p>\n<p>MappedByteBuffer <br>MappedByteBuffer</p>\n<p><a href=\"http://www.iocoder.cn/RocketMQ/message-store/\" target=\"_blank\" rel=\"external\">http://www.iocoder.cn/RocketMQ/message-store/</a><br>CommitRealTimeService     &amp;&amp;     <br>FlushRealTimeService     &amp;&amp;     <br>GroupCommitService        <br></p>\n<p><a href=\"http://blog.csdn.net/iie_libi/article/details/54289580\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/iie_libi/article/details/54289580</a><br></p>\n<p>Consumer  sendfile RocketMQmmap+write<br> <br>  DMA  sendfile CPUJVM Crash</p>\n<p></p>\n<p>ext4<br>iodeadlinedeadline IO </p>\n<p></p>\n<p><br>+ </p>\n<p>pagecache</p>\n<p>RocketMQFileChannel.map()MappedByteBufferBufferMQ<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">clean</span><span class=\"params\">(<span class=\"keyword\">final</span> ByteBuffer buffer)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (buffer == <span class=\"keyword\">null</span> || !buffer.isDirect() || buffer.capacity() == <span class=\"number\">0</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    invoke(invoke(viewed(buffer), <span class=\"string\">\"cleaner\"</span>), <span class=\"string\">\"clean\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Deallocator</span></span></div><div class=\"line\"><span class=\"class\">        <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Unsafe unsafe = Unsafe.getUnsafe();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> address;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> size;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> capacity;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Deallocator</span><span class=\"params\">(<span class=\"keyword\">long</span> address, <span class=\"keyword\">long</span> size, <span class=\"keyword\">int</span> capacity)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">assert</span> (address != <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">        <span class=\"keyword\">this</span>.size = size;</div><div class=\"line\">        <span class=\"keyword\">this</span>.capacity = capacity;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (address == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// Paranoia</span></div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        unsafe.freeMemory(address);</div><div class=\"line\">        address = <span class=\"number\">0</span>;</div><div class=\"line\">        Bits.unreserveMemory(size, capacity);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Full GCFull GCDisableExplicitGCGCFull GC</p>\n<p>  pagecacheIO <br>rocketmq<br><br> <br> PAGECACHE  1k <br>  Commit Log  IO NOOP 5 </p>\n<p> </p>\n<p> 1+<br> a) <br> b) <br> 2<br> a) <br> 3xxhashcrc<br> a) <a href=\"https://cyan4973.github.io/xxHash/\" target=\"_blank\" rel=\"external\">https://cyan4973.github.io/xxHash/</a><br> 4topic<br> a) topic<br> 5STLdequeMESA list<br> a) Dequevector<br> b) <br> 6MESA list<br> a) +logn<br> b) <br> i. leveldbhbase</p>\n<p> <em>java.nio.channels.FileChannel</em><br> <code>public abstract void force(boolean metaData) throws java.io.IOException</code><br> Forces any updates to this channels file to be written to the storage device that contains it.<br> If this channels file resides on a local storage device then when this method returns it is guaranteed that all changes made to the file since this channel was created, or since this method was last invoked, will have been written to that device. This is useful for ensuring that critical information is not lost in the event of a system crash.<br> If the file does not reside on a local device then no such guarantee is made.<br> The metaData parameter can be used to limit the number of I/O operations that this method is required to perform. Passing false for this parameter indicates that only updates to the files content need be written to storage; passing true indicates that updates to both the files content and metadata must be written, which generally requires at least one more I/O operation. Whether this parameter actually has any effect is dependent upon the underlying operating system and is therefore unspecified.<br> Invoking this method may cause an I/O operation to occur even if the channel was only opened for reading. Some operating systems, for example, maintain a last-access time as part of a files metadata, and this time is updated whenever the file is read. Whether or not this is actually done is system-dependent and is therefore unspecified.<br> This method is only guaranteed to force changes that were made to this channels file via the methods defined in this class. <strong>It may or may not force changes that were made by modifying the content of a mapped byte buffer obtained by invoking the map method. Invoking the force method of the mapped byte buffer will force changes made to the buffers content to be written.</strong></p>\n<p> <em>java.nio.MappedByteBuffer</em><br> <code>public final MappedByteBuffer force()</code><br> Forces any changes made to this buffers content to be written to the storage device containing the mapped file.<br> If the file mapped into this buffer resides on a local storage device then when this method returns it is guaranteed that all changes made to the buffer since it was created, or since this method was last invoked, will have been written to that device.<br> If the file does not reside on a local device then no such guarantee is made.<br> If this buffer was not mapped in read/write mode (java.nio.channels.FileChannel.MapMode.READ_WRITE) then invoking this method has no effect.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <a href=\"http://blog.csdn.net/a417930422/article/details/52585862\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585862</a></p>\n<p></p>\n<p>wangbin00162017-08-08 17:011<br> -sendfile java<br>FileChannel.transferTo(long position, long count, WritableByteChannel target)//</p>\n<p>rocketmq  RocketMQmmap+writesendfile</p>\n<p>nettyFileRegion FileChannel.transferTo</p>\n<p>FileRegion fileRegion =<br>new ManyMessageTransfer(response.encodeHeader(getMessageResult.getBufferTotalSize()), getMessageResult);<br>channel.writeAndFlush(fileRegion)<br>              2<br>             a417930422<br>            a4179304222017-09-21 10:35<br>            wangbin0016rocketmqmmapjavaMappedByteBuffer<br>             a417930422<br>            a4179304222017-09-21 10:32<br>            wangbin0016rocketmqConsumer mmap+writerocketmq<a href=\"http://blog.csdn.net/a417930422/article/details/52585180\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/a417930422/article/details/52585180</a>.<br>            nettyFileRegionrocketmqManyMessageTransfertransferGetMessageResultnettychannelsocket<br>            GetMessageResultmmap<br>             com.alibaba.rocketmq.store.DefaultMessageStore.getMessage</p>\n<p>rocketmq</p>\n<ol>\n<li><p>io</p>\n<ol>\n<li></li>\n<li>DMA</li>\n</ol>\n</li>\n<li><ol>\n<li></li>\n</ol>\n</li>\n</ol>\n<pre><code>1. \n2. cpu\n3. cpuio(ide,scsi)io\n4. iocpu\n5. cpu\n6. io\n7. cpu\n8. cpu\n</code></pre><ol>\n<li><ol>\n<li>DMA  </li>\n</ol>\n</li>\n<li>DMA</li>\n</ol>\n<pre><code>1. \n2. cpu\n3. cpuDMAio\n4. iocpu\n5. cpu\n6. io\n7. DMAcpu\n8. cpu\n9. cpu\n</code></pre><ol>\n<li>cpucpu<ol>\n<li></li>\n</ol>\n</li>\n<li>  </li>\n</ol>\n<pre><code>1. readDMA\n2. readcpu\n3. sendcpucpu(socket)\n4. sendDMA\n5. \n</code></pre><ol>\n<li></li>\n<li><p></p>\n<ol>\n<li>-sendfile java</li>\n</ol>\n<p>FileChannel.transferTo(long position, long count, WritableByteChannel target)//<br></p>\n</li>\n<li>23</li>\n</ol>\n<pre><code>1. DMA\n2. cpu(socket)\n3. DMA\n4. 2\n</code></pre><ol>\n<li>cpu</li>\n<li>linux2.4socketDMA</li>\n</ol>\n<pre><code>1. DMA\n2. (socket)\n3. DMA\n</code></pre><ol>\n<li><p>-mmap java</p>\n<p>MappedByteBuffer//</p>\n<ol>\n<li>sendfile</li>\n</ol>\n</li>\n<li><ol>\n<li><a href=\"http://blog.chinaunix.net/uid-25314474-id-3325879.html\" target=\"_blank\" rel=\"external\">http://blog.chinaunix.net/uid-25314474-id-3325879.html</a></li>\n<li><a href=\"http://blog.chinaunix.net/uid-28874972-id-3725082.html\" target=\"_blank\" rel=\"external\">http://blog.chinaunix.net/uid-28874972-id-3725082.html</a></li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/java/j-zerocopy/#fig1\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/java/j-zerocopy/#fig1</a></li>\n<li><a href=\"http://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/\" target=\"_blank\" rel=\"external\">http://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/</a></li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/\" target=\"_blank\" rel=\"external\">https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/</a></li>\n</ol>\n</li>\n</ol>\n"},{"title":"RocketMQPullRequest()","date":"2017-09-20T08:58:52.000Z","_content":"\n\nClientBroker\n\n### Client: \n\n### Broker:\nPullMessageProcessorprocessRequestConsumerQueue\nNettychannel\npullRequestPullRequestHoldServicepullRequestTablesuspend\n``` java \ncase ResponseCode.PULL_NOT_FOUND:\n    if (brokerAllowSuspend && hasSuspendFlag) {\n        long pollingTimeMills = suspendTimeoutMillisLong;\n        if (!this.brokerController.getBrokerConfig().isLongPollingEnable()) {\n            pollingTimeMills = this.brokerController.getBrokerConfig().getShortPollingTimeMills();\n        }\n\n        String topic = requestHeader.getTopic();\n        long offset = requestHeader.getQueueOffset();\n        int queueId = requestHeader.getQueueId();\n        PullRequest pullRequest = new PullRequest(request, channel, pollingTimeMills,\n            this.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);\n        this.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);\n        // repsonsenullremote-serverchannel\n        // 1. PullRequestHoldService hold\n        // 2. \n        response = null;\n        break;\n    }\n```\nCommitLogHoldPullRequest\nDefaultMessageStore.ReputMessageService\nReputMessageService(Busy Spin)CPU\n``` java\nwhile (!this.isStopped()) {\n    try {\n        Thread.sleep(1);\n        this.doReput();\n    } catch (Exception e) {\n        DefaultMessageStore.log.warn(this.getServiceName() + \" service has exception. \", e);\n    }\n}\n```\nCommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)\n\nconsumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset\nindex file\nbitmapdoDispatch\n\nmessageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving\nPullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient\n``` java\n// \nprivate void doReput() {\n    for (boolean doNext = true; this.isCommitLogAvailable() && doNext; ) {\n        ...\n        SelectMappedBufferResult result = DefaultMessageStore.this.commitLog.getData(reputFromOffset);\n        ...\n        this.reputFromOffset = result.getStartOffset();\n\n        for (int readSize = 0; readSize < result.getSize() && doNext; ) {\n            DispatchRequest dispatchRequest =\n                DefaultMessageStore.this.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), false, false);\n            int size = dispatchRequest.getMsgSize();\n            ...\n            if (size > 0) {\n                // dispatchconsumerQueueindex file\n                DefaultMessageStore.this.doDispatch(dispatchRequest);\n                \n                if (BrokerRole.SLAVE != DefaultMessageStore.this.getMessageStoreConfig().getBrokerRole()\n                    && DefaultMessageStore.this.brokerConfig.isLongPollingEnable()) {\n                    // suspend pullRequestPullRequestHoldServicepullRequesthold\n                    DefaultMessageStore.this.messageArrivingListener.arriving(dispatchRequest.getTopic(),\n                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + 1,\n                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),\n                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());\n                }\n\n            } \n            ...\n        }\n    }\n}\n```\n\n\n\n![](https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg)\n","source":"_posts/RocketMQ-Pull-message-with-long-polling.md","raw":"---\ntitle: RocketMQPullRequest()\ndate: 2017-09-20 16:58:52\ntags: RocketMQ\n---\n\n\nClientBroker\n\n### Client: \n\n### Broker:\nPullMessageProcessorprocessRequestConsumerQueue\nNettychannel\npullRequestPullRequestHoldServicepullRequestTablesuspend\n``` java \ncase ResponseCode.PULL_NOT_FOUND:\n    if (brokerAllowSuspend && hasSuspendFlag) {\n        long pollingTimeMills = suspendTimeoutMillisLong;\n        if (!this.brokerController.getBrokerConfig().isLongPollingEnable()) {\n            pollingTimeMills = this.brokerController.getBrokerConfig().getShortPollingTimeMills();\n        }\n\n        String topic = requestHeader.getTopic();\n        long offset = requestHeader.getQueueOffset();\n        int queueId = requestHeader.getQueueId();\n        PullRequest pullRequest = new PullRequest(request, channel, pollingTimeMills,\n            this.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);\n        this.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);\n        // repsonsenullremote-serverchannel\n        // 1. PullRequestHoldService hold\n        // 2. \n        response = null;\n        break;\n    }\n```\nCommitLogHoldPullRequest\nDefaultMessageStore.ReputMessageService\nReputMessageService(Busy Spin)CPU\n``` java\nwhile (!this.isStopped()) {\n    try {\n        Thread.sleep(1);\n        this.doReput();\n    } catch (Exception e) {\n        DefaultMessageStore.log.warn(this.getServiceName() + \" service has exception. \", e);\n    }\n}\n```\nCommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)\n\nconsumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset\nindex file\nbitmapdoDispatch\n\nmessageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving\nPullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient\n``` java\n// \nprivate void doReput() {\n    for (boolean doNext = true; this.isCommitLogAvailable() && doNext; ) {\n        ...\n        SelectMappedBufferResult result = DefaultMessageStore.this.commitLog.getData(reputFromOffset);\n        ...\n        this.reputFromOffset = result.getStartOffset();\n\n        for (int readSize = 0; readSize < result.getSize() && doNext; ) {\n            DispatchRequest dispatchRequest =\n                DefaultMessageStore.this.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), false, false);\n            int size = dispatchRequest.getMsgSize();\n            ...\n            if (size > 0) {\n                // dispatchconsumerQueueindex file\n                DefaultMessageStore.this.doDispatch(dispatchRequest);\n                \n                if (BrokerRole.SLAVE != DefaultMessageStore.this.getMessageStoreConfig().getBrokerRole()\n                    && DefaultMessageStore.this.brokerConfig.isLongPollingEnable()) {\n                    // suspend pullRequestPullRequestHoldServicepullRequesthold\n                    DefaultMessageStore.this.messageArrivingListener.arriving(dispatchRequest.getTopic(),\n                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + 1,\n                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),\n                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());\n                }\n\n            } \n            ...\n        }\n    }\n}\n```\n\n\n\n![](https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg)\n","slug":"RocketMQ-Pull-message-with-long-polling","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszm002z3iq2i3szvgv4","content":"<p>ClientBroker</p>\n<h3 id=\"Client\"><a href=\"#Client\" class=\"headerlink\" title=\"Client:\"></a>Client:</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker:\"></a>Broker:</h3><p>PullMessageProcessorprocessRequestConsumerQueue<br>Nettychannel<br>pullRequestPullRequestHoldServicepullRequestTablesuspend<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> ResponseCode.PULL_NOT_FOUND:</div><div class=\"line\">    <span class=\"keyword\">if</span> (brokerAllowSuspend &amp;&amp; hasSuspendFlag) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> pollingTimeMills = suspendTimeoutMillisLong;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.brokerController.getBrokerConfig().isLongPollingEnable()) &#123;</div><div class=\"line\">            pollingTimeMills = <span class=\"keyword\">this</span>.brokerController.getBrokerConfig().getShortPollingTimeMills();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        String topic = requestHeader.getTopic();</div><div class=\"line\">        <span class=\"keyword\">long</span> offset = requestHeader.getQueueOffset();</div><div class=\"line\">        <span class=\"keyword\">int</span> queueId = requestHeader.getQueueId();</div><div class=\"line\">        PullRequest pullRequest = <span class=\"keyword\">new</span> PullRequest(request, channel, pollingTimeMills,</div><div class=\"line\">            <span class=\"keyword\">this</span>.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);</div><div class=\"line\">        <span class=\"keyword\">this</span>.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);</div><div class=\"line\">        <span class=\"comment\">// repsonsenullremote-serverchannel</span></div><div class=\"line\">        <span class=\"comment\">// 1. PullRequestHoldService hold</span></div><div class=\"line\">        <span class=\"comment\">// 2. </span></div><div class=\"line\">        response = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogHoldPullRequest<br>DefaultMessageStore.ReputMessageService<br>ReputMessageService(Busy Spin)CPU<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Thread.sleep(<span class=\"number\">1</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.doReput();</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        DefaultMessageStore.log.warn(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">\" service has exception. \"</span>, e);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)<br><br>consumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset<br>index file<br>bitmapdoDispatch</p>\n<p>messageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving<br>PullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doReput</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">boolean</span> doNext = <span class=\"keyword\">true</span>; <span class=\"keyword\">this</span>.isCommitLogAvailable() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">        ...</div><div class=\"line\">        SelectMappedBufferResult result = DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.getData(reputFromOffset);</div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">this</span>.reputFromOffset = result.getStartOffset();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> readSize = <span class=\"number\">0</span>; readSize &lt; result.getSize() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">            DispatchRequest dispatchRequest =</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">int</span> size = dispatchRequest.getMsgSize();</div><div class=\"line\">            ...</div><div class=\"line\">            <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">// dispatchconsumerQueueindex file</span></div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.doDispatch(dispatchRequest);</div><div class=\"line\">                </div><div class=\"line\">                <span class=\"keyword\">if</span> (BrokerRole.SLAVE != DefaultMessageStore.<span class=\"keyword\">this</span>.getMessageStoreConfig().getBrokerRole()</div><div class=\"line\">                    &amp;&amp; DefaultMessageStore.<span class=\"keyword\">this</span>.brokerConfig.isLongPollingEnable()) &#123;</div><div class=\"line\">                    <span class=\"comment\">// suspend pullRequestPullRequestHoldServicepullRequesthold</span></div><div class=\"line\">                    DefaultMessageStore.<span class=\"keyword\">this</span>.messageArrivingListener.arriving(dispatchRequest.getTopic(),</div><div class=\"line\">                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + <span class=\"number\">1</span>,</div><div class=\"line\">                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),</div><div class=\"line\">                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">            &#125; </div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></p>\n<p><img src=\"https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>ClientBroker</p>\n<h3 id=\"Client\"><a href=\"#Client\" class=\"headerlink\" title=\"Client:\"></a>Client:</h3><h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker:\"></a>Broker:</h3><p>PullMessageProcessorprocessRequestConsumerQueue<br>Nettychannel<br>pullRequestPullRequestHoldServicepullRequestTablesuspend<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> ResponseCode.PULL_NOT_FOUND:</div><div class=\"line\">    <span class=\"keyword\">if</span> (brokerAllowSuspend &amp;&amp; hasSuspendFlag) &#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> pollingTimeMills = suspendTimeoutMillisLong;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.brokerController.getBrokerConfig().isLongPollingEnable()) &#123;</div><div class=\"line\">            pollingTimeMills = <span class=\"keyword\">this</span>.brokerController.getBrokerConfig().getShortPollingTimeMills();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        String topic = requestHeader.getTopic();</div><div class=\"line\">        <span class=\"keyword\">long</span> offset = requestHeader.getQueueOffset();</div><div class=\"line\">        <span class=\"keyword\">int</span> queueId = requestHeader.getQueueId();</div><div class=\"line\">        PullRequest pullRequest = <span class=\"keyword\">new</span> PullRequest(request, channel, pollingTimeMills,</div><div class=\"line\">            <span class=\"keyword\">this</span>.brokerController.getMessageStore().now(), offset, subscriptionData, messageFilter);</div><div class=\"line\">        <span class=\"keyword\">this</span>.brokerController.getPullRequestHoldService().suspendPullRequest(topic, queueId, pullRequest);</div><div class=\"line\">        <span class=\"comment\">// repsonsenullremote-serverchannel</span></div><div class=\"line\">        <span class=\"comment\">// 1. PullRequestHoldService hold</span></div><div class=\"line\">        <span class=\"comment\">// 2. </span></div><div class=\"line\">        response = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogHoldPullRequest<br>DefaultMessageStore.ReputMessageService<br>ReputMessageService(Busy Spin)CPU<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Thread.sleep(<span class=\"number\">1</span>);</div><div class=\"line\">        <span class=\"keyword\">this</span>.doReput();</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        DefaultMessageStore.log.warn(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">\" service has exception. \"</span>, e);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>CommitLogMaxOffsetCommitLogdispatchRequestDefaultMessageStoredoDispatch(dispatchRequest)<br><br>consumerQueue2consumerQueuelogicOffsetCommitLogPhyicOffset<br>index file<br>bitmapdoDispatch</p>\n<p>messageArrivingListenerarrivingpullRequestHoldServicenotifyMessageArriving<br>PullMessageProcessorprocessRequestpullRequestconsumerQueuenettyclient<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// </span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doReput</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">boolean</span> doNext = <span class=\"keyword\">true</span>; <span class=\"keyword\">this</span>.isCommitLogAvailable() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">        ...</div><div class=\"line\">        SelectMappedBufferResult result = DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.getData(reputFromOffset);</div><div class=\"line\">        ...</div><div class=\"line\">        <span class=\"keyword\">this</span>.reputFromOffset = result.getStartOffset();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> readSize = <span class=\"number\">0</span>; readSize &lt; result.getSize() &amp;&amp; doNext; ) &#123;</div><div class=\"line\">            DispatchRequest dispatchRequest =</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">int</span> size = dispatchRequest.getMsgSize();</div><div class=\"line\">            ...</div><div class=\"line\">            <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"comment\">// dispatchconsumerQueueindex file</span></div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.doDispatch(dispatchRequest);</div><div class=\"line\">                </div><div class=\"line\">                <span class=\"keyword\">if</span> (BrokerRole.SLAVE != DefaultMessageStore.<span class=\"keyword\">this</span>.getMessageStoreConfig().getBrokerRole()</div><div class=\"line\">                    &amp;&amp; DefaultMessageStore.<span class=\"keyword\">this</span>.brokerConfig.isLongPollingEnable()) &#123;</div><div class=\"line\">                    <span class=\"comment\">// suspend pullRequestPullRequestHoldServicepullRequesthold</span></div><div class=\"line\">                    DefaultMessageStore.<span class=\"keyword\">this</span>.messageArrivingListener.arriving(dispatchRequest.getTopic(),</div><div class=\"line\">                        dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + <span class=\"number\">1</span>,</div><div class=\"line\">                        dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),</div><div class=\"line\">                        dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">            &#125; </div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></p>\n<p><img src=\"https://ws2.sinaimg.cn/large/006tKfTcgy1fkeelo8oxpj30za0g2adr.jpg\" alt=\"\"></p>\n"},{"title":"RocketMQ","date":"2017-11-10T10:41:47.000Z","_content":"\n\n### \n\nLengthFieldBasedFrameDecoder\n\n### Request, Response\n\njsonProtobuf\n\n\nhttps://zhuanlan.zhihu.com/rocketmq","source":"_posts/RocketMQ-Remote-communication-protocol-and-serialization.md","raw":"---\ntitle: RocketMQ\ndate: 2017-11-10 18:41:47\ntags: RocketMQ\n---\n\n\n### \n\nLengthFieldBasedFrameDecoder\n\n### Request, Response\n\njsonProtobuf\n\n\nhttps://zhuanlan.zhihu.com/rocketmq","slug":"RocketMQ-Remote-communication-protocol-and-serialization","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszo00323iq2s7omtwei","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>LengthFieldBasedFrameDecoder</p>\n<h3 id=\"Request-Response\"><a href=\"#Request-Response\" class=\"headerlink\" title=\"Request, Response\"></a>Request, Response</h3><p>jsonProtobuf</p>\n<p><a href=\"https://zhuanlan.zhihu.com/rocketmq\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/rocketmq</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>LengthFieldBasedFrameDecoder</p>\n<h3 id=\"Request-Response\"><a href=\"#Request-Response\" class=\"headerlink\" title=\"Request, Response\"></a>Request, Response</h3><p>jsonProtobuf</p>\n<p><a href=\"https://zhuanlan.zhihu.com/rocketmq\" target=\"_blank\" rel=\"external\">https://zhuanlan.zhihu.com/rocketmq</a></p>\n"},{"title":"Serialization-Hessian","date":"2017-12-05T02:35:33.000Z","_content":"\nhttp://www.jianshu.com/p/e800d8af4e22\n\nhttp://hessian.caucho.com/doc/hessian-serialization.html","source":"_posts/Serialization-Hessian.md","raw":"---\ntitle: Serialization-Hessian\ndate: 2017-12-05 10:35:33\ntags: \n---\n\nhttp://www.jianshu.com/p/e800d8af4e22\n\nhttp://hessian.caucho.com/doc/hessian-serialization.html","slug":"Serialization-Hessian","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszp00333iq2rvy6nca8","content":"<p><a href=\"http://www.jianshu.com/p/e800d8af4e22\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/e800d8af4e22</a></p>\n<p><a href=\"http://hessian.caucho.com/doc/hessian-serialization.html\" target=\"_blank\" rel=\"external\">http://hessian.caucho.com/doc/hessian-serialization.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.jianshu.com/p/e800d8af4e22\" target=\"_blank\" rel=\"external\">http://www.jianshu.com/p/e800d8af4e22</a></p>\n<p><a href=\"http://hessian.caucho.com/doc/hessian-serialization.html\" target=\"_blank\" rel=\"external\">http://hessian.caucho.com/doc/hessian-serialization.html</a></p>\n"},{"title":"RocketMQ","date":"2017-10-11T08:27:43.000Z","_content":"\n\nhttps://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\n\n![](RocketMQ-Transactional-message/transaction_rocketmq.gif)\n\n### \n\nproducerhalf msgbrokerconsumerlong pooling\nCOMMIT ConsumeQueue\n``` java\nclass CommitLogDispatcherBuildConsumeQueue implements CommitLogDispatcher {\n\n    @Override\n    public void dispatch(DispatchRequest request) {\n        final int tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());\n        switch (tranType) {\n            case MessageSysFlag.TRANSACTION_NOT_TYPE:\n            // commit log TRANSACTION_COMMIT_TYPE consume queue\n            // consumer\n            case MessageSysFlag.TRANSACTION_COMMIT_TYPE:\n                DefaultMessageStore.this.putMessagePositionInfo(request);\n                break;\n            case MessageSysFlag.TRANSACTION_PREPARED_TYPE:\n            case MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:\n                break;\n        }\n    }\n}\n```","source":"_posts/RocketMQ-Transactional-message.md","raw":"---\ntitle: RocketMQ\ndate: 2017-10-11 16:27:43\ntags: RocketMQ\n---\n\n\nhttps://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\n\n![](RocketMQ-Transactional-message/transaction_rocketmq.gif)\n\n### \n\nproducerhalf msgbrokerconsumerlong pooling\nCOMMIT ConsumeQueue\n``` java\nclass CommitLogDispatcherBuildConsumeQueue implements CommitLogDispatcher {\n\n    @Override\n    public void dispatch(DispatchRequest request) {\n        final int tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());\n        switch (tranType) {\n            case MessageSysFlag.TRANSACTION_NOT_TYPE:\n            // commit log TRANSACTION_COMMIT_TYPE consume queue\n            // consumer\n            case MessageSysFlag.TRANSACTION_COMMIT_TYPE:\n                DefaultMessageStore.this.putMessagePositionInfo(request);\n                break;\n            case MessageSysFlag.TRANSACTION_PREPARED_TYPE:\n            case MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:\n                break;\n        }\n    }\n}\n```","slug":"RocketMQ-Transactional-message","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszq00363iq287wvfb7q","content":"<p><a href=\"https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\" target=\"_blank\" rel=\"external\">https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7</a></p>\n<p><img src=\"/2017/10/11/RocketMQ-Transactional-message/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>producerhalf msgbrokerconsumerlong pooling<br>COMMIT ConsumeQueue<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CommitLogDispatcherBuildConsumeQueue</span> <span class=\"keyword\">implements</span> <span class=\"title\">CommitLogDispatcher</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());</div><div class=\"line\">        <span class=\"keyword\">switch</span> (tranType) &#123;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_NOT_TYPE:</div><div class=\"line\">            <span class=\"comment\">// commit log TRANSACTION_COMMIT_TYPE consume queue</span></div><div class=\"line\">            <span class=\"comment\">// consumer</span></div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_COMMIT_TYPE:</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.putMessagePositionInfo(request);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_PREPARED_TYPE:</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7\" target=\"_blank\" rel=\"external\">https://help.aliyun.com/document_detail/43348.html?spm=5176.doc43490.6.566.Zd5Bl7</a></p>\n<p><img src=\"/2017/10/11/RocketMQ-Transactional-message/transaction_rocketmq.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>producerhalf msgbrokerconsumerlong pooling<br>COMMIT ConsumeQueue<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CommitLogDispatcherBuildConsumeQueue</span> <span class=\"keyword\">implements</span> <span class=\"title\">CommitLogDispatcher</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(DispatchRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> tranType = MessageSysFlag.getTransactionValue(request.getSysFlag());</div><div class=\"line\">        <span class=\"keyword\">switch</span> (tranType) &#123;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_NOT_TYPE:</div><div class=\"line\">            <span class=\"comment\">// commit log TRANSACTION_COMMIT_TYPE consume queue</span></div><div class=\"line\">            <span class=\"comment\">// consumer</span></div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_COMMIT_TYPE:</div><div class=\"line\">                DefaultMessageStore.<span class=\"keyword\">this</span>.putMessagePositionInfo(request);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_PREPARED_TYPE:</div><div class=\"line\">            <span class=\"keyword\">case</span> MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n"},{"title":"SourceCode-Future","date":"2017-12-03T03:15:24.000Z","_content":"\n\nFutureChannelFuture","source":"_posts/SourceCode-Future.md","raw":"---\ntitle: SourceCode-Future\ndate: 2017-12-03 11:15:24\ntags: \n---\n\n\nFutureChannelFuture","slug":"SourceCode-Future","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszr00373iq2l573mnlh","content":"<p>FutureChannelFuture</p>\n","site":{"data":{}},"excerpt":"","more":"<p>FutureChannelFuture</p>\n"},{"title":"SourceCode-AbstractQueuedSynchronizer","date":"2017-12-03T03:15:58.000Z","_content":"\n\nhttp://guochenglai.com/2016/06/06/java-concurrent5-aqs-code-analysis/\n\n### AQS\n\n### fair\n\n\n\n### nonfair\n\n\n\n``` java\nfinal void lock() {\n    if (compareAndSetState(0, 1))\n        setExclusiveOwnerThread(Thread.currentThread());\n    else\n         acquire(1);\n }\n```\n\n``` java\n/**\n * Releases in exclusive mode.  Implemented by unblocking one or\n * more threads if {@link #tryRelease} returns true.\n * This method can be used to implement method {@link Lock#unlock}.\n *\n * @param arg the release argument.  This value is conveyed to\n *        {@link #tryRelease} but is otherwise uninterpreted and\n *        can represent anything you like.\n * @return the value returned from {@link #tryRelease}\n */\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {\n        Node h = head;\n        if (h != null && h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\n```\n\n\n### AQS\n\n### AQSsemaphore\n\n\n\n\n\n### \nhttp://blog.csdn.net/hengyunabc/article/details/28126139\n\nparkunpark\nunparkpark\n\nunParkparkparkparkparkunpark\n\n\n\nJava5wait/notify/notifyAllwait/notifyBnotifyABAwaitA\n\nnotifynotifyAll\n\nnotifywaitnotifyAll\n\npark/unparkObject\n\nHotSpotpark/unpark\n\njavaParkerParker\n\n``` C++ \nclass Parker : public os::PlatformParker {  \nprivate:  \n  volatile int _counter ;  \n  ...  \npublic:  \n  void park(bool isAbsolute, jlong time);  \n  void unpark();  \n  ...  \n}  \nclass PlatformParker : public CHeapObj<mtInternal> {  \n  protected:  \n    pthread_mutex_t _mutex [1] ;  \n    pthread_cond_t  _cond  [1] ;  \n    ...  \n} \n```","source":"_posts/SourceCode-AbstractQueuedSynchronizer.md","raw":"---\ntitle: SourceCode-AbstractQueuedSynchronizer\ndate: 2017-12-03 11:15:58\ntags: \n---\n\n\nhttp://guochenglai.com/2016/06/06/java-concurrent5-aqs-code-analysis/\n\n### AQS\n\n### fair\n\n\n\n### nonfair\n\n\n\n``` java\nfinal void lock() {\n    if (compareAndSetState(0, 1))\n        setExclusiveOwnerThread(Thread.currentThread());\n    else\n         acquire(1);\n }\n```\n\n``` java\n/**\n * Releases in exclusive mode.  Implemented by unblocking one or\n * more threads if {@link #tryRelease} returns true.\n * This method can be used to implement method {@link Lock#unlock}.\n *\n * @param arg the release argument.  This value is conveyed to\n *        {@link #tryRelease} but is otherwise uninterpreted and\n *        can represent anything you like.\n * @return the value returned from {@link #tryRelease}\n */\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {\n        Node h = head;\n        if (h != null && h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\n```\n\n\n### AQS\n\n### AQSsemaphore\n\n\n\n\n\n### \nhttp://blog.csdn.net/hengyunabc/article/details/28126139\n\nparkunpark\nunparkpark\n\nunParkparkparkparkparkunpark\n\n\n\nJava5wait/notify/notifyAllwait/notifyBnotifyABAwaitA\n\nnotifynotifyAll\n\nnotifywaitnotifyAll\n\npark/unparkObject\n\nHotSpotpark/unpark\n\njavaParkerParker\n\n``` C++ \nclass Parker : public os::PlatformParker {  \nprivate:  \n  volatile int _counter ;  \n  ...  \npublic:  \n  void park(bool isAbsolute, jlong time);  \n  void unpark();  \n  ...  \n}  \nclass PlatformParker : public CHeapObj<mtInternal> {  \n  protected:  \n    pthread_mutex_t _mutex [1] ;  \n    pthread_cond_t  _cond  [1] ;  \n    ...  \n} \n```","slug":"SourceCode-AbstractQueuedSynchronizer","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszs003a3iq2ehvny98o","content":"<p><a href=\"http://guochenglai.com/2016/06/06/java-concurrent5-aqs-code-analysis/\" target=\"_blank\" rel=\"external\">http://guochenglai.com/2016/06/06/java-concurrent5-aqs-code-analysis/</a></p>\n<h3 id=\"AQS\"><a href=\"#AQS\" class=\"headerlink\" title=\"AQS\"></a>AQS</h3><h3 id=\"fair\"><a href=\"#fair\" class=\"headerlink\" title=\"fair\"></a>fair</h3><p></p>\n<h3 id=\"nonfair\"><a href=\"#nonfair\" class=\"headerlink\" title=\"nonfair\"></a>nonfair</h3><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (compareAndSetState(<span class=\"number\">0</span>, <span class=\"number\">1</span>))</div><div class=\"line\">        setExclusiveOwnerThread(Thread.currentThread());</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">         acquire(<span class=\"number\">1</span>);</div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Releases in exclusive mode.  Implemented by unblocking one or</span></div><div class=\"line\"><span class=\"comment\"> * more threads if &#123;<span class=\"doctag\">@link</span> #tryRelease&#125; returns true.</span></div><div class=\"line\"><span class=\"comment\"> * This method can be used to implement method &#123;<span class=\"doctag\">@link</span> Lock#unlock&#125;.</span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> arg the release argument.  This value is conveyed to</span></div><div class=\"line\"><span class=\"comment\"> *        &#123;<span class=\"doctag\">@link</span> #tryRelease&#125; but is otherwise uninterpreted and</span></div><div class=\"line\"><span class=\"comment\"> *        can represent anything you like.</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> the value returned from &#123;<span class=\"doctag\">@link</span> #tryRelease&#125;</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">release</span><span class=\"params\">(<span class=\"keyword\">int</span> arg)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (tryRelease(arg)) &#123;</div><div class=\"line\">        Node h = head;</div><div class=\"line\">        <span class=\"keyword\">if</span> (h != <span class=\"keyword\">null</span> &amp;&amp; h.waitStatus != <span class=\"number\">0</span>)</div><div class=\"line\">            unparkSuccessor(h);</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"AQS\"><a href=\"#AQS\" class=\"headerlink\" title=\"AQS\"></a>AQS</h3><h3 id=\"AQSsemaphore\"><a href=\"#AQSsemaphore\" class=\"headerlink\" title=\"AQSsemaphore\"></a>AQSsemaphore</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/hengyunabc/article/details/28126139\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/hengyunabc/article/details/28126139</a></p>\n<p>parkunpark<br>unparkpark</p>\n<p>unParkparkparkparkparkunpark</p>\n<p></p>\n<p>Java5wait/notify/notifyAllwait/notifyBnotifyABAwaitA</p>\n<p>notifynotifyAll</p>\n<p>notifywaitnotifyAll</p>\n<p>park/unparkObject</p>\n<p>HotSpotpark/unpark</p>\n<p>javaParkerParker</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parker</span> :</span> <span class=\"keyword\">public</span> os::PlatformParker &#123;  </div><div class=\"line\"><span class=\"keyword\">private</span>:  </div><div class=\"line\">  <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> _counter ;  </div><div class=\"line\">  ...  </div><div class=\"line\"><span class=\"keyword\">public</span>:  </div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">park</span><span class=\"params\">(<span class=\"keyword\">bool</span> isAbsolute, jlong time)</span></span>;  </div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unpark</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">  ...  </div><div class=\"line\">&#125;  </div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PlatformParker</span> :</span> <span class=\"keyword\">public</span> CHeapObj&lt;mtInternal&gt; &#123;  </div><div class=\"line\">  <span class=\"keyword\">protected</span>:  </div><div class=\"line\">    <span class=\"keyword\">pthread_mutex_t</span> _mutex [<span class=\"number\">1</span>] ;  </div><div class=\"line\">    <span class=\"keyword\">pthread_cond_t</span>  _cond  [<span class=\"number\">1</span>] ;  </div><div class=\"line\">    ...  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://guochenglai.com/2016/06/06/java-concurrent5-aqs-code-analysis/\" target=\"_blank\" rel=\"external\">http://guochenglai.com/2016/06/06/java-concurrent5-aqs-code-analysis/</a></p>\n<h3 id=\"AQS\"><a href=\"#AQS\" class=\"headerlink\" title=\"AQS\"></a>AQS</h3><h3 id=\"fair\"><a href=\"#fair\" class=\"headerlink\" title=\"fair\"></a>fair</h3><p></p>\n<h3 id=\"nonfair\"><a href=\"#nonfair\" class=\"headerlink\" title=\"nonfair\"></a>nonfair</h3><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (compareAndSetState(<span class=\"number\">0</span>, <span class=\"number\">1</span>))</div><div class=\"line\">        setExclusiveOwnerThread(Thread.currentThread());</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">         acquire(<span class=\"number\">1</span>);</div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Releases in exclusive mode.  Implemented by unblocking one or</span></div><div class=\"line\"><span class=\"comment\"> * more threads if &#123;<span class=\"doctag\">@link</span> #tryRelease&#125; returns true.</span></div><div class=\"line\"><span class=\"comment\"> * This method can be used to implement method &#123;<span class=\"doctag\">@link</span> Lock#unlock&#125;.</span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> arg the release argument.  This value is conveyed to</span></div><div class=\"line\"><span class=\"comment\"> *        &#123;<span class=\"doctag\">@link</span> #tryRelease&#125; but is otherwise uninterpreted and</span></div><div class=\"line\"><span class=\"comment\"> *        can represent anything you like.</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> the value returned from &#123;<span class=\"doctag\">@link</span> #tryRelease&#125;</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">release</span><span class=\"params\">(<span class=\"keyword\">int</span> arg)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (tryRelease(arg)) &#123;</div><div class=\"line\">        Node h = head;</div><div class=\"line\">        <span class=\"keyword\">if</span> (h != <span class=\"keyword\">null</span> &amp;&amp; h.waitStatus != <span class=\"number\">0</span>)</div><div class=\"line\">            unparkSuccessor(h);</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"AQS\"><a href=\"#AQS\" class=\"headerlink\" title=\"AQS\"></a>AQS</h3><h3 id=\"AQSsemaphore\"><a href=\"#AQSsemaphore\" class=\"headerlink\" title=\"AQSsemaphore\"></a>AQSsemaphore</h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://blog.csdn.net/hengyunabc/article/details/28126139\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/hengyunabc/article/details/28126139</a></p>\n<p>parkunpark<br>unparkpark</p>\n<p>unParkparkparkparkparkunpark</p>\n<p></p>\n<p>Java5wait/notify/notifyAllwait/notifyBnotifyABAwaitA</p>\n<p>notifynotifyAll</p>\n<p>notifywaitnotifyAll</p>\n<p>park/unparkObject</p>\n<p>HotSpotpark/unpark</p>\n<p>javaParkerParker</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parker</span> :</span> <span class=\"keyword\">public</span> os::PlatformParker &#123;  </div><div class=\"line\"><span class=\"keyword\">private</span>:  </div><div class=\"line\">  <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> _counter ;  </div><div class=\"line\">  ...  </div><div class=\"line\"><span class=\"keyword\">public</span>:  </div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">park</span><span class=\"params\">(<span class=\"keyword\">bool</span> isAbsolute, jlong time)</span></span>;  </div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unpark</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">  ...  </div><div class=\"line\">&#125;  </div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PlatformParker</span> :</span> <span class=\"keyword\">public</span> CHeapObj&lt;mtInternal&gt; &#123;  </div><div class=\"line\">  <span class=\"keyword\">protected</span>:  </div><div class=\"line\">    <span class=\"keyword\">pthread_mutex_t</span> _mutex [<span class=\"number\">1</span>] ;  </div><div class=\"line\">    <span class=\"keyword\">pthread_cond_t</span>  _cond  [<span class=\"number\">1</span>] ;  </div><div class=\"line\">    ...  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"SourceCode-Map","date":"2017-11-12T13:54:26.000Z","_content":"\nhttp://www.importnew.com/26049.html\nConcurrentHashMap\n\nJDK ConcurrentHashMap\nconcurrenthashmap\n\nhttp://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\nHashMap\n\nHashMap\n\nHashMap\nhashmap  2. newCap = oldCap << 1 Map\n\nHashMap  tableloadFactor  \nHashMap \nHashMap  HashTableConcurrentHashMap \nHashMap\nHashMapLinkedMapTreeMap\nHashMapTreeMap\nHashMap(load factor)\nHashMap  Map  hashcode \n\nJDK1.8  concurrentHashMap \n\n\nhttp://guochenglai.com/2016/06/04/java-concurrent4-java-subsection-decompose/\n\n\n\n ExecutorService  runnabledead","source":"_posts/SourceCode-Map.md","raw":"---\ntitle: SourceCode-Map\ndate: 2017-11-12 21:54:26\ntags: \n---\n\nhttp://www.importnew.com/26049.html\nConcurrentHashMap\n\nJDK ConcurrentHashMap\nconcurrenthashmap\n\nhttp://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\nHashMap\n\nHashMap\n\nHashMap\nhashmap  2. newCap = oldCap << 1 Map\n\nHashMap  tableloadFactor  \nHashMap \nHashMap  HashTableConcurrentHashMap \nHashMap\nHashMapLinkedMapTreeMap\nHashMapTreeMap\nHashMap(load factor)\nHashMap  Map  hashcode \n\nJDK1.8  concurrentHashMap \n\n\nhttp://guochenglai.com/2016/06/04/java-concurrent4-java-subsection-decompose/\n\n\n\n ExecutorService  runnabledead","slug":"SourceCode-Map","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszt003b3iq24ls47zc7","content":"<p><a href=\"http://www.importnew.com/26049.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/26049.html</a><br>ConcurrentHashMap</p>\n<p>JDK ConcurrentHashMap<br>concurrenthashmap</p>\n<p><a href=\"http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\" target=\"_blank\" rel=\"external\">http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more</a><br>HashMap</p>\n<p>HashMap</p>\n<p>HashMap<br>hashmap  2. newCap = oldCap &lt;&lt; 1 Map<br><br>HashMap  tableloadFactor  <br>HashMap <br>HashMap  HashTableConcurrentHashMap <br>HashMap<br>HashMapLinkedMapTreeMap<br>HashMapTreeMap<br>HashMap(load factor)<br>HashMap  Map  hashcode </p>\n<p>JDK1.8  concurrentHashMap </p>\n<p><br><a href=\"http://guochenglai.com/2016/06/04/java-concurrent4-java-subsection-decompose/\" target=\"_blank\" rel=\"external\">http://guochenglai.com/2016/06/04/java-concurrent4-java-subsection-decompose/</a></p>\n<p> ExecutorService  runnabledead</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.importnew.com/26049.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/26049.html</a><br>ConcurrentHashMap</p>\n<p>JDK ConcurrentHashMap<br>concurrenthashmap</p>\n<p><a href=\"http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more\" target=\"_blank\" rel=\"external\">http://pettyandydog.com/2016/08/28/HashMap_infinite_loop/#more</a><br>HashMap</p>\n<p>HashMap</p>\n<p>HashMap<br>hashmap  2. newCap = oldCap &lt;&lt; 1 Map<br><br>HashMap  tableloadFactor  <br>HashMap <br>HashMap  HashTableConcurrentHashMap <br>HashMap<br>HashMapLinkedMapTreeMap<br>HashMapTreeMap<br>HashMap(load factor)<br>HashMap  Map  hashcode </p>\n<p>JDK1.8  concurrentHashMap </p>\n<p><br><a href=\"http://guochenglai.com/2016/06/04/java-concurrent4-java-subsection-decompose/\" target=\"_blank\" rel=\"external\">http://guochenglai.com/2016/06/04/java-concurrent4-java-subsection-decompose/</a></p>\n<p> ExecutorService  runnabledead</p>\n"},{"title":"Thread-FAQ","date":"2017-10-27T03:07:35.000Z","_content":"\n\n### TODO hexo new Thread-Poolize-thread\n\n```\n10\n\n10\n\n10\n\n4\n\n4\n\n14\n\n14410\n```\n\n\n### Executor\n\n``` java\nfinal void runWorker(Worker w) {\n    Thread wt = Thread.currentThread();\n    Runnable task = w.firstTask;\n    w.firstTask = null;\n    w.unlock(); // allow interrupts\n    boolean completedAbruptly = true;\n    try {\n        while (task != null || (task = getTask()) != null) {\n            w.lock();\n            // If pool is stopping, ensure thread is interrupted;\n            // if not, ensure thread is not interrupted.  This\n            // requires a recheck in second case to deal with\n            // shutdownNow race while clearing interrupt\n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                 (Thread.interrupted() &&\n                  runStateAtLeast(ctl.get(), STOP))) &&\n                !wt.isInterrupted())\n                wt.interrupt();\n            try {\n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    task.run();\n                } catch (RuntimeException x) {\n                    thrown = x; throw x;\n                } catch (Error x) {\n                    thrown = x; throw x;\n                } catch (Throwable x) {\n                    thrown = x; throw new Error(x);\n                } finally {\n                    afterExecute(task, thrown);\n                }\n            } finally {\n                task = null;\n                w.completedTasks++;\n                w.unlock();\n            }\n        }\n        completedAbruptly = false;\n    } finally {\n        processWorkerExit(w, completedAbruptly);\n    }\n}\n```\n\n### ExecutorServicesubmitexecute\n\n\n\n\n\n\n\n\nhttp://blog.csdn.net/zhandoushi1982/article/details/5506597\nCPU\n\n### ThreadLocal\n\n\n### Future\n\n\n### Promise\n\n### Difference between ReentrantLock and sync\n\n### join\n\n### yield\n\n### fork\n\n\n### Java\n\nReentrantLock\n\nsyncABmonitorAmonitorAB\n\nCopyOnWrite\n\n15Java\n\n1)T1T2T3T2T1T3T2\n\njoinjoin\n\n2)JavaLocksynchronized\n\nlockConcurrentHashMapJavaLocks\n\n3)javawaitsleep\n\nJavawaitsleepWaitsleep\n\n4Java\n\nJavawait()notify()Java 5\n\n5Java\n\nJava\n\n6Java\n\nJavadeadlock free codeNNn2Java\n\n7) Java\n\njava\n\n8) JavavolatileJavasynchronized\n\nJava 5Javavolatilevolatile\n\n9) \n\nJavajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java\n\n10) thread dumpThread dump\n\nUNIXkill -3thread dumpwindowsCTRL+Break\n\n11) start()run()run()\n\njavaJavastart()run()run()startrun\n\n12) Java\n\nIOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java\n\n13)JavaCycliBarriarCountdownLatch\n\nJDK5CyclicBarrierCountdownLatch\n\n14) \n\njavaString\n\n15) \n\nMemory-interfaceJava\n\nhttp://www.importnew.com/27105.html","source":"_posts/Thread-FAQ.md","raw":"---\ntitle: Thread-FAQ\ndate: 2017-10-27 11:07:35\ntags: THread\n---\n\n\n### TODO hexo new Thread-Poolize-thread\n\n```\n10\n\n10\n\n10\n\n4\n\n4\n\n14\n\n14410\n```\n\n\n### Executor\n\n``` java\nfinal void runWorker(Worker w) {\n    Thread wt = Thread.currentThread();\n    Runnable task = w.firstTask;\n    w.firstTask = null;\n    w.unlock(); // allow interrupts\n    boolean completedAbruptly = true;\n    try {\n        while (task != null || (task = getTask()) != null) {\n            w.lock();\n            // If pool is stopping, ensure thread is interrupted;\n            // if not, ensure thread is not interrupted.  This\n            // requires a recheck in second case to deal with\n            // shutdownNow race while clearing interrupt\n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                 (Thread.interrupted() &&\n                  runStateAtLeast(ctl.get(), STOP))) &&\n                !wt.isInterrupted())\n                wt.interrupt();\n            try {\n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    task.run();\n                } catch (RuntimeException x) {\n                    thrown = x; throw x;\n                } catch (Error x) {\n                    thrown = x; throw x;\n                } catch (Throwable x) {\n                    thrown = x; throw new Error(x);\n                } finally {\n                    afterExecute(task, thrown);\n                }\n            } finally {\n                task = null;\n                w.completedTasks++;\n                w.unlock();\n            }\n        }\n        completedAbruptly = false;\n    } finally {\n        processWorkerExit(w, completedAbruptly);\n    }\n}\n```\n\n### ExecutorServicesubmitexecute\n\n\n\n\n\n\n\n\nhttp://blog.csdn.net/zhandoushi1982/article/details/5506597\nCPU\n\n### ThreadLocal\n\n\n### Future\n\n\n### Promise\n\n### Difference between ReentrantLock and sync\n\n### join\n\n### yield\n\n### fork\n\n\n### Java\n\nReentrantLock\n\nsyncABmonitorAmonitorAB\n\nCopyOnWrite\n\n15Java\n\n1)T1T2T3T2T1T3T2\n\njoinjoin\n\n2)JavaLocksynchronized\n\nlockConcurrentHashMapJavaLocks\n\n3)javawaitsleep\n\nJavawaitsleepWaitsleep\n\n4Java\n\nJavawait()notify()Java 5\n\n5Java\n\nJava\n\n6Java\n\nJavadeadlock free codeNNn2Java\n\n7) Java\n\njava\n\n8) JavavolatileJavasynchronized\n\nJava 5Javavolatilevolatile\n\n9) \n\nJavajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java\n\n10) thread dumpThread dump\n\nUNIXkill -3thread dumpwindowsCTRL+Break\n\n11) start()run()run()\n\njavaJavastart()run()run()startrun\n\n12) Java\n\nIOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java\n\n13)JavaCycliBarriarCountdownLatch\n\nJDK5CyclicBarrierCountdownLatch\n\n14) \n\njavaString\n\n15) \n\nMemory-interfaceJava\n\nhttp://www.importnew.com/27105.html","slug":"Thread-FAQ","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszv003e3iq2f566n7t5","content":"<h3 id=\"TODO-hexo-new-Thread-Poolize-thread\"><a href=\"#TODO-hexo-new-Thread-Poolize-thread\" class=\"headerlink\" title=\"TODO hexo new Thread-Poolize-thread\"></a>TODO hexo new Thread-Poolize-thread</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">10</div><div class=\"line\"></div><div class=\"line\">10</div><div class=\"line\"></div><div class=\"line\">10</div><div class=\"line\"></div><div class=\"line\">4</div><div class=\"line\"></div><div class=\"line\">4</div><div class=\"line\"></div><div class=\"line\">14</div><div class=\"line\"></div><div class=\"line\">14410</div></pre></td></tr></table></figure>\n<h3 id=\"Executor\"><a href=\"#Executor\" class=\"headerlink\" title=\"Executor\"></a>Executor</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">runWorker</span><span class=\"params\">(Worker w)</span> </span>&#123;</div><div class=\"line\">    Thread wt = Thread.currentThread();</div><div class=\"line\">    Runnable task = w.firstTask;</div><div class=\"line\">    w.firstTask = <span class=\"keyword\">null</span>;</div><div class=\"line\">    w.unlock(); <span class=\"comment\">// allow interrupts</span></div><div class=\"line\">    <span class=\"keyword\">boolean</span> completedAbruptly = <span class=\"keyword\">true</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">while</span> (task != <span class=\"keyword\">null</span> || (task = getTask()) != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            w.lock();</div><div class=\"line\">            <span class=\"comment\">// If pool is stopping, ensure thread is interrupted;</span></div><div class=\"line\">            <span class=\"comment\">// if not, ensure thread is not interrupted.  This</span></div><div class=\"line\">            <span class=\"comment\">// requires a recheck in second case to deal with</span></div><div class=\"line\">            <span class=\"comment\">// shutdownNow race while clearing interrupt</span></div><div class=\"line\">            <span class=\"keyword\">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</div><div class=\"line\">                 (Thread.interrupted() &amp;&amp;</div><div class=\"line\">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</div><div class=\"line\">                !wt.isInterrupted())</div><div class=\"line\">                wt.interrupt();</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                beforeExecute(wt, task);</div><div class=\"line\">                Throwable thrown = <span class=\"keyword\">null</span>;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    task.run();</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (RuntimeException x) &#123;</div><div class=\"line\">                    thrown = x; <span class=\"keyword\">throw</span> x;</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Error x) &#123;</div><div class=\"line\">                    thrown = x; <span class=\"keyword\">throw</span> x;</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Throwable x) &#123;</div><div class=\"line\">                    thrown = x; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Error(x);</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    afterExecute(task, thrown);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                task = <span class=\"keyword\">null</span>;</div><div class=\"line\">                w.completedTasks++;</div><div class=\"line\">                w.unlock();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        completedAbruptly = <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        processWorkerExit(w, completedAbruptly);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"ExecutorServicesubmitexecute\"><a href=\"#ExecutorServicesubmitexecute\" class=\"headerlink\" title=\"ExecutorServicesubmitexecute\"></a>ExecutorServicesubmitexecute</h3><p><a href=\"http://blog.csdn.net/zhandoushi1982/article/details/5506597\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/zhandoushi1982/article/details/5506597</a><br>CPU</p>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h3><h3 id=\"Future\"><a href=\"#Future\" class=\"headerlink\" title=\"Future\"></a>Future</h3><h3 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h3><h3 id=\"Difference-between-ReentrantLock-and-sync\"><a href=\"#Difference-between-ReentrantLock-and-sync\" class=\"headerlink\" title=\"Difference between ReentrantLock and sync\"></a>Difference between ReentrantLock and sync</h3><h3 id=\"join\"><a href=\"#join\" class=\"headerlink\" title=\"join\"></a>join</h3><h3 id=\"yield\"><a href=\"#yield\" class=\"headerlink\" title=\"yield\"></a>yield</h3><h3 id=\"fork\"><a href=\"#fork\" class=\"headerlink\" title=\"fork\"></a>fork</h3><h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>ReentrantLock</p>\n<p>syncABmonitorAmonitorAB</p>\n<p>CopyOnWrite</p>\n<p>15Java</p>\n<p>1)T1T2T3T2T1T3T2</p>\n<p>joinjoin</p>\n<p>2)JavaLocksynchronized</p>\n<p>lockConcurrentHashMapJavaLocks</p>\n<p>3)javawaitsleep</p>\n<p>JavawaitsleepWaitsleep</p>\n<p>4Java</p>\n<p>Javawait()notify()Java 5</p>\n<p>5Java</p>\n<p>Java</p>\n<p>6Java</p>\n<p>Javadeadlock free codeNNn2Java</p>\n<p>7) Java</p>\n<p>java</p>\n<p>8) JavavolatileJavasynchronized</p>\n<p>Java 5Javavolatilevolatile</p>\n<p>9) </p>\n<p>Javajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java</p>\n<p>10) thread dumpThread dump</p>\n<p>UNIXkill -3thread dumpwindowsCTRL+Break</p>\n<p>11) start()run()run()</p>\n<p>javaJavastart()run()run()startrun</p>\n<p>12) Java</p>\n<p>IOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java</p>\n<p>13)JavaCycliBarriarCountdownLatch</p>\n<p>JDK5CyclicBarrierCountdownLatch</p>\n<p>14) </p>\n<p>javaString</p>\n<p>15) </p>\n<p>Memory-interfaceJava</p>\n<p><a href=\"http://www.importnew.com/27105.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/27105.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"TODO-hexo-new-Thread-Poolize-thread\"><a href=\"#TODO-hexo-new-Thread-Poolize-thread\" class=\"headerlink\" title=\"TODO hexo new Thread-Poolize-thread\"></a>TODO hexo new Thread-Poolize-thread</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">10</div><div class=\"line\"></div><div class=\"line\">10</div><div class=\"line\"></div><div class=\"line\">10</div><div class=\"line\"></div><div class=\"line\">4</div><div class=\"line\"></div><div class=\"line\">4</div><div class=\"line\"></div><div class=\"line\">14</div><div class=\"line\"></div><div class=\"line\">14410</div></pre></td></tr></table></figure>\n<h3 id=\"Executor\"><a href=\"#Executor\" class=\"headerlink\" title=\"Executor\"></a>Executor</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">runWorker</span><span class=\"params\">(Worker w)</span> </span>&#123;</div><div class=\"line\">    Thread wt = Thread.currentThread();</div><div class=\"line\">    Runnable task = w.firstTask;</div><div class=\"line\">    w.firstTask = <span class=\"keyword\">null</span>;</div><div class=\"line\">    w.unlock(); <span class=\"comment\">// allow interrupts</span></div><div class=\"line\">    <span class=\"keyword\">boolean</span> completedAbruptly = <span class=\"keyword\">true</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">while</span> (task != <span class=\"keyword\">null</span> || (task = getTask()) != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            w.lock();</div><div class=\"line\">            <span class=\"comment\">// If pool is stopping, ensure thread is interrupted;</span></div><div class=\"line\">            <span class=\"comment\">// if not, ensure thread is not interrupted.  This</span></div><div class=\"line\">            <span class=\"comment\">// requires a recheck in second case to deal with</span></div><div class=\"line\">            <span class=\"comment\">// shutdownNow race while clearing interrupt</span></div><div class=\"line\">            <span class=\"keyword\">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</div><div class=\"line\">                 (Thread.interrupted() &amp;&amp;</div><div class=\"line\">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</div><div class=\"line\">                !wt.isInterrupted())</div><div class=\"line\">                wt.interrupt();</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                beforeExecute(wt, task);</div><div class=\"line\">                Throwable thrown = <span class=\"keyword\">null</span>;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    task.run();</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (RuntimeException x) &#123;</div><div class=\"line\">                    thrown = x; <span class=\"keyword\">throw</span> x;</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Error x) &#123;</div><div class=\"line\">                    thrown = x; <span class=\"keyword\">throw</span> x;</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Throwable x) &#123;</div><div class=\"line\">                    thrown = x; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Error(x);</div><div class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                    afterExecute(task, thrown);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">                task = <span class=\"keyword\">null</span>;</div><div class=\"line\">                w.completedTasks++;</div><div class=\"line\">                w.unlock();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        completedAbruptly = <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        processWorkerExit(w, completedAbruptly);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"ExecutorServicesubmitexecute\"><a href=\"#ExecutorServicesubmitexecute\" class=\"headerlink\" title=\"ExecutorServicesubmitexecute\"></a>ExecutorServicesubmitexecute</h3><p><a href=\"http://blog.csdn.net/zhandoushi1982/article/details/5506597\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/zhandoushi1982/article/details/5506597</a><br>CPU</p>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h3><h3 id=\"Future\"><a href=\"#Future\" class=\"headerlink\" title=\"Future\"></a>Future</h3><h3 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h3><h3 id=\"Difference-between-ReentrantLock-and-sync\"><a href=\"#Difference-between-ReentrantLock-and-sync\" class=\"headerlink\" title=\"Difference between ReentrantLock and sync\"></a>Difference between ReentrantLock and sync</h3><h3 id=\"join\"><a href=\"#join\" class=\"headerlink\" title=\"join\"></a>join</h3><h3 id=\"yield\"><a href=\"#yield\" class=\"headerlink\" title=\"yield\"></a>yield</h3><h3 id=\"fork\"><a href=\"#fork\" class=\"headerlink\" title=\"fork\"></a>fork</h3><h3 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h3><p>ReentrantLock</p>\n<p>syncABmonitorAmonitorAB</p>\n<p>CopyOnWrite</p>\n<p>15Java</p>\n<p>1)T1T2T3T2T1T3T2</p>\n<p>joinjoin</p>\n<p>2)JavaLocksynchronized</p>\n<p>lockConcurrentHashMapJavaLocks</p>\n<p>3)javawaitsleep</p>\n<p>JavawaitsleepWaitsleep</p>\n<p>4Java</p>\n<p>Javawait()notify()Java 5</p>\n<p>5Java</p>\n<p>Java</p>\n<p>6Java</p>\n<p>Javadeadlock free codeNNn2Java</p>\n<p>7) Java</p>\n<p>java</p>\n<p>8) JavavolatileJavasynchronized</p>\n<p>Java 5Javavolatilevolatile</p>\n<p>9) </p>\n<p>Javajavaor writing code which is free of data race or any other race conditionConcurrency practices in Java</p>\n<p>10) thread dumpThread dump</p>\n<p>UNIXkill -3thread dumpwindowsCTRL+Break</p>\n<p>11) start()run()run()</p>\n<p>javaJavastart()run()run()startrun</p>\n<p>12) Java</p>\n<p>IOwait()sleep()join()InterruptedExceptionHow to deal with blocking methods in java</p>\n<p>13)JavaCycliBarriarCountdownLatch</p>\n<p>JDK5CyclicBarrierCountdownLatch</p>\n<p>14) </p>\n<p>javaString</p>\n<p>15) </p>\n<p>Memory-interfaceJava</p>\n<p><a href=\"http://www.importnew.com/27105.html\" target=\"_blank\" rel=\"external\">http://www.importnew.com/27105.html</a></p>\n"},{"title":"tree-cache-single-thread-event-handler-in-curator","date":"2017-09-20T07:32:22.000Z","_content":"\n\nGenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.\n\n``` java\nchannel.writeAndFlush(request).addListener(new ChannelFutureListener() {\n    @Override\n    public void operationComplete(ChannelFuture f) throws Exception {\n        if (f.isSuccess()) {\n            responseFuture.setSendRequestOK(true);\n            return;\n        } else {\n            responseFuture.setSendRequestOK(false);\n        }\n\n        responseTable.remove(opaque);\n        responseFuture.setCause(f.cause());\n        responseFuture.putResponse(null);\n        log.warn(\"send a request command to channel <\" + addr + \"> failed.\");\n    }\n});\n```","source":"_posts/tree-cache-single-thread-event-handler-in-curator.md","raw":"---\ntitle: tree-cache-single-thread-event-handler-in-curator\ndate: 2017-09-20 15:32:22\ntags: Curator\n---\n\n\nGenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.\n\n``` java\nchannel.writeAndFlush(request).addListener(new ChannelFutureListener() {\n    @Override\n    public void operationComplete(ChannelFuture f) throws Exception {\n        if (f.isSuccess()) {\n            responseFuture.setSendRequestOK(true);\n            return;\n        } else {\n            responseFuture.setSendRequestOK(false);\n        }\n\n        responseTable.remove(opaque);\n        responseFuture.setCause(f.cause());\n        responseFuture.putResponse(null);\n        log.warn(\"send a request command to channel <\" + addr + \"> failed.\");\n    }\n});\n```","slug":"tree-cache-single-thread-event-handler-in-curator","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszw003f3iq2p08iekn5","content":"<p>GenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">channel.writeAndFlush(request).addListener(<span class=\"keyword\">new</span> ChannelFutureListener() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operationComplete</span><span class=\"params\">(ChannelFuture f)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (f.isSuccess()) &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">true</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        responseTable.remove(opaque);</div><div class=\"line\">        responseFuture.setCause(f.cause());</div><div class=\"line\">        responseFuture.putResponse(<span class=\"keyword\">null</span>);</div><div class=\"line\">        log.warn(<span class=\"string\">\"send a request command to channel &lt;\"</span> + addr + <span class=\"string\">\"&gt; failed.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>GenericFutureListener.operationComplete(Future) is directly called by an I/O thread. Therefore, performing a time consuming task or a blocking operation in the handler method can cause an unexpected pause during I/O. If you need to perform a blocking operation on I/O completion, try to execute the operation in a different thread using a thread pool.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">channel.writeAndFlush(request).addListener(<span class=\"keyword\">new</span> ChannelFutureListener() &#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operationComplete</span><span class=\"params\">(ChannelFuture f)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (f.isSuccess()) &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">true</span>);</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            responseFuture.setSendRequestOK(<span class=\"keyword\">false</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        responseTable.remove(opaque);</div><div class=\"line\">        responseFuture.setCause(f.cause());</div><div class=\"line\">        responseFuture.putResponse(<span class=\"keyword\">null</span>);</div><div class=\"line\">        log.warn(<span class=\"string\">\"send a request command to channel &lt;\"</span> + addr + <span class=\"string\">\"&gt; failed.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>"},{"title":"TCP-Protocol-Analyzer","date":"2017-12-22T01:54:47.000Z","_content":"\nhttp://blog.csdn.net/q1007729991/article/details/70154359\n\n\n\n","source":"_posts/TCP-Protocol-Analyzer.md","raw":"---\ntitle: TCP-Protocol-Analyzer\ndate: 2017-12-22 09:54:47\ntags: TCP\n---\n\nhttp://blog.csdn.net/q1007729991/article/details/70154359\n\n\n\n","slug":"TCP-Protocol-Analyzer","published":1,"updated":"2018-03-06T08:21:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjj3wcszx003h3iq2k4wtfnjt","content":"<p><a href=\"http://blog.csdn.net/q1007729991/article/details/70154359\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/q1007729991/article/details/70154359</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://blog.csdn.net/q1007729991/article/details/70154359\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/q1007729991/article/details/70154359</a></p>\n"}],"PostAsset":[{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/abnormal.gif","slug":"abnormal.gif","post":"cjj3wcsxe00003iq2gzdelso7","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/normal.gif","slug":"normal.gif","post":"cjj3wcsxe00003iq2gzdelso7","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/after-cobar-driver.gif","slug":"after-cobar-driver.gif","post":"cjj3wcsxo00053iq26l3j2g45","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Enhance-cobar-driver-with-high-availability/before-cobar-driver.gif","slug":"before-cobar-driver.gif","post":"cjj3wcsxo00053iq26l3j2g45","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/datasource-swithch-with-zk-event-sender.gif","slug":"datasource-swithch-with-zk-event-sender.gif","post":"cjj3wcsxe00003iq2gzdelso7","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datahost.gif","slug":"datasource-on-datahost.gif","post":"cjj3wcsxm00043iq2c34i3z84","modified":0,"renderable":0},{"_id":"source/_posts/JVM-Lock/light_lock_flow.jpg","slug":"light_lock_flow.jpg","post":"cjj3wcsyv001d3iq2r9wnctq8","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/zk-distributed-lock.gif","slug":"zk-distributed-lock.gif","post":"cjj3wcsxe00003iq2gzdelso7","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Enhance-cobar-dataSource-with-dataHost/datasource-on-datanode.gif","slug":"datasource-on-datanode.gif","post":"cjj3wcsxm00043iq2c34i3z84","modified":0,"renderable":0},{"_id":"source/_posts/JVM-Lock/biased_lock_flow.jpg","slug":"biased_lock_flow.jpg","post":"cjj3wcsyv001d3iq2r9wnctq8","modified":0,"renderable":0},{"_id":"source/_posts/RocketMQ-Message-send-and-persistence/disc-fall.gif","slug":"disc-fall.gif","post":"cjj3wcszl002y3iq2nubws3qo","modified":0,"renderable":0},{"_id":"source/_posts/Distributed-Transaction/transaction_rocketmq.gif","slug":"transaction_rocketmq.gif","post":"cjj3wcsyp00103iq2ucqi5ypu","modified":0,"renderable":0},{"_id":"source/_posts/Netty-Jemalloc/jemalloc.jpg","slug":"jemalloc.jpg","post":"cjj3wcszc002g3iq23ojidxuk","modified":0,"renderable":0},{"_id":"source/_posts/RocketMQ-Index-service/index-file.gif","slug":"index-file.gif","post":"cjj3wcszh002q3iq23tzaootq","modified":0,"renderable":0},{"_id":"source/_posts/RocketMQ-Transactional-message/transaction_rocketmq.gif","slug":"transaction_rocketmq.gif","post":"cjj3wcszq00363iq287wvfb7q","modified":0,"renderable":0},{"_id":"source/_posts/TCP-Protocol-Analyzer/mySql-handshake.gif","slug":"mySql-handshake.gif","post":"cjj3wcszx003h3iq2k4wtfnjt","modified":0,"renderable":0},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/disk_read_write_speed.jpg","slug":"disk_read_write_speed.jpg","post":"cjj3wcsz2001s3iq2vlvq2mg0","modified":0,"renderable":0},{"_id":"source/_posts/Kafka-High-performance-design-with-pagecache/read_write.gif","slug":"read_write.gif","post":"cjj3wcsz2001s3iq2vlvq2mg0","modified":0,"renderable":0},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeAsync.png","slug":"invokeAsync.png","post":"cjj3wcszk002v3iq20wk995eu","modified":0,"renderable":0},{"_id":"source/_posts/RocketMQ-Netty-imp-sync-and-async-invoke/invokeSync.png","slug":"invokeSync.png","post":"cjj3wcszk002v3iq20wk995eu","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Database-Scales/backup-and-replay.gif","slug":"backup-and-replay.gif","post":"cjj3wcsxi00023iq2zuhv730g","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Database-Scales/binlog-sync.gif","slug":"binlog-sync.gif","post":"cjj3wcsxi00023iq2zuhv730g","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Database-Scales/cobar-rule-reload.gif","slug":"cobar-rule-reload.gif","post":"cjj3wcsxi00023iq2zuhv730g","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactor.gif","slug":"CobarReactor.gif","post":"cjj3wcsyb000m3iq28hisx8ou","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Reactor-design-pattern/CobarReactorSign.gif","slug":"CobarReactorSign.gif","post":"cjj3wcsyb000m3iq28hisx8ou","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioRegister.gif","slug":"NioRegister.gif","post":"cjj3wcsyb000m3iq28hisx8ou","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Reactor-design-pattern/NioSign.gif","slug":"NioSign.gif","post":"cjj3wcsyb000m3iq28hisx8ou","modified":0,"renderable":0},{"_id":"source/_posts/JVM-Lock/biased_lock_convert_flow.jpg","slug":"biased_lock_convert_flow.jpg","post":"cjj3wcsyv001d3iq2r9wnctq8","modified":0,"renderable":0},{"_id":"source/_posts/JVM-Lock/markword_state.jpg","slug":"markword_state.jpg","post":"cjj3wcsyv001d3iq2r9wnctq8","modified":0,"renderable":0},{"_id":"source/_posts/Cobar-Cluster-datasource-switch-design-with-distributed-lock/sign.gif","slug":"sign.gif","post":"cjj3wcsxe00003iq2gzdelso7","modified":0,"renderable":0}],"PostCategory":[],"PostTag":[{"post_id":"cjj3wcsxo00053iq26l3j2g45","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsxt00083iq2hma8loh3"},{"post_id":"cjj3wcsxe00003iq2gzdelso7","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsxw000a3iq20dptr55l"},{"post_id":"cjj3wcsxq00063iq2xthrhv0u","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsy3000d3iq24p6oi1dk"},{"post_id":"cjj3wcsxu00093iq2dca6d2bp","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsy5000f3iq2wu68ezmx"},{"post_id":"cjj3wcsxi00023iq2zuhv730g","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsy9000h3iq2u59iqzij"},{"post_id":"cjj3wcsxx000b3iq2t3uuz87t","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsya000j3iq2h6bwmter"},{"post_id":"cjj3wcsy3000e3iq29fsbo0i0","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsyb000l3iq2lezk3enn"},{"post_id":"cjj3wcsxm00043iq2c34i3z84","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsyc000n3iq2z32r1dk6"},{"post_id":"cjj3wcsy6000g3iq212o4z0ne","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsyd000p3iq2tejgqj56"},{"post_id":"cjj3wcsy9000i3iq27zsf12m1","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsye000s3iq2ejtkywnl"},{"post_id":"cjj3wcsya000k3iq2rwljv25y","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsyf000u3iq2zkcuey87"},{"post_id":"cjj3wcsyb000m3iq28hisx8ou","tag_id":"cjj3wcsxk00033iq2xnwmdf1r","_id":"cjj3wcsyf000w3iq2rud9ii53"},{"post_id":"cjj3wcsyc000o3iq2moo800ti","tag_id":"cjj3wcsye000r3iq2x00h70fn","_id":"cjj3wcsyp000z3iq2ye1828aj"},{"post_id":"cjj3wcsyd000q3iq2b0608ezy","tag_id":"cjj3wcsyp000y3iq22x7yn21p","_id":"cjj3wcsys00143iq2fqfu7813"},{"post_id":"cjj3wcsye000t3iq2wdmff3j6","tag_id":"cjj3wcsye000r3iq2x00h70fn","_id":"cjj3wcsyt00183iq2a00wj1jb"},{"post_id":"cjj3wcsyf000v3iq2br47vxag","tag_id":"cjj3wcsys00163iq2jq3idxll","_id":"cjj3wcsyv001c3iq2c646fpkl"},{"post_id":"cjj3wcsyg000x3iq2dj9yykcq","tag_id":"cjj3wcsyu001a3iq2onvj0k57","_id":"cjj3wcsyx001g3iq2frwva4un"},{"post_id":"cjj3wcsyp00103iq2ucqi5ypu","tag_id":"cjj3wcsys00163iq2jq3idxll","_id":"cjj3wcsyy001k3iq2ex4i0ida"},{"post_id":"cjj3wcsyq00113iq2fhmdjdlq","tag_id":"cjj3wcsyy001i3iq24hxopdil","_id":"cjj3wcsz0001o3iq2uytnx6bb"},{"post_id":"cjj3wcsyr00133iq28ruqmiy5","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcsz2001t3iq2qlj740ue"},{"post_id":"cjj3wcsys00153iq2y5swmh97","tag_id":"cjj3wcsz1001r3iq2xuv5a8t5","_id":"cjj3wcsz4001x3iq27mdjbkr4"},{"post_id":"cjj3wcsyt00173iq2d9knarfl","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcsz600213iq2djkecgaw"},{"post_id":"cjj3wcsyv001d3iq2r9wnctq8","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcsz800253iq21mlleayn"},{"post_id":"cjj3wcsyw001f3iq2bm65fbv1","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcsza00293iq2c96rjg2n"},{"post_id":"cjj3wcsyx001h3iq236xbkaoq","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcszb002d3iq26hlno5zg"},{"post_id":"cjj3wcsyy001j3iq2svsv8eib","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcszd002h3iq28y6zr2l4"},{"post_id":"cjj3wcsyz001l3iq2xv0kkf5u","tag_id":"cjj3wcsz0001n3iq2z3l8gbxd","_id":"cjj3wcszf002l3iq21qfdtou4"},{"post_id":"cjj3wcsyz001m3iq22f2w8ej8","tag_id":"cjj3wcsze002j3iq2bdgzao49","_id":"cjj3wcszh002p3iq24jmisnrb"},{"post_id":"cjj3wcsz0001p3iq2blqyektp","tag_id":"cjj3wcszg002n3iq2ymjgvnwa","_id":"cjj3wcszj002t3iq24visqgef"},{"post_id":"cjj3wcsz1001q3iq277vqqfxa","tag_id":"cjj3wcszg002n3iq2ymjgvnwa","_id":"cjj3wcszl002x3iq2t6g2b0bj"},{"post_id":"cjj3wcsz2001s3iq2vlvq2mg0","tag_id":"cjj3wcsze002j3iq2bdgzao49","_id":"cjj3wcszo00313iq2uyxlrhwo"},{"post_id":"cjj3wcsz2001u3iq25sb2tc7q","tag_id":"cjj3wcszg002n3iq2ymjgvnwa","_id":"cjj3wcszq00353iq2zty5hzge"},{"post_id":"cjj3wcsz4001w3iq2ekv8tzku","tag_id":"cjj3wcszg002n3iq2ymjgvnwa","_id":"cjj3wcszs00393iq2j3gkjtzx"},{"post_id":"cjj3wcsz4001y3iq21upnlcfx","tag_id":"cjj3wcszg002n3iq2ymjgvnwa","_id":"cjj3wcszv003d3iq22hyi0rb7"},{"post_id":"cjj3wcsz600203iq26rajsf3m","tag_id":"cjj3wcszu003c3iq2m5u7eg52","_id":"cjj3wcszx003i3iq2tlgeox2g"},{"post_id":"cjj3wcszw003f3iq2p08iekn5","tag_id":"cjj3wcsye000r3iq2x00h70fn","_id":"cjj3wcszx003j3iq2yj434epd"},{"post_id":"cjj3wcsz600223iq21j7hapdn","tag_id":"cjj3wcszw003g3iq2ckk9vng7","_id":"cjj3wcszy003l3iq24hslts05"},{"post_id":"cjj3wcsz700243iq2rifp8qvr","tag_id":"cjj3wcszw003g3iq2ckk9vng7","_id":"cjj3wcszy003n3iq2kkn5jr6i"},{"post_id":"cjj3wcsz900283iq2sa3t8x1m","tag_id":"cjj3wcszw003g3iq2ckk9vng7","_id":"cjj3wcszz003p3iq2fhpwygfn"},{"post_id":"cjj3wcsza002a3iq29m143btj","tag_id":"cjj3wcszw003g3iq2ckk9vng7","_id":"cjj3wcszz003r3iq28c7ll772"},{"post_id":"cjj3wcszb002e3iq2xb0uzft0","tag_id":"cjj3wcszw003g3iq2ckk9vng7","_id":"cjj3wct01003t3iq2dtwbomb4"},{"post_id":"cjj3wcszc002g3iq23ojidxuk","tag_id":"cjj3wcszw003g3iq2ckk9vng7","_id":"cjj3wct01003v3iq239vp9muy"},{"post_id":"cjj3wcsze002k3iq2vee6r50k","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct02003x3iq2rp793yxh"},{"post_id":"cjj3wcszf002m3iq2kg8i6lo9","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct02003z3iq2intnz53n"},{"post_id":"cjj3wcszg002o3iq2fon5c2qo","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct0300413iq25ro5qcnc"},{"post_id":"cjj3wcszh002q3iq23tzaootq","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct0300433iq2df8w3qxm"},{"post_id":"cjj3wcszi002r3iq29xlel3d5","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct0400453iq2lchxdws4"},{"post_id":"cjj3wcszj002u3iq2qxnyww2i","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct0400473iq2cls2yuun"},{"post_id":"cjj3wcszk002v3iq20wk995eu","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct0400493iq27e6hnp9y"},{"post_id":"cjj3wcszl002y3iq2nubws3qo","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct05004b3iq2f2vo5ay5"},{"post_id":"cjj3wcszm002z3iq2i3szvgv4","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct05004d3iq2e1b9kana"},{"post_id":"cjj3wcszo00323iq2s7omtwei","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct06004f3iq20ow0dd8h"},{"post_id":"cjj3wcszp00333iq2rvy6nca8","tag_id":"cjj3wct06004e3iq2i5vo2hsf","_id":"cjj3wct06004h3iq2xjs2vtjy"},{"post_id":"cjj3wcszq00363iq287wvfb7q","tag_id":"cjj3wct01003u3iq2x96hq97e","_id":"cjj3wct07004j3iq242gr8exm"},{"post_id":"cjj3wcszr00373iq2l573mnlh","tag_id":"cjj3wct06004i3iq2pj41vdwk","_id":"cjj3wct08004l3iq231bo0ywq"},{"post_id":"cjj3wcszs003a3iq2ehvny98o","tag_id":"cjj3wct06004i3iq2pj41vdwk","_id":"cjj3wct08004n3iq2pkgy8h3l"},{"post_id":"cjj3wcszt003b3iq24ls47zc7","tag_id":"cjj3wct06004i3iq2pj41vdwk","_id":"cjj3wct08004p3iq26purhysj"},{"post_id":"cjj3wcszv003e3iq2f566n7t5","tag_id":"cjj3wct08004o3iq2vlbl8ihe","_id":"cjj3wct09004r3iq2u3tcqdwu"},{"post_id":"cjj3wcszx003h3iq2k4wtfnjt","tag_id":"cjj3wct09004q3iq2cw8gl033","_id":"cjj3wct09004s3iq2yh81u8pp"}],"Tag":[{"name":"Cobar","_id":"cjj3wcsxk00033iq2xnwmdf1r"},{"name":"Curator","_id":"cjj3wcsye000r3iq2x00h70fn"},{"name":"Raft","_id":"cjj3wcsyp000y3iq22x7yn21p"},{"name":"","_id":"cjj3wcsys00163iq2jq3idxll"},{"name":"","_id":"cjj3wcsyu001a3iq2onvj0k57"},{"name":"Guava","_id":"cjj3wcsyy001i3iq24hxopdil"},{"name":"JVM","_id":"cjj3wcsz0001n3iq2z3l8gbxd"},{"name":"","_id":"cjj3wcsz1001r3iq2xuv5a8t5"},{"name":"Kafka","_id":"cjj3wcsze002j3iq2bdgzao49"},{"name":"Linux","_id":"cjj3wcszg002n3iq2ymjgvnwa"},{"name":"MySQL","_id":"cjj3wcszu003c3iq2m5u7eg52"},{"name":"Netty","_id":"cjj3wcszw003g3iq2ckk9vng7"},{"name":"RocketMQ","_id":"cjj3wct01003u3iq2x96hq97e"},{"name":"","_id":"cjj3wct06004e3iq2i5vo2hsf"},{"name":"","_id":"cjj3wct06004i3iq2pj41vdwk"},{"name":"THread","_id":"cjj3wct08004o3iq2vlbl8ihe"},{"name":"TCP","_id":"cjj3wct09004q3iq2cw8gl033"}]}}